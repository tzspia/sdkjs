/*
 * (c) Copyright Ascensio System SIA 2010-2025
 *
 * This program is a free software product. You can redistribute it and/or
 * modify it under the terms of the GNU Affero General Public License (AGPL)
 * version 3 as published by the Free Software Foundation. In accordance with
 * Section 7(a) of the GNU AGPL its Section 15 shall be amended to the effect
 * that Ascensio System SIA expressly excludes the warranty of non-infringement
 * of any third-party rights.
 *
 * This program is distributed WITHOUT ANY WARRANTY; without even the implied
 * warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR  PURPOSE. For
 * details, see the GNU AGPL at: http://www.gnu.org/licenses/agpl-3.0.html
 *
 * You can contact Ascensio System SIA at 20A-6 Ernesta Birznieka-Upish
 * street, Riga, Latvia, EU, LV-1050.
 *
 * The  interactive user interfaces in modified source and object code versions
 * of the Program must display Appropriate Legal Notices, as required under
 * Section 5 of the GNU AGPL version 3.
 *
 * Pursuant to Section 7(b) of the License you must retain the original Product
 * logo when distributing the program. Pursuant to Section 7(e) we decline to
 * grant you any rights under trademark law for use of our trademarks.
 *
 * All the Product's GUI elements, including illustrations and icon sets, as
 * well as technical writing content are licensed under the terms of the
 * Creative Commons Attribution-ShareAlike 4.0 International. See the License
 * terms at http://creativecommons.org/licenses/by-sa/4.0/legalcode
 *
 */


$(function () {
	// Mocks for API Testing
	Asc.spreadsheet_api.prototype._init = function () {
		this._loadModules();
	};
	Asc.spreadsheet_api.prototype._loadFonts = function (fonts, callback) {
		callback();
	};
	AscCommonExcel.WorkbookView.prototype._calcMaxDigitWidth = function () {
	};
	AscCommonExcel.WorkbookView.prototype._init = function () {
	};
	AscCommonExcel.WorkbookView.prototype._isLockedUserProtectedRange = function (callback) {
		callback(true);
	};
	AscCommonExcel.WorkbookView.prototype._onWSSelectionChanged = function () {
	};
	AscCommonExcel.WorkbookView.prototype.showWorksheet = function () {
	};
	AscCommonExcel.WorkbookView.prototype.recalculateDrawingObjects = function () {
	};
	AscCommonExcel.WorkbookView.prototype.restoreFocus = function () {
	};
	AscCommonExcel.WorksheetView.prototype._init = function () {
	};
	AscCommonExcel.WorksheetView.prototype.updateRanges = function () {
	};
	AscCommonExcel.WorksheetView.prototype._autoFitColumnsWidth = function () {
	};
	AscCommonExcel.WorksheetView.prototype.cleanSelection = function () {
	};
	AscCommonExcel.WorksheetView.prototype._drawSelection = function () {
	};
	AscCommonExcel.WorksheetView.prototype._scrollToRange = function () {
	};
	AscCommonExcel.WorksheetView.prototype.draw = function () {
	};
	AscCommonExcel.WorksheetView.prototype._prepareDrawingObjects = function () {
	};
	AscCommonExcel.WorksheetView.prototype._initCellsArea = function () {
	};
	AscCommonExcel.WorksheetView.prototype.getZoom = function () {
	};
	AscCommonExcel.WorksheetView.prototype._prepareCellTextMetricsCache = function () {
	};

	AscCommon.baseEditorsApi.prototype._onEndLoadSdk = function () {
	};

	AscCommon.baseEditorsApi.prototype._onEndLoadSdk = function () {
	};
	Asc.ReadDefTableStyles = function () {
	};
	AscCommonExcel.WorksheetView.prototype._isLockedCells = function (oFromRange, subType, callback) {
		callback(true);
		return true;
	};
	AscCommonExcel.WorksheetView.prototype._isLockedAll = function (callback) {
		callback(true);
	};
	AscCommonExcel.WorksheetView.prototype._isLockedFrozenPane = function (callback) {
		callback(true);
	};
	AscCommonExcel.WorksheetView.prototype._updateVisibleColsCount = function () {
	};
	AscCommonExcel.WorksheetView.prototype._calcActiveCellOffset = function () {
	};

	// Init basic data
	const parserFormula = AscCommonExcel.parserFormula;
	const g_oIdCounter = AscCommon.g_oIdCounter;
	let oParser, wb, ws, sData = AscCommon.getEmpty(), tmp;
	if (AscCommon.c_oSerFormat.Signature === sData.substring(0, AscCommon.c_oSerFormat.Signature.length)) {

		Asc.spreadsheet_api.prototype._init = function() {
			this.isLoadFullApi = true;
		};


		let api = new Asc.spreadsheet_api({
			'id-view': 'editor_sdk'
		});
		api.FontLoader = {
			LoadDocumentFonts: function () {
			}
		};

		let docInfo = new Asc.asc_CDocInfo();
		docInfo.asc_putTitle("TeSt.xlsx");
		api.DocInfo = docInfo;


		window["Asc"]["editor"] = api;
		AscCommon.g_oTableId.init(api);
		api._onEndLoadSdk();
		api.isOpenOOXInBrowser = false;
		api.OpenDocumentFromBin(null, AscCommon.getEmpty());
		api.initCollaborativeEditing({});
		wb = new AscCommonExcel.Workbook(new AscCommonExcel.asc_CHandlersList(), api, true);
		api.wbModel = wb;
		api.wb = new AscCommonExcel.WorkbookView(api.wbModel, api.controller, api.handlers, api.HtmlElement,
			api.topLineEditorElement, api, api.collaborativeEditing, api.fontRenderingMode);
		AscCommon.History.init(wb);
		// There is no operation with history, disabled to avoid unnecessary serializations.
		AscCommon.History.TurnOff();
		wb.maxDigitWidth = 7;
		wb.paddingPlusBorder = 5;

		api.initCollaborativeEditing({});

		if (this.User) {
			g_oIdCounter.Set_UserId(this.User.asc_getId());
		}

		AscCommonExcel.g_oUndoRedoCell = new AscCommonExcel.UndoRedoCell(wb);
		AscCommonExcel.g_oUndoRedoWorksheet = new AscCommonExcel.UndoRedoWoorksheet(wb);
		AscCommonExcel.g_oUndoRedoWorkbook = new AscCommonExcel.UndoRedoWorkbook(wb);
		AscCommonExcel.g_oUndoRedoCol = new AscCommonExcel.UndoRedoRowCol(wb, false);
		AscCommonExcel.g_oUndoRedoRow = new AscCommonExcel.UndoRedoRowCol(wb, true);
		AscCommonExcel.g_oUndoRedoComment = new AscCommonExcel.UndoRedoComment(wb);
		AscCommonExcel.g_oUndoRedoAutoFilters = new AscCommonExcel.UndoRedoAutoFilters(wb);
		AscCommonExcel.g_DefNameWorksheet = new AscCommonExcel.Worksheet(wb, -1);
		g_oIdCounter.Set_Load(false);

		const oBinaryFileReader = new AscCommonExcel.BinaryFileReader();
		oBinaryFileReader.Read(sData, wb);
		ws = wb.getWorksheet(wb.getActive());
		AscCommonExcel.getFormulasInfo();
	}

	// Init basic functions
	function testArrayFormula(assert, func, dNotSupportAreaArg) {

		const getValue = function (ref) {
			oParser = new parserFormula(func + "(" + ref + ")", "A2", ws);
			assert.ok(oParser.parse(), 'Formula is parsed');
			return oParser.calculate().getValue();
		};
		const description = `Test: testArrayFormula. ${func}. `;

		//***array-formula***
		ws.getRange2("A100").setValue("1");
		ws.getRange2("B100").setValue("3");
		ws.getRange2("C100").setValue("-4");
		ws.getRange2("A101").setValue("2");
		ws.getRange2("B101").setValue("4");
		ws.getRange2("C101").setValue("5");


		oParser = new parserFormula(func + "(A100:C101)", "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("E106:H107").bbox);
		assert.ok(oParser.parse(), 'Formula is parsed.');
		let array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), getValue("A100"), description + 'Reference Link. Area.');
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), getValue("B100"), description + 'Reference Link. Area.');
			assert.strictEqual(array.getElementRowCol(0, 2).getValue(), getValue("C100"), description + 'Reference Link. Area.');
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), getValue("A101"), description + 'Reference Link. Area.');
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), getValue("B101"), description + 'Reference Link. Area.');
			assert.strictEqual(array.getElementRowCol(1, 2).getValue(), getValue("C101"), description + 'Reference Link. Area.');
		} else {
			if (!dNotSupportAreaArg) {
				assert.strictEqual(false, true, 'func: ' + func + ' don\'t support area argument.');
			}
			//consoleLog("func: " + func + " don't return area array");
		}

		oParser = new parserFormula(func + "({1,2,-3})", "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("E106:H107").bbox);
		assert.ok(oParser.parse(), 'Formula is parsed.');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), getValue(1), description + 'Number.');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), getValue(2), description + 'Number.');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), getValue(-3), description + 'Number.');
	}
	//returnOnlyValue - those functions that must always be fed arrays as input and that return a single value
	function testArrayFormula2(assert, func, minArgCount, maxArgCount, dNotSupportAreaArg, returnOnlyValue) {

		const getValue = function (ref, countArg) {
			let argStr = "(";
			for (let j = 1; j <= countArg; j++) {
				argStr += ref;
				if (i !== j) {
					argStr += ",";
				} else {
					argStr += ")";
				}
			}
			oParser = new parserFormula(func + argStr, "A2", ws);
			assert.ok(oParser.parse(), 'Test: Formula ' + func + argStr + ' is parsed.');
			return oParser.calculate().getValue();
		};


		//***array-formula***
		ws.getRange2("A100").setValue("1");
		ws.getRange2("B100").setValue("3");
		ws.getRange2("C100").setValue("-4");
		ws.getRange2("A101").setValue("2");
		ws.getRange2("B101").setValue("4");
		ws.getRange2("C101").setValue("5");

		//формируем массив значений
		const randomArray = [];
		let randomStrArray = "{";
		let maxArg = 4;
		for (let i = 1; i <= maxArg; i++) {
			let randVal = Math.random();
			randomArray.push(randVal);
			randomStrArray += randVal;
			if (i !== maxArg) {
				randomStrArray += ",";
			} else {
				randomStrArray += "}";
			}
		}

		for (var i = minArgCount; i <= maxArgCount; i++) {
			let argStrArr = "(";
			let randomArgStrArr = "(";
			for (let j = 1; j <= i; j++) {
				argStrArr += "A100:C101";
				randomArgStrArr += randomStrArray;
				if (i !== j) {
					argStrArr += ",";
					randomArgStrArr += ",";
				} else {
					argStrArr += ")";
					randomArgStrArr += ")";
				}
			}

			oParser = new parserFormula(func + argStrArr, "A1", ws);
			oParser.setArrayFormulaRef(ws.getRange2("E106:H107").bbox);
			assert.ok(oParser.parse(), 'Test: Formula ' + func + argStrArr + ' is parsed.');
			let array = oParser.calculate();
			if (AscCommonExcel.cElementType.array === array.type) {
				assert.strictEqual(array.getElementRowCol(0, 0).getValue(), getValue("A100", i), 'Test: testArrayFormula2. Area.');
				assert.strictEqual(array.getElementRowCol(0, 1).getValue(), getValue("B100", i), 'Test: testArrayFormula2. Area.');
				assert.strictEqual(array.getElementRowCol(0, 2).getValue(), getValue("C100", i), 'Test: testArrayFormula2. Area.');
				assert.strictEqual(array.getElementRowCol(1, 0).getValue(), getValue("A101", i), 'Test: testArrayFormula2. Area.');
				assert.strictEqual(array.getElementRowCol(1, 1).getValue(), getValue("B101", i), 'Test: testArrayFormula2. Area.');
				assert.strictEqual(array.getElementRowCol(1, 2).getValue(), getValue("C101", i), 'Test: testArrayFormula2. Area.');
			} else {
				if (!(dNotSupportAreaArg || returnOnlyValue)) {
					assert.strictEqual(false, true);
				}
				//consoleLog("func: " + func + " don't return area array");
			}

			oParser = new parserFormula(func + randomArgStrArr, "A1", ws);
			oParser.setArrayFormulaRef(ws.getRange2("E106:H107").bbox);
			assert.ok(oParser.parse(), 'Test: Formula ' + func + randomArgStrArr + ' is parsed.');
			array = oParser.calculate();
			if (AscCommonExcel.cElementType.array === array.type) {
				assert.strictEqual(array.getElementRowCol(0, 0).getValue(), getValue(randomArray[0], i), 'Test: testArrayFormula2. Random array');
				assert.strictEqual(array.getElementRowCol(0, 1).getValue(), getValue(randomArray[1], i), 'Test: testArrayFormula2. Random array');
				assert.strictEqual(array.getElementRowCol(0, 2).getValue(), getValue(randomArray[2], i), 'Test: testArrayFormula2. Random array');
			} else {
				if (!returnOnlyValue) {
					assert.strictEqual(false, true);
				}
				//consoleLog("func: " + func + " don't return array");
			}
		}
	}

    	function testArrayFormulaEqualsValues(assert, str, formula, isNotLowerCase) {
		//***array-formula***
		ws.getRange2("A1").setValue("1");
		ws.getRange2("B1").setValue("3.123");
		ws.getRange2("C1").setValue("-4");
		ws.getRange2("A2").setValue("2");
		ws.getRange2("B2").setValue("4");
		ws.getRange2("C2").setValue("5");

		oParser = new parserFormula(formula, "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("E6:H8").bbox);
		assert.ok(oParser.parse());
		var array = oParser.calculate();

		var splitStr = str.split(";");

		for (var i = 0; i < splitStr.length; i++) {
			var subSplitStr = splitStr[i].split(",");
			for (var j = 0; j < subSplitStr.length; j++) {
				var valMs = subSplitStr[j];
				var element;
				if (array.getElementRowCol) {
					var row = 1 === array.array.length ? 0 : i;
					var col = 1 === array.array[0].length ? 0 : j;
					if (array.array[row] && array.array[row][col]) {
						element = array.getElementRowCol(row, col);
					} else {
						element = new window['AscCommonExcel'].cError(window['AscCommonExcel'].cErrorType.not_available);
					}
				} else {
					element = array;
				}
				var ourVal = element && undefined != element.value ? element.value.toString() : "#N/A";
				if (!isNotLowerCase) {
					valMs = valMs.toLowerCase();
					ourVal = ourVal.toLowerCase();
				}
				assert.strictEqual(valMs, ourVal, "formula: " + formula + " i: " + i + " j: " + j)
			}
		}
	}
	/**
	 * Function creates table or edit existed table.
	 * * Creating happened when the function was called for the first time in the code totally.
	 * In that case, you should set range coordinates like you're creating table, select needed range.
	 * * For editing table you should consider that you have constant row with header and one data row as minimum required.
	 * In that case your minimum row coordinates must be equal 2 rows.
	 * For filling data use cells A601:L6**
	 * @param {number} r1
	 * @param {number} c1
	 * @param {number} r2
	 * @param {number} c2
	 * @returns {TablePart}
	 */
	function getTableType(r1, c1, r2, c2) {
		const range = new window["Asc"].Range(c1, r1, c2, r2);
		const  tableName = 'Table1';
		const tableParts = ws.TableParts;
		/** @type {TablePart} */
		const foundedTable = tableParts.find(function(table) { return table.DisplayName === tableName});
		if (foundedTable) {
			// Change table
			ws.autoFilters.changeTableRange(tableName, range);
			return foundedTable;
		}
		// Create table
		const tableOptFormat = ws.autoFilters.getAddFormatTableOptions(range);
		const styleName = 'TableStyleMedium2';
		ws.autoFilters.addAutoFilter(styleName, range, tableOptFormat);

		return tableParts[tableParts.length - 1]
	}
	function getSecondSheet () {
		let ws2 = wb.getWorksheetByName('Sheet2');
		if (!ws2) {
			ws2 = wb.createWorksheet(null, 'Sheet2');
		}

		return ws2;
	}
	function initDefNames() {
		const defName = new Asc.asc_CDefName('TestName', ws.getName() + '!$A$201');
		const defName2 = new Asc.asc_CDefName('TestName1', ws.getName() + '!$A$202');
		const defName3 = new Asc.asc_CDefName('TestName2', ws.getName() + '!$A$203');
		const defName4 = new Asc.asc_CDefName('TestName3', ws.getName() + '!$A$204');
		const defName5 = new Asc.asc_CDefName('TestName4', ws.getName() + '!$A$205');
		const defNameArea = new Asc.asc_CDefName('TestNameArea', ws.getName() + '!$A$206:$A$207');
		const defNameArea2 = new Asc.asc_CDefName('TestNameArea2', ws.getName() + '!$A$208:$B$208');
		const ws2 = getSecondSheet();
		const defName3D = new Asc.asc_CDefName('TestName3D', ws2.getName() + '!$A$11');
		const defName3D2 = new Asc.asc_CDefName('TestName3D1', ws2.getName() + '!$A$12');
		const defName3D3 = new Asc.asc_CDefName('TestName3D2', ws2.getName() + '!$A$13');
		const defName3D4 = new Asc.asc_CDefName('TestName3D3', ws2.getName() + '!$A$14');
		const defName3D5 = new Asc.asc_CDefName('TestName3D4', ws2.getName() + '!$A$15');
		const defNameArea3D = new Asc.asc_CDefName('TestNameArea3D', ws2.getName() + '!$A$16:$A$17');
		const defNameArea3D2 = new Asc.asc_CDefName('TestNameArea3D2', ws2.getName() + '!$A$18:$B$18');

		wb.editDefinesNames(null, defName);
		wb.editDefinesNames(null, defName2);
		wb.editDefinesNames(null, defName3);
		wb.editDefinesNames(null, defName4);
		wb.editDefinesNames(null, defName5);
		wb.editDefinesNames(null, defNameArea);
		wb.editDefinesNames(null, defNameArea2);
		wb.editDefinesNames(null, defName3D);
		wb.editDefinesNames(null, defName3D2);
		wb.editDefinesNames(null, defName3D3);
		wb.editDefinesNames(null, defName3D4);
		wb.editDefinesNames(null, defName3D5);
		wb.editDefinesNames(null, defNameArea3D);
		wb.editDefinesNames(null, defNameArea3D2);
	}

	wb.dependencyFormulas.lockRecal();
	getTableType(599, 0, 599, 0); // Init table
	initDefNames();

	QUnit.module('Lookup and reference formulas');

	QUnit.test("Test: \"ADDRESS\"", function (assert) {
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("");
		ws.getRange2("A101").setValue("'");
		ws.getRange2("A102").setValue("2");
		ws.getRange2("A103").setValue("3");
		ws.getRange2("A104").setValue("0");
		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 2);
		ws.getRange2("A601").setValue("20"); // Column1
		ws.getRange2("B601").setValue("25"); // Column2
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("1");
		// DefNames. Use A201-A208, B208
		ws.getRange2("A201").setValue("4"); // TestName
		ws.getRange2("A202").setValue("1"); // TestName1
		ws.getRange2("A208").setValue("0"); // TestNameArea2
		ws.getRange2("B208").setValue(""); // TestNameArea2
		// DefNames 3D. Use A11-A18, B18
		ws2.getRange2("A11").setValue("10") // TestName3D
		ws2.getRange2("A12").setValue("15") // TestName3D1

		// Positive cases:

		// Case #1: Number(3). Row and col - number (2;3), abs_num - 2. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'C$2', 'Test: Positive case: Number(3). Row and col - number (2;3), abs_num - 2. 3 of 5 arguments used.');
		// Case #2: Number(3), Boolean. Row and col - number (2;3), abs_num (opt) - 2, A1 (opt) - boolean (FALSE) . 4 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,2,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,2,FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'R2C[3]', 'Test: Positive case: Number(3), Boolean. Row and col - number (2;3), abs_num (opt) - 2, A1 (opt) - boolean (FALSE) . 4 of 5 arguments used.');
		// Case #3: Number(3), Boolean, String. Row and col - number (2;3), abs_num (opt) - 1, A1 (opt) - boolean (FALSE), sheet text (opt) - string . 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,1,FALSE,"[Book1]Sheet1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,1,FALSE,"[Book1]Sheet1") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '\'[Book1]Sheet1\'!R2C3', 'Test: Positive case: Number(3), Boolean, String. Row and col - number (2;3), abs_num (opt) - 1, A1 (opt) - boolean (FALSE), sheet text (opt) - string . 5 of 5 arguments used.');
		// Case #4: Number(3), Boolean, String. Row and col - number (2;3), abs_num (opt) - 1, A1 (opt) - boolean (FALSE) . 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,1,FALSE,"EXCEL SHEET")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,1,FALSE,"EXCEL SHEET") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '\'EXCEL SHEET\'!R2C3', 'Test: Positive case: Number(3), Boolean, String. Row and col - number (2;3), abs_num (opt) - 1, A1 (opt) - boolean (FALSE) . 5 of 5 arguments used.');
		// Case #5: Number(4), Reference link. Row and col - number (2;3), abs_num (opt) - 1, A1 (opt) - number (1), sheet _ext(opt) - Ref (empty cell) . 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,2,1,A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,2,1,A100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '!C$2', 'Test: Positive case: Number(4), Reference link. Row and col - number (2;3), abs_num (opt) - 1, A1 (opt) - number (1), sheet _ext(opt) - Ref (empty cell) . 5 of 5 arguments used.');
		// Case #6: Number(4), Reference link. Row and col - number (2;3), abs_num (opt) - 1, A1 (opt) - number (1), sheet_text(opt) - Ref (\' val) . 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,2,1,A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,2,1,A101) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '!C$2', 'Test: Positive case: Number(4), Reference link. Row and col - number (2;3), abs_num (opt) - 1, A1 (opt) - number (1), sheet_text(opt) - Ref (\' val) . 5 of 5 arguments used.');
		// Case #7: Number(4), String. Row and col - number(2;3), abs_num (opt) - 1, A1 (opt) - number (1), sheet_text(opt) - empty string . 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,2,1,"")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,2,1,"") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '!C$2', 'Test: Positive case: Number(4), String. Row and col - number(2;3), abs_num (opt) - 1, A1 (opt) - number (1), sheet_text(opt) - empty string . 5 of 5 arguments used.');
		// Case #8: Number(4), String. Row and col - number(2;3), abs_num (opt) - 1, A1 (opt) - number (1), sheet_text(opt) -  string (\') . 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,2,1,"\'")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,2,1,"\'") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), "''''!C$2", 'Test: Positive case: Number(4), String. Row and col - number(2;3), abs_num (opt) - 1, A1 (opt) - number (1), sheet_text(opt) -  string (\') . 5 of 5 arguments used.');
		// Case #9: Number(2), Empty(2), Number. Row and col - number(2;3), abs_num (opt) - Empty, A1 (opt) - Empty, sheet_text(opt) -  number (1) . 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,,,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,,,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '\'1\'!$C$2', 'Test: Positive case: Number(2), Empty(2), Number. Row and col - number(2;3), abs_num (opt) - Empty, A1 (opt) - Empty, sheet_text(opt) -  number (1) . 5 of 5 arguments used.');
		// Case #10: Number(3), Empty, Number. Row and col - number(2;3), abs_num (opt) - 1, A1 (opt) - Empty, sheet_text(opt) -  number (1) . 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,1,,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,1,,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '\'1\'!$C$2', 'Test: Positive case: Number(3), Empty, Number. Row and col - number(2;3), abs_num (opt) - 1, A1 (opt) - Empty, sheet_text(opt) -  number (1) . 5 of 5 arguments used.');
		// Case #11: Number(3), Empty, Number. Row and col - number(2;3), abs_num (opt) - 2, A1 (opt) - Empty, sheet_text(opt) -  number (1) . 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,2,,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,2,,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '\'1\'!C$2', 'Test: Positive case: Number(3), Empty, Number. Row and col - number(2;3), abs_num (opt) - 2, A1 (opt) - Empty, sheet_text(opt) -  number (1) . 5 of 5 arguments used.');
		// Case #12: Number(2), Empty, Boolean, Number. Row and col - number(2;3), abs_num (opt) - Empty, A1 (opt) - bool (TRUE), sheet_text(opt) -  number (1) . 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,,TRUE,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,,TRUE,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '\'1\'!$C$2', 'Test: Positive case: Number(2), Empty, Boolean, Number. Row and col - number(2;3), abs_num (opt) - Empty, A1 (opt) - bool (TRUE), sheet_text(opt) -  number (1) . 5 of 5 arguments used.');
		// Case #13: Number(2), Empty, Boolean, Number. Row and col - number(2;3), abs_num (opt) - Empty, A1 (opt) - bool (FALSE), sheet_text(opt) -  number (1) . 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,,FALSE,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,,FALSE,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '\'1\'!R2C3', 'Test: Positive case: Number(2), Empty, Boolean, Number. Row and col - number(2;3), abs_num (opt) - Empty, A1 (opt) - bool (FALSE), sheet_text(opt) -  number (1) . 5 of 5 arguments used.');
		// Case #14: Number(2), Empty(2). Row and col - number(1;7), abs_num (opt) - Empty, A1 (opt) - Empty . 4 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(1,7,,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(1,7,,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$G$1', 'Test: Positive case: Number(2), Empty(2). Row and col - number(1;7), abs_num (opt) - Empty, A1 (opt) - Empty . 4 of 5 arguments used.');
		// Case #15: Number(2), Empty(3). Row and col - number(2;3), abs_num (opt) - Empty, A1 (opt) - Empty, sheet_text(opt) - Empty . 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(1,7,,,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(1,7,,,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$G$1', 'Test: Positive case: Number(2), Empty(3). Row and col - number(2;3), abs_num (opt) - Empty, A1 (opt) - Empty, sheet_text(opt) - Empty . 5 of 5 arguments used.');
		// Case #16: Number(3). Row and col - number (2.123;3.3213), abs_num - 2. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2.123,3.3213,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2.123,3.3213,2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'C$2', 'Test: Positive case: Number(3). Row and col - number (2.123;3.3213), abs_num - 2. 3 of 5 arguments used.');
		// Case #17: String(2), Number. Row and col - string (5;10), abs_num - 3. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS("5","10",3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS("5","10",3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$J5', 'Test: Positive case: String(2), Number. Row and col - string (5;10), abs_num - 3. 3 of 5 arguments used.');
		// Case #18: String(5). Row and col - string(2;3), abs_num (opt) - string (4), A1 (opt) - string (TRUE), sheet_text(opt) - string (Sheet3) . 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS("2","3","4","TRUE","Sheet3")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS("2","3","4","TRUE","Sheet3") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Sheet3!C2', 'Test: Positive case: String(5). Row and col - string(2;3), abs_num (opt) - string (4), A1 (opt) - string (TRUE), sheet_text(opt) - string (Sheet3) . 5 of 5 arguments used.');
		// Case #19: Formula(2), Number. Row and col - formula returning numbers (2;3), abs_num (opt) - 4. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(INT(2.9),ROUND(3.1,0),4)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(INT(2.9),ROUND(3.1,0),4) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'C2', 'Test: Positive case: Formula(2), Number. Row and col - formula returning numbers (2;3), abs_num (opt) - 4. 3 of 5 arguments used.');
		// Case #20: Formula(2), Number, Boolean, String. Row and col - formula(2;3), abs_num (opt) - 3, A1 (opt) - TRUE, sheet_text (opt) - string (Test). 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(INT(2.9),ROUND(3.1,0),3,TRUE,"Test")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(INT(2.9),ROUND(3.1,0),3,TRUE,"Test") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Test!$C2', 'Test: Positive case: Formula(2), Number, Boolean, String. Row and col - formula(2;3), abs_num (opt) - 3, A1 (opt) - TRUE, sheet_text (opt) - string (Test). 5 of 5 arguments used.');
		// Case #21: Reference link(2), Number(3). Row and col - reference links(2;3), abs_num (opt) - 3. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(A102,A103,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(A102,A103,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$C2', 'Test: Positive case: Reference link(2), Number(3). Row and col - reference links(2;3), abs_num (opt) - 3. 3 of 5 arguments used.');
		// Case #22: Reference link(2), Number, Boolean, String. Row and col - reference links, abs_num (opt) - 3, a1 (opt)  - TRUE, sheet_text (opt) - string. 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(A102,A103,3,TRUE,"Test")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(A102,A103,3,TRUE,"Test") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Test!$C2', 'Test: Positive case: Reference link(2), Number, Boolean, String. Row and col - reference links, abs_num (opt) - 3, a1 (opt)  - TRUE, sheet_text (opt) - string. 5 of 5 arguments used.');
		// Case #23: Area(2), Number(3). Row and col - single-cell areas (2;3), abs_num (opt) - 3. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(A102:A102,A103:A103,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(A102:A102,A103:A103,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$C2', 'Test: Positive case: Area(2), Number(3). Row and col - single-cell areas (2;3), abs_num (opt) - 3. 3 of 5 arguments used.');
		// Case #24: Array(2), Number. Row and col - arrays with single numbers(5;10), abs_num (opt) - 3. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS({5},{10},3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS({5},{10},3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$J5', 'Test: Positive case: Array(2), Number. Row and col - arrays with single numbers(5;10), abs_num (opt) - 3. 3 of 5 arguments used.');
		// Case #25: Name(2), Number. Row and col - named ranges with numbers(4;1), abs_num (opt) - 3. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(TestName,TestName1,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(TestName,TestName1,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$A4', 'Test: Positive case: Name(2), Number. Row and col - named ranges with numbers(4;1), abs_num (opt) - 3. 3 of 5 arguments used.');
		// Case #26: Name3D(2), Number. Row and col - 3D named ranges with numbers(10;15), abs_num (opt) - 3. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(TestName3D,TestName3D1,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(TestName3D,TestName3D1,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$O10', 'Test: Positive case: Name3D(2), Number. Row and col - 3D named ranges with numbers(10;15), abs_num (opt) - 3. 3 of 5 arguments used.');
		// Case #27: Ref3D(2), Number. Row and col - 3D references with numbers(1;1), abs_num (opt) - 3. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(Sheet2!A1,Sheet2!A2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(Sheet2!A1,Sheet2!A2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$A1', 'Test: Positive case: Ref3D(2), Number. Row and col - 3D references with numbers(1;1), abs_num (opt) - 3. 3 of 5 arguments used.');
		// Case #28: Area3D(2), Number. Row and col - 3D single-cell areas with numbers(1;1), abs_num (opt) - 4. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(Sheet2!A1:A1,Sheet2!A2:A2,4)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(Sheet2!A1:A1,Sheet2!A2:A2,4) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'A1', 'Test: Positive case: Area3D(2), Number. Row and col - 3D single-cell areas with numbers(1;1), abs_num (opt) - 4. 3 of 5 arguments used.');
		// Case #29: Table(2), Number. Row and col - table references with numbers(20;25), abs_num (opt) - 4. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(Table1[Column1],Table1[Column2],4)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(Table1[Column1],Table1[Column2],4) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Y20', 'Test: Positive case: Table(2), Number. Row and col - table references with numbers(20;25), abs_num (opt) - 4. 3 of 5 arguments used.');
		// Case #30: Number(2), Formula(3). Row and col - numbers (2;3), abs_num (opt) - nested formula(1), a1 (opt) - nested formula (TRUE), sheet_text (opt) - nested formula (Sheet1). 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,IF(TRUE,1,2),IF(TRUE,TRUE,FALSE),CONCATENATE("S","heet1"))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,IF(TRUE,1,2),IF(TRUE,TRUE,FALSE),CONCATENATE("S","heet1")) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Sheet1!$C$2', 'Test: Positive case: Number(2), Formula(3). Row and col - numbers (2;3), abs_num (opt) - nested formula(1), a1 (opt) - nested formula (TRUE), sheet_text (opt) - nested formula (Sheet1). 5 of 5 arguments used.');
		// Case #31: Number(5). Row and col - numbers (2;3), abs_num (opt) - 1, A1 (opt) - number (0 equivalent to FALSE), sheet_text (opt) - number (1). 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,1,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,1,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '\'1\'!R2C3', 'Test: Positive case: Number(5). Row and col - numbers (2;3), abs_num (opt) - 1, A1 (opt) - number (0 equivalent to FALSE), sheet_text (opt) - number (1). 5 of 5 arguments used.');
		// Case #32: Formula. ADDRESS used inside another formula. 3 of 5 arguments used for ADDRESS.
		oParser = new parserFormula('SUM(LEN(ADDRESS(2,3,1)),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula SUM(LEN(ADDRESS(2,3,1)),1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Test: Positive case: Formula. ADDRESS used inside another formula. 3 of 5 arguments used for ADDRESS.');
		// Case #33: Number(2), Formula, Number. Row and col - numbers (2;3), abs_num (opt) from MATCH formula returning 3 A1 (opt) - number(1). 4 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,MATCH(3,{1,2,3,4},0),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,MATCH(3,{1,2,3,4},0),1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$C2', 'Test: Positive case: Number(2), Formula, Number. Row and col - numbers (2;3), abs_num (opt) from MATCH formula returning 3 A1 (opt) - number(1). 4 of 5 arguments used.');
		// Case #34: Number(3), Boolean, Formula. Row and col - numbers (2;3), abs_num (opt) - 4, A1 (opt) - bool (TRUE), sheet_text (opt) from text manipulation formula. 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,4,TRUE,LEFT("Sheet1",6))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,4,TRUE,LEFT("Sheet1",6)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Sheet1!C2', 'Test: Positive case: Number(3), Boolean, Formula. Row and col - numbers (2;3), abs_num (opt) - 4, A1 (opt) - bool (TRUE), sheet_text (opt) from text manipulation formula. 5 of 5 arguments used.');
		// Case #35: String(2), Empty(3). Row and col - numbers (2.5;3.5), optional args empty. 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS("2.5","3.5",,,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS("2.5","3.5",,,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$C$2', 'Test: Positive case: String(2), Empty(3). Row and col - numbers (2.5;3.5), optional args empty. 5 of 5 arguments used.');
		// Case #36: Number(4), String. Row and col - numbers (2;3), abs_num (opt) - 4, A1 - number (1), sheet_text (opt) containing spaces. 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,4,1,"Sheet name with spaces")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,4,1,"Sheet name with spaces") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '\'Sheet name with spaces\'!C2', 'Test: Positive case: Number(4), String. Row and col - numbers (2;3), abs_num (opt) - 4, A1 - number (1), sheet_text (opt) containing spaces. 5 of 5 arguments used.');
		// Case #37: Number(4), String. Row and col - numbers (2;3), abs_num  (opt) - 4, A1 (opt) - number (1), sheet_text (opt) with special characters. 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,4,1,"Sheet-Special!@#$%")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,4,1,"Sheet-Special!@#$%") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '\'Sheet-Special!@#$%\'!C2', 'Test: Positive case: Number(4), String. Row and col - numbers (2;3), abs_num  (opt) - 4, A1 (opt) - number (1), sheet_text (opt) with special characters. 5 of 5 arguments used.');
		// Case #38: Number(2), Array(3). Row and col - numbers (2;3), optional arguments as single-element arrays. 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,{1},{TRUE},{"Sheet1"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,{1},{TRUE},{"Sheet1"}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Sheet1!$C$2', 'Test: Positive case: Number(2), Array(3). Row and col - numbers (2;3), optional arguments as single-element arrays. 5 of 5 arguments used.');
		// Case #39: Formula(2), Number. Row formula (DATE -> number), col (TIME -> number), abs_num (opt) - 3 . 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(DATE(2023,1,1),TIME(12,0,0)+1,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(DATE(2023,1,1),TIME(12,0,0)+1,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$A44927', 'Test: Positive case: Formula(2), Number. Row formula (DATE -> number), col (TIME -> number), abs_num (opt) - 3 . 3 of 5 arguments used.');
		// Case #40: Number(3), Formula, String. Row and col - numbers (2;3), abs_num (opt) - 3,A1 (opt) - date (non-zero = TRUE), sheet_text (opt) - string (Sheet1). 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,3,DATE(2023,1,1),"Sheet1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,3,DATE(2023,1,1),"Sheet1") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Sheet1!$C2', 'Test: Positive case: Number(3), Formula, String. Row and col - numbers (2;3), abs_num (opt) - 3,A1 (opt) - date (non-zero = TRUE), sheet_text (opt) - string (Sheet1). 5 of 5 arguments used.');
		// Case #41: Area, Number. Row - area (2 cells with value), col - number (3). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(A102:B102,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(A102:B102,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$C$2', 'Test: Positive case: Area, Number. Row - area (2 cells with value), col - number (3). 2 of 5 arguments used.');
		// Case #42: Number, Area. Row - number (2), col - area (2 cells with value). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,A102:B102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,A102:B102) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$B$2', 'Test: Positive case: Number, Area. Row - number (2), col - area (2 cells with value). 2 of 5 arguments used.');
		// Case #43: Array, Number. Row - array (2 elements with values), col - number (1). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS({2,3},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS({2,3},1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$A$2', 'Test: Positive case: Array, Number. Row - array (2 elements with values), col - number (1). 2 of 5 arguments used.');
		// Case #44: Number, Array. Row - number (1), col - array (2 elements with values). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(1,{2,3})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(1,{2,3}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$B$1', 'Test: Positive case: Number, Array. Row - number (1), col - array (2 elements with values). 2 of 5 arguments used.');
		// Case #45: Number(2), Array. abs_num -array (2 elements with values). 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,{1,2})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,{1,2}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$C$2', 'Test: Positive case: Number(2), Array. abs_num -array (2 elements with values). 3 of 5 arguments used.');
		// Case #46: Number(3), Array. a1 - array (2 elements with values). 4 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,1,{TRUE,FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,1,{TRUE,FALSE}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$C$2', 'Test: Positive case: Number(3), Array. a1 - array (2 elements with values). 4 of 5 arguments used.');
		// Case #47: Number(4), Array. sheet_text - array (2 elements with values). 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,1,TRUE,{"Sheet1","Sheet2"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,1,TRUE,{"Sheet1","Sheet2"}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Sheet1!$C$2', 'Test: Positive case: Number(4), Array. sheet_text - array (2 elements with values). 5 of 5 arguments used.');

		// Negative cases:

		// Case #1: Number, Empty. Row - number(1), col - Empty. 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(1,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(1,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Empty. Row - number(1), col - Empty. 2 of 5 arguments used.');
		// Case #2: Number(2). Row is negative (invalid), col - number (1). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(-1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(-1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number(2). Row is negative (invalid), col - number (1). 2 of 5 arguments used.');
		// Case #3: Empty, Number. Row - Empty, col - number (1). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Empty, Number. Row - Empty, col - number (1). 2 of 5 arguments used.');
		// Case #4: Number(2). Row - number (1), col - number (-1). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(1,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(1,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number(2). Row - number (1), col - number (-1). 2 of 5 arguments used.');
		// Case #5: Number(2), Empty. Row - number (1048576 exceeds maximum), col - number (1), abs_num (opt) - Empty. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(1048577,1,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(1048577,1,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number(2), Empty. Row - number (1048576 exceeds maximum), col - number (1), abs_num (opt) - Empty. 3 of 5 arguments used.');
		// Case #6: Number(2), Empty. Row - number (1), col - number (16384 exceeds maximum ), abs_num (opt) - Empty. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(1,16385,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(1,16385,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number(2), Empty. Row - number (1), col - number (16384 exceeds maximum ), abs_num (opt) - Empty. 3 of 5 arguments used.');
		// Case #7: Number(3), Boolean. Row and col - numbers (2;3), abs_num (opt) - number (0 below valid range 1-4), A1 (opt) - bool (TRUE). 4 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,0,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,0,TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number(3), Boolean. Row and col - numbers (2;3), abs_num (opt) - number (0 below valid range 1-4), A1 (opt) - bool (TRUE). 4 of 5 arguments used.');
		// Case #8: Number(3), Boolean. Row and col - numbers (2;3), abs_num (opt) - number (5 above valid range 1-4), A1 (opt) - bool (TRUE). 4 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,5,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,5,TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number(3), Boolean. Row and col - numbers (2;3), abs_num (opt) - number (5 above valid range 1-4), A1 (opt) - bool (TRUE). 4 of 5 arguments used.');
		// Case #9: Number(3), String. Row and col - number (2;3), abs_num (opt) -  number (2) ,A1 (opt) - string (text val). 4 of 5 arguments used.
		// TODO Need to fix. Blocked by https://nct.onlyoffice.com/Products/Files/DocEditor.aspx?fileid=366936 Bug #9
		/*oParser = new parserFormula('ADDRESS(2,3,2,"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,2,"abc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number(3), String. Row and col - number (2;3), abs_num (opt) -  number (2) ,A1 (opt) - string (text val). 4 of 5 arguments used.');*/
		// Case #10: String(2), Empty. Row - string (non-numeric text), col - string (3), abs_num (opt) - Empty. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS("abc","3",)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS("abc","3",) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: String(2), Empty. Row - string (non-numeric text), col - string (3), abs_num (opt) - Empty. 3 of 5 arguments used.');
		// Case #11: String(2), Empty. Row - string (2), col - string  (non-numeric text), abs_num (opt) - Empty. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS("2","abc",)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS("2","abc",) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: String(2), Empty. Row - string (2), col - string  (non-numeric text), abs_num (opt) - Empty. 3 of 5 arguments used.');
		// Case #12: String(3), Empty. Row and col - strings (2;3), abs_num (opt) - string (non-numeric text), A1 (opt) - Empty. 4 of 5 arguments used.
		oParser = new parserFormula('ADDRESS("2","3","abc",)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS("2","3","abc",) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: String(3), Empty. Row and col - strings (2;3), abs_num (opt) - string (non-numeric text), A1 (opt) - Empty. 4 of 5 arguments used.');
		// Case #13: String(4), Empty. Row and col - strings (2;3), abs_num (opt) - string (1), A1 (opt) - string  (non-numeric/non-boolean text)m sheet_text (opt) - Empty. 5 of 5 arguments used.
		//TODO Need to fix. Blocked by https://nct.onlyoffice.com/Products/Files/DocEditor.aspx?fileid=366936 Bug #9
		/*oParser = new parserFormula('ADDRESS("2","3","1","abc",)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS("2","3","1","abc",) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: String(4), Empty. Row and col - strings (2;3), abs_num (opt) - string (1), A1 (opt) - string  (non-numeric/non-boolean text)m sheet_text (opt) - Empty. 5 of 5 arguments used.');*/
		// Case #14: Number(2), Error. Row and col - number (2;3), abs_num (opt) - error value. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number(2), Error. Row and col - number (2;3), abs_num (opt) - error value. 3 of 5 arguments used.');
		// Case #15: Error, Number. Row - error value, col - number (3). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(NA(),3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(NA(),3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error, Number. Row - error value, col - number (3). 2 of 5 arguments used.');
		// Case #16: Number, Error. Row - number (2), col - error value. 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Error. Row - number (2), col - error value. 2 of 5 arguments used.');
		// Case #17: Number(3), Error. Row and col - number (2;3), abs_num(opt) - number (2), A1 (opt) is error value. 4 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,2,NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,2,NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number(3), Error. Row and col - number (2;3), abs_num(opt) - number (2), A1 (opt) is error value. 4 of 5 arguments used.');
		// Case #18: Number(4), Error. sheet_text (opt) - error value. 5 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,2,TRUE,NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,2,TRUE,NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number(4), Error. sheet_text (opt) - error value. 5 of 5 arguments used.');
		// Case #19: Area, Number. Row - area (2 cells with value incorrect numbers). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(A104:B104,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(A104:B104,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number. Row - area (2 cells with value incorrect numbers). 2 of 5 arguments used.');
		// Case #20: Number, Area. Col - area (2 cells with value incorrect numbers). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,A104:B104)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,A104:B104) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Area. Col - area (2 cells with value incorrect numbers). 2 of 5 arguments used.');
		// Case #21: Array, Number. Row - array (2 elements with incorrect values). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS({0,-1},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS({0,-1},1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, Number. Row - array (2 elements with incorrect values). 2 of 5 arguments used.');
		// Case #22: Number, Array. Col - array (2 elements with values). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(1,{0,-1})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(1,{0,-1}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Array. Col - array (2 elements with values). 2 of 5 arguments used.');
		// Case #23: Number(2), Array. abs_num -array (2 elements with incorrect values). 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,{0,5})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,{0,5}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number(2), Array. abs_num -array (2 elements with incorrect values). 3 of 5 arguments used.');
		// Case #24: Number(3), Array. a1 - array (2 elements with incorrect values). 4 of 5 arguments used.
		// TODO Need to fix. Blocked by https://nct.onlyoffice.com/Products/Files/DocEditor.aspx?fileid=366936 Bug #9
		/*oParser = new parserFormula('ADDRESS(2,3,1,{"abc","cba"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,1,{"abc","cba"}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number(3), Array. a1 - array (2 elements with incorrect values). 4 of 5 arguments used.');*/
		// Case #25: Name, Number. Row - name (area with 2 cells with incorrect values). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(TestNameArea2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(TestNameArea2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Name, Number. Row - name (area with 2 cells with incorrect values). 2 of 5 arguments used.');
		// Case #26: Number, Name. Col - name (area with 2 cells with incorrect values). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,TestNameArea2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,TestNameArea2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Name. Col - name (area with 2 cells with incorrect values). 2 of 5 arguments used.');
		// Case #27: Empty(2). Both row and column are empty. 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Empty(2). Both row and column are empty. 2 of 5 arguments used.');
		// Case #28: Formula, Number. Row formula returns #N/A error. 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(MATCH("xyz",{"a","b","c"},0),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(MATCH("xyz",{"a","b","c"},0),1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Formula, Number. Row formula returns #N/A error. 2 of 5 arguments used.');
		// Case #29: Number(2). Row - number (0 minimum unaccepted number), col - number (1 - minimum accepted number). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number(2). Row - number (0 minimum unaccepted number), col - number (1 - minimum accepted number). 2 of 5 arguments used.');
		// Case #30: Number(2). Row - number (1 - minimum accepted number) , col - number (0 minimum unaccepted number). 2 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(1,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(1,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number(2). Row - number (1 - minimum accepted number) , col - number (0 minimum unaccepted number). 2 of 5 arguments used.');

		// Bounded cases:

		// Case #1: Number(2), Empty. Minimum valid row and column. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(1,1,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(1,1,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$A$1', 'Test: Bounded case: Number(2), Empty. Minimum valid row and column. 3 of 5 arguments used.');
		// Case #2: Number(2), Empty. Maximum valid row and column. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(1048576,16384,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(1048576,16384,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$XFD$1048576', 'Test: Bounded case: Number(2), Empty. Maximum valid row and column. 3 of 5 arguments used.');
		// Case #3: Number(3), Empty. Minimum valid abs_num. 4 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,1,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,1,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$C$2', 'Test: Bounded case: Number(3), Empty. Minimum valid abs_num. 4 of 5 arguments used.');
		// Case #4: Number(3), Empty. Maximum valid abs_num. 4 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(2,3,4,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(2,3,4,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'C2', 'Test: Bounded case: Number(3), Empty. Maximum valid abs_num. 4 of 5 arguments used.');
		// Case #5: Number(2), Formula, Boolean. Maximum row, column, abs_num with R1C1 reference style. 4 of 5 arguments used.
		// Different result with MS
		oParser = new parserFormula('ADDRESS(1048576,16384,4,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(1048576,16384,1,FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'R[1048576]C[16384]', 'Test: Bounded case: Number(2), Formula, Boolean. Maximum row, column, abs_num with R1C1 reference style. 4 of 5 arguments used.');
		// Case #6: Formula(2), Number(3). Row and column at maximum from formula. 3 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(ROUNDDOWN(1048576.9,0),ROUNDDOWN(16384.9,0),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(ROUNDDOWN(1048576.9,0),ROUNDDOWN(16384.9,0),1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '$XFD$1048576', 'Test: Bounded case: Formula(2), Number(3). Row and column at maximum from formula. 3 of 5 arguments used.');
		// Case #7: Number, Formula, Number(2), Boolean. Column at minimum from formula. 4 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(1,ROUNDUP(0.1,0),4,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(1,ROUNDUP(0.1,0),4,FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'R[1]C[1]', 'Test: Bounded case: Number, Formula, Number(2), Boolean. Column at minimum from formula. 4 of 5 arguments used.');
		// Case #8: Formula, Number, Number(2), Boolean. Row at minimum from formula. 4 of 5 arguments used.
		oParser = new parserFormula('ADDRESS(ROUNDUP(0.1,0),1,4,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula ADDRESS(ROUNDUP(0.1,0),1,4,FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'R[1]C[1]', 'Test: Bounded case: Formula, Number, Number(2), Boolean. Row at minimum from formula. 4 of 5 arguments used.');

		testArrayFormula2(assert, "ADDRESS", 2, 5);
	});


	QUnit.test("Test: \"AREAS\"", function (assert) {

		oParser = new parserFormula('AREAS(1)', "A1", ws);
		assert.ok(oParser.parse(), "AREAS(1)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of AREAS(1)");

		oParser = new parserFormula('AREAS("str")', "A1", ws);
		assert.ok(oParser.parse(), 'AREAS("str")');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of AREAS("str")');

		oParser = new parserFormula('AREAS({1,2,3})', "A1", ws);
		assert.ok(oParser.parse(), 'AREAS({1,2,3})');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of AREAS({1,2,3})');

		oParser = new parserFormula('AREAS(A10)', "A1", ws);
		assert.ok(oParser.parse(), "AREAS(A10)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of AREAS(A10)");

		oParser = new parserFormula('AREAS('+ ws.getName() + '!A10)', "A1", ws);
		assert.ok(oParser.parse(), "AREAS(Sheet1!A10)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of AREAS(Sheet1!A10)");

		oParser = new parserFormula('AREAS(A10:A11)', "A1", ws);
		assert.ok(oParser.parse(), "AREAS(A10:A11)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of AREAS(A10:A11)");

		oParser = new parserFormula('AREAS('+ ws.getName() + '!A10:A11)', "A1", ws);
		assert.ok(oParser.parse(), "AREAS(Sheet1!A10:A11)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of AREAS(Sheet1!A10:A11)");

	});

	QUnit.test("Test: \"CHOOSE\"", function (assert) {
		let array;
		let arraySize;
		// Data for reference link.
		ws.getRange2("A2").setValue("1st");
		ws.getRange2("A3").setValue("2nd");
		ws.getRange2("A4").setValue("3rd");
		ws.getRange2("A5").setValue("Finished");

		ws.getRange2("B2").setValue("Nails");
		ws.getRange2("B3").setValue("Screws");
		ws.getRange2("B4").setValue("Nuts");
		ws.getRange2("B5").setValue("Bolts");
		// for bug 58523
		ws.getRange2("C1").setValue("CBT-1");
		ws.getRange2("C2").setValue("CBT-2");
		ws.getRange2("C3").setValue("CBT-3");
		ws.getRange2("E1").setValue("HIS0361");
		ws.getRange2("E2").setValue("HIS0362");
		ws.getRange2("E3").setValue("HIS0363");
		// for bug 67639
		ws.getRange2("A102").setValue("23");
		ws.getRange2("A103").setValue("45");
		ws.getRange2("A104").setValue("12");
		ws.getRange2("A105").setValue("10");
		ws.getRange2("B102").setValue("1");
		ws.getRange2("B103").setValue("2");
		ws.getRange2("B104").setValue("3");
		ws.getRange2("C102").setValue("2");
		ws.getRange2("C103").setValue("1");
		ws.getRange2("E102").setValue("ds");
		ws.getRange2("E103").setValue("fasf");
		ws.getRange2("E104").setValue("gas");
		ws.getRange2("F102").setValue("123das");
		ws.getRange2("F103").setValue("jkl");
		ws.getRange2("F104").setValue("zcasd");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 2);
		ws.getRange2("A601").setValue("1st"); // Column1
		ws.getRange2("B601").setValue("2nd"); // Column2
		ws.getRange2("C601").setValue("2"); // Column3
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1").setValue("1st");
		ws2.getRange2("A2").setValue("2nd");
		ws2.getRange2("A3").setValue("3rd");
		ws2.getRange2("A4").setValue("Finished");
		ws2.getRange2("A5").setValue("2");
		// DefNames. Use A201-A208, B208
		ws.getRange2("A201").setValue("1st"); // TestName
		ws.getRange2("A202").setValue("2nd"); // TestName1
		ws.getRange2("A203").setValue("3rd"); // TestName2
		ws.getRange2("A204").setValue("Finished"); // TestName3
		ws.getRange2("A205").setValue("2"); // TestName4
		// DefNames 3D. Use A11-A18, B18
		ws2.getRange2("A11").setValue("1st") // TestName3D
		ws2.getRange2("A12").setValue("2nd") // TestName3D1
		ws2.getRange2("A13").setValue("3rd") // TestName3D2
		ws2.getRange2("A14").setValue("Finished") // TestName3D3
		ws2.getRange2("A15").setValue("2") // TestName3D4

		//Positive cases:
		// Case #1: Number, Reference link(4). Value of the second list argument (value of cell A3). 5 arguments were used.
		oParser = new parserFormula('CHOOSE(2,A2,A3,A4,A5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(2,A2,A3,A4,A5) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), '2nd', 'Test: Positive case: Number, Reference link(4). Value of the second list argument (value of cell A3). 5 arguments were used.');
		// Case #2: Number, Reference link(4). Value of the fourth list argument (value of cell B5). 5 arguments were used.
		oParser = new parserFormula('CHOOSE(4,B2,B3,B4,B5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(4,B2,B3,B4,B5) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 'Bolts', 'Test: Positive case: Number, Reference link(4). Value of the fourth list argument (value of cell B5). 5 arguments were used.');
		// Case #3: Number, String, Number, String, Number. Value of the third list argument. 5 arguments were used.
		oParser = new parserFormula('CHOOSE(3,"Wide",115,"world",8)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(3,"Wide",115,"world",8) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'world', 'Test: Positive case: Number, String, Number, String, Number. Value of the third list argument. 5 arguments were used.');
		// Case #4: Boolean, Number(3). Value of the first list argument (index_num as bool -> number). 5 arguments were used.
		oParser = new parserFormula('CHOOSE(TRUE,1,2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(TRUE,1,2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Boolean, Number(3). Value of the first list argument (index_num as bool -> number). 5 arguments were used.');
		// Case #5: String, Number(3). Value of the first list argument (index_num as string -> number). 5 arguments were used.
		oParser = new parserFormula('CHOOSE("1",1,2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE("1",1,2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: String, Number(3). Value of the first list argument (index_num as string -> number). 5 arguments were used.');
		// arr
		// Case #6: Number(2), Array, Number. Second value is array. 4 arguments were used.
		oParser = new parserFormula('CHOOSE(2,1,{1,2,3},3)', "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(2,1,{1,2,3},3) is parsed.');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Number(2). Second value is array. 4 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 2, 'Test: Positive case: Number(2). Second value is array. 4 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 3, 'Test: Positive case: Number(2). Second value is array. 4 arguments were used.[0,2]');
		// Case #7: Array, Area(2). Choosing 1st and 2nd value args. 3 arguments were used.
		let bbox = ws.getRange2("G1").bbox;
		let cellWithFormula = new window['AscCommonExcel'].CCellWithFormula(ws, bbox.r1, bbox.c1);
		oParser = new parserFormula('CHOOSE({1,2},C1:C3,E1:E3)', cellWithFormula, ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE({1,2},C1:C3,E1:E3) is parsed.');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "CBT-1", 'Test: Positive case: Array, Area(2). Choosing 1st and 2nd value args. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "HIS0361", 'Test: Positive case: Array, Area(2). Choosing 1st and 2nd value args. 3 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "CBT-2", 'Test: Positive case: Array, Area(2). Choosing 1st and 2nd value args. 3 arguments were used.[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "HIS0362", 'Test: Positive case: Array, Area(2). Choosing 1st and 2nd value args. 3 arguments were used.[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "CBT-3", 'Test: Positive case: Array, Area(2). Choosing 1st and 2nd value args. 3 arguments were used.[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "HIS0363", 'Test: Positive case: Array, Area(2). Choosing 1st and 2nd value args. 3 arguments were used.[2,1]');
		// Case #8: Array, Area(2). Choosing 1st and 2nd value args. Formula cell is G2. 3 arguments were used.
		bbox = ws.getRange2("G2").bbox;
		cellWithFormula = new window['AscCommonExcel'].CCellWithFormula(ws, bbox.r1, bbox.c1);
		oParser = new parserFormula('CHOOSE({1,2},C1:C3,E1:E3)', cellWithFormula, ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE({1,2},C1:C3,E1:E3) is parsed.');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "CBT-1", 'Test: Positive case: Array, Area(2). Choosing 1st and 2nd value args. Formula cell is G2. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "HIS0361", 'Test: Positive case: Array, Area(2). Choosing 1st and 2nd value args. Formula cell is G2. 3 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "CBT-2", 'Test: Positive case: Array, Area(2). Choosing 1st and 2nd value args. Formula cell is G2. 3 arguments were used.[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "HIS0362", 'Test: Positive case: Array, Area(2). Choosing 1st and 2nd value args. Formula cell is G2. 3 arguments were used.[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "CBT-3", 'Test: Positive case: Array, Area(2). Choosing 1st and 2nd value args. Formula cell is G2. 3 arguments were used.[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "HIS0363", 'Test: Positive case: Array, Area(2). Choosing 1st and 2nd value args. Formula cell is G2. 3 arguments were used.[2,1]');
		// Case #9: Array, Area(2). Choosing incorrect value and 2nd value  for index_num arg. Formula cell is G3. 3 arguments were used.
		bbox = ws.getRange2("G3").bbox;
		cellWithFormula = new window['AscCommonExcel'].CCellWithFormula(ws, bbox.r1, bbox.c1);
		oParser = new parserFormula('CHOOSE({"",2},C1:C3,E1:E3)', cellWithFormula, ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE({"",2},C1:C3,E1:E3) is parsed.');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", 'Test: Positive case: Array, Area(2). Choosing incorrect value and 2nd value  for index_num arg. Formula cell is G3. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "HIS0361", 'Test: Positive case: Array, Area(2). Choosing incorrect value and 2nd value  for index_num arg. Formula cell is G3. 3 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", 'Test: Positive case: Array, Area(2). Choosing incorrect value and 2nd value  for index_num arg. Formula cell is G3. 3 arguments were used.[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "HIS0362", 'Test: Positive case: Array, Area(2). Choosing incorrect value and 2nd value  for index_num arg. Formula cell is G3. 3 arguments were used.[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#VALUE!", 'Test: Positive case: Array, Area(2). Choosing incorrect value and 2nd value  for index_num arg. Formula cell is G3. 3 arguments were used.[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "HIS0363", 'Test: Positive case: Array, Area(2). Choosing incorrect value and 2nd value  for index_num arg. Formula cell is G3. 3 arguments were used.[2,1]');
		// Case #10: Array, Area(2). Choosing 1st value and 1st (as decimal number would be trunced) value for index_num arg. Formula cell is G3. 3 arguments were used.
		bbox = ws.getRange2("G3").bbox;
		cellWithFormula = new window['AscCommonExcel'].CCellWithFormula(ws, bbox.r1, bbox.c1);
		oParser = new parserFormula('CHOOSE({1,1.1},C1:C3,E1:E3)', cellWithFormula, ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE({1,1.1},C1:C3,E1:E3) is parsed.');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "CBT-1", 'Test: Positive case: Array, Area(2). Choosing 1st value and 1st (as decimal number would be trunced) value for index_num arg. Formula cell is G3. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "CBT-1", 'Test: Positive case: Array, Area(2). Choosing 1st value and 1st (as decimal number would be trunced) value for index_num arg. Formula cell is G3. 3 arguments were used.[0,1]');
		// Case #10.1: Array, Area(2). Choosing 1st value and 1nd (as decimal number would be trunced to the lowest int) value for index_num arg. Formula cell is G3. 3 arguments were used.
		bbox = ws.getRange2("G3").bbox;
		cellWithFormula = new window['AscCommonExcel'].CCellWithFormula(ws, bbox.r1, bbox.c1);
		oParser = new parserFormula('CHOOSE({1,1.9},C1:C3,E1:E3)', cellWithFormula, ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE({1,1.9},C1:C3,E1:E3) is parsed.');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "CBT-1", 'Test: Positive case: Array, Area(2). Choosing 1st value and 1st (as decimal number would be trunced to the lowest int) value for index_num arg. Formula cell is G3. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "CBT-1", 'Test: Positive case: Array, Area(2). Choosing 1st value and 1st (as decimal number would be trunced to the lowest int) value for index_num arg. Formula cell is G3. 3 arguments were used.[0,1]');
		// Case #11: Array, Area(2). Choosing 1st value and 2nd (as decimal number would be trunced) value for index_num arg. Formula cell is G3. 3 arguments were used.
		bbox = ws.getRange2("G3").bbox;
		cellWithFormula = new window['AscCommonExcel'].CCellWithFormula(ws, bbox.r1, bbox.c1);
		oParser = new parserFormula('CHOOSE({1,2.1},C1:C3,E1:E3)', cellWithFormula, ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE({1,2.1},C1:C3,E1:E3) is parsed.');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "CBT-1", 'Test: Positive case: Array, Area(2). Choosing 1st value and 2nd (as decimal number would be trunced) value for index_num arg. Formula cell is G3. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "HIS0361", 'Test: Positive case: Array, Area(2). Choosing 1st value and 2nd (as decimal number would be trunced) value for index_num arg. Formula cell is G3. 3 arguments were used.[0,1]');
		// Case #12: Formula. CHOOSE is nested formula in SUM
		oParser = new parserFormula('SUM(A102:CHOOSE(2,A103,A104,A105))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula SUM(A102:CHOOSE(2,A103,A104,A105)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 80, 'Test: Positive case: Formula. CHOOSE is nested formula in SUM');
		// Case #13: Formula. CHOOSE is nested formula in SUM.
		oParser = new parserFormula('SIN(A102:CHOOSE(2,A103,A104,A105))', "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula SIN(A102:CHOOSE(2,A103,A104,A105)) is parsed.');
		oParser.setArrayFormulaRef(ws.getRange2("E200:F210").bbox);
		array = oParser.calculate();
		arraySize = array.getDimensions();
		assert.ok(arraySize.row === 3 && arraySize.col === 1, 'Test: Array size in SIN(A102:CHOOSE(2,A103,A104,A105))');
		assert.strictEqual(array.getElementRowCol(0, 0).getValue().toFixed(2), "-0.85", 'Test: Positive case: Formula. CHOOSE is nested formula in SUM.[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue().toFixed(2), "0.85", 'Test: Positive case: Formula. CHOOSE is nested formula in SUM.[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue().toFixed(2), "-0.54", 'Test: Positive case: Formula. CHOOSE is nested formula in SUM.[2,0]');
		// Case #14: Array, Area(2). Choose 1st and 2nd value. 3 arguments were used.
		oParser = new parserFormula('CHOOSE({1,2},A102:A104,B102:B103)', "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE({1,2},A102:A104,B102:B103) is parsed.');
		array = oParser.calculate();
		arraySize = array.getDimensions();
		assert.ok(arraySize.row === 3 && arraySize.col === 2, 'Test: Array size in CHOOSE({1,2},A102:A104,B102:B103');
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 23, 'Test: Positive case: Array, Area(2). Choose 1st and 2nd value. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 1, 'Test: Positive case: Array, Area(2). Choose 1st and 2nd value. 3 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 45, 'Test: Positive case: Array, Area(2). Choose 1st and 2nd value. 3 arguments were used.[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 2, 'Test: Positive case: Array, Area(2). Choose 1st and 2nd value. 3 arguments were used.[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 12, 'Test: Positive case: Array, Area(2). Choose 1st and 2nd value. 3 arguments were used.[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "#N/A", 'Test: Positive case: Array, Area(2). Choose 1st and 2nd value. 3 arguments were used.[2,1]');
		// Case #15: Area(3). Index num is area which choose 1 and 2 value. 3 arguments were used.
		oParser = new parserFormula('CHOOSE(B102:C102,A102:A104,B102:B103)', "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(B102:C102,A102:A104,B102:B103) is parsed.');
		array = oParser.calculate();
		arraySize = array.getDimensions();
		assert.ok(arraySize.row === 3 && arraySize.col === 2, 'Test: Array size in CHOOSE(B102:C102,A102:A104,B102:B103)');
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 23, 'Test: Positive case: Area(3). Index num is area which choose  1 and 2 value. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 1, 'Test: Positive case: Area(3). Index num is area which choose  1 and 2 value. 3 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 45, 'Test: Positive case: Area(3). Index num is area which choose  1 and 2 value. 3 arguments were used.[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 2, 'Test: Positive case: Area(3). Index num is area which choose  1 and 2 value. 3 arguments were used.[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 12, 'Test: Positive case: Area(3). Index num is area which choose  1 and 2 value. 3 arguments were used.[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "#N/A", 'Test: Positive case: Area(3). Index num is area which choose  1 and 2 value. 3 arguments were used.[2,1]');
		// Case #16: Area(2), Number. Index num is area which choose 1 and 2 value. 3 arguments were used.
		oParser = new parserFormula('CHOOSE(B102:C102,A102:B104,9)', "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(B102:C102,A102:B104,9) is parsed.');
		array = oParser.calculate();
		arraySize = array.getDimensions();
		assert.ok(arraySize.row === 3 && arraySize.col === 2, 'Test: Array size in CHOOSE(B102:C102,A102:B104,9)');
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 23, 'Test: Positive case: Area(2), Number. Index num is area which choose  1 and 2 value. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 9, 'Test: Positive case: Area(2), Number. Index num is area which choose  1 and 2 value. 3 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 45, 'Test: Positive case: Area(2), Number. Index num is area which choose  1 and 2 value. 3 arguments were used.[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 9, 'Test: Positive case: Area(2), Number. Index num is area which choose  1 and 2 value. 3 arguments were used.[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 12, 'Test: Positive case: Area(2), Number. Index num is area which choose  1 and 2 value. 3 arguments were used.[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 9, 'Test: Positive case: Area(2), Number. Index num is area which choose  1 and 2 value. 3 arguments were used.[2,1]');
		// Case #17: Area, Number, Area. Index num is area which choose 1 and 2 value. 3 arguments were used.
		oParser = new parserFormula('CHOOSE(B102:C102,9,A102:B104)', "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(B102:C102,9,A102:B104) is parsed.');
		array = oParser.calculate();
		arraySize = array.getDimensions();
		assert.ok(arraySize.row === 3 && arraySize.col === 2, 'Test: Array size in CHOOSE(B102:C102,9,A102:B104)');
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 9, 'Test: Positive case: Area, Number, Area. Index num is area which choose  1 and 2 value. 3 arguments were used[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 1, 'Test: Positive case: Area, Number, Area. Index num is area which choose  1 and 2 value. 3 arguments were used[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 9, 'Test: Positive case: Area, Number, Area. Index num is area which choose  1 and 2 value. 3 arguments were used[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 2, 'Test: Positive case: Area, Number, Area. Index num is area which choose  1 and 2 value. 3 arguments were used[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 9, 'Test: Positive case: Area, Number, Area. Index num is area which choose  1 and 2 value. 3 arguments were used[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 3, 'Test: Positive case: Area, Number, Area. Index num is area which choose  1 and 2 value. 3 arguments were used[2,1]');
		// Case #18: Area(3). Index num is area which choose 1 and 2 value. 3 arguments were used.
		oParser = new parserFormula('CHOOSE(B102:B103,A102:A105,E102:F104)', "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(B102:B103,A102:A105,E102:F104) is parsed.');
		array = oParser.calculate();
		arraySize = array.getDimensions();
		assert.ok(arraySize.row === 4 && arraySize.col === 2, 'Test: Array size in CHOOSE(B102:B103,A102:A105,E102:F104)');
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 23, 'Test: Positive case: Area(3). Index num is area which choose 1 and 2 value. 3 arguments were used[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 23, 'Test: Positive case: Area(3). Index num is area which choose 1 and 2 value. 3 arguments were used[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "fasf", 'Test: Positive case: Area(3). Index num is area which choose 1 and 2 value. 3 arguments were used[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "jkl", 'Test: Positive case: Area(3). Index num is area which choose 1 and 2 value. 3 arguments were used[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", 'Test: Positive case: Area(3). Index num is area which choose 1 and 2 value. 3 arguments were used[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "#N/A", 'Test: Positive case: Area(3). Index num is area which choose 1 and 2 value. 3 arguments were used[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", 'Test: Positive case: Area(3). Index num is area which choose 1 and 2 value. 3 arguments were used[3,0]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), "#N/A", 'Test: Positive case: Area(3). Index num is area which choose 1 and 2 value. 3 arguments were used[3,1]');
		// Case #19: Array, Area(2). Index num is array which choose 1 and 2 value. 3 arguments were used.
		oParser = new parserFormula('CHOOSE({1;2},A102:A105,E102:F104)', "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE({1;2},A102:A105,E102:F104) is parsed.');
		array = oParser.calculate();
		arraySize = array.getDimensions();
		assert.ok(arraySize.row === 4 && arraySize.col === 2, 'Test: Array size in CHOOSE({1;2},A102:A105,E102:F104');
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 23, 'Test: Positive case: Array, Area(2). Index num is array which choose 1 and 2 value. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 23, 'Test: Positive case: Array, Area(2). Index num is array which choose 1 and 2 value. 3 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "fasf", 'Test: Positive case: Array, Area(2). Index num is array which choose 1 and 2 value. 3 arguments were used.[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "jkl", 'Test: Positive case: Array, Area(2). Index num is array which choose 1 and 2 value. 3 arguments were used.[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", 'Test: Positive case: Array, Area(2). Index num is array which choose 1 and 2 value. 3 arguments were used.[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "#N/A", 'Test: Positive case: Array, Area(2). Index num is array which choose 1 and 2 value. 3 arguments were used.[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", 'Test: Positive case: Array, Area(2). Index num is array which choose 1 and 2 value. 3 arguments were used.[3,0]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), "#N/A", 'Test: Positive case: Array, Area(2). Index num is array which choose 1 and 2 value. 3 arguments were used.[3,1]');
		// Case #20: Array, Area(2). Index num is array which choose 2 and 1 value in decimal number. 3 arguments were used.
		oParser = new parserFormula('CHOOSE({2,2;1,1;1,1},A102:A105,E102:F104)', "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE({2,2;1,1;1,1},A102:A105,E102:F104) is parsed.');
		array = oParser.calculate();
		arraySize = array.getDimensions();
		assert.ok(arraySize.row === 4 && arraySize.col === 2, 'Test: Array size in CHOOSE({1;2},A102:A105,E102:F104');
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "ds", 'Test: Positive case:Array, Area(2). Index num is array which choose 2 and 1 value in decimal number. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "123das", 'Test: Positive case:Array, Area(2). Index num is array which choose 2 and 1 value in decimal number. 3 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 45, 'Test: Positive case:Array, Area(2). Index num is array which choose 2 and 1 value in decimal number. 3 arguments were used.[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 45, 'Test: Positive case:Array, Area(2). Index num is array which choose 2 and 1 value in decimal number. 3 arguments were used.[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 12, 'Test: Positive case:Array, Area(2). Index num is array which choose 2 and 1 value in decimal number. 3 arguments were used.[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 12, 'Test: Positive case:Array, Area(2). Index num is array which choose 2 and 1 value in decimal number. 3 arguments were used.[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", 'Test: Positive case:Array, Area(2). Index num is array which choose 2 and 1 value in decimal number. 3 arguments were used.[3,0]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), "#N/A", 'Test: Positive case:Array, Area(2). Index num is array which choose 2 and 1 value in decimal number. 3 arguments were used.[3,1]');
		// Case #21: Number, Area3D(2). Valid Area3D references with index_num = 2. 3  arguments were used.
		oParser = new parserFormula('CHOOSE(2,Sheet2!A1:A1,Sheet2!A2:A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(2,Sheet2!A1:A1,Sheet2!A2:A2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue()[0].getValue(), '2nd', 'Test: Positive case: Number, Area3D(2). Valid Area3D references with index_num = 2. 3  arguments were used.');
		// Case #22: Number, Ref3D(3). Valid Ref3D references with index_num = 3. 4  arguments were used.
		oParser = new parserFormula('CHOOSE(3,Sheet2!A1,Sheet2!A2, Sheet2!A3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(3,Sheet2!A1,Sheet2!A2, Sheet2!A3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), '3rd', 'Test: Positive case: Number, Ref3D(3). Valid Ref3D references with index_num = 3. 4  arguments were used.');
		// Case #23: Number, Table(2). Valid Table references with index_num = 2. 3 arguments were used.
		oParser = new parserFormula('CHOOSE(2,Table1[Column1],Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(2,Table1[Column1],Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), '2nd', 'Test: Positive case: Number, Table(2). Valid Table references with index_num = 2. 3 arguments were used.');
		// Case #24: Number, Name(2). Valid Name references with index_num = 3. 4 arguments were used.
		oParser = new parserFormula('CHOOSE(3,TestName,TestName1,TestName2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(3,TestName,TestName1,TestName2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().value, '3rd', 'Test: Positive case: Number, Name(2). Valid Name references with index_num = 3. 4 arguments were used.');
		// Case #25: Number, Name3D(2). Valid Name3D references with index_num = 4. 5 arguments were used.
		oParser = new parserFormula('CHOOSE(4,TestName3D,TestName3D1, TestName3D2, TestName3D3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(4,TestName3D,TestName3D1, TestName3D2, TestName3D3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 'Finished', 'Test: Positive case: Number, Name3D(2). Valid Name3D references with index_num = 4. 5 arguments were used.');
		// Case #26: Area3D, String(3). index_num is Area3D reference.
		// Different result with MS.
		oParser = new parserFormula('CHOOSE(Sheet2!A5:A5,"1st","2nd","3rd")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(Sheet2!A5:A5,"1st","2nd","3rd") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '2nd', 'Test: Positive case: Area3D, String(3). index_num is Area3D reference.');
		// Case #27: Ref3D, String(3). index_num is Ref3D reference.
		oParser = new parserFormula('CHOOSE(Sheet2!A5,"1st","2nd", "3rd")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(Sheet2!A5,"1st","2nd", "3rd") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '2nd', 'Test: Positive case: Ref3D, String(3). index_num is Ref3D reference.');
		// Case #28: Table, String(3). index_num is Table reference.
		oParser = new parserFormula('CHOOSE(Table1[Column3],"1st","2nd", "3rd")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(Table1[Column3],"1st","2nd", "3rd") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '2nd', 'Test: Positive case: Table, String(3). index_num is Table reference.');
		// Case #29: Name, String(3). index_num is Name reference.
		oParser = new parserFormula('CHOOSE(TestName4,"1st","2nd", "3rd")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(TestName4,"1st","2nd", "3rd") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '2nd', 'Test: Positive case: Name, String(3). index_num is Name reference.');
		// Case #30: Name3D, String(3). index_num is Name3D reference.
		oParser = new parserFormula('CHOOSE(TestName3D4,"1st","2nd", "3rd")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(TestName3D4,"1st","2nd", "3rd") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '2nd', 'Test: Positive case: Name3D, String(3). index_num is Name3D reference.');

		// Negative cases:

		ws.getRange2("B2").setValue("#N/A");
		ws.getRange2("B3").setValue("#DIV/0!");

		// Case #1: Boolean, Number(3). Incorrect value of the list argumets (index_num as bool -> number) index_num is less than 1. 4 arguments were used.
		oParser = new parserFormula('CHOOSE(FALSE,1,2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(FALSE,1,2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Boolean, Number(3). Incorrect value of the list argumets (index_num as bool -> number) index_num is less than 1. 4 arguments were used.');
		// Case #2: String, Number(3). Incorrect value of the list argumets, index_num string as text. 4 arguments were used.
		oParser = new parserFormula('CHOOSE("1s",1,2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE("1s",1,2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: String, Number(3). Incorrect value of the list argumets, index_num string as text. 4 arguments were used.');
		// Case #3: Reference link, Number(3). Incorrect value of the list argumets, index_num ref to #N/A error. 4 arguments were used.
		oParser = new parserFormula('CHOOSE(B2,1,2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(B2,1,2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Reference link, Number(3). Incorrect value of the list argumets, index_num ref to #N/A error. 4 arguments were used.');
		// Case #4: Number, Reference link, Number(2). Value of the first list argument. First value ref to #N/A error. 4 arguments were used.
		oParser = new parserFormula('CHOOSE(1,B2,2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(1,B2,2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), '#N/A', 'Test: Negative case: Number, Reference link, Number(2). Value of the first list argument. First value ref to #N/A error. 4 arguments were used.');
		// Case #5: Reference link(2), Number(2). Incorrect value of the list argumets, index_num ref to #DIV/0 error and the first value ref to #N/A error. 4 arguments were used.
		oParser = new parserFormula('CHOOSE(B3,B2,2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(B3,B2,2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#DIV/0!', 'Test: Negative case: Reference link(2), Number(2). Incorrect value of the list argumets, index_num ref to #DIV/0 error and the first value ref to #N/A error. 4 arguments were used.');
		// Case #6: Error, Number(3). Incorrect value of the list argumets, index_num #N/A error. 4 arguments were used.
		oParser = new parserFormula('CHOOSE(#N/A,1,2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(#N/A,1,2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error, Number(3). Incorrect value of the list argumets, index_num #N/A error. 4 arguments were used.');
		// Case #7: Number, Error, Number(2). Value of the first list argument. First value is #N/A error. 4 arguments were used.
		oParser = new parserFormula('CHOOSE(1,#N/A,2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(1,#N/A,2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Error, Number(2). Value of the first list argument. First value is #N/A error. 4 arguments were used.');
		// Case #8: Error(2), Number(2). Incorrect value of the list argumets, index_num #DIV/0 error and the first value is #N/A error. 4 arguments were used.
		oParser = new parserFormula('CHOOSE(#DIV/0!,#N/A,2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(#DIV/0!,#N/A,2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#DIV/0!', 'Test: Negative case: Error(2), Number(2). Incorrect value of the list argumets, index_num #DIV/0 error and the first value is #N/A error. 4 arguments were used.');
		// Case #9: Empty, String(2). Empty index_num results in #VALUE! error. 1 of 2 arguments used.
		oParser = new parserFormula('CHOOSE(,"1st","2nd")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(,"1st","2nd") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Empty, String(2). Empty index_num results in #VALUE! error. 1 of 2 arguments used.');
		// Case #10: Number, Area. Value is whole column. 2 arguments were used.
		oParser = new parserFormula('CHOOSE(1,A:A)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(1,A:A) is parsed.');
		assert.strictEqual(oParser.calculate().getValue()[0].getValue(), '1st', 'Test: Negative case: Number, Area. Value is whole column. 2 arguments were used.');
		// Case #11: Array, Number(3). Index_num is an array with mostly incorrect number. 4 arguments were used.
		oParser = new parserFormula('CHOOSE({-1,0,1},1,2,3)', "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE({-1,0,1},1,2,3) is parsed.');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", 'Test: Negative case: Array, Number(3). Index_num is an array with mostly incorrect number. 4 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#VALUE!", 'Test: Negative case: Array, Number(3). Index_num is an array with mostly incorrect number. 4 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 1, 'Test: Negative case: Array, Number(3). Index_num is an array with mostly incorrect number. 4 arguments were used.[0,2]');

		// Bounded cases:

		// Case #1: Number, Ref3D. Minimum valid index_num with Ref3D reference.
		oParser = new parserFormula('CHOOSE(1,Sheet2!A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(1,Sheet2!A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), '1st', 'Test: Bounded case: Number, Ref3D. Minimum valid index_num with Ref3D reference.');
		// Case #2: Number, Empty. Value is empty. 2 arguments were used.
		// Different result with MS
		oParser = new parserFormula('CHOOSE(1,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSE(1,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Bounded case: Number, Empty. Value is empty. 2 arguments were used.');

		//функция возвращает ref
		//testArrayFormula2(assert, "CHOOSE", 2, 9);
	});


	QUnit.test("Test: \"CHOOSECOLS\"", function (assert) {
		//1. Adding common tests
		// Data for reference link. Use A100-A111
		ws.getRange2("A1").setValue("1");
		ws.getRange2("A2").setValue("2");
		ws.getRange2("A3").setValue("");
		ws.getRange2("A4").setValue("4");
		ws.getRange2("A5").setValue("#N/A");
		ws.getRange2("A6").setValue("f");

		ws.getRange2("B1").setValue("q");
		ws.getRange2("B2").setValue("w");
		ws.getRange2("B3").setValue("e");
		ws.getRange2("B4").setValue("test");
		ws.getRange2("B5").setValue("hhh");
		ws.getRange2("B6").setValue("g");

		ws.getRange2("C1").setValue("r");
		ws.getRange2("C2").setValue("3");
		ws.getRange2("C3").setValue("5");
		ws.getRange2("C4").setValue("");
		ws.getRange2("C5").setValue("6");
		ws.getRange2("C6").setValue("h");

		ws.getRange2("A100").setValue("1");
		ws.getRange2("A101").setValue("2");
		ws.getRange2("B100").setValue("3");
		ws.getRange2("B101").setValue("4");
		ws.getRange2("C100").setValue("5");
		ws.getRange2("C101").setValue("6");

		ws.getRange2("F1").setValue("1");
		ws.getRange2("G1").setValue("3");
		// Table type. Use A601:L6**
		getTableType(599, 0, 601, 0);
		ws.getRange2("A601").setValue("1"); // Column1
		ws.getRange2("A602").setValue("2"); // Column1
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("1");
		// DefNames. Use A201-A208, B208
		ws.getRange2("A201").setValue("1"); // TestName
		ws.getRange2("A206").setValue("1"); // TestNameArea
		ws.getRange2("A207").setValue("2"); // TestNameArea
		// DefNames 3D. Use A11-A18, B18
		ws2.getRange2("A11").setValue("1") // TestName3D
		ws2.getRange2("A16").setValue("1"); // TestNameArea3D
		ws2.getRange2("A17").setValue("2"); // TestNameArea3D

		// Positive cases:

		// Case #1:	Area, Number(2). Choose C and A columns. 3 arguments were used.
		oParser = new parserFormula("CHOOSECOLS(A1:C6;-1;1)", "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(A1:C6;-1;1) is parsed.');
		let array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 'r', 'Test: Positive case: Area, Number(2). Choose C and A columns. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 3, 'Test: Positive case: Area, Number(2). Choose C and A columns. 3 arguments were used.[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 5, 'Test: Positive case: Area, Number(2). Choose C and A columns. 3 arguments were used.[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), '', 'Test: Positive case: Area, Number(2). Choose C and A columns. 3 arguments were used.[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 6, 'Test: Positive case: Area, Number(2). Choose C and A columns. 3 arguments were used.[4,0]');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), 'h', 'Test: Positive case: Area, Number(2). Choose C and A columns. 3 arguments were used.[5,0]');

		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 1, 'Test: Positive case: Area, Number(2). Choose C and A columns. 3 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 2, 'Test: Positive case: Area, Number(2). Choose C and A columns. 3 arguments were used.[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), '', 'Test: Positive case: Area, Number(2). Choose C and A columns. 3 arguments were used.[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), 4, 'Test: Positive case: Area, Number(2). Choose C and A columns. 3 arguments were used.[3,1]');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), '#N/A', 'Test: Positive case: Area, Number(2). Choose C and A columns. 3 arguments were used.[4,1]');
		assert.strictEqual(array.getElementRowCol(5, 1).getValue(), 'f', 'Test: Positive case: Area, Number(2). Choose C and A columns. 3 arguments were used.[5,1]');

		// Case #2: Area, Number(2). Choose B and C columns. 3 arguments were used.
		oParser = new parserFormula("CHOOSECOLS(A1:C6;-2;3)", "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(A1:C6;-2;3) is parsed.');
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 'q', 'Test: Positive case: Area, Number(2). Choose B and C columns. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 'w', 'Test: Positive case: Area, Number(2). Choose B and C columns. 3 arguments were used.[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 'e', 'Test: Positive case: Area, Number(2). Choose B and C columns. 3 arguments were used.[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 'test', 'Test: Positive case: Area, Number(2). Choose B and C columns. 3 arguments were used.[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 'hhh', 'Test: Positive case: Area, Number(2). Choose B and C columns. 3 arguments were used.[4,0]');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), 'g', 'Test: Positive case: Area, Number(2). Choose B and C columns. 3 arguments were used.[5,0]');

		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'r', 'Test: Positive case: Area, Number(2). Choose B and C columns. 3 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 3, 'Test: Positive case: Area, Number(2). Choose B and C columns. 3 arguments were used.[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 5, 'Test: Positive case: Area, Number(2). Choose B and C columns. 3 arguments were used.[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), '', 'Test: Positive case: Area, Number(2). Choose B and C columns. 3 arguments were used.[3,1]');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), 6, 'Test: Positive case: Area, Number(2). Choose B and C columns. 3 arguments were used.[4,1]');
		assert.strictEqual(array.getElementRowCol(5, 1).getValue(), 'h', 'Test: Positive case: Area, Number(2). Choose B and C columns. 3 arguments were used.[5,1]');
		//2. Arguments with different types
		// Case #3: Number(2). Array as number and choosing first column. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Number(2). Array as number and choosing first column. 2 arguments were used.');
		// Case #4: String,Number. Array as string and choosing first column. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS("test",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS("test",1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'test', 'Test: Positive case: String,Number. Array as string and choosing first column. 2 arguments were used.');
		// Case #5: Boolean, Number. Array as boolean and choosing first column. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(true,1.5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(true,1.5) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'TRUE', 'Test: Positive case: Boolean, Number. Array as boolean and choosing first column. 2 arguments were used.');
		// Case #6: Reference link, Number. Array as reference link with single cell and choosing first column. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(B1, 1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(B1, 1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'q', 'Test: Positive case: Reference link, Number. Array as reference link with single cell and choosing first column. 2 arguments were used.');
		// Case #7: Array,Number. Array as number and choosing first column. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS({2,"","test"},3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS({2,"","test"},3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'test', 'Test: Positive case: Array,Number. Array as number and choosing first column. 2 arguments were used.');
		// Case #8: Area(2). Array has only one column. col_num1 is first colimn by single cell area. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(A1:A2,F1:F1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(A1:A2,F1:F1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Area(2). Array has only one column. col_num1 is first colimn by single cell area. 2 arguments were used.');
		// Case #9: Number, Boolean. Col_num as boolean which converting to 1. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(1,true)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(1,true) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Number, Boolean. Col_num as boolean which converting to 1. 2 arguments were used.');
		// Case #10: Number, Reference link. Col_num as ref to single cell. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(1,A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(1,A1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Number, Reference link. Col_num as ref to single cell. 2 arguments were used.');
		// Case #11: Table,Number. Array is table with 1 column. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(Table1[Column1],1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(Table1[Column1],1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Table,Number. Array is table with 1 column. 2 arguments were used.');
		// Case #12: Ref3D(2). Array is ref3D link to 1 column cells. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(Sheet2!A1:A2,Sheet2!A3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(Sheet2!A1:A2,Sheet2!A3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Ref3D(2). Array is ref3D link to 1 column cells. 2 arguments were used.');
		// Case #13: Name(2). Array is name link to 1 column cells. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(TestNameArea,TestName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(TestNameArea,TestName) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Name(2). Array is name link to 1 column cells. 2 arguments were used.');
		// Case #14: Name3D(2). Array is name3D link to 1 column cells. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(TestNameArea3D,TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(TestNameArea3D,TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Name3D(2). Array is name3D link to 1 column cells. 2 arguments were used.');
		// Case #15: Formula. CHOOSECOLS is nested formula
		oParser = new parserFormula('SUM(CHOOSECOLS(A100:C101,-1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula SUM(CHOOSECOLS(A100:C101,-1,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 14, 'Test: Positive case: Formula. CHOOSECOLS is nested formula');
		// Case #16: Area(3). Choose 1 and 3 column using area two times. 3 arguments were used.
		oParser = new parserFormula("CHOOSECOLS(A1:C2,F1:G1,F1:G1)", "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(A1:C2,F1:G1,F1:G1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case:Area(3). Choose 1 and 3 column using area two times. 3 arguments were used.[0,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 0).getValue(), 2, 'Test: Positive case:Area(3). Choose 1 and 3 column using area two times. 3 arguments were used.[1,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 1).getValue(), "r", 'Test: Positive case:Area(3). Choose 1 and 3 column using area two times. 3 arguments were used.[0,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 1).getValue(), 3, 'Test: Positive case:Area(3). Choose 1 and 3 column using area two times. 3 arguments were used.[1,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 2).getValue(), 1, 'Test: Positive case:Area(3). Choose 1 and 3 column using area two times. 3 arguments were used.[0,2]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 2).getValue(), 2, 'Test: Positive case:Area(3). Choose 1 and 3 column using area two times. 3 arguments were used.[1,2]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 3).getValue(), "r", 'Test: Positive case:Area(3). Choose 1 and 3 column using area two times. 3 arguments were used.[0,3]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 3).getValue(), 3, 'Test: Positive case:Area(3). Choose 1 and 3 column using area two times. 3 arguments were used.[1,3]');
		// Case #17: Area(2). Choose 1 and 3 column using area two times. 2 arguments were used.
		oParser = new parserFormula("CHOOSECOLS(A1:C2,F1:G1)", "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(A1:C2,F1:G1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case:Area(2). Choose 1 and 3 column using area two times. 2 arguments were used. [0,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 0).getValue(), 2, 'Test: Positive caseArea(2). Choose 1 and 3 column using area two times. 2 arguments were used.: [1,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 1).getValue(), "r", 'Test: Positive case:Area(2). Choose 1 and 3 column using area two times. 2 arguments were used. [0,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 1).getValue(), 3, 'Test: Positive case:Area(2). Choose 1 and 3 column using area two times. 2 arguments were used. [1,1]');
		// Case #18: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used.
		oParser = new parserFormula("CHOOSECOLS(A1:C2,{1,2},{1,2},{1,2,3})", "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(A1:C2,{1,2},{1,2},{1,2,3}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [0,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 0).getValue(), 2, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [1,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 1).getValue(), "q", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [0,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 1).getValue(), "w", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [1,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 2).getValue(), 1, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [0,2]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 2).getValue(), 2, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [1,2]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 3).getValue(), "q", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [0,3]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 3).getValue(), "w", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [1,3]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 4).getValue(), 1, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [0,4]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 4).getValue(), 2, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [1,4]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 5).getValue(), "q", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [0,5]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 5).getValue(), "w", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [1,5]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 6).getValue(), "r", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [0,6]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 6).getValue(), 3, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array. 4 arguments were used. [1,6]');
		// Case #19:  Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used.
		oParser = new parserFormula("CHOOSECOLS(A1:C2,{1;2},{1;2},{1;2;3})", "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(A1:C2,{1;2},{1;2},{1;2;3}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [0,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 0).getValue(), 2, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [1,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 1).getValue(), "q", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [0,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 1).getValue(), "w", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [1,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 2).getValue(), 1, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [0,2]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 2).getValue(), 2, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [1,2]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 3).getValue(), "q", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [0,3]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 3).getValue(), "w", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [1,3]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 4).getValue(), 1, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [0,4]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 4).getValue(), 2, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [1,4]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 5).getValue(), "q", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [0,5]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 5).getValue(), "w", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [1,5]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 6).getValue(), "r", 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [0,6]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 6).getValue(), 3, 'Test: Positive case: Area, Array(3). Choose 1 and 2 columns two times using array and 1,2,3 column using array (with divide ";"). 4 arguments were used. [1,6]');

		// Negative cases:

		// Case #1: Area, Number(2). col_num1 is exceeds the number of columns in the array. 3 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(A1:C6,-4,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(A1:C6,-4,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number(2). col_num1 is exceeds the number of columns in the array. 3 arguments were used.');
		// Case #2: Area, Number(2). col_num2 is exceeds the number of columns in the array. 3 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(A1:C6,-2,4)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(A1:C6,-2,4) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number(2). col_num2 is exceeds the number of columns in the array. 3 arguments were used.');
		// Case #3: Area, Number(2). col_num2 is zero. 3 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(A1:C6,-2,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(A1:C6,-2,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number(2). col_num2 is zero. 3 arguments were used.');
		// Case #4: Error, Number. Array is error. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(#VALUE!,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(#VALUE!,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Error, Number. Array is error. 2 arguments were used.');
		// Case #5: Empty, Number. Array is empty. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(,2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Empty, Number. Array is empty. 2 arguments were used.');
		// Case #6: Array, Number. Array is array with  row orienation and col_num is exceeds the number of columns in the array. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS({2;"";"test"},3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS({2;"";"test"},3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, Number. Array is array with  row orienation and col_num is exceeds the number of columns in the array. 2 arguments were used.');
		// Case #7: Number, String. col_num is string with text. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(1,"test")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(1,"test") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, String. col_num is string with text. 2 arguments were used.');
		// Case #8: Number, Error. col_num is error. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(1, #VALUE!)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(1, #VALUE!) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Error. col_num is error. 2 arguments were used.');
		// Case #9: Number, Empty. col_num is empty. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(1,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(1,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Empty. col_num is empty. 2 arguments were used.');
		// Case #10: Number, Area. col_num  is area with incorrect data. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(1,A1:B5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(1,A1:B5) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Area. col_num  is area with incorrect data. 2 arguments were used.');
		// Case #11: Number,Array. col_num is string with text. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(1,{2;"";"test"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(1,{2;"";"test"}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number,Array. col_num is string with text. 2 arguments were used.');
		// Case #12: Area, Array(3). col_num2  has incorrect orientation  row and cols.  4 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(A1:C2,{1;2},{1,1;2,1},{1;2;3})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(A1:C2,{1;2},{1,1;2,1},{1;2;3}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Array(3). col_num2  has incorrect orientation  row and cols.  4 arguments were used.');
		// Case #13: Area, Array, Area. col_num2 as area  has incorrect orientation  row and cols.  3 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(A1:C2,{1;2},F1:G2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(A1:C2,{1;2},F1:G2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Array, Area. col_num2 as area  has incorrect orientation  row and cols.  3 arguments were used.');
		// Case #14: Area, Number(2). Array whole row. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(100:100, 10)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(100:100, 10) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '', 'Test: Negative case: Area, Number(2). Array whole row. 2 arguments were used.');
		// Case #15: Area, Number(2). Array whole column. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(D:D, 1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(D:D, 1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '', 'Test: Negative case: Area, Number(2). Array whole column. 2 arguments were used.');
		// Case #16: Number, Table. Table with incorrect data for col_num. 2 arguments were used.
		oParser = new parserFormula('CHOOSECOLS(1,Table1[Column1])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSECOLS(1,Table1[Column1]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Table. Table with incorrect data for col_num. 2 arguments were used.');
	});

	QUnit.test("Test: \"CHOOSEROWS\"", function (assert) {
		//1. Adding common tests
		// Data for reference link. Use A100-A111
		ws.getRange2("A1").setValue("1");
		ws.getRange2("A2").setValue("2");
		ws.getRange2("A3").setValue("");
		ws.getRange2("A4").setValue("4");
		ws.getRange2("A5").setValue("#N/A");
		ws.getRange2("A6").setValue("f");

		ws.getRange2("B1").setValue("q");
		ws.getRange2("B2").setValue("w");
		ws.getRange2("B3").setValue("e");
		ws.getRange2("B4").setValue("test");
		ws.getRange2("B5").setValue("hhh");
		ws.getRange2("B6").setValue("g");

		ws.getRange2("C1").setValue("r");
		ws.getRange2("C2").setValue("3");
		ws.getRange2("C3").setValue("5");
		ws.getRange2("C4").setValue("");
		ws.getRange2("C5").setValue("6");
		ws.getRange2("C6").setValue("h");

		ws.getRange2("A100").setValue("1");
		ws.getRange2("A101").setValue("2");
		ws.getRange2("B100").setValue("3");
		ws.getRange2("B101").setValue("4");
		ws.getRange2("C100").setValue("5");
		ws.getRange2("C101").setValue("6");

		ws.getRange2("F1").setValue("1");
		ws.getRange2("G1").setValue("3");
		// Table type. Use A601:L6**
		getTableType(599, 0, 601, 1);
		ws.getRange2("A601").setValue("1"); // Column1
		ws.getRange2("A602").setValue("2"); // Column1
		ws.getRange2("B601").setValue("1"); // Column2
		ws.getRange2("B602").setValue("2"); // Column2
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("1");
		// DefNames. Use A201-A208, B208
		ws.getRange2("A201").setValue("1"); // TestName
		ws.getRange2("A206").setValue("1"); // TestNameArea
		ws.getRange2("A207").setValue("2"); // TestNameArea
		// DefNames 3D. Use A11-A18, B18
		ws2.getRange2("A11").setValue("1") // TestName3D
		ws2.getRange2("A16").setValue("1"); // TestNameArea3D
		ws2.getRange2("A17").setValue("2"); // TestNameArea3D

		// Positive cases:

		// Case #1: Area, Number(2).Choosing 6 row and 1 row. 3 arguments were used.
		oParser = new parserFormula("CHOOSEROWS(A1:C6;-1;1)", "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(A1:C6;-1;1) is parsed.');
		let array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 'f', 'Test: Positive case: Area, Number(2).Choose 6 row and 1 row. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 1, 'Test: Positive case: Area, Number(2).Choose 6 row and 1 row. 3 arguments were used.[1,0]');

		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'g', 'Test: Positive case: Area, Number(2).Choose 6 row and 1 row. 3 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 'q', 'Test: Positive case: Area, Number(2).Choose 6 row and 1 row. 3 arguments were used.[1,1]');

		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 'h', 'Test: Positive case: Area, Number(2).Choose 6 row and 1 row. 3 arguments were used.[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 'r', 'Test: Positive case: Area, Number(2).Choose 6 row and 1 row. 3 arguments were used.[1,2]');
		// Case #2: Area, Number(2). Choosing 5 row and 3 row. 3 arguments were used.
		oParser = new parserFormula("CHOOSEROWS(A1:C6;-2;3)", "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(A1:C6;-2;3) is parsed.');
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), '#N/A', 'Test: Positive case: Area, Number(2).Choose 5 row and 3 row. 3 arguments were used.[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), '', 'Test: Positive case: Area, Number(2).Choose 5 row and 3 row. 3 arguments were used.[1,0]');

		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'hhh', 'Test: Positive case: Area, Number(2).Choose 5 row and 3 row. 3 arguments were used.[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 'e', 'Test: Positive case: Area, Number(2).Choose 5 row and 3 row. 3 arguments were used.[1,1]');

		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 6, 'Test: Positive case: Area, Number(2).Choose 5 row and 3 row. 3 arguments were used.[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 5, 'Test: Positive case: Area, Number(2).Choose 5 row and 3 row. 3 arguments were used.[1,2]');
		//2. Arguments with different type.
		// Case #3: Number(2). Array as number and choosing first column. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Number(2). Array as number and choosing first column. 2 arguments were used.');
		// Case #4: String,Number. Array as string and choosing first column. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS("test",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS("test",1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'test', 'Test: Positive case: String,Number. Array as string and choosing first column. 2 arguments were used.');
		// Case #5: Boolean, Number. Array as boolean and choosing first column. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(true,1.5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(true,1.5) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'TRUE', 'Test: Positive case: Boolean, Number. Array as boolean and choosing first column. 2 arguments were used.');
		// Case #6: Reference link, Number. Array as reference link with single cell and choosing first column. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(B1, 1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(B1, 1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'q', 'Test: Positive case: Reference link, Number. Array as reference link with single cell and choosing first column. 2 arguments were used.');
		// Case #7: Array,Number. Array as number and choosing first column. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS({2;"";"test"},3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS({2;"";"test"},3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'test', 'Test: Positive case: Array,Number. Array as number and choosing first column. 2 arguments were used.');
		// Case #8: Area(2). Array has only one column. col_num1 is first colimn by single cell area. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(A1:A2,F1:F1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(A1:A2,F1:F1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Area(2). Array has only one column. col_num1 is first colimn by single cell area. 2 arguments were used.');
		// Case #9: Number, Boolean. Col_num as boolean which converting to 1. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(1,true)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(1,true) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Number, Boolean. Col_num as boolean which converting to 1. 2 arguments were used.');
		// Case #10: Number, Reference link. Col_num as ref to single cell. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(1,A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(1,A1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Number, Reference link. Col_num as ref to single cell. 2 arguments were used.');
		// Case #11: Table, Number. Array is table with 1 column. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(Table1[Column1],1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(Table1[Column1],1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Table, Number. Array is table with 1 column. 2 arguments were used.');
		// Case #12: Table(2). Array is table with 1 column  and col_num table with 1 column. 2 arguments were used.
		// Different result with MS
		oParser = new parserFormula('CHOOSEROWS(Table1[Column1],Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(Table1[Column1],Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Table(2). Array is table with 1 column  and col_num table with 1 column. 2 arguments were used.');
		// Case #13: Ref3D(2). Array is ref3D link to 1 column cells. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(Sheet2!A1:A2,Sheet2!A3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(Sheet2!A1:A2,Sheet2!A3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Ref3D(2). Array is ref3D link to 1 column cells. 2 arguments were used.');
		// Case #14: Name(2). Array is name link to 1 column cells. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(TestNameArea,TestName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(TestNameArea,TestName) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Name(2). Array is name link to 1 column cells. 2 arguments were used.');
		// Case #15: Name3D(2). Array is name3D link to 1 column cells. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(TestNameArea3D,TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(TestNameArea3D,TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Name3D(2). Array is name3D link to 1 column cells. 2 arguments were used.');
		// Case #16: Formula. CHOOSEROWS is nested formula
		oParser = new parserFormula('SUM(CHOOSEROWS(A100:C101,-1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula SUM(CHOOSEROWS(A100:C101,-1,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 21, 'Test: Positive case: Formula. CHOOSEROWS is nested formula');
		ws.getRange2("G1").setValue("2");
		// Case #17: Area(3). Choosing 1 and 2 row using Area. 3 arguments were used.
		oParser = new parserFormula("CHOOSEROWS(A1:C2,F1:G1,F1:G1)", "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(A1:C2,F1:G1,F1:G1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Area(3). Choosing 1 and 2 row using Area. 3 argument were used.[0,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 1).getValue(), "q", 'Test: Positive case: Area(3). Choosing 1 and 2 row using Area. 3 argument were used.[0,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 2).getValue(), "r", 'Test: Positive case: Area(3). Choosing 1 and 2 row using Area. 3 argument were used.[0,2]');

		assert.strictEqual(oParser.calculate().getElementRowCol(1, 0).getValue(), 2, 'Test: Positive case: Area(3). Choosing 1 and 2 row using Area. 3 argument were used.[1,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 1).getValue(), "w", 'Test: Positive case: Area(3). Choosing 1 and 2 row using Area. 3 argument were used.[1,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 2).getValue(), 3, 'Test: Positive case: Area(3). Choosing 1 and 2 row using Area. 3 argument were used.[1,2]');

		assert.strictEqual(oParser.calculate().getElementRowCol(2, 0).getValue(), 1, 'Test: Positive case: Area(3). Choosing 1 and 2 row using Area. 3 argument were used.[2,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(2, 1).getValue(), "q", 'Test: Positive case: Area(3). Choosing 1 and 2 row using Area. 3 argument were used.[2,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(2, 2).getValue(), "r", 'Test: Positive case: Area(3). Choosing 1 and 2 row using Area. 3 argument were used.[2,]');

		assert.strictEqual(oParser.calculate().getElementRowCol(3, 0).getValue(), 2, 'Test: Positive case: Area(3). Choosing 1 and 2 row using Area. 3 argument were used.[3,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(3, 1).getValue(), "w", 'Test: Positive case: Area(3). Choosing 1 and 2 row using Area. 3 argument were used.[3,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(3, 2).getValue(), 3, 'Test: Positive case: Area(3). Choosing 1 and 2 row using Area. 3 argument were used.[3,2]');
		// Case #18: Area, Array(2). Choosing 1 and 2 row using Array.3 arguments were used.
		oParser = new parserFormula("CHOOSEROWS(A1:C2,{1;2},{1;2})", "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(A1:C2,{1;2},{1;2}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array.3 arguments were used.[0,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 1).getValue(), "q", 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array.3 arguments were used.[0,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 2).getValue(), "r", 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array.3 arguments were used.[0,2]');

		assert.strictEqual(oParser.calculate().getElementRowCol(1, 0).getValue(), 2, 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array.3 arguments were used.[1,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 1).getValue(), "w", 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array.3 arguments were used.[1,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 2).getValue(), 3, 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array.3 arguments were used.[1,2]');

		assert.strictEqual(oParser.calculate().getElementRowCol(2, 0).getValue(), 1, 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array.3 arguments were used.[2,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(2, 1).getValue(), "q", 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array.3 arguments were used.[2,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(2, 2).getValue(), "r", 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array.3 arguments were used.[2,2]');

		assert.strictEqual(oParser.calculate().getElementRowCol(3, 0).getValue(), 2, 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array.3 arguments were used.[3,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(3, 1).getValue(), "w", 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array.3 arguments were used.[3,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(3, 2).getValue(), 3, 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array.3 arguments were used.[3,2]');

		oParser = new parserFormula("CHOOSEROWS(A1:C2,{1;2},{1;3})", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		// Case #19: Area, Array(2). Area, Array(2). Choosing 1 and 2 row using Array (divide ","). 3 arguments were used.
		oParser = new parserFormula("CHOOSEROWS(A1:C2,{1,2},{1,2})", "A1", ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(A1:C2,{1,2},{1,2}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array (divide ","). 3 arguments were used.[0,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 1).getValue(), "q", 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array (divide ","). 3 arguments were used.[0,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 2).getValue(), "r", 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array (divide ","). 3 arguments were used.[0,2]');

		assert.strictEqual(oParser.calculate().getElementRowCol(1, 0).getValue(), 2, 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array (divide ","). 3 arguments were used.[1,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 1).getValue(), "w", 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array (divide ","). 3 arguments were used.[1,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 2).getValue(), 3, 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array (divide ","). 3 arguments were used.[1,2]');

		assert.strictEqual(oParser.calculate().getElementRowCol(2, 0).getValue(), 1, 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array (divide ","). 3 arguments were used.[2,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(2, 1).getValue(), "q", 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array (divide ","). 3 arguments were used.[2,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(2, 2).getValue(), "r", 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array (divide ","). 3 arguments were used.[2,2]');

		assert.strictEqual(oParser.calculate().getElementRowCol(3, 0).getValue(), 2, 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array (divide ","). 3 arguments were used.[3,0]');
		assert.strictEqual(oParser.calculate().getElementRowCol(3, 1).getValue(), "w", 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array (divide ","). 3 arguments were used.[3,1]');
		assert.strictEqual(oParser.calculate().getElementRowCol(3, 2).getValue(), 3, 'Test: Positive case: Area, Array(2). Choosing 1 and 2 row using Array (divide ","). 3 arguments were used.[3,2]');

		// Negative cases:

		// Case #1: Area, Number(2). row_num2 is exceed number of rows. 3 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(A1:C6,-4,20)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(A1:C6,-4,20) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number(2). row_num2 is exceed number of rows. 3 arguments were used.');
		// Case #2: Area, Number(2). row_num is exceed number of rows. 3 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(A1:C6,-10,4)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(A1:C6,-10,4) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number(2). row_num is exceed number of rows. 3 arguments were used.');
		// Case #3: Area, Number(2). row_num2 is zero. 3 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(A1:C6,-2,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(A1:C6,-2,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number(2). row_num2 is zero. 3 arguments were used.');
		// Case #4: Error, Number. Array is error. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(#VALUE!,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(#VALUE!,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Error, Number. Array is error. 2 arguments were used.');
		// Case #5: Empty, Number. Array is empty. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(,2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Empty, Number. Array is empty. 2 arguments were used.');
		// Case #6: Array, Number. Array is array with  row orienation and col_num is exceeds the number of columns in the array. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS({2,"","test"},3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS({2,"","test"},3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, Number. Array is array with  row orienation and col_num is exceeds the number of columns in the array. 2 arguments were used.');
		// Case #7: Number, String. col_num is string with text. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(1,"test")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(1,"test") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, String. col_num is string with text. 2 arguments were used.');
		// Case #8: Number, Error. col_num is error. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(1, #VALUE!)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(1, #VALUE!) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Error. col_num is error. 2 arguments were used.');
		// Case #9: Number, Empty. col_num is empty. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(1,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(1,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Empty. col_num is empty. 2 arguments were used.');
		// Case #10: Number, Area. col_num  is area with incorrect data. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(1,A1:B5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(1,A1:B5) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Area. col_num  is area with incorrect data. 2 arguments were used.');
		// Case #11: Number,Array. col_num is string with text. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(1,{2;"";"test"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(1,{2;"";"test"}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number,Array. col_num is string with text. 2 arguments were used.');
		// Case #12: Area(3). col_num2  has incorrect orientation  row and cols.  3 arguments were used.
		ws.getRange2("G1").setValue("3");
		oParser = new parserFormula('CHOOSEROWS(A1:C2,F1:G1,F1:G1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(A1:C2,F1:G1,F1:G1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area(3). col_num2  has incorrect orientation  row and cols.  3 arguments were used.');
		// Case #13: Area, Array(2). col_num2  is array with incorrect data. 3 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(A1:C2,{1;2},{1;3})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(A1:C2,{1;2},{1;3}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Array(2). col_num2  is array with incorrect data. 3 arguments were used.');
		// Case #14: Area, Number(2). Array whole row. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(100:100, 10)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(100:100, 10) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number(2). Array whole row. 2 arguments were used.');
		// Case #15: Area, Number(2). Array whole column. 2 arguments were used.
		oParser = new parserFormula('CHOOSEROWS(D:D, 1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula CHOOSEROWS(D:D, 1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '', 'Test: Negative case: Area, Number(2). Array whole column. 2 arguments were used.');

	});

	QUnit.test("Test: \"COLUMN\"", function (assert) {

		// Positive cases:

		// Case #1: Reference link. Ref to B5 return 2
		oParser = new parserFormula('COLUMN(B6)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(B6) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Reference link. Ref to B5 return 2');
		// Case #2: Reference link. Ref to C16 return 3
		oParser = new parserFormula('COLUMN(C16)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(C16) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Test: Positive case: Reference link. Ref to C16 return 3');
		// Case #3: Empty. Empty argument return current cell
		oParser = new parserFormula('COLUMN()', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN() is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Empty. Empty argument return current cell');
		// Case #4: Formula. Current cell + current cell = 2
		oParser = new parserFormula('COLUMN()+COLUMN()', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN()+COLUMN() is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Formula. Current cell + current cell = 2');
		// Case #5: Reference link. Reference link to valid cell.
		oParser = new parserFormula('COLUMN(A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(A100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Reference link. Reference link to valid cell.');
		// Case #6: Area. Single-cell range as input.
		oParser = new parserFormula('COLUMN(A101:A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(A101:A102) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Area. Single-cell range as input.');
		// Case #7: Name. Named range.
		oParser = new parserFormula('COLUMN(TestName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(TestName) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Name. Named range.');
		// Case #8: Name3D. 3D Named range.
		oParser = new parserFormula('COLUMN(TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Name3D. 3D Named range.');
		// Case #9: Table. Table structured reference.
		oParser = new parserFormula('COLUMN(Table1[Column1])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(Table1[Column1]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Table. Table structured reference.');
		// Case #10: Ref3D. 3D reference link to valid cell.
		oParser = new parserFormula('COLUMN(Sheet2!A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(Sheet2!A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Ref3D. 3D reference link to valid cell.');
		// Case #11: Formula. Nested COLUMN functions.
		oParser = new parserFormula('SUM(COLUMN(A1:A2),COLUMN(A3))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula SUM(COLUMN(A1:A2),COLUMN(A3)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Formula. Nested COLUMN functions.');
		// Case #12: Area. Whole col
		oParser = new parserFormula('COLUMN(A:A)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(A:A) is parsed.');

		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Area. Whole col');
		// Case #13: Area. Whole row
		oParser = new parserFormula('COLUMN(1:1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(1:1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Area. Whole row');

		// Negative cases:

		// Case #1: Error. Input with #REF! error propagates the error.
		oParser = new parserFormula('COLUMN(#REF!)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(#REF!) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Error. Input with #REF! error propagates the error.');
		// Case #2: Reference link. Incorrect ref link minimum
		oParser = new parserFormula('COLUMN(A0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(A0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NAME?', 'Test: Negative case: Reference link. Incorrect ref link minimum');
		// Case #3: Reference link. Incorrect ref link maximum
		oParser = new parserFormula('COLUMN(XFE1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(XFE1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NAME?', 'Test: Negative case: Reference link. Incorrect ref link maximum');
		// Case #4: Name. Incorrect name
		oParser = new parserFormula('COLUMN(UnknownName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(UnknownName) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NAME?', 'Test: Negative case: Name. Incorrect name');

		// Bounded cases:

		// Case #1: Number. Maximum valid column index in Excel.
		oParser = new parserFormula('COLUMN(XFD1048576)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(XFD1048576) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 16384, 'Test: Bounded case: Number. Maximum valid column index in Excel.');
		// Case #2: Number. Minimum valid column index in Excel.
		oParser = new parserFormula('COLUMN(A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Bounded case: Number. Minimum valid column index in Excel.');
		// Case #3: Area. Maximum valid range with 2 cells.
		oParser = new parserFormula('COLUMN(A1:B2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMN(A1:B2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Bounded case: Area. Maximum valid range with 2 cells.');


		testArrayFormulaEqualsValues(assert, "5,6,7,8;5,6,7,8;5,6,7,8", "COLUMN()");
		testArrayFormulaEqualsValues(assert, "1,2,3,#N/A;1,2,3,#N/A;1,2,3,#N/A", "COLUMN(A1:C2)");
		testArrayFormulaEqualsValues(assert, "1,2,#N/A,#N/A;1,2,#N/A,#N/A;1,2,#N/A,#N/A", "COLUMN(A1:B1)");
		testArrayFormulaEqualsValues(assert, "1,1,1,1;1,1,1,1;1,1,1,1", "COLUMN(A1)");

	});

	QUnit.test("Test: \"COLUMNS\"", function (assert) {
		// Positive cases:

		// Case #1: Area. Number of columns in the reference C1:E4.
		oParser = new parserFormula('COLUMNS(C1:E4)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(C1:E4) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Test: Positive case: Area. Number of columns in the reference C1:E4.');
		// Case #2: Array. Number of columns in the array constant {1,2,3;4,5,6}.
		oParser = new parserFormula('COLUMNS({1,2,3;4,5,6})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS({1,2,3;4,5,6}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Test: Positive case: Array. Number of columns in the array constant {1,2,3;4,5,6}.');
		// Case #3: Number. Basic valid input: reference to a range with 3 columns.
		oParser = new parserFormula('COLUMNS(A1:C1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(A1:C1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Test: Positive case: Number. Basic valid input: reference to a range with 3 columns.');
		// Case #4: Array. Array with 3 elements.
		oParser = new parserFormula('COLUMNS({1, 2, 3})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS({1, 2, 3}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Test: Positive case: Array. Array with 3 elements.');
		// Case #5: Reference link. Reference link to a single cell. Returns 1 column.
		oParser = new parserFormula('COLUMNS(A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(A100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Reference link. Reference link to a single cell. Returns 1 column.');
		// Case #6: Area. Reference to a multi-cell range with 3 columns. Returns 3 columns.
		oParser = new parserFormula('COLUMNS(A100:C101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(A100:C101) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Test: Positive case: Area. Reference to a multi-cell range with 3 columns. Returns 3 columns.');
		// Case #7: Name. Named range with multiple columns. Returns 2 column.
		oParser = new parserFormula('COLUMNS(TestNameArea2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(TestNameArea2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Name. Named range with multiple columns. Returns 2 column.');
		// Case #8: Name3D. 3D named range. Returns 2 column.
		oParser = new parserFormula('COLUMNS(TestNameArea3D2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(TestNameArea3D2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Name3D. 3D named range. Returns 2 column.');
		// Case #9: Ref3D. 3D reference to a single cell. Returns 1 column.
		oParser = new parserFormula('COLUMNS(Sheet2!A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(Sheet2!A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Ref3D. 3D reference to a single cell. Returns 1 column.');
		// Case #10: Table. Table structured reference. Returns 1 column.
		oParser = new parserFormula('COLUMNS(Table1[Column1])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(Table1[Column1]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Table. Table structured reference. Returns 1 column.');
		// Case #11: Area3D. 3D reference to a three-cell range. Returns 26 columns.
		oParser = new parserFormula('COLUMNS(Sheet2!A1:Z3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(Sheet2!A1:Z3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 26, 'Test: Positive case: Area3D. 3D reference to a three-cell range. Returns 26 columns.');
		// Case #12: Formula. Nested formula: TRANSPOSE swaps rows and columns. Returns 3 columns.
		oParser = new parserFormula('COLUMNS(TRANSPOSE(A1:A3))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(TRANSPOSE(A1:A3)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Test: Positive case: Formula. Nested formula: TRANSPOSE swaps rows and columns. Returns 3 columns.');
		// Case #13: String. Arg as string. Returns 1 column.
		// Different result with MS
		oParser = new parserFormula('COLUMNS("A1:C1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS("A1:C1") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: String. Arg as string. Returns 1 column.');
		// Case #14: Range. Entire column range. Returns 1 column.
		oParser = new parserFormula('COLUMNS(M:M)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(M:M) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Range. Entire column range. Returns 1 column.');
		// Case #15: Range. Entire row range. Returns 16384 columns.
		oParser = new parserFormula('COLUMNS(100:100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(100:100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 16384, 'Test: Positive case: Range. Entire row range. Returns 16384 columns.');
		// Case #16: Reference link. Reference to a range with 5 rows and 5 column. Returns 5 column.
		oParser = new parserFormula('COLUMNS(A1:E5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(A1:E5) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Test: Positive case: Reference link. Reference to a range with 5 rows and 5 column. Returns 5 column.');
		// Case #17: Reference link. Reference to a range with 4 columns. Returns 4 columns.
		oParser = new parserFormula('COLUMNS(A1:D1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(A1:D1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Test: Positive case: Reference link. Reference to a range with 4 columns. Returns 4 columns.');

		// Negative cases:

		// Case #1: Number. Input is a number. Returns 1 column.
		// Different result with MS
		oParser = new parserFormula('COLUMNS(1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Number. Input is a number. Returns 1 column.');
		// Case #2: Boolean. Input is a Boolean - TRUE. Returns 1 column.
		// Different result with MS
		oParser = new parserFormula('COLUMNS(TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Boolean. Input is a Boolean - TRUE. Returns 1 column.');
		// Case #3: Boolean. Input is a Boolean - FALSE. Returns 1 column.
		// Different result with MS
		oParser = new parserFormula('COLUMNS(FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Boolean. Input is a Boolean - FALSE. Returns 1 column.');
		// Case #4: String. Input is an invalid string. Returns 1 column.
		// Different result with MS
		oParser = new parserFormula('COLUMNS("Test")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS("Test") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: String. Input is an invalid string. Returns 1 column.');
		// Case #5: Error. Input is an error value. Returns #N/A error.
		// Different result with MS
		oParser = new parserFormula('COLUMNS(NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error. Input is an error value. Returns #N/A error.');
		// Case #7: Reference link. Invalid reference outside of range. Returns #NAME? error.
		// Different result with MS
		oParser = new parserFormula('COLUMNS(A0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(A0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NAME?', 'Test: Negative case: Reference link. Invalid reference outside of range. Returns #REF! error.');
		// Case #8: Reference link. Invalid reference outside of range. Returns #NAME? error.
		// Different result with MS
		oParser = new parserFormula('COLUMNS(XFG1048577)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(XFG1048577) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NAME?', 'Test: Negative case: Reference link. Invalid reference outside of range. Returns #REF! error.');

		// Bounded cases:

		// Case #1: Reference link. Minimum valid cell: single cell. Returns 1 column.
		oParser = new parserFormula('COLUMNS(A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Bounded case: Reference link. Minimum valid cell: single cell. Returns 1 column.');
		// Case #2: Reference link. Maximum valid cell. Returns 1 column.
		oParser = new parserFormula('COLUMNS(XFD1048576)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula COLUMNS(XFD1048576) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Bounded case: Reference link. Maximum valid cell. Returns 1 column.');

		//TODO нужна другая функция для тестирования
		//testArrayFormula2(assert, "COLUMNS", 1, 1);
	});


	QUnit.test("Test: \"DROP\"", function (assert) {
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("1");
		ws.getRange2("A101").setValue("2");
		ws.getRange2("A102").setValue("3");
		ws.getRange2("A103").setValue("1");
		ws.getRange2("A104").setValue("0");
		ws.getRange2("A105").setValue("text");
		ws.getRange2("A106").setValue("#NULL!");

		ws.getRange2("A1").setValue("1");
		ws.getRange2("A2").setValue("2");
		ws.getRange2("A3").setValue("");
		ws.getRange2("A4").setValue("4");
		ws.getRange2("A5").setValue("#N/A");
		ws.getRange2("A6").setValue("f");

		ws.getRange2("B1").setValue("q");
		ws.getRange2("B2").setValue("w");
		ws.getRange2("B3").setValue("e");
		ws.getRange2("B4").setValue("test");
		ws.getRange2("B5").setValue("hhh");
		ws.getRange2("B6").setValue("g");

		ws.getRange2("C1").setValue("r");
		ws.getRange2("C2").setValue("3");
		ws.getRange2("C3").setValue("5");
		ws.getRange2("C4").setValue("");
		ws.getRange2("C5").setValue("6");
		ws.getRange2("C6").setValue("h");

		ws.getRange2("D1").setValue("");
		ws.getRange2("D2").setValue("");
		ws.getRange2("D3").setValue("");
		ws.getRange2("D4").setValue("");
		ws.getRange2("D5").setValue("");
		ws.getRange2("D6").setValue("");
		// Table type. Use A601:L6**
		getTableType(599, 0, 602, 0);
		ws.getRange2("A601").setValue("1"); // Column1
		ws.getRange2("A602").setValue("2"); // Column1
		ws.getRange2("A603").setValue("3"); // Column1
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("3");
		// DefNames. Use A201-A208, B208
		ws.getRange2("A206").setValue("1"); // TestNameArea
		ws.getRange2("A207").setValue("2"); // TestNameArea


		//1. Adding common tests
		oParser = new parserFormula("DROP(A1:C6,1,2)", "A1", ws);
		assert.ok(oParser.parse());
		let array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 3);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 5);
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), '');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 6);
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 'h');

		//TODO ms calc error
		oParser = new parserFormula("DROP(A1:D5,100,100)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		//TODO ms calc error
		oParser = new parserFormula("DROP(A1:D5,-1,-4)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		oParser = new parserFormula("DROP(A1:D5,,-2)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), '');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 4);
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), '#N/A');

		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'q');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 'w');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 'e');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), 'hhh');
		

		oParser = new parserFormula("DROP(A1:D5,2,)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), '');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 4);
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), '#N/A');

		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'e');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 'hhh');

		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 5);
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), '');
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), 6);

		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), '');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), '');
		assert.strictEqual(array.getElementRowCol(2, 3).getValue(), '');
		

		oParser = new parserFormula("DROP(A1:D5,2)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), '');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 4);
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), '#N/A');

		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'e');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 'hhh');

		// Positive cases:

		// Case #1: Number, Empty. Return 1
		oParser = new parserFormula('DROP(1,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(1,) is parsed.')
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Number, Empty. Return 1');
		// Case #2: Area, Number. Drop 1 row from the beginning of vertical array. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 2, 'Test: Positive case: Area, Number. Drop 1 row from the beginning of vertical array. 2 of 3 arguments used.');
		// Case #3: Area, Number. Drop 1 row from the end using negative value. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Area, Number. Drop 1 row from the end using negative value. 2 of 3 arguments used.');
		// Case #4: Area, Number(2). Drop 1 row, columns argument is 0. 3 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,1,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,1,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Area, Number(2). Drop 1 row, columns argument is 0. 3 of 3 arguments used.');
		// Case #5: Area, String. Rows argument as numeric string converted to number. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,"1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,"1") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 2, 'Test: Positive case: Area, String. Rows argument as numeric string converted to number. 2 of 3 arguments used.');
		// Case #6: Area, Formula. Rows argument using ROUND formula. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,ROUND(1.9,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,ROUND(1.9,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 3, 'Test: Positive case: Area, Formula. Rows argument using ROUND formula. 2 of 3 arguments used.');
		// Case #7: Formula, Number. DROP as part of SUM formula. 2 of 3 arguments used.
		oParser = new parserFormula('SUM(DROP(A100:A103,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula SUM(DROP(A100:A103,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 6, 'Test: Positive case: Formula, Number. DROP as part of SUM formula. 2 of 3 arguments used.');
		// Case #8: Area, Reference link(2). Both rows and columns as reference links. 3 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A102,A103,A104)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A102,A103,A104) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Area, Reference link(2). Both rows and columns as reference links. 3 of 3 arguments used.');
		// Case #9: Name, Number. Array argument as defined name. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(TestNameArea,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(TestNameArea,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 2, 'Test: Positive case: Name, Number. Array argument as defined name. 2 of 3 arguments used.');
		// Case #10: Ref3D, Number. Array argument as 3D reference. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(Sheet2!A1:A3,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(Sheet2!A1:A3,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0, 'Test: Positive case: Ref3D, Number. Array argument as 3D reference. 2 of 3 arguments used.');
		// Case #11: Table, Number. Array argument as table reference. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(Table1[Column1],1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(Table1[Column1],1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Table, Number. Array argument as table reference. 2 of 3 arguments used.');

		// Negative cases:

		// Case #1: Area, Number. Rows value exceeds array size, returns #CALC! error. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,5) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Area, Number. Rows value exceeds array size, returns #CALC! error. 2 of 3 arguments used.');
		// Case #2: Area, Number. Negative rows value exceeds array size, returns #CALC! error. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,-5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,-5) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Area, Number. Negative rows value exceeds array size, returns #CALC! error. 2 of 3 arguments used.');
		// Case #3: Area, String. Non-numeric string for rows returns #VALUE! error. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,"text")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,"text") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, String. Non-numeric string for rows returns #VALUE! error. 2 of 3 arguments used.');
		// Case #4: Area, Number, String. Non-numeric string for columns returns #VALUE! error. 3 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,1,"text")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,1,"text") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number, String. Non-numeric string for columns returns #VALUE! error. 3 of 3 arguments used.');
		// Case #5: Area, Error. Rows argument as error returns #N/A. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,#N/A)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,#N/A) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Area, Error. Rows argument as error returns #N/A. 2 of 3 arguments used.');
		// Case #6: Area, Number, Error. Columns argument as error returns #N/A. 3 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,1,#N/A)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,1,#N/A) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Area, Number, Error. Columns argument as error returns #N/A. 3 of 3 arguments used.');
		// Case #7: Error, Number. Array argument as error returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(#VALUE!,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(#VALUE!,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Error, Number. Array argument as error returns #VALUE!. 2 of 3 arguments used.');
		// Case #8: String, Number. Array argument as text string returns #VALUE! error. 2 of 3 arguments used.
		oParser = new parserFormula('DROP("text",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP("text",1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: String, Number. Array argument as text string returns #VALUE! error. 2 of 3 arguments used.');
		// Case #9: Area, Reference link. Rows argument reference to cell with text returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,A106)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,A106) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NULL!', 'Test: Negative case: Area, Reference link. Rows argument reference to cell with text returns #VALUE!. 2 of 3 arguments used.');
		// Case #10: Area, Reference link. Rows argument reference to cell with error returns #NULL!. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,A107)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,A107) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Reference link. Rows argument reference to cell with error returns #NULL!. 2 of 3 arguments used.');
		// Case #11: Area, Number(2). Dropping all rows returns #CALC! error. 3 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,4,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,4,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Area, Number(2). Dropping all rows returns #CALC! error. 3 of 3 arguments used.');
		// Case #12: Empty, Number. Empty array argument returns #VALUE! error. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Empty, Number. Empty array argument returns #VALUE! error. 2 of 3 arguments used.');
		// Case #13: Boolean, Number. Array argument as boolean returns #VALUE! error. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(TRUE,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(TRUE,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Boolean, Number. Array argument as boolean returns #VALUE! error. 2 of 3 arguments used.');
		// Case #14: Area, String. Empty string for rows returns #VALUE! error. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,"")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,"") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, String. Empty string for rows returns #VALUE! error. 2 of 3 arguments used.');
		// Case #15: Area, Boolean. Boolean TRUE in rows converted to 1, valid positive case behavior. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A103,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A103,TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#SPILL!', 'Test: Negative case: Area, Boolean. Boolean TRUE in rows converted to 1, valid positive case behavior. 2 of 3 arguments used.');
		// Case #16: Number(2). Return #VALUE!
		oParser = new parserFormula('DROP(1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Number(2). Return #VALUE!');
		// Case #17: String, Number. Return #VALUE!
		oParser = new parserFormula('DROP("test",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP("test",1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: String, Number. Return #VALUE!');
		// Case #18: Boolean, Number. Return #VALUE!
		oParser = new parserFormula('DROP(true,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(true,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Boolean, Number. Return #VALUE!');
		// Case #19: Error, Number. Return #VALUE!
		oParser = new parserFormula('DROP(#VALUE!,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(#VALUE!,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Error, Number. Return #VALUE!');
		// Case #20: Empty, Number. Return #VALUE!
		oParser = new parserFormula('DROP(,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(,2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Empty, Number. Return #VALUE!');
		// Case #21: Reference link,  Number. Return #VALUE!
		oParser = new parserFormula('DROP(B1, 1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(B1, 1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Reference link,  Number. Return #VALUE!');
		// Case #22: Array, Number. Return #VALUE!
		oParser = new parserFormula('DROP({2;"";"test"},3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP({2;"";"test"},3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Array, Number. Return #VALUE!');
		// Case #23: Number, String. Return #VALUE!
		oParser = new parserFormula('DROP(1,"test")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(1,"test") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, String. Return #VALUE!');
		// Case #24: Number, Boolean. Return #VALUE!
		oParser = new parserFormula('DROP(1,true)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(1,true) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Number, Boolean. Return #VALUE!');
		// Case #25: Number, Error. Return #N/A
		oParser = new parserFormula('DROP(1, #N/A)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(1, #N/A) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Error. Return #N/A');
		// Case #26: Number, Reference link. Return #VALUE!
		oParser = new parserFormula('DROP(1,A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(1,A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Reference link. Return #VALUE!');
		// Case #27: Number, Area. Return #VALUE!
		oParser = new parserFormula('DROP(1,A1:B5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(1,A1:B5) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Number, Area. Return #VALUE!');
		// Case #28: Number, Array. Return #VALUE!
		oParser = new parserFormula('DROP(1,{2;"";"test"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(1,{2;"";"test"}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Number, Array. Return #VALUE!');

		// Bounded cases:

		// Case #1: Area, Number. Minimum array size (2 cells), drop 1 row. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A101,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A101,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 2, 'Test: Bounded case: Area, Number. Minimum array size (2 cells), drop 1 row. 2 of 3 arguments used.');
		// Case #2: Area, Number. Minimum array size (2 cells), drop 1 from end. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A100:A101,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A100:A101,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Bounded case: Area, Number. Minimum array size (2 cells), drop 1 from end. 2 of 3 arguments used.');
		// Case #3: Area, Number. Whole row reference, drop 1 row. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(1:2,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(1:1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Bounded case: Area, Number. Whole row reference, drop 1 row. 2 of 3 arguments used.');
		// Case #4: Area, Number. Whole column reference, drop 0 rows. 2 of 3 arguments used.
		oParser = new parserFormula('DROP(A:A,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: Formula DROP(A:A,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Bounded case: Area, Number. Whole column reference, drop 0 rows. 2 of 3 arguments used.');
	});

	QUnit.test("Test: \"EXPAND\"", function (assert) {
		let array;

		ws.getRange2("A1").setValue("2");
		ws.getRange2("A2").setValue("");
		ws.getRange2("A3").setValue("test");

		ws.getRange2("B1").setValue("test2");
		ws.getRange2("B2").setValue("#N/A");
		ws.getRange2("B3").setValue("TRUE");

		ws.getRange2("J7").setValue("7");

		ws.getRange2("B101").setValue();
		ws.getRange2("B102").setValue();

		oParser = new parserFormula('EXPAND(B101,2,3)', "A1", ws);
		assert.ok(oParser.parse(), "EXPAND(B101,2,3)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of EXPAND(B101,2,3)");

		oParser = new parserFormula('EXPAND(A1,2,3)', "A1", ws);
		assert.ok(oParser.parse(), "EXPAND(A1,2,3)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of EXPAND(A1,2,3).[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#N/A", "Result of EXPAND(A1,2,3).[0,1]");
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), "#N/A", "Result of EXPAND(A1,2,3).[0,2]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#N/A", "Result of EXPAND(A1,2,3).[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#N/A", "Result of EXPAND(A1,2,3).[1,1]");

		oParser = new parserFormula('EXPAND(B101:B102,)', "A1", ws);
		assert.ok(oParser.parse(), "EXPAND(B101:B102,)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "", "Result of EXPAND(B101:B102,2).[0,0]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of EXPAND(B101:B102,2).[1,0]");

		oParser = new parserFormula('EXPAND(B101:B102,1)', "A1", ws);
		assert.ok(oParser.parse(), "EXPAND(B101:B102,1)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of EXPAND(B101:B102,1)");

		oParser = new parserFormula('EXPAND(B101:B102,2)', "A1", ws);
		assert.ok(oParser.parse(), "EXPAND(B101:B102,2)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "", "Result of EXPAND(B101:B102,2).[0,0]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of EXPAND(B101:B102,2).[1,0]");

		// normal call
		oParser = new parserFormula('EXPAND(A1:B2,3,3,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Regular function call: EXPAND(A1:B2,3,3,'new_val')");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Regular function call.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "test2", "Regular function call.[0,1]");
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), "new_val", "Regular function call.[0,2]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Regular function call.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#N/A", "Regular function call.[1,1]");
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), "new_val", "Regular function call.[1,2]");
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "new_val", "Regular function call.[2,0]");
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "new_val", "Regular function call.[2,1]");
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), "new_val", "Regular function call.[2,2]");

		// array_size > max_array_size
		oParser = new parserFormula('EXPAND(A1:A3,5000,5000,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Call function with resulting array more than 1048576");
		array = oParser.calculate();
		assert.strictEqual(oParser.calculate().getValue(), "#NUM!", "If the resulting array is too large return #NUM!");

		// ------------------------------ arg[0] ------------------------------ //
		// cell ref(single value)
		oParser = new parserFormula('EXPAND(A1,2,2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass a single value from cell to the first argument");
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 2, "Pass a single value from cell to the first argument");

		// cell ref(array-like value)
		oParser = new parserFormula('EXPAND(A1:B2,3,3,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass an array-like value from cells to the first argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass an array-like value from cells to the first argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "test2", "Pass an array-like value from cells to the first argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), "new_val", "Pass an array-like value from cells to the first argument.[0,2]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Pass an array-like value from cells to the first argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#N/A", "Pass an array-like value from cells to the first argument.[1,1]");
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), "new_val", "Pass an array-like value from cells to the first argument.[1,2]");
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "new_val", "Pass an array-like value from cells to the first argument.[2,0]");
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "new_val", "Pass an array-like value from cells to the first argument.[2,1]");
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), "new_val", "Pass an array-like value from cells to the first argument.[2,2]");

		// empty (no value)
		oParser = new parserFormula('EXPAND(,2,2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass an empty value() to the first argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass an empty value() to the first argument");

		// empty ("")
		oParser = new parserFormula('EXPAND("",2,2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass an empty value('') to the first argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "", "Pass an empty value('') to the first argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "new_val", "Pass an empty value('') to the first argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "new_val", "Pass an empty value('') to the first argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "new_val", "Pass an empty value('') to the first argument.[1,1]");

		// string
		oParser = new parserFormula('EXPAND("str",2,2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass a string to the first argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "str", "Pass a string to the first argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "new_val", "Pass a string to the first argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "new_val", "Pass a string to the first argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "new_val", "Pass a string to the first argument.[1,1]");

		// bool
		oParser = new parserFormula('EXPAND(TRUE,2,2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass a boolean to the first argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "TRUE", "Pass a boolean to the first argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "new_val", "Pass a boolean to the first argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "new_val", "Pass a boolean to the first argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "new_val", "Pass a boolean to the first argument.[1,1]");

		// number
		oParser = new parserFormula('EXPAND(98,2,2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass a number to the first argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 98, "Pass a number to the first argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "new_val", "Pass a number to the first argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "new_val", "Pass a number to the first argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "new_val", "Pass a number to the first argument.[1,1]");

		// error
		oParser = new parserFormula('EXPAND(#N/A,2,2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass an error to the first argument");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Pass an error to the first argument");

		// array(1,2,3)
		oParser = new parserFormula('EXPAND({1,2,3},3,3,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass an array to the first argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, "Pass an array to the first argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 2, "Pass an array to the first argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 3, "Pass an array to the first argument.[0,2]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "new_val", "Pass an array to the first argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "new_val", "Pass an array to the first argument.[1,1]");
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), "new_val", "Pass an array to the first argument.[1,2]");
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "new_val", "Pass an array to the first argument.[2,0]");
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "new_val", "Pass an array to the first argument.[2,1]");
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), "new_val", "Pass an array to the first argument.[2,2]");

		// ------------------------------ arg[1] ------------------------------ //
		// empty (no value)
		oParser = new parserFormula('EXPAND(A1:B2,,2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass an empty value() to the second argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass an empty value() to the second argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "test2" ,"Pass an empty value() to the second argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Pass an empty value() to the second argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#N/A", "Pass an empty value() to the second argument.[1,1]");

		// string
		oParser = new parserFormula('EXPAND(A1:B2,"str",2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass a string with letters to the second argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass a string with letters to the second argument. Should return #VALUE");

		// string (with number inside)
		oParser = new parserFormula('EXPAND(A1:B2,"2",2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass a string with numbers to the second argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass a string with numbers to the second argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "test2", "Pass a string with numbers to the second argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Pass a string with numbers to the second argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#N/A", "Pass a string with numbers to the second argument.[1,1]");

		oParser = new parserFormula('EXPAND(98,"2s",2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass a string with numbers to the second argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass a string with numbers to the second argument");

		// bool
		oParser = new parserFormula('EXPAND(A1:B2,TRUE,2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass a boolean to the second argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass a boolean to the second argument.");

		// error
		oParser = new parserFormula('EXPAND(A1:B2,#N/A,2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass an error to the second argument");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Pass an error to the second argument.");

		// row < arr.length
		oParser = new parserFormula('EXPAND(A1:B3,1,4,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a number to the second argument(number < rows in exist area)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "If the second argument is less than the original row length should return #VALUE!.");

		// array(first number < array.length)
		oParser = new parserFormula('EXPAND(A1:B2,{1,2,3},4,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass an array to the second argument(first number of array < rows in exist area)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "If the second argument is less than the original row length should return #VALUE!.");

		// array(first number >= arr.length)
		oParser = new parserFormula('EXPAND(A1:B1,{3,2,4},4,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass an array to the second argument(first number of array >= rows in exist area)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass an array to the second argument(first number of array >= rows in exist area).[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "test2", "Pass an array to the second argument(first number of array >= rows in exist area).[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 5, "Pass an array to the second argument(first number of array >= rows in exist area).[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 5, "Pass an array to the second argument(first number of array >= rows in exist area).[1,1]");

		// cell ref(single value - string)
		oParser = new parserFormula('EXPAND(A1:B1,B1,3,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a reference to value in cell(single - string) to the second argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass a reference to value in cell(single - string) to the second argument.");

		// cell ref(single value - number)
		oParser = new parserFormula('EXPAND(A1:B1,A1,3,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a reference to value in cell(single - number) to the second argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass a reference to value in cell(single - number) to the second argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "test2", "Pass a reference to value in cell(single - number) to the second argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 5, "Pass a reference to value in cell(single - number) to the second argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 5, "Pass a reference to value in cell(single - number) to the second argument.[1,1]");
		
		// cell ref(single value - boolean)
		oParser = new parserFormula('EXPAND(A1:B1,TRUE,3,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a reference to value in cell(single - boolean(TRUE)) to the second argument. TRUE transform in to 1 and then the function works with a number");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass a reference to value in cell(single - boolean(TRUE)) to the second argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "test2", "Pass a reference to value in cell(single - boolean(TRUE)) to the second argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Pass a reference to value in cell(single - boolean(TRUE)) to the second argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Pass a reference to value in cell(single - boolean(TRUE)) to the second argument.[1,1]");

		// cell ref(single value - boolean)
		oParser = new parserFormula('EXPAND(A1:B1,FALSE,3,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a reference to value in cell(single - boolean(FALSE)) to the second argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass a reference to value in cell(single - boolean(FALSE)) to the second argument.");

		// cell ref(array-like cellsRange)
		oParser = new parserFormula('EXPAND(A1:B1,A1:B1,3,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a reference to values in cells(cellsRange) to the second argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass a reference to values in cells(cellsRange) to the second argument.");

		// ------------------------------ arg[2] ------------------------------ //
		// empty (no value)
		oParser = new parserFormula('EXPAND(A1:B2,2,,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass an empty value() to the third argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass an empty value() to the third argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "test2", "Pass an empty value() to the third argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Pass an empty value() to the third argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#N/A", "Pass an empty value() to the third argument.[1,1]");

		// string
		oParser = new parserFormula('EXPAND(A1:B2,2,"str","new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass a string with letters to the third argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass a string with letters to the third argument. Should return #VALUE");

		// string (with number inside)
		oParser = new parserFormula('EXPAND(A1:B2,2,"2","new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass a string with numbers to the third argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass a string with numbers to the third argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "test2", "Pass a string with numbers to the third argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Pass a string with numbers to the third argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#N/A", "Pass a string with numbers to the third argument.[1,1]");

		// bool
		oParser = new parserFormula('EXPAND(A1:B2,2,TRUE,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass a boolean value to the third argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass a boolean value to the third argument.");

		// error
		oParser = new parserFormula('EXPAND(A1:B2,2,#N/A,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass an error to the third argument");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Pass an error to the third argument.");

		// column < array.length
		oParser = new parserFormula('EXPAND(A1:B3,4,1,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a number to the third argument(number < columns in exist area)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "If the third argument is less than the original column length should return #VALUE!.");

		// array(first number < array.length)
		oParser = new parserFormula('EXPAND(A1:B2,4,{1,2,3},5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass an array to the third argument(first number of array < columns in exist area)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "If the third argument is less than the original column length should return #VALUE!.");

		// arry(first number >= arr.length)
		oParser = new parserFormula('EXPAND(A1:B1,3,{3,2,4},5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass an array to the third argument(first number of array >= columns in exist area)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass an array to the third argument(first number of array >= columns in exist area).[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "test2", "Pass an array to the third argument(first number of array >= columns in exist area).[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 5, "Pass an array to the third argument(first number of array >= columns in exist area).[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 5, "Pass an array to the third argument(first number of array >= columns in exist area).[1,1]");

		// cell ref(single value - string)
		oParser = new parserFormula('EXPAND(A1:B1,3,B1,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a reference to value in cell(single - string) to the third argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass a reference to value in cell(single - string) to the third argument.");

		// cell ref(single value - number)
		oParser = new parserFormula('EXPAND(A1:B1,3,A1,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a reference to value in cell(single - number) to the third argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass a reference to value in cell(single - number) to the third argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "test2", "Pass a reference to value in cell(single - number) to the third argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 5, "Pass a reference to value in cell(single - number) to the third argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 5, "Pass a reference to value in cell(single - number) to the third argument.[1,1]");
		
		// cell ref(single value - boolean)
		oParser = new parserFormula('EXPAND(A1:B1,3,TRUE,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a reference to value in cell(single - boolean) to the third argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass a reference to value in cell(single - boolean) to the third argument.");

		// cell ref(array-like cellsRange)
		oParser = new parserFormula('EXPAND(A1:B1,3,A1:B1,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a reference to values in cells(cellsRange) to the third argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass a reference to values in cells(cellsRange) to the third argument.");


		// ------------------------------ arg[3] ------------------------------ //
		// empty (no value)
		oParser = new parserFormula('EXPAND(A1:A1,2,2)', "A1", ws);
		assert.ok(oParser.parse(), "Did not pass a value to the last argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Did not pass a value to the last argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#N/A", "Did not pass a value to the last argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#N/A", "Did not pass a value to the last argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#N/A", "Did not pass a value to the last argument.[1,1]");

		// empty ("")
		oParser = new parserFormula('EXPAND(A1:A1,2,2,)', "A1", ws);
		assert.ok(oParser.parse(), "Pass an empty value() to the last argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass an empty value() to the last argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Pass an empty value() to the last argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Pass an empty value() to the last argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Pass an empty value() to the last argument.[1,1]");

		// number
		oParser = new parserFormula('EXPAND(A1:A1,2,2,5)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a number to the last argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass a number to the last argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 5, "Pass a number to the last argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 5, "Pass a number to the last argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 5, "Pass a number to the last argument.[1,1]");

		// string
		oParser = new parserFormula('EXPAND(A1:A1,2,2,"new_val")', "A1", ws);
		assert.ok(oParser.parse(), "Pass a string to the last argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass a string to the last argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "new_val", "Pass a string to the last argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "new_val", "Pass a string to the last argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "new_val", "Pass a string to the last argument.[1,1]");

		// bool
		oParser = new parserFormula('EXPAND(A1:A1,2,2,TRUE)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a boolean value to the last argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass a boolean value to the last argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "TRUE", "Pass a boolean value to the last argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "TRUE", "Pass a boolean value to the last argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "TRUE", "Pass a boolean value to the last argument.[1,1]");

		// error
		oParser = new parserFormula('EXPAND(A1:A1,2,2,#N/A)', "A1", ws);
		assert.ok(oParser.parse(), "Pass an error to the last argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass an error to the last argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#N/A", "Pass an error to the last argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#N/A", "Pass an error to the last argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#N/A", "Pass an error to the last argument.[1,1]");

		// cell ref(single)
		oParser = new parserFormula('EXPAND(A1:A1,2,2,A3)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a reference to value in cell(single) to the last argument");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Pass a reference to value in cell(single) to the last argument.[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue().getValue(), "test", "Pass a reference to value in cell(single) to the last argument.[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue().getValue(), "test", "Pass a reference to value in cell(single) to the last argument.[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue().getValue(), "test", "Pass a reference to value in cell(single) to the last argument.[1,1]");

		// cell ref(multiple)
		// get the array -> get the values from array
		oParser = new parserFormula('EXPAND(A1:A1,2,2,A1:B1)', "A1", ws);
		assert.ok(oParser.parse(), "Pass a reference to value in cell(array-like) to the last argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass a reference to value in cell(single) to the last argument.");

		// array
		oParser = new parserFormula('EXPAND(A1:A1,2,2,{1,2})', "A1", ws);
		assert.ok(oParser.parse(), "Pass an array to the last argument");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Pass an array to the last argument.");

		ws.getRange2("A100:C214").cleanAll();
		// Data for reference link. Use A100-A115
		ws.getRange2("A100").setValue("1");
		ws.getRange2("A101").setValue("2");
		ws.getRange2("A102").setValue("3");
		ws.getRange2("A103").setValue("4");
		ws.getRange2("A104").setValue("5");
		ws.getRange2("A105").setValue("6");
		ws.getRange2("A106").setValue("7");
		ws.getRange2("A107").setValue("8");
		ws.getRange2("A108").setValue("9");
		ws.getRange2("A109").setValue("10");
		ws.getRange2("A110").setValue("11");
		ws.getRange2("A111").setValue("11");

		ws.getRange2("B100").setValue("10");
		ws.getRange2("B101").setValue("20");
		ws.getRange2("B102").setValue("30");
		ws.getRange2("B103").setValue("40");
		ws.getRange2("B104").setValue("50");
		ws.getRange2("B105").setValue("60");
		ws.getRange2("B106").setValue("70");
		ws.getRange2("B107").setValue("80");
		ws.getRange2("B108").setValue("90");
		ws.getRange2("B109").setValue("100");
		ws.getRange2("B110").setValue("110");
		ws.getRange2("B111").setValue("110");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 2);
		ws.getRange2("A601").setValue("5"); // Num (Column1)
		ws.getRange2("B601").setValue("10"); // Num (Column2)
		ws.getRange2("C601").setValue("Text"); // Text (Column3)

		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2


		// Positive cases:
		// Case #1: Array, Number. Expands 1x3 array to 4x3, padded with 0. Returns {1,2,3;0,0,0;0,0,0;0,0,0}.
		oParser = new parserFormula('EXPAND({1,2,3},4,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2,3},4,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Number. Expands 1x3 array to 4x3, padded with 0. Returns {1,2,3;0,0,0;0,0,0;0,0,0}.');
		// Case #2: Array, Number. Expands 3x1 array to 4x2, padded with "N/A". Returns {1,"N/A";2,"N/A";3,"N/A";"N/A","N/A"}.
		oParser = new parserFormula('EXPAND({1;2;3},4,2,"N/A")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1;2;3},4,2,"N/A") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Number. Expands 3x1 array to 4x2, padded with "N/A". Returns {1,"N/A";2,"N/A";3,"N/A";"N/A","N/A"}.');
		// Case #3: Formula, Number. Nested TRANSPOSE creates 3x1 array, expanded to 5x3, padded with 0.
		oParser = new parserFormula('EXPAND(TRANSPOSE({1,2,3}),5,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(TRANSPOSE({1,2,3}),5,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula, Number. Nested TRANSPOSE creates 3x1 array, expanded to 5x3, padded with 0.');
		// Case #4: Reference link. Reference to range, expanded to 4x3, padded with 0.
		oParser = new parserFormula('EXPAND(A100:A102,4,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(A100:A102,4,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Reference link. Reference to range, expanded to 4x3, padded with 0.');
		// Case #5: Area. Single-column range, expanded to 4x2, padded with "X".
		oParser = new parserFormula('EXPAND(A103:A105,4,2,"X")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(A103:A105,4,2,"X") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 4, 'Test: Positive case: Area. Single-column range, expanded to 4x2, padded with "X".');
		// Case #6: Array, Number. Expands 2x2 array to 3x3, padded with 0. Returns {1,2,0;3,4,0;0,0,0}.
		oParser = new parserFormula('EXPAND({1,2;3,4},3,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2;3,4},3,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Number. Expands 2x2 array to 3x3, padded with 0. Returns {1,2,0;3,4,0;0,0,0}.');
		// Case #7: Name, Number. Named range as array, expanded to 4x3, padded with 0.
		oParser = new parserFormula('EXPAND(TestName,4,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(TestName,4,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name, Number. Named range as array, expanded to 4x3, padded with 0.');
		// Case #8: Name3D, Number. 3D named range as array, expanded to 4x3, padded with "N/A".
		oParser = new parserFormula('EXPAND(TestName3D,4,3,"N/A")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(TestName3D,4,3,"N/A") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name3D, Number. 3D named range as array, expanded to 4x3, padded with "N/A".');
		// Case #9: Ref3D, Number. 3D reference range, expanded to 4x3, padded with 0.
		oParser = new parserFormula('EXPAND(Sheet2!A1:A3,4,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(Sheet2!A1:A3,4,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Ref3D, Number. 3D reference range, expanded to 4x3, padded with 0.');
		// Case #10: Area3D, Number. 3D single-column range, expanded to 4x2, padded with "X".
		oParser = new parserFormula('EXPAND(Sheet2!A4:A6,4,2,"X")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(Sheet2!A4:A6,4,2,"X") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), "", 'Test: Positive case: Area3D, Number. 3D single-column range, expanded to 4x2, padded with "X".');
		// Case #11: Table, Number. Table reference as array, expanded to 4x3, padded with 0.
		oParser = new parserFormula('EXPAND(Table1[Column1],4,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(Table1[Column1],4,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 5, 'Test: Positive case: Table, Number. Table reference as array, expanded to 4x3, padded with 0.');
		// Case #12: Array, Empty. Rows and columns omitted, defaults to array size (1x3), no padding needed.
		oParser = new parserFormula('EXPAND({1,2,3},,,"N/A")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2,3},,,"N/A") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Empty. Rows and columns omitted, defaults to array size (1x3), no padding needed.');
		// Case #13: Array, Number. Columns omitted, defaults to array columns (1), expanded to 3x1, padded with 0.
		oParser = new parserFormula('EXPAND({1;2},3,,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1;2},3,,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Number. Columns omitted, defaults to array columns (1), expanded to 3x1, padded with 0.');
		// Case #14: Formula, Number. Nested IF producing array, expanded to 4x3, padded with 0.
		oParser = new parserFormula('EXPAND(IF(TRUE,{1,2,3},{4,5,6}),4,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(IF(TRUE,{1,2,3},{4,5,6}),4,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula, Number. Nested IF producing array, expanded to 4x3, padded with 0.');
		// Case #15: Formula. EXPAND inside SUM, valid expansion to 3x3, padded with 0. Returns sum of array elements.
		oParser = new parserFormula('SUM(EXPAND({1,2},3,3,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SUM(EXPAND({1,2},3,3,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Test: Positive case: Formula. EXPAND inside SUM, valid expansion to 3x3, padded with 0. Returns sum of array elements.');
		// Case #16: Array, Number, String. String pad_with, expands 1x3 to 4x3, padded with "X".
		oParser = new parserFormula('EXPAND({1,2,3},4,3,"X")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2,3},4,3,"X") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Number, String. String pad_with, expands 1x3 to 4x3, padded with "X".');
		// Case #17: Date, Number. Date as single-value array, expanded to 4x1, padded with 0.
		oParser = new parserFormula('EXPAND(DATE(2025,1,1),4,1,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(DATE(2025,1,1),4,1,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 45658, 'Test: Positive case: Date, Number. Date as single-value array, expanded to 4x1, padded with 0.');
		// Case #18: Time, Number. Time as single-value array, expanded to 4x1, padded with 0.
		oParser = new parserFormula('EXPAND(TIME(12,0,0),4,1,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(TIME(12,0,0),4,1,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Time, Number. Time as single-value array, expanded to 4x1, padded with 0.');
		// Case #19: Array, Number. No pad_with, defaults to #N/A for padded cells. Returns {1,2;3,4}.
		oParser = new parserFormula('EXPAND({1,2;3,4},2,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2;3,4},2,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Number. No pad_with, defaults to #N/A for padded cells. Returns {1,2;3,4}.');
		// Case #20: Reference link, Number. Columns omitted, defaults to range columns (1), expanded to 4x1, padded with 0.
		oParser = new parserFormula('EXPAND(A106:A108,4,,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(A106:A108,4,,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 7, 'Test: Positive case: Reference link, Number. Columns omitted, defaults to range columns (1), expanded to 4x1, padded with 0.');
		// Case #21: Array, Number. Boolean pad_with, expands 1x3 to 5x4, padded with TRUE.
		oParser = new parserFormula('EXPAND({1,2,3},5,4,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2,3},5,4,TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Number. Boolean pad_with, expands 1x3 to 5x4, padded with TRUE.');

		// Negative cases:
		// Case #1: Array, Number. Rows (2) less than array rows (3). Returns #VALUE! error.
		oParser = new parserFormula('EXPAND({1,2,3},2,2,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2,3},2,2,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, Number. Rows (2) less than array rows (3). Returns #VALUE! error.');
		// Case #2: Array, Number. Columns (1) less than array columns (2). Returns #VALUE! error.
		oParser = new parserFormula('EXPAND({1,2;3,4},2,1,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2;3,4},2,1,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, Number. Columns (1) less than array columns (2). Returns #VALUE! error.');
		// Case #3: Error, Number. Array is #N/A. Returns #N/A.
		oParser = new parserFormula('EXPAND(NA(),4,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(NA(),4,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error, Number. Array is #N/A. Returns #N/A.');
		// Case #4: Empty, Number. Empty array reference. Returns #VALUE! error.
		oParser = new parserFormula('EXPAND(A109,4,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(A109,4,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 10, 'Test: Negative case: Empty, Number. Empty array reference. Returns #VALUE! error.');
		// Case #5: Boolean, Number. Boolean array, treated as single value, expanded to 4x3, padded with 0. Returns valid array.
		oParser = new parserFormula('EXPAND(TRUE,4,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(TRUE,4,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'TRUE', 'Test: Negative case: Boolean, Number. Boolean array, treated as single value, expanded to 4x3, padded with 0. Returns valid array.');
		// Case #6: Array, Number. Array too large for Excel limits. Returns #NUM! error.
		oParser = new parserFormula('EXPAND({1,2,3},1000000,1000000,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2,3},1000000,1000000,0) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Array, Number. Array too large for Excel limits. Returns #NUM! error.');
		// Case #7: Formula, Number. Nested formula producing #NUM! error. Returns #NUM! error.
		oParser = new parserFormula('EXPAND(SQRT(-1),4,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(SQRT(-1),4,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula, Number. Nested formula producing #NUM! error. Returns #NUM! error.');
		// Case #8: Reference link, Number. Rows (2) less than range rows (3). Returns #VALUE! error.
		oParser = new parserFormula('EXPAND(A100:A102,2,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(A100:A102,2,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Reference link, Number. Rows (2) less than range rows (3). Returns #VALUE! error.');
		// Case #9: Name, Number. Multi-cell named range. Returns #VALUE! error.
		oParser = new parserFormula('EXPAND(TestNameArea2,4,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(TestNameArea2,4,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name, Number. Multi-cell named range. Returns #VALUE! error.');
		// Case #10: Name3D, Number. Multi-cell 3D named range. Returns #VALUE! error.
		oParser = new parserFormula('EXPAND(TestNameArea3D2,4,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(TestNameArea3D2,4,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name3D, Number. Multi-cell 3D named range. Returns #VALUE! error.');
		// Case #11: Ref3D, Number. 3D reference range, rows (2) less than range rows (3). Returns #VALUE! error.
		oParser = new parserFormula('EXPAND(Sheet2!A7:A9,2,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(Sheet2!A7:A9,2,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Ref3D, Number. 3D reference range, rows (2) less than range rows (3). Returns #VALUE! error.');
		// Case #12: Area3D, Number. 3D range, rows (2) less than range rows (3). Returns #VALUE! error.
		oParser = new parserFormula('EXPAND(Sheet2!A10:A12,2,2,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(Sheet2!A10:A12,2,2,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area3D, Number. 3D range, rows (2) less than range rows (3). Returns #VALUE! error.');
		// Case #13: Table, Number. Table reference, rows (2).
		oParser = new parserFormula('EXPAND(Table1[Column3],2,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(Table1[Column3],2,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), "Text", 'Test: Negative case: Table, Number. Table reference, rows (2) less than table rows (assume 3). Returns #VALUE! error.');
		// Case #14: Array, Number. Columns (0) invalid. Returns #VALUE! error.
		oParser = new parserFormula('EXPAND({1,2,3},4,0,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2,3},4,0,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, Number. Columns (0) invalid. Returns #VALUE! error.');
		// Case #15: Array, Number. Rows (0) invalid. Returns #VALUE! error.
		oParser = new parserFormula('EXPAND({1,2,3},0,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2,3},0,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, Number. Rows (0) invalid. Returns #VALUE! error.');
		// Case #16: Array, String. Non-numeric pad_with for numeric array, valid but may not be intended. Returns {1,2,3;"abc","abc","abc";"abc","abc","abc";"abc","abc","abc"}.
		oParser = new parserFormula('EXPAND({1,2,3},4,3,"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2,3},4,3,"abc") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array, String. Non-numeric pad_with for numeric array, valid but may not be intended. Returns {1,2,3;"abc","abc","abc";"abc","abc","abc";"abc","abc","abc"}.');
		// Case #17: Array, Number. pad_with is #N/A, valid but pads with #N/A. Returns {1,2,#N/A;3,4,#N/A;#N/A,#N/A,#N/A}.
		oParser = new parserFormula('EXPAND({1,2;3,4},3,3,NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2;3,4},3,3,NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array, Number. pad_with is #N/A, valid but pads with #N/A. Returns {1,2,#N/A;3,4,#N/A;#N/A,#N/A,#N/A}.');
		// Case #18: Reference link, Empty. Rows and columns omitted, defaults to range size (3x1), no padding needed. Returns {1,2,3}.
		oParser = new parserFormula('EXPAND(A100:A102,,,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND(A100:A102,,,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Reference link, Empty. Rows and columns omitted, defaults to range size (3x1), no padding needed. Returns {1,2,3}.');
		// Case #19: Array, Number. No pad_with, padded cells return #N/A. Returns {"a","b";#N/A,#N/A;#N/A,#N/A;#N/A,#N/A}.
		oParser = new parserFormula('EXPAND({"a","b"},4,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({"a","b"},4,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'a', 'Test: Negative case: Array, Number. No pad_with, padded cells return #N/A. Returns {"a","b";#N/A,#N/A;#N/A,#N/A;#N/A,#N/A}.');
		// Case #20: Array, Number. Negative rows invalid. Returns #VALUE! error.
		oParser = new parserFormula('EXPAND({1,2,3},-1,3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1,2,3},-1,3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, Number. Negative rows invalid. Returns #VALUE! error.');

		// Bounded cases:
		// Case #1: Array, Number. Minimum array size (1x1), no expansion needed. Returns {1}.
		oParser = new parserFormula('EXPAND({1},1,1,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({1},1,1,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Array, Number. Minimum array size (1x1), no expansion needed. Returns {1}.');
		// Case #2: Array, Number. Maximum string length (32,767) in array, expanded to 2x1, padded with "X".
		let str = "Z";
		oParser = new parserFormula('EXPAND("A"&REPT("Z",32766),2,1,"X")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND("A"&REPT("Z",32766),2,1,"X") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), "A" + str.repeat(32766), 'Test: Bounded case: Array, Number. Maximum string length (32,767) in array, expanded to 2x1, padded with "X".');
		// Case #3: Array, Number. Maximum Excel number in array, expanded to 2x1, padded with 0.
		oParser = new parserFormula('EXPAND({9.99999999999999E+307},2,1,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: EXPAND({9.99999999999999E+307},2,1,0) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1e+308, 'Test: Bounded case: Array, Number. Maximum Excel number in array, expanded to 2x1, padded with 0.');
		// Case #4: Array, Number. Maximum Excel sheet dimensions (1048576 rows, 16384 columns), padded with 0. Returns large array.
		oParser = new parserFormula('EXPAND({1},1048576,16384,0)', 'A2', ws);
		//? assert.ok(oParser.parse(), 'Test: EXPAND({1},1048576,16384,0) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '`=EXPAND({1},1048576,16384,0)', 'Test: Bounded case: Array, Number. Maximum Excel sheet dimensions (1048576 rows, 16384 columns), padded with 0. Returns large array.');

		// Need to fix: big number in row/col args problems(#NUM err?), boundary case diff
		// Case #6: Array, Number. Array too large for Excel limits. Returns #NUM! error.
		// Case #3: Array, Number. Maximum Excel number in array, expanded to 2x1, padded with 0.
		// Case #4: Array, Number. Maximum Excel sheet dimensions (1048576 rows, 16384 columns), padded with 0. Returns large array.


	});

	QUnit.test("Test: \"FILTER\"", function (assert) {
		let array;

		ws.getRange2("B10").setValue("");
		ws.getRange2("B11").setValue();

		ws.getRange2("F10").setValue("1");
		ws.getRange2("F11").setValue("3");
		ws.getRange2("F12").setValue("5");
		ws.getRange2("F13").setValue("7");
		ws.getRange2("F14").setValue("9");
		ws.getRange2("F15").setValue("11");
		ws.getRange2("G10").setValue("25");
		ws.getRange2("G11").setValue("24");
		ws.getRange2("G12").setValue("23");
		ws.getRange2("G13").setValue("22");
		ws.getRange2("G14").setValue("21");
		ws.getRange2("G15").setValue("20");
		ws.getRange2("H10").setValue("1");
		ws.getRange2("H11").setValue("-10");
		ws.getRange2("H12").setValue("-5");
		ws.getRange2("H13").setValue("0");
		ws.getRange2("H14").setValue("5");
		ws.getRange2("H15").setValue("10");

		// range && range
		oParser = new parserFormula("FILTER(F10:H15,F10:H10=1)", "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,F10:H10=1)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of FILTER(F10:H15,F10:H10=1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 1, 'Result of FILTER(F10:H15,F10:H10=1)[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), "", 'Result of FILTER(F10:H15,F10:H10=1)[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 3, 'Result of FILTER(F10:H15,F10:H10=1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), -10, 'Result of FILTER(F10:H15,F10:H10=1)[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), "", 'Result of FILTER(F10:H15,F10:H10=1)[1,2]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 5, 'Result of FILTER(F10:H15,F10:H10=1)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), -5, 'Result of FILTER(F10:H15,F10:H10=1)[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 7, 'Result of FILTER(F10:H15,F10:H10=1)[3,0]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), 0, 'Result of FILTER(F10:H15,F10:H10=1)[3,1]');

		oParser = new parserFormula('FILTER({1;2;3},{FALSE;FALSE;FALSE},25)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3},{FALSE;FALSE;FALSE},25)');
		array = oParser.calculate();
		assert.strictEqual(oParser.calculate().getValue(), 25, 'Result of FILTER({1;2;3},{FALSE;FALSE;FALSE},25)');

		oParser = new parserFormula('FILTER({1,2,3}, {TRUE,FALSE,TRUE})', "С2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), 'FILTER({1,2,3}, {TRUE,FALSE,TRUE})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of FILTER({1,2,3}, {TRUE,FALSE,TRUE})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 3, 'Result of FILTER({1,2,3}, {TRUE,FALSE,TRUE})[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), "", 'Result of FILTER({1,2,3}, {TRUE,FALSE,TRUE})[0,2]');

		oParser = new parserFormula("FILTER(F10:H15,F10:F15>8)", "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,F10:F15>8)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 9, 'Result of FILTER(F10:H15,F10:F15>8)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 21, 'Result of FILTER(F10:H15,F10:F15>8)[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 5, 'Result of FILTER(F10:H15,F10:F15>8)[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 11, 'Result of FILTER(F10:H15,F10:F15>8)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 20, 'Result of FILTER(F10:H15,F10:F15>8)[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 10, 'Result of FILTER(F10:H15,F10:F15>8)[1,2]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", 'Result of FILTER(F10:H15,F10:F15>8)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "", 'Result of FILTER(F10:H15,F10:F15>8)[2,1]');
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), "", 'Result of FILTER(F10:H15,F10:F15>8)[2,2]');

		oParser = new parserFormula("FILTER({1;2;3;4},{FALSE;0;1;1},25)", "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER({1;2;3;4},{FALSE;0;1;1},25)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 3, 'Result of FILTER({1;2;3;4},{FALSE;0;1;1},25)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of FILTER({1;2;3;4},{FALSE;0;1;1},25)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 4, 'Result of FILTER({1;2;3;4},{FALSE;0;1;1},25)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of FILTER({1;2;3;4},{FALSE;0;1;1},25)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", 'Result of FILTER({1;2;3;4},{FALSE;0;1;1},25)[2,0]');

		oParser = new parserFormula('FILTER({1;2;3;4},{"FALSE";0;1;1},25)', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), 'FILTER({1;2;3;4},{"FALSE";0;1;1},25)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 3, 'Result of FILTER({1;2;3;4},{"FALSE";0;1;1},25)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of FILTER({1;2;3;4},{"FALSE";0;1;1},25)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 4, 'Result of FILTER({1;2;3;4},{"FALSE";0;1;1},25)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of FILTER({1;2;3;4},{"FALSE";0;1;1},25)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", 'Result of FILTER({1;2;3;4},{"FALSE";0;1;1},25)[2,0]');

		oParser = new parserFormula('FILTER({1;2;3;4},{"FALSE";0;"TRUE";"trUe"},25)', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), 'FILTER({1;2;3;4},{"FALSE";0;"TRUE";"trUe"},25)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 3, 'Result of FILTER({1;2;3;4},{"FALSE";0;"TRUE";"trUe"},25)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of FILTER({1;2;3;4},{"FALSE";0;"TRUE";"trUe"},25)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 4, 'Result of FILTER({1;2;3;4},{"FALSE";0;"TRUE";"trUe"},25)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of FILTER({1;2;3;4},{"FALSE";0;"TRUE";"trUe"},25)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", 'Result of FILTER({1;2;3;4},{"FALSE";0;"TRUE";"trUe"},25)[2,0]');

		oParser = new parserFormula('FILTER({1;2;3;4},{FALSE;"0";1;1},25)', "C2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3;4},{FALSE;"0";1;1},25)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of FILTER({1;2;3;4},{FALSE;"0";1;1},25)');

		oParser = new parserFormula('FILTER({1;2;3;4},{FALSE;0;1;"str"},25)', "C2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3;4},{FALSE;0;1;"str"},25)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of FILTER({1;2;3;4},{FALSE;0;1;"str"},25)');

		oParser = new parserFormula('FILTER({1;2;3;4;5},{FALSE;0;1;"str"},25)', "C2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3;4;5},{FALSE;0;1;"str"},25)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of FILTER({1;2;3;4;5},{FALSE;0;1;"str"},25)');

		oParser = new parserFormula('FILTER({1;2;3},{FALSE;TRUE},25)', "C2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3},{FALSE;TRUE},25)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of FILTER({1;2;3},{FALSE;TRUE},25)');

		oParser = new parserFormula('FILTER({1;2;3},{FALSE;TRUE})', "C2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3},{FALSE;TRUE})');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of FILTER({1;2;3},{FALSE;TRUE})');

		oParser = new parserFormula("FILTER(F10:H15,(F10:F15>5)*(F10:F15<9))", "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,(F10:F15>5)*(F10:F15<9)))");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 7, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<9)))[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 22, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<9)))[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 0, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<9)))[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<9)))[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<9)))[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<9)))[1,2]');

		oParser = new parserFormula("FILTER(F10:H15,(F10:H10=1)*(F11:H11=-10))", "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,(F10:H10=1)*(F11:H11=-10))");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of FILTER(F10:H15,(F10:H10=1)*(F11:H11=-10))[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of FILTER(F10:H15,(F10:H10=1)*(F11:H11=-10))[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), "#N/A", 'Result of FILTER(F10:H15,(F10:H10=1)*(F11:H11=-10))[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), -10, 'Result of FILTER(F10:H15,(F10:H10=1)*(F11:H11=-10))[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of FILTER(F10:H15,(F10:H10=1)*(F11:H11=-10))[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), -5, 'Result of FILTER(F10:H15,(F10:H10=1)*(F11:H11=-10))[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 0, 'Result of FILTER(F10:H15,(F10:H10=1)*(F11:H11=-10))[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 5, 'Result of FILTER(F10:H15,(F10:H10=1)*(F11:H11=-10))[4,0]');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), 10, 'Result of FILTER(F10:H15,(F10:H10=1)*(F11:H11=-10))[5,0]');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),F10:G11)', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,(F10:F15>5)*(F10:F15<6)),F10:G11)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),F10:G11))[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 25, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),F10:G11))[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 3, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),F10:G11))[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 24, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),F10:G11))[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),F10:G11))[2,0]');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),B10)', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,(F10:F15>5)*(F10:F15<6)),B10)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue().getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),B10))');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),B11)', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,(F10:F15>5)*(F10:F15<6)),B11)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue().getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),B11))');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(F10:F15<6), "")', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,(F10:F15>5)*(F10:F15<6)))");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),""))');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),25)', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,(F10:F15>5)*(F10:F15<6)),25)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), 25, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),25))');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),"str")', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,(F10:F15>5)*(F10:F15<6)),'str')");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "str", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),"str"))');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),TRUE)', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,(F10:F15>5)*(F10:F15<6)),TRUE)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "TRUE", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),TRUE))');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),FALSE)', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,(F10:F15>5)*(F10:F15<6)),FALSE)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "FALSE", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),FALSE))');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2,3})', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,(F10:F15>5)*(F10:F15<6)),{1,2,3})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2,3}))[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 2, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2,3}))[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 3, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2,3}))[0,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2,3}))[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2,3}))[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2,3}))[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2,3}))[1,2]');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2,3}))[1,3]');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1;2;3})', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,(F10:F15>5)*(F10:F15<6)),{1;2;3})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1;2;3}))[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1;2;3}))[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1;2;3}))[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1;2;3}))[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 3, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1;2;3}))[2,0]');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2;3,4})', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), "FILTER(F10:H15,(F10:F15>5)*(F10:F15<6)),{1,2;3,4})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2;3,4}))[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 2, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2;3,4}))[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 3, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2;3,4}))[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 4, 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2;3,4}))[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(F10:F15<6),{1,2;3,4}))[2,0]');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15))', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), 'FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15))');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 9, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15))[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 21, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15))[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 5, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15))[0,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15))[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 11, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15))[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 20, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15))[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 10, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15))[1,2]');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15))[1,3]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15))[2,0]');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(TRUE))', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), 'FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(TRUE))');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 9, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(TRUE))[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 21, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(TRUE))[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 5, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(TRUE))[0,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(TRUE))[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 11, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(TRUE))[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 20, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(TRUE))[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 10, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(TRUE))[1,2]');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(TRUE))[1,3]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(TRUE))[2,0]');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(1))', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), 'FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(1))');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 9, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(1))[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 21, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(1))[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 5, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(1))[0,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(1))[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 11, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(1))[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 20, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(1))[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 10, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(1))[1,2]');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(1))[1,3]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(1))[2,0]');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({1}))', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), 'FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*({1}))');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 9, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({1}))[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 21, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({1}))[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 5, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({1}))[0,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({1}))[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 11, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({1}))[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 20, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({1}))[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 10, 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({1}))[1,2]');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({1}))[1,3]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({1}))[2,0]');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(FALSE))', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), 'FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(FALSE))');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(FALSE))');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(0))', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), 'FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(0))');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*(0))');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({0}))', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), 'FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({0}))');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({0}))');

		oParser = new parserFormula('FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({1,2}))', "C2", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C2:E7").bbox);
		assert.ok(oParser.parse(), 'FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({1,2}))');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of FILTER(F10:H15,(F10:F15>5)*(G10:G15<23)*(H10:H15)*({1,2}))');

		// value && value
		oParser = new parserFormula('FILTER(12,"0")', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,"0")');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER(12,"0")');
		
		oParser = new parserFormula('FILTER(12,"1")', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,"1")');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER(12,"1")');

		oParser = new parserFormula('FILTER(12,"TRUE")', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,"TRUE")');
		assert.strictEqual(oParser.calculate().getValue(), 12, 'Result of FILTER(12,"TRUE")');

		oParser = new parserFormula('FILTER(12,"FALSE")', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,"FALSE")');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER(12,"FALSE")');		// #CALC!

		oParser = new parserFormula('FILTER(12,"0",25)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,"0",25)');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER(12,"0",25)');
		
		oParser = new parserFormula('FILTER(12,"1",25)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,"1",25)');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER(12,"1",25)');

		oParser = new parserFormula('FILTER(12,"TRUE",25)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,"TRUE",25)');
		assert.strictEqual(oParser.calculate().getValue(), 12, 'Result of FILTER(12,"TRUE",25)');

		oParser = new parserFormula('FILTER(12,"FALSE",25)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,"FALSE")');
		assert.strictEqual(oParser.calculate().getValue(), 25, 'Result of FILTER(12,"FALSE")');

		oParser = new parserFormula('FILTER(12,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), 12, 'Result of FILTER(12,TRUE)');

		oParser = new parserFormula('FILTER(12,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER(12,FALSE)');	// #CALC!

		oParser = new parserFormula('FILTER(12,12)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,12)');
		assert.strictEqual(oParser.calculate().getValue(), 12, 'Result of FILTER(12,12)');

		oParser = new parserFormula('FILTER(12,0)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,0)');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER(12,0)');		// #CALC!

		oParser = new parserFormula('FILTER(FALSE,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(FALSE,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), "FALSE", 'Result of FILTER(FALSE,TRUE)');

		oParser = new parserFormula('FILTER(#N/A,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(#N/A,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of FILTER(#N/A,TRUE)');

		oParser = new parserFormula('FILTER(FALSE,#NUM!)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(FALSE,#NUM!)');
		assert.strictEqual(oParser.calculate().getValue(), "#NUM!", 'Result of FILTER(FALSE,#NUM!)');

		oParser = new parserFormula('FILTER(#N/A,#NUM!)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(#N/A,#NUM!)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of FILTER(#N/A,#NUM!)');

		oParser = new parserFormula('FILTER(,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER(,TRUE)');

		oParser = new parserFormula('FILTER(B10,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(B10,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), "", 'Result of FILTER(B10,TRUE)');	// 0

		oParser = new parserFormula('FILTER(B11,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(B11,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), "", 'Result of FILTER(B11,TRUE)');	// 0

		oParser = new parserFormula('FILTER(TRUE,)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(TRUE,)');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER(TRUE,)');

		oParser = new parserFormula('FILTER(TRUE,B10)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(TRUE,B10)');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER(TRUE,B10)');	// #CALC!

		oParser = new parserFormula('FILTER(TRUE,B11)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(TRUE,B11)');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER(TRUE,B11)');	// #CALC!

		// value && range
		oParser = new parserFormula('FILTER("z", {TRUE})', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER("z", {TRUE})');
		assert.strictEqual(oParser.calculate().getValue(), "z", 'Result of FILTER("z", {TRUE})');

		oParser = new parserFormula('FILTER("z", {TRUE,FALSE})', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER("z", {TRUE,FALSE})');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER("z", {TRUE,FALSE})');

		oParser = new parserFormula('FILTER("x", {TRUE;FALSE})', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER("x", {TRUE;FALSE})');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER("x", {TRUE;FALSE})');

		oParser = new parserFormula('FILTER("12", {FALSE})', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER("12", {FALSE})');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of FILTER("12", {FALSE})');	// #CALC!

		// range && value
		oParser = new parserFormula('FILTER({1;2;3},FALSE,25)', "C2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3},FALSE,25)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), 25, 'Result of FILTER({1;2;3},FALSE,25)');

		oParser = new parserFormula('FILTER({1,2,3},TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER({1,2,3},TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of FILTER({1,2,3},TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 2, 'Result of FILTER({1,2,3},TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 3, 'Result of FILTER({1,2,3},TRUE)[0,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), "", 'Result of FILTER({1,2,3},TRUE)[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", 'Result of FILTER({1,2,3},TRUE)[1,0]');

		oParser = new parserFormula('FILTER({1;2;3},TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3},TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of FILTER({1,2,3},TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of FILTER({1,2,3},TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, 'Result of FILTER({1,2,3},TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 3, 'Result of FILTER({1,2,3},TRUE)[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "", 'Result of FILTER({1,2,3},TRUE)[3,0]');

		oParser = new parserFormula('FILTER({1;2;3},FALSE, 25)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3},FALSE, 25)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), 25, 'Result of FILTER({1,2,3},FALSE)');

		oParser = new parserFormula('FILTER({1;2;3},FALSE,)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3},FALSE,)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of FILTER({1,2,3},FALSE,)');

		oParser = new parserFormula('FILTER({1;2;3},FALSE,B10)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3},FALSE,B10)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue().getValue(), "", 'Result of FILTER({1,2,3},FALSE,B10)'); 		// 0

		oParser = new parserFormula('FILTER({1;2;3},FALSE,B11)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3},FALSE,B11)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue().getValue(), "", 'Result of FILTER({1,2,3},FALSE,B11)');			// 0

		oParser = new parserFormula('FILTER({1;2;3},FALSE,#N/A)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3},FALSE,#N/A)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#N/A", 'Result of FILTER({1,2,3},FALSE,#N/A)');

		oParser = new parserFormula('FILTER({1;2;3},FALSE,0)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER({1;2;3},FALSE,0)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), 0, 'Result of FILTER({1,2,3},FALSE,0)');

		oParser = new parserFormula('FILTER(12,TRUE,)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,TRUE,)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), 12, 'Result of FILTER(12,TRUE,)');

		oParser = new parserFormula('FILTER(12,TRUE,#N/A)', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(12,TRUE,#N/A)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), 12, 'Result of FILTER(12,TRUE,#N/A)');

		ws.getRange2("A:B").cleanAll();
		ws.getRange2("A100:A200").setValue("10");
		ws.getRange2("A100").setValue("1");
		ws.getRange2("A102").setValue("2");
		ws.getRange2("A105").setValue("3");
		ws.getRange2("A110").setValue("4");
		ws.getRange2("B100:B150").setValue("Str");
		ws.getRange2("B100").setValue("Test");
		ws.getRange2("B102").setValue("Test");
		ws.getRange2("B105").setValue("Test");
		ws.getRange2("B110").setValue("Test");

		// for bug 64954
		oParser = new parserFormula('FILTER(A:A,B:B="Test")', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(A:A,B:B="Test")');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 1, 'Result of FILTER(A:A,B:B="Test")');
		assert.strictEqual(array.getElementRowCol(1,0).getValue(), 2, 'Result of FILTER(A:A,B:B="Test")');
		assert.strictEqual(array.getElementRowCol(2,0).getValue(), 3, 'Result of FILTER(A:A,B:B="Test")');
		assert.strictEqual(array.getElementRowCol(3,0).getValue(), 4, 'Result of FILTER(A:A,B:B="Test")');

		oParser = new parserFormula('FILTER(A:A<3,B:B="Test")', "A2", ws);
		assert.ok(oParser.parse(), 'FILTER(A:A<3,B:B="Test")');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), "TRUE", 'Result of FILTER(A:A<3,B:B="Test")');
		assert.strictEqual(array.getElementRowCol(1,0).getValue(), "TRUE", 'Result of FILTER(A:A<3,B:B="Test")');
		assert.strictEqual(array.getElementRowCol(2,0).getValue(), "FALSE", 'Result of FILTER(A:A<3,B:B="Test")');
		assert.strictEqual(array.getElementRowCol(3,0).getValue(), "FALSE", 'Result of FILTER(A:A<3,B:B="Test")');

		ws.getRange2("A100:C214").cleanAll();
		// Data for reference link. Use A100-A115
		ws.getRange2("A100").setValue("1");
		ws.getRange2("A101").setValue("2");
		ws.getRange2("A102").setValue("3");
		ws.getRange2("A103").setValue("4");
		ws.getRange2("A104").setValue("5");
		ws.getRange2("A105").setValue("6");
		ws.getRange2("A106").setValue("7");
		ws.getRange2("A107").setValue("8");
		ws.getRange2("A108").setValue("9");
		ws.getRange2("A109").setValue("10");
		ws.getRange2("A110").setValue("11");
		ws.getRange2("A111").setValue("11");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 2);
		ws.getRange2("A601").setValue("5"); // Num (Column1)
		ws.getRange2("B601").setValue("10"); // Num (Column2)
		ws.getRange2("C601").setValue("Text"); // Text (Column3)

		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2


		// Positive cases:
		// Case #1: Range, Formula. Filters range A100:A110 where values > 5. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100:A110,A100:A110>5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100:A110,A100:A110>5) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 6, 'Test: Positive case: Range, Formula. Filters range A100:A110 where values > 5. 2 of 3 arguments used.');
		// Case #2: Range, Formula, String. Filters range with string if_empty. 3 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100:A110,A100:A110>5,"No Data")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100:A110,A100:A110>5,"No Data") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 6, 'Test: Positive case: Range, Formula, String. Filters range with string if_empty. 3 of 3 arguments used.');
		// Case #3: Array, Array. Filters array with boolean array. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER({1,2,3,4,5},{TRUE,FALSE,TRUE,FALSE,TRUE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER({1,2,3,4,5},{TRUE,FALSE,TRUE,FALSE,TRUE}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Array. Filters array with boolean array. 2 of 3 arguments used.');
		// Case #4: Array, Array, String. Filters array with boolean array and if_empty string. 3 of 3 arguments used.
		oParser = new parserFormula('FILTER({1,2,3,4,5},{TRUE,FALSE,TRUE,FALSE,TRUE},"Empty")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER({1,2,3,4,5},{TRUE,FALSE,TRUE,FALSE,TRUE},"Empty") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Array, String. Filters array with boolean array and if_empty string. 3 of 3 arguments used.');
		// Case #5: Reference link, Formula. Single-cell reference filtered by condition. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100,A100>5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100,A100>5) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Positive case: Reference link, Formula. Single-cell reference filtered by condition. 2 of 3 arguments used.');
		// Case #6: Reference link, Formula, Number. Single-cell reference with numeric if_empty. 3 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100,A100>5,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100,A100>5,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Positive case: Reference link, Formula, Number. Single-cell reference with numeric if_empty. 3 of 3 arguments used.');
		// Case #7: Area, Formula. Single-cell range filtered by condition. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(A101:A101,A101:A101>5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A101:A101,A101:A101>5) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Positive case: Area, Formula. Single-cell range filtered by condition. 2 of 3 arguments used.');
		// Case #8: Area, Formula, String. Single-cell range with string if_empty. 3 of 3 arguments used.
		oParser = new parserFormula('FILTER(A101:A101,A101:A101>5,"None")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A101:A101,A101:A101>5,"None") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'None', 'Test: Positive case: Area, Formula, String. Single-cell range with string if_empty. 3 of 3 arguments used.');
		// Case #9: Table, Formula. Table column filtered by condition. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(Table1[Column1],Table1[Column1]>5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(Table1[Column1],Table1[Column1]>5) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Positive case: Table, Formula. Table column filtered by condition. 2 of 3 arguments used.');
		// Case #10: Table, Formula, String. Table column with string if_empty. 3 of 3 arguments used.
		oParser = new parserFormula('FILTER(Table1[Column1],Table1[Column1]>5,"No Data")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(Table1[Column1],Table1[Column1]>5,"No Data") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'No Data', 'Test: Positive case: Table, Formula, String. Table column with string if_empty. 3 of 3 arguments used.');
		// Case #11: Ref3D, Formula. 3D reference filtered by condition. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(Sheet2!A1,Sheet2!A1>5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(Sheet2!A1,Sheet2!A1>5) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Positive case: Ref3D, Formula. 3D reference filtered by condition. 2 of 3 arguments used.');
		// Case #12: Area3D, Formula. 3D single-cell range filtered. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(Sheet2!A2:A2,Sheet2!A2:A2>5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(Sheet2!A2:A2,Sheet2!A2:A2>5) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Positive case: Area3D, Formula. 3D single-cell range filtered. 2 of 3 arguments used.');
		// Case #13: Name, Formula. Named range filtered by condition. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(TestName,TestName>5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(TestName,TestName>5) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Positive case: Name, Formula. Named range filtered by condition. 2 of 3 arguments used.');
		// Case #14: Name3D, Formula. 3D named range filtered. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(TestName3D,TestName3D>5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(TestName3D,TestName3D>5) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Positive case: Name3D, Formula. 3D named range filtered. 2 of 3 arguments used.');
		// Case #15: Formula, Formula. Nested IF for array argument. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(IF(TRUE,A100:A110,A101:A111),A100:A110>5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(IF(TRUE,A100:A110,A101:A111),A100:A110>5) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 6, 'Test: Positive case: Formula, Formula. Nested IF for array argument. 2 of 3 arguments used.');
		// Case #16: Formula, Formula, Formula. Nested SUM in include argument. 3 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100:A110,A100:A110>SUM(5,2),"Empty")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100:A110,A100:A110>SUM(5,2),"Empty") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 8, 'Test: Positive case: Formula, Formula, Formula. Nested SUM in include argument. 3 of 3 arguments used.');
		// Case #17: Array, Formula. Nested IF in include argument. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER({1,2,3,4,5},IF(TRUE,TRUE,FALSE))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER({1,2,3,4,5},IF(TRUE,TRUE,FALSE)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Formula. Nested IF in include argument. 2 of 3 arguments used.');
		// Case #18: Formula, Formula. FILTER inside SUM formula. 2 of 3 arguments used.
		oParser = new parserFormula('SUM(FILTER(A100:A110,A100:A110>5))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SUM(FILTER(A100:A110,A100:A110>5)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 51, 'Test: Positive case: Formula, Formula. FILTER inside SUM formula. 2 of 3 arguments used.');
		// Case #19: Date, Formula. Date as array filtered by condition. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(DATE(2025,1,1),DATE(2025,1,1)>DATE(2024,1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(DATE(2025,1,1),DATE(2025,1,1)>DATE(2024,1,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 45658, 'Test: Positive case: Date, Formula. Date as array filtered by condition. 2 of 3 arguments used.');
		// Case #20: Time, Formula. Time adjusted to valid number filtered. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(TIME(12,0,0)+1,TIME(12,0,0)+1>1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(TIME(12,0,0)+1,TIME(12,0,0)+1>1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1.5, 'Test: Positive case: Time, Formula. Time adjusted to valid number filtered. 2 of 3 arguments used.');
		// Case #21: Array, Array, Number. Filters array with numeric if_empty. 3 of 3 arguments used.
		oParser = new parserFormula('FILTER({1,2,3},{TRUE,TRUE,FALSE},0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER({1,2,3},{TRUE,TRUE,FALSE},0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Array, Number. Filters array with numeric if_empty. 3 of 3 arguments used.');
		// Case #22: Range, Formula, Formula. Nested AVERAGE in include argument. 3 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100:A110,A100:A110>AVERAGE(A100:A110),"No Data")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100:A110,A100:A110>AVERAGE(A100:A110),"No Data") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 7, 'Test: Positive case: Range, Formula, Formula. Nested AVERAGE in include argument. 3 of 3 arguments used.');

		// Negative cases:
		// Case #1: Empty, Formula. Empty array argument returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(,A100:A110>5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(,A100:A110>5) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Empty, Formula. Empty array argument returns #VALUE!. 2 of 3 arguments used.');
		// Case #2: Range, Empty. Empty include argument returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100:A110,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100:A110,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Range, Empty. Empty include argument returns #VALUE!. 2 of 3 arguments used.');
		// Case #3: Range, String. Non-boolean include returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100:A110,"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100:A110,"abc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Range, String. Non-boolean include returns #VALUE!. 2 of 3 arguments used.');
		// Case #4: Range, Error. Error in include propagates #N/A. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100:A110,NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100:A110,NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Range, Error. Error in include propagates #N/A. 2 of 3 arguments used.');
		// Case #5: Error, Formula. Error in array propagates #N/A. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(NA(),A100:A110>5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(NA(),A100:A110>5) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error, Formula. Error in array propagates #N/A. 2 of 3 arguments used.');
		// Case #6: Range, Array. Mismatched array sizes returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100:A110,{TRUE,FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100:A110,{TRUE,FALSE}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Range, Array. Mismatched array sizes returns #VALUE!. 2 of 3 arguments used.');
		// Case #7: Area, Formula. Multi-cell range as single argument returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(A101:A102,A101:A102>5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A101:A102,A101:A102>5) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Area, Formula. Multi-cell range as single argument returns #VALUE!. 2 of 3 arguments used.');
		// Case #8: Array, Array. Mismatched array sizes returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER({1,2},{TRUE,FALSE,TRUE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER({1,2},{TRUE,FALSE,TRUE}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, Array. Mismatched array sizes returns #VALUE!. 2 of 3 arguments used.');
		// Case #9: Reference link, String. Non-boolean string include returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100,"TRUE")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100,"TRUE") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Reference link, String. Non-boolean string include returns #VALUE!. 2 of 3 arguments used.');
		// Case #10: Area3D, Formula. 3D multi-cell range returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(Sheet2!A1:A2,Sheet2!A1:A2>5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(Sheet2!A1:A2,Sheet2!A1:A2>5) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Area3D, Formula. 3D multi-cell range returns #VALUE!. 2 of 3 arguments used.');
		// Case #11: Name, String. Non-boolean include for named range returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(TestName,"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(TestName,"abc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Name, String. Non-boolean include for named range returns #VALUE!. 2 of 3 arguments used.');
		// Case #12: Name3D, Error. Error in include for 3D named range propagates #N/A. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(TestName3D2,NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(TestName3D2,NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Name3D, Error. Error in include for 3D named range propagates #N/A. 2 of 3 arguments used.');
		// Case #13: Table, String. Non-boolean include for table returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(Table1[Column1],"Str")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(Table1[Column1],"Str") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Table, String. Non-boolean include for table returns #VALUE!. 2 of 3 arguments used.');
		// Case #14: Ref3D, Error. Error in include for 3D ref propagates #N/A. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(Sheet2!A1,NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(Sheet2!A1,NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Ref3D, Error. Error in include for 3D ref propagates #N/A. 2 of 3 arguments used.');
		// Case #15: Range, Boolean. Single boolean include returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100:A110,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100:A110,FALSE) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Range, Boolean. Single boolean include returns #VALUE!. 2 of 3 arguments used.');
		// Case #16: Range, Formula. Divide by zero in include returns #DIV/0!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100:A110,A100:A110/0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100:A110,A100:A110/0) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#DIV/0!', 'Test: Negative case: Range, Formula. Divide by zero in include returns #DIV/0!. 2 of 3 arguments used.');
		// Case #17: Name, Name. Non-boolean include name returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(TestName,TestName1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(TestName,TestName1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), -0.5, 'Test: Negative case: Name, Name. Non-boolean include name returns #VALUE!. 2 of 3 arguments used.');
		// Case #18: Name3D, Name3D. Non-boolean include 3D name returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(TestName3D,TestNameArea3D2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(TestName3D,TestNameArea3D2) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#NAME?', 'Test: Negative case: Name3D, Name3D. Non-boolean include 3D name returns #VALUE!. 2 of 3 arguments used.');
		// Case #19: Range, Formula. Non-numeric comparison in include returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100:A110,A100:A110="text")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100:A110,A100:A110="text") is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Range, Formula. Non-numeric comparison in include returns #VALUE!. 2 of 3 arguments used.');
		// Case #20: Array, String. Non-boolean string include returns #VALUE!. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER({1,2,3},"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER({1,2,3},"abc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, String. Non-boolean string include returns #VALUE!. 2 of 3 arguments used.');

		// Bounded cases:
		// Case #1: Number, Formula. Minimum valid array (single number). 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(1,TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Bounded case: Number, Formula. Minimum valid array (single number). 2 of 3 arguments used.');
		// Case #2: Number, Formula. Maximum valid Excel number in array. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER(9.99999999999999E+307,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(9.99999999999999E+307,TRUE) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1e+308, 'Test: Bounded case: Number, Formula. Maximum valid Excel number in array. 2 of 3 arguments used.');
		// Case #3: Array, Array. Minimum valid positive numbers in array. 2 of 3 arguments used.
		oParser = new parserFormula('FILTER({1E-307,1E-307},{TRUE,TRUE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER({1E-307,1E-307},{TRUE,TRUE}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1e-307, 'Test: Bounded case: Array, Array. Minimum valid positive numbers in array. 2 of 3 arguments used.');
		// Case #4: Range, Formula, Number. Maximum valid condition in include. 3 of 3 arguments used.
		oParser = new parserFormula('FILTER(A100:A110,A100:A110>9.99999999999999E+307,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FILTER(A100:A110,A100:A110>9.99999999999999E+307,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Bounded case: Range, Formula, Number. Maximum valid condition in include. 3 of 3 arguments used.');

		// Need to fix: error type diff(#CALC instead #VALUE), result diff in boundary case
		// Case #5: Reference link, Formula. Single-cell reference filtered by condition. 2 of 3 arguments used.
		// Case #7: Area, Formula. Single-cell range filtered by condition. 2 of 3 arguments used.
		// Case #11: Ref3D, Formula. 3D reference filtered by condition. 2 of 3 arguments used.
		// Case #12: Area3D, Formula. 3D single-cell range filtered. 2 of 3 arguments used.
		// Case #13: Name, Formula. Named range filtered by condition. 2 of 3 arguments used.
		// Case #14: Name3D, Formula. 3D named range filtered. 2 of 3 arguments used.
		// Case #7: Area, Formula. Multi-cell range as single argument returns #VALUE!. 2 of 3 arguments used.
		// Case #10: Area3D, Formula. 3D multi-cell range returns #VALUE!. 2 of 3 arguments used.
		// Case #15: Range, Boolean. Single boolean include returns #VALUE!. 2 of 3 arguments used.
		// Case #16: Range, Formula. Divide by zero in include returns #DIV/0!. 2 of 3 arguments used.
		// Case #18: Name3D, Name3D. Non-boolean include 3D name returns #VALUE!. 2 of 3 arguments used.
		// Case #19: Range, Formula. Non-numeric comparison in include returns #VALUE!. 2 of 3 arguments used.
		// Case #2: Number, Formula. Maximum valid Excel number in array. 2 of 3 arguments used. - res diff


	});

	QUnit.test("FORMULATEXT", function (assert) {
		wb.dependencyFormulas.unlockRecal();

		ws.getRange2("S101").setValue("=TODAY()");
		ws.getRange2("S102").setValue("");
		ws.getRange2("S103").setValue("=1+1");

		oParser = new parserFormula("FORMULATEXT(S101)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "=TODAY()");

		oParser = new parserFormula("FORMULATEXT(S101:S102)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "=TODAY()");

		oParser = new parserFormula("FORMULATEXT(S102)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		oParser = new parserFormula("FORMULATEXT(S100:105)", "A1", ws);
		assert.ok(oParser.parse());
		//"#N/A" - в ms excel
		assert.strictEqual(oParser.calculate().getValue(), newFormulaParser ? "#N/A" : "#VALUE!");

		oParser = new parserFormula("FORMULATEXT(S103)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "=1+1");

		oParser = new parserFormula("FORMULATEXT(#REF!)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		wb.dependencyFormulas.lockRecal();

		testArrayFormulaEqualsValues(assert, "#N/A,#N/A,#N/A,#N/A;#N/A,#N/A,#N/A,#N/A;#N/A,#N/A,#N/A,#N/A", "FORMULATEXT(A1:C2)");

		ws.getRange2("A1:C214").cleanAll();
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue('=SQRT("")');
		ws.getRange2("A101").setValue('=SUM("")');
		ws.getRange2("A104").setValue("Text");
		// For area
		ws.getRange2("A102").setValue("=SUM(1)");
		ws.getRange2("A103").setValue('=TEXT("1s")');
		ws.getRange2("A105").setValue("NonFormula");
		ws.getRange2("A106").setValue("1E+307");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 2);
		ws.getRange2("A601").setValue("=SUM(1)"); // Formula (Column1)
		ws.getRange2("B601").setValue("SUM(1)"); // Text (Column2)
		ws.getRange2("C601").setValue("Text"); // Text (Column3)

		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2

		// Positive cases:
		// Case #1: Reference link. Reference to cell with formula, returns "=1+1". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '=SQRT(\")', 'Test: Positive case: Reference link. Reference to cell with formula, returns "=1+1". 1 argument used.');
		// Case #2: Reference link. Reference to cell with different formula, returns "=SUM(A1:A2)". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A101) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '=SUM(\")', 'Test: Positive case: Reference link. Reference to cell with different formula, returns "=SUM(A1:A2)". 1 argument used.');
		// Case #3: Area. Multi-cell range, returns formula from upper-left cell "=1+1". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A100:A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A100:A101) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '=SQRT(\")', 'Test: Positive case: Area. Multi-cell range, returns formula from upper-left cell "=1+1". 1 argument used.');
		// Case #4: Area. Single-cell range with formula, returns "=1+1". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A100:A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A100:A100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '=SQRT(\")', 'Test: Positive case: Area. Single-cell range with formula, returns "=1+1". 1 argument used.');
		// Case #5: Formula. Nested IF formula resolving to valid reference, returns "=1+1". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(IF(TRUE,A101,A100))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(IF(TRUE,A101,A100)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '=SUM(\")', 'Test: Positive case: Formula. Nested IF formula resolving to valid reference, returns "=1+1". 1 argument used.');
		// Case #6: Name. Named range with formula, returns "=1+1". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(TestName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(TestName) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Name. Named range with formula, returns "=1+1". 1 argument used.');
		// Case #7: Name3D. 3D named range with formula, returns "=1+1". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Name3D. 3D named range with formula, returns "=1+1". 1 argument used.');
		// Case #8: Ref3D. 3D reference to cell with formula, returns "=1+1". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(Sheet2!A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(Sheet2!A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Ref3D. 3D reference to cell with formula, returns "=1+1". 1 argument used.');
		// Case #9: Area3D. 3D single-cell range with formula, returns "=1+1". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(Sheet2!A1:A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(Sheet2!A1:A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Area3D. 3D single-cell range with formula, returns "=1+1". 1 argument used.');
		// Case #10: Table. Table structured reference with formula, returns "=A1+1". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(Table1[Column1])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(Table1[Column1]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '=SUM(1)', 'Test: Positive case: Table. Table structured reference with formula, returns "=A1+1". 1 argument used.');
		// Case #11: Reference link. Self-reference, returns "=FORMULATEXT(A1)" without circular reference warning. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A102) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '=SUM(1)', 'Test: Positive case: Reference link. Self-reference, returns "=FORMULATEXT(A1)" without circular reference warning. 1 argument used.');
		// Case #12: Formula. Nested ADDRESS formula resolving to valid reference A1 with formula, returns formula in A1. 1 argument used.
		oParser = new parserFormula('FORMULATEXT($A$100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT($A$100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '=SQRT(\")', 'Test: Positive case: Formula. Nested ADDRESS formula resolving to valid reference A1 with formula, returns formula in A1. 1 argument used.');
		// Case #13: Reference link. Reference to cell with complex formula, returns "=SUM(A1:A2)". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A$100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A$100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '=SQRT(\")', 'Test: Positive case: Reference link. Reference to cell with complex formula, returns "=SUM(A1:A2)". 1 argument used.');
		// Case #14: Area. Large range, returns formula from upper-left cell. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A100:A105)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A100:A105) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '=SQRT(\")', 'Test: Positive case: Area. Large range, returns formula from upper-left cell. 1 argument used.');
		// Case #15: Reference link. Entire row reference, returns formula from first cell in row. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(1:1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(1:1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Reference link. Entire row reference, returns formula from first cell in row. 1 argument used.');
		// Case #16: Reference link. Entire column reference, returns formula from first cell in column. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A:A)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A:A) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Reference link. Entire column reference, returns formula from first cell in column. 1 argument used.');
		// Case #17: Formula. FORMULATEXT inside SUM, returns "=1+1" as text (SUM may error). 1 argument used.
		oParser = new parserFormula('SUM(FORMULATEXT(A100),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SUM(FORMULATEXT(A100),1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Positive case: Formula. FORMULATEXT inside SUM, returns "=1+1" as text (SUM may error). 1 argument used.');
		// Case #18: Reference link. 3D multi-cell range, returns formula from upper-left cell "=1+1". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(Sheet2!A1:A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(Sheet2!A1:A2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Reference link. 3D multi-cell range, returns formula from upper-left cell "=1+1". 1 argument used.');
		// Case #19: Name. Named range with different formula, returns "=SUM(A1:A2)". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(TestName1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(TestName1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Name. Named range with different formula, returns "=SUM(A1:A2)". 1 argument used.');
		// Case #20: Ref3D. 3D reference to another formula, returns "=1+1". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(Sheet2!A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(Sheet2!A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Ref3D. 3D reference to another formula, returns "=1+1". 1 argument used.');

		// Negative cases:
		// Case #1: String. Non-reference string returns #VALUE!. 1 argument used.
		oParser = new parserFormula('FORMULATEXT("abc")', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: FORMULATEXT("abc") is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=FORMULATEXT("abc")', 'Test: Negative case: String. Non-reference string returns #VALUE!. 1 argument used.');
		// Case #2: Number. Non-reference number returns #VALUE!. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(123)', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: FORMULATEXT(123) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=FORMULATEXT(123)', 'Test: Negative case: Number. Non-reference number returns #VALUE!. 1 argument used.');
		// Case #3: Boolean. Boolean input returns #VALUE!. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(TRUE)', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: FORMULATEXT(TRUE) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=FORMULATEXT(TRUE)', 'Test: Negative case: Boolean. Boolean input returns #VALUE!. 1 argument used.');
		// Case #4: Empty. Empty reference link returns #N/A (no formula). 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A102) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '=SUM(1)', 'Test: Negative case: Empty. Empty reference link returns #N/A (no formula). 1 argument used.');
		// Case #5: Error. Error input returns #VALUE!. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(NA())', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: FORMULATEXT(NA()) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=FORMULATEXT(NA())', 'Test: Negative case: Error. Error input returns #VALUE!. 1 argument used.');
		// Case #6: Reference link. Reference to cell with non-formula value, returns #N/A. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A103)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A103) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Reference link. Reference to cell with non-formula value, returns #N/A. 1 argument used.');
		// Case #7: Ref3D. 3D reference to cell with non-formula value, returns #N/A. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(Sheet2!A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(Sheet2!A2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Ref3D. 3D reference to cell with non-formula value, returns #N/A. 1 argument used.');
		// Case #8: Name. Named range with non-formula value, returns #N/A. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(TestNameArea2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(TestNameArea2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Name. Named range with non-formula value, returns #N/A. 1 argument used.');
		// Case #9: Name3D. 3D named range with non-formula value, returns #N/A. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(TestNameArea3D2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(TestNameArea3D2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Name3D. 3D named range with non-formula value, returns #N/A. 1 argument used.');
		// Case #10: Table. Table column with non-formula value, returns #N/A. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Table. Table column with non-formula value, returns #N/A. 1 argument used.');
		// Case #11: Reference link. Reference to closed workbook, returns #N/A. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(External.xlsx!A1)', 'A2', ws);
		//? assert.ok(oParser.parse(), 'Test: FORMULATEXT(External.xlsx!A1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Reference link. Reference to closed workbook, returns #N/A. 1 argument used.');
		// Case #12: Reference link. Reference to protected cell with formula, returns #N/A (assuming worksheet protection). 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A104)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A104) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Reference link. Reference to protected cell with formula, returns #N/A (assuming worksheet protection). 1 argument used.');
		// Case #13: Array. Array input returns #VALUE!. 1 argument used.
		oParser = new parserFormula('FORMULATEXT({A100,A101})', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: FORMULATEXT({A100,A101}) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=FORMULATEXT({A100,A101})', 'Test: Negative case: Array. Array input returns #VALUE!. 1 argument used.');
		// Case #14: Formula. Formula resulting in #NUM! returns #VALUE!. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(SQRT(-1))', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: FORMULATEXT(SQRT(-1)) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=FORMULATEXT(SQRT(-1))', 'Test: Negative case: Formula. Formula resulting in #NUM! returns #VALUE!. 1 argument used.');
		// Case #15: Reference link. Reference to cell with formula > 8192 characters, returns #N/A. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A105)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A105) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Reference link. Reference to cell with formula > 8192 characters, returns #N/A. 1 argument used.');
		// Case #16: Area. Multi-cell range with mixed formula/non-formula, returns formula from F1 "=1+1". 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A100:A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A100:A102) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '=SQRT(\")', 'Test: Negative case: Area. Multi-cell range with mixed formula/non-formula, returns formula from F1 "=1+1". 1 argument used.');
		// Case #17: Ref3D. 3D multi-cell range with non-formula value, returns #N/A. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(Sheet2!A2:A3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(Sheet2!A2:A3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Ref3D. 3D multi-cell range with non-formula value, returns #N/A. 1 argument used.');
		// Case #18: Name. Named range with non-formula value, returns #N/A. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(TestNameArea3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(TestNameArea3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NAME?', 'Test: Negative case: Name. Named range with non-formula value, returns #N/A. 1 argument used.');
		// Case #19: Date. Date input returns #VALUE!. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(DATE(2025,1,1))', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: FORMULATEXT(DATE(2025,1,1)) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=FORMULATEXT(DATE(2025,1,1))', 'Test: Negative case: Date. Date input returns #VALUE!. 1 argument used.');
		// Case #20: Time. Time input returns #VALUE!. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(TIME(12,0,0))', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: FORMULATEXT(TIME(12,0,0)) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=FORMULATEXT(TIME(12,0,0))', 'Test: Negative case: Time. Time input returns #VALUE!. 1 argument used.');

		// Bounded cases:
		// Case #1: Reference link. Entire worksheet row range, returns formula from first cell in row. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(1:1048576)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(1:1048576) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Bounded case: Reference link. Entire worksheet row range, returns formula from first cell in row. 1 argument used.');
		// Case #2: Reference link. Entire worksheet column range, returns formula from first cell in column. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A:XFD)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A:XFD) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Bounded case: Reference link. Entire worksheet column range, returns formula from first cell in column. 1 argument used.');
		// Case #3: Area. Large range, returns formula from upper-left cell. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A101:A10001)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A101:A10001) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '=SUM(\")', 'Test: Bounded case: Area. Large range, returns formula from upper-left cell. 1 argument used.');
		// Case #4: Reference link. Reference to cell with long formula (e.g., 8000 characters), returns formula text. 1 argument used.
		oParser = new parserFormula('FORMULATEXT(A106)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: FORMULATEXT(A106) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Bounded case: Reference link. Reference to cell with long formula (e.g., 8000 characters), returns formula text. 1 argument used.');

		// TODO formula can't be enter without correct reference to a cell or name
		// Need to fix:
		// Case #1: String. Non-reference string returns #VALUE!. 1 argument used.
		// Case #2: Number. Non-reference number returns #VALUE!. 1 argument used.
		// Case #3: Boolean. Boolean input returns #VALUE!. 1 argument used.
		// Case #5: Error. Error input returns #VALUE!. 1 argument used.
		// Case #13: Array. Array input returns #VALUE!. 1 argument used.
		// Case #19: Date. Date input returns #VALUE!. 1 argument used.
		// Case #20: Time. Time input returns #VALUE!. 1 argument used.
		// Case #11: Reference link. Reference to closed workbook, returns #N/A. 1 argument used. - external link


	});

	QUnit.test("Test: \"HLOOKUP\"", function (assert) {

		let array;

		ws.getRange2("A501").setValue("Density");
		ws.getRange2("A502").setValue("Bearings");
		ws.getRange2("A503").setValue("Bolts");
		ws.getRange2("A504").setValue("");

		ws.getRange2("B501").setValue("0.457");
		ws.getRange2("B502").setValue("3.55");
		ws.getRange2("B503").setValue("500");
		ws.getRange2("C501").setValue("0.525");
		ws.getRange2("C502").setValue("3.25");
		ws.getRange2("C503").setValue("400");
		ws.getRange2("D501").setValue("0.616");
		ws.getRange2("D502").setValue("2.93");
		ws.getRange2("D503").setValue("300");
		ws.getRange2("E501").setValue("0.675");
		ws.getRange2("E502").setValue("2.75");
		ws.getRange2("E503").setValue("250");
		ws.getRange2("F501").setValue("0.746");
		ws.getRange2("F502").setValue("2.57");
		ws.getRange2("F503").setValue("200");
		ws.getRange2("G501").setValue("0.835");
		ws.getRange2("G502").setValue("2.38");
		ws.getRange2("G503").setValue("15");
		ws.getRange2("H501").setValue("0.946");
		ws.getRange2("H502").setValue("2.17");
		ws.getRange2("H503").setValue("100");
		ws.getRange2("I501").setValue("1.09");
		ws.getRange2("I502").setValue("1.95");
		ws.getRange2("I503").setValue("50");
		ws.getRange2("J501").setValue("1.29");
		ws.getRange2("J502").setValue("1.71");
		ws.getRange2("J503").setValue("0");

		ws.getRange2("A8100").setValue("2");
		ws.getRange2("B8100").setValue("4");
		ws.getRange2("C8100").setValue("40");
		ws.getRange2("A8101").setValue("1");
		ws.getRange2("B8101").setValue("2");
		ws.getRange2("C8101").setValue("3");
		ws.getRange2("E8100").setValue("1");
		ws.getRange2("E8101").setValue("1");
		ws.getRange2("E8102").setValue("1");
		ws.getRange2("F8100").setValue("2");
		ws.getRange2("F8101").setValue("1");
		ws.getRange2("G8100").setValue("3");
		ws.getRange2("G8101").setValue("1");

		ws.getRange2("A1401:M1402").cleanAll();
		ws.getRange2("A1401").setValue("AnyStringValue2");
		ws.getRange2("B1401").setValue("StringValue(Awesome)");
		ws.getRange2("C1401").setValue("1.12");
		ws.getRange2("D1401").setValue("2.24");
		ws.getRange2("E1401").setValue("#VALUE!");
		ws.getRange2("F1401").setValue("#NUM!");
		ws.getRange2("G1401").setValue("#DIV/0!");
		ws.getRange2("H1401").setValue("TRUE");
		ws.getRange2("I1401").setValue("Sandra");
		ws.getRange2("J1401").setValue("");
		ws.getRange2("K1401").setValue("Sandra");
		ws.getRange2("L1401").setValue("0");
		ws.getRange2("M1401").setValue("5,2");
		ws.getRange2("A1402").setValue("1");
		ws.getRange2("B1402").setValue("2");
		ws.getRange2("C1402").setValue("3");
		ws.getRange2("D1402").setValue("4");
		ws.getRange2("E1402").setValue("5");
		ws.getRange2("F1402").setValue("6");
		ws.getRange2("G1402").setValue("7");
		ws.getRange2("H1402").setValue("8");
		ws.getRange2("I1402").setValue("9");
		ws.getRange2("J1402").setValue("10");
		ws.getRange2("K1402").setValue("11");
		ws.getRange2("L1402").setValue("12");
		ws.getRange2("M1402").setValue("13");

		ws.getRange2("C1101:Y1102").cleanAll();
		ws.getRange2("C1101").setValue("0");
		ws.getRange2("D1101").setValue("0");
		ws.getRange2("E1101").setValue("2.1");
		ws.getRange2("F1101").setValue("2.4");
		ws.getRange2("G1101").setValue("2.4");
		ws.getRange2("H1101").setValue("9");
		ws.getRange2("I1101").setValue("10");
		ws.getRange2("J1101").setValue("11");
		ws.getRange2("K1101").setValue("11");
		ws.getRange2("L1101").setValue("11");
		ws.getRange2("M1101").setValue("12");
		ws.getRange2("N1101").setValue("12");
		ws.getRange2("O1101").setValue("12");
		ws.getRange2("P1101").setValue("67");
		ws.getRange2("Q1101").setValue("");
		ws.getRange2("R1101").setValue("ALDEBARAN");
		ws.getRange2("S1101").setValue("BLUE");
		ws.getRange2("T1101").setValue("CIANO");
		ws.getRange2("U1101").setValue("RED");
		ws.getRange2("V1101").setValue("#N/A");
		ws.getRange2("W1101").setValue("Vega");
		ws.getRange2("X1101").setValue("FALSE");
		ws.getRange2("Y1101").setValue("TRUE");
		ws.getRange2("C1102").setValue("1");
		ws.getRange2("D1102").setValue("2");
		ws.getRange2("E1102").setValue("3");
		ws.getRange2("F1102").setValue("4");
		ws.getRange2("G1102").setValue("5");
		ws.getRange2("H1102").setValue("6");
		ws.getRange2("I1102").setValue("7");
		ws.getRange2("J1102").setValue("8");
		ws.getRange2("K1102").setValue("9");
		ws.getRange2("L1102").setValue("10");
		ws.getRange2("M1102").setValue("11");
		ws.getRange2("N1102").setValue("12");
		ws.getRange2("O1102").setValue("13");
		ws.getRange2("P1102").setValue("14");
		ws.getRange2("Q1102").setValue("15");
		ws.getRange2("R1102").setValue("16");
		ws.getRange2("S1102").setValue("17");
		ws.getRange2("T1102").setValue("18");
		ws.getRange2("U1102").setValue("19");
		ws.getRange2("V1102").setValue("20");
		ws.getRange2("W1102").setValue("21");
		ws.getRange2("X1102").setValue("22");
		ws.getRange2("Y1102").setValue("23");

		ws.getRange2("K100:Z200").cleanAll();
		ws.getRange2("K100").setValue("SCALE 1");
		ws.getRange2("L100").setValue("$");
		ws.getRange2("M100").setValue("");
		ws.getRange2("N100").setValue("0");
		ws.getRange2("O100").setValue("88");
		ws.getRange2("P100").setValue("371");
		ws.getRange2("Q100").setValue("515");
		ws.getRange2("R100").setValue("932");
		ws.getRange2("S100").setValue("1957");
		ws.getRange2("T100").setValue("3111");
		ws.getRange2("U100").setValue("");
		ws.getRange2("V100").setValue("");
		ws.getRange2("W100").setValue("");
		ws.getRange2("X100").setValue("");

		ws.getRange2("K101").setValue("");
		ws.getRange2("L101").setValue("a");
		ws.getRange2("M101").setValue("");
		ws.getRange2("N101").setValue("0.19");
		ws.getRange2("O101").setValue("0.2348");
		ws.getRange2("P101").setValue("0.219");
		ws.getRange2("Q101").setValue("0.3477");
		ws.getRange2("R101").setValue("0.345");
		ws.getRange2("S101").setValue("0.39");
		ws.getRange2("T101").setValue("0.47");
		ws.getRange2("U101").setValue("1");
		ws.getRange2("V101").setValue("2");
		ws.getRange2("W101").setValue("3");
		ws.getRange2("X101").setValue("4");

		ws.getRange2("K103").setValue("SCALE 2");
		ws.getRange2("L103").setValue("$");
		ws.getRange2("M103").setValue("");
		ws.getRange2("N103").setValue("0");
		ws.getRange2("O103").setValue("359");
		ws.getRange2("P103").setValue("438");
		ws.getRange2("Q103").setValue("548");
		ws.getRange2("R103").setValue("721");
		ws.getRange2("S103").setValue("865");
		ws.getRange2("T103").setValue("1282");
		ws.getRange2("U103").setValue("2307");
		ws.getRange2("V103").setValue("3461");
		ws.getRange2("W103").setValue("");
		ws.getRange2("X103").setValue("");
		ws.getRange2("Y103").setValue("");

		ws.getRange2("K104").setValue("");
		ws.getRange2("L104").setValue("a");
		ws.getRange2("M104").setValue("");
		ws.getRange2("N104").setValue("");
		ws.getRange2("O104").setValue("0.19");
		ws.getRange2("P104").setValue("0.29");
		ws.getRange2("Q104").setValue("0.21");
		ws.getRange2("R104").setValue("0.219");
		ws.getRange2("S104").setValue("0.3477");
		ws.getRange2("T104").setValue("0.345");
		ws.getRange2("U104").setValue("0.39");
		ws.getRange2("V104").setValue("0.47");
		ws.getRange2("W104").setValue("1");
		ws.getRange2("X104").setValue("2");
		ws.getRange2("Y104").setValue("3");

		ws.getRange2("E301:Q302").cleanAll();
		ws.getRange2("E301").setValue("String");
		ws.getRange2("F301").setValue("1");
		ws.getRange2("G301").setValue("2");
		ws.getRange2("H301").setValue("3");
		ws.getRange2("I301").setValue("#VALUE!");
		ws.getRange2("J301").setValue("#NUM!");
		ws.getRange2("K301").setValue("#DIV/0!");
		ws.getRange2("L301").setValue("TRUE");
		ws.getRange2("M301").setValue("Sandra");
		ws.getRange2("N301").setValue("");
		ws.getRange2("O301").setValue("");
		ws.getRange2("P301").setValue("");
		ws.getRange2("Q301").setValue("5");
		ws.getRange2("E302").setValue("1");
		ws.getRange2("F302").setValue("2");
		ws.getRange2("G302").setValue("3");
		ws.getRange2("H302").setValue("4");
		ws.getRange2("I302").setValue("5");
		ws.getRange2("J302").setValue("6");
		ws.getRange2("K302").setValue("7");
		ws.getRange2("L302").setValue("8");
		ws.getRange2("M302").setValue("9");
		ws.getRange2("N302").setValue("10");
		ws.getRange2("O302").setValue("11");
		ws.getRange2("P302").setValue("12");
		ws.getRange2("Q302").setValue("13");

		ws.getRange2("G303").setValue("Aa");
		ws.getRange2("H303").setValue("Ae");
		ws.getRange2("I303").setValue("Ba");
		ws.getRange2("J303").setValue("Be");
		ws.getRange2("K303").setValue("CA");
		ws.getRange2("L303").setValue("CE");
		ws.getRange2("M303").setValue("DA");
		ws.getRange2("N303").setValue("DE");
		ws.getRange2("O303").setValue("Ha");
		ws.getRange2("P303").setValue("HE");
		ws.getRange2("Q303").setValue("Ia");
		ws.getRange2("R303").setValue("Ie");
		ws.getRange2("S303").setValue("Ja");
		ws.getRange2("T303").setValue("Je");
		ws.getRange2("U303").setValue("Ka");
		ws.getRange2("V303").setValue("Ke");

		ws.getRange2("AA201:AH202").setValue("W");
		ws.getRange2("AA201").setValue("1");
		ws.getRange2("AB201").setValue("2");
		ws.getRange2("AC201").setValue("3");
		ws.getRange2("AD201").setValue("4");
		ws.getRange2("AE201").setValue("5");
		ws.getRange2("AF201").setValue("6");
		ws.getRange2("AG201").setValue("7");
		ws.getRange2("AH201").setValue("8");
		ws.getRange2("AC202").setValue("Looked result(3)");

		ws.getRange2("AA1101").setValue("1");
		ws.getRange2("AB1101").setValue("1");
		ws.getRange2("AC1101").setValue("1");
		ws.getRange2("AD1101").setValue("1");
		ws.getRange2("AE1101").setValue("#N/A");
		ws.getRange2("AF1101").setValue("1");
		ws.getRange2("AG1101").setValue("1");
		ws.getRange2("AH1101").setValue("1");
		ws.getRange2("AI1101").setValue("1");
		ws.getRange2("AJ1101").setValue("1");

		ws.getRange2("AA1102").setValue("1");
		ws.getRange2("AB1102").setValue("2");
		ws.getRange2("AC1102").setValue("3");
		ws.getRange2("AD1102").setValue("4");
		ws.getRange2("AE1102").setValue("5");
		ws.getRange2("AF1102").setValue("6");
		ws.getRange2("AG1102").setValue("7");
		ws.getRange2("AH1102").setValue("8");
		ws.getRange2("AI1102").setValue("9");
		ws.getRange2("AJ1102").setValue("10");

		ws.getRange2("AA1111").setValue("1");
		ws.getRange2("AB1111").setValue("1");
		ws.getRange2("AC1111").setValue("1");
		ws.getRange2("AD1111").setValue("1");
		ws.getRange2("AE1111").setValue("");
		ws.getRange2("AF1111").setValue("a");
		ws.getRange2("AG1111").setValue("2");
		ws.getRange2("AH1111").setValue("1");
		ws.getRange2("AI1111").setValue("1");
		ws.getRange2("AJ1111").setValue("1");

		ws.getRange2("AA1112").setValue("1");
		ws.getRange2("AB1112").setValue("2");
		ws.getRange2("AC1112").setValue("3");
		ws.getRange2("AD1112").setValue("4");
		ws.getRange2("AE1112").setValue("5");
		ws.getRange2("AF1112").setValue("6");
		ws.getRange2("AG1112").setValue("7");
		ws.getRange2("AH1112").setValue("8");
		ws.getRange2("AI1112").setValue("9");
		ws.getRange2("AJ1112").setValue("10");

		ws.getRange2("AA1121").setValue("2");
		ws.getRange2("AB1121").setValue("a");
		ws.getRange2("AC1121").setValue("#N/A");
		ws.getRange2("AD1121").setValue("7");
		ws.getRange2("AE1121").setValue("");
		ws.getRange2("AF1121").setValue("0");
		ws.getRange2("AG1121").setValue("0");
		ws.getRange2("AH1121").setValue("1");
		ws.getRange2("AI1121").setValue("1");
		ws.getRange2("AJ1121").setValue("1");

		ws.getRange2("AA1122").setValue("1");
		ws.getRange2("AB1122").setValue("2");
		ws.getRange2("AC1122").setValue("3");
		ws.getRange2("AD1122").setValue("4");
		ws.getRange2("AE1122").setValue("5");
		ws.getRange2("AF1122").setValue("6");
		ws.getRange2("AG1122").setValue("7");
		ws.getRange2("AH1122").setValue("8");
		ws.getRange2("AI1122").setValue("9");
		ws.getRange2("AJ1122").setValue("10");

		ws.getRange2("AA1131").setValue("1");
		ws.getRange2("AB1131").setValue("0");
		ws.getRange2("AC1131").setValue("0");
		ws.getRange2("AD1131").setValue("0");
		ws.getRange2("AE1131").setValue("");
		ws.getRange2("AF1131").setValue(" ");
		ws.getRange2("AG1131").setValue("a");
		ws.getRange2("AH1131").setValue("b");
		ws.getRange2("AI1131").setValue("c");
		ws.getRange2("AJ1131").setValue("d");

		ws.getRange2("AA1132").setValue("1");
		ws.getRange2("AB1132").setValue("2");
		ws.getRange2("AC1132").setValue("3");
		ws.getRange2("AD1132").setValue("4");
		ws.getRange2("AE1132").setValue("5");
		ws.getRange2("AF1132").setValue("6");
		ws.getRange2("AG1132").setValue("7");
		ws.getRange2("AH1132").setValue("8");
		ws.getRange2("AI1132").setValue("9");
		ws.getRange2("AJ1132").setValue("10");

		AscCommonExcel.g_oHLOOKUPCache.clean();

		const defName3D = new Asc.asc_CDefName('HLOOKUPTestName3D', ws.getName() + '!$S$1101');
		const defName3D2 = new Asc.asc_CDefName('HLOOKUPTestName3D2', ws.getName() + '!$D$1102');
		const defNameArea3D = new Asc.asc_CDefName('HLOOKUPTestNameArea3D', ws.getName() + '!$C$1101:$Y$1102');

		wb.editDefinesNames(null, defName3D);
		wb.editDefinesNames(null, defNameArea3D);
		wb.editDefinesNames(null, defName3D2);

		// Positive сases:
		// Case #1: Number, Array, Number
		oParser = new parserFormula("HLOOKUP(1,{1,2;2,3;3,4},2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		// Case #2: Number, Array, Number, Number (Number -> Boolean, TRUE)
		oParser = new parserFormula("HLOOKUP(1,{1,2;2,3;3,4},3,1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 3);

		// Case #3: Array, Array, Number
		oParser = new parserFormula( "HLOOKUP({2,3,4},{1,2,3;2,3,4},2)", "A2", ws );
		assert.ok(oParser.parse(), "Parse HLOOKUP({2,3,4},{1,2,3;2,3,4},2)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 3, "Result of HLOOKUP({2,3,4},{1,2,3;2,3,4},2)[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 4, "Result of HLOOKUP({2,3,4},{1,2,3;2,3,4},2)[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 4, "Result of HLOOKUP({2,3,4},{1,2,3;2,3,4},2)[0,2]");

		// Case #4: Array, Array, Number, Boolean
		oParser = new parserFormula("HLOOKUP({2,3,4},{1,2;2,3;3,4},2,FALSE)", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP({2,3,4},{1,2;2,3;3,4},2,FALSE)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 3, "Result of HLOOKUP({2,3,4},{1,2;2,3;3,4},2,FALSE)[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), "#N/A", "Result of HLOOKUP({2,3,4},{1,2;2,3;3,4},2,FALSE)[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), "#N/A", "Result of HLOOKUP({2,3,4},{1,2;2,3;3,4},2,FALSE)[0,2]");

		// Case #5: Array, Array, Array
		oParser = new parserFormula("HLOOKUP({2,3,4},{1,2,3;2,3,4},{1,5,6})", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP({2,3,4},{1,2,3;2,3,4},{1,5,6})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 2, "Result of HLOOKUP({2,3,4},{1,2,3;2,3,4},{1,5,6})[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 3, "Result of HLOOKUP({2,3,4},{1,2,3;2,3,4},{1,5,6})[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 3, "Result of HLOOKUP({2,3,4},{1,2,3;2,3,4},{1,5,6})[0,2]");

		// Case #6: Array, Array, Array
		oParser = new parserFormula("HLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})", "A2", ws );
		assert.ok( oParser.parse(), "Parse HLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 2, "Result of HLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 3, "Result of HLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 3, "Result of HLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})[0,2]");

		// Case #7: Array, Array, Array
		oParser = new parserFormula("HLOOKUP({5,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})", "A2", ws );
		assert.ok(oParser.parse(), "Parse HLOOKUP({5,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 3, "Result of HLOOKUP({5,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 3, "Result of HLOOKUP({5,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 3, "Result of HLOOKUP({5,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})[0,2]");

		// Case #8: Array, Array, Number
		oParser = new parserFormula("HLOOKUP({2,3,4},{1,2,6;2,3,7;3,4,8},1)", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP({2,3,4},{1,2,6;2,3,7;3,4,8},1)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 2, "Result of HLOOKUP({2,3,4},{1,2,6;2,3,7;3,4,8},1)[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 2, "Result of HLOOKUP({2,3,4},{1,2,6;2,3,7;3,4,8},1)[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 2, "Result of HLOOKUP({2,3,4},{1,2,6;2,3,7;3,4,8},1)[0,2]");

		// Case #9: Number, Array, Number
		oParser = new parserFormula("HLOOKUP(4,{1,2,3;2,3,4;6,7,8},2)", "A2", ws );
		assert.ok(oParser.parse());
		assert.strictEqual( oParser.calculate().getValue(), 4 );

		// Case #10: Number, Array, Number
		oParser = new parserFormula("HLOOKUP(4,{1,2,6;2,3,7;3,4,8},3)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 4);

		// Case #11: Empty, Array, Number. Array contains zero (Empty -> Zero)
		oParser = new parserFormula('HLOOKUP(,{0,1,2},1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 0);

		// Case #12: Empty, Array, Number. Array contains <= zero (Empty -> Zero)
		oParser = new parserFormula('HLOOKUP(,{-1,2,3},1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), -1);

		// Case #13: Number, Array, Number. Array contains several suitable values
		oParser = new parserFormula('HLOOKUP(1,{0,1,"c",1,1,"b",2;1,2,3,4,5,6,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 5);

		// Case #14: String, Array, Number. Array contains several suitable values, Sorted only second half
		oParser = new parserFormula('HLOOKUP("a",{"c","a","5","a","a","c","a";1,2,3,4,5,6,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 5);

		// Case #15: Empty, Array, Number. Array contains only empty strings
		oParser = new parserFormula('HLOOKUP(,{"","","","","","","";1,2,3,4,5,6,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #16: Empty, Array, Number. Array contains only empty strings and zero in second half
		oParser = new parserFormula('HLOOKUP(,{"","","","",0,"","";1,2,3,4,5,6,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 5);

		// Case #17: Empty, Array, Number. Array contains only empty strings and zero in fist half
		oParser = new parserFormula('HLOOKUP(,{"",0,"","","","","";1,2,3,4,5,6,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		// Case #18: Number, Array, Number. Array not contains exact match, but contains value < seachValue
		oParser = new parserFormula('HLOOKUP(25,{26,66,13,24,70,"","";1,2,3,4,5,6,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 4);

		// Case #19: Number, Array, Number, Number (Number -> Boolean, FALSE)
		oParser = new parserFormula("HLOOKUP(1,{1,2;2,3;3,4},3,0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 3);

		// Case #20: Number, Array, Number, Boolean. Array not sorted
		oParser = new parserFormula("HLOOKUP(1,{5,8,3,-20,1;1,2,3,4,5},2,FALSE)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 5);

		// Case #21: String, Array, Number, Boolean. Array not sorted
		oParser = new parserFormula('HLOOKUP("a",{"b","a","-c","k",1;1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		// Case #22: Empty, Array, Number, Boolean. Array not sorted
		oParser = new parserFormula('HLOOKUP(,{0,0,1,"k",1;1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 1);

		// Case #23: Number, Array, Number, Boolean. Array not sorted and contains similar values
		oParser = new parserFormula("HLOOKUP(1,{-1,2,5,1,1;1,2,3,4,5},2,FALSE)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 4);

		// Case #24: String, Array, Number, Boolean. Array not sorted and contains similar values
		oParser = new parserFormula('HLOOKUP("a",{"b","a","a","a","c";1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		// Case #25: Boolean, Array, Number, Boolean. Array not sorted and contains similar values
		oParser = new parserFormula('HLOOKUP(FALSE,{TRUE,FALSE,FALSE,"a",FALSE;1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		// Case #26: Empty, Array, Number, Boolean. Array not sorted and contains errors, similar zero values
		oParser = new parserFormula('HLOOKUP(,{#N/A,2,0,0,#N/A;1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 3);

		// Case #27: Empty, Array, Number, Boolean. Array not sorted and contains errors, similar zero values, Booleans
		oParser = new parserFormula('HLOOKUP(,{FALSE,TRUE,0," ",#N/A;1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 3);

		// Case #28: String, Array, Number, Boolean. Trying to find empty string
		oParser = new parserFormula('HLOOKUP("",{"","",0," ",#N/A;1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 1);

		// Case #29: String, Array, Number, Boolean. Trying to find string with space
		oParser = new parserFormula('HLOOKUP(" ",{""," ",0," ",#N/A;1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		// Case #30: Number, Area, Number
		oParser = new parserFormula("HLOOKUP(1,A501:J503,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2.17);

		// Case #31: Number, Area, Number, TRUE
		oParser = new parserFormula("HLOOKUP(1,A501:J503,3,TRUE)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 100.00);

		// Case #32: Number, Area, Number, TRUE
		oParser = new parserFormula("HLOOKUP(2,A501:J503,2,TRUE)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 1.71);

		// Case #33: Number, Area, Array
		oParser = new parserFormula("HLOOKUP(5,A8100:C8101,{1,1,1})", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP(5,A8100:C8101,{1,1,1})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 4, "Result of HLOOKUP(5,A8100:C8101,{1,1,1})[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 4, "Result of HLOOKUP(5,A8100:C8101,{1,1,1})[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 4, "Result of HLOOKUP(5,A8100:C8101,{1,1,1})[0,2]");

		// Case #34: Array, Area, Area
		oParser = new parserFormula("HLOOKUP({2,4,40},A8100:C8101,E8100)", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP({2,4,40},A8100:C8101,E8100)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 2, "Result of HLOOKUP({2,4,40},A8100:C8101,E8100)[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 4, "Result of HLOOKUP({2,4,40},A8100:C8101,E8100)[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 40, "Result of HLOOKUP({2,4,40},A8100:C8101,E8100)[0,2]");

		// Case #35: Array, Area, Array
		oParser = new parserFormula("HLOOKUP({2,4,40},{1,2,3;4,5,6},{1;2;3})", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP({2,4,40},{1,2,3;4,5,6},{1;2;3})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 2, "Result of HLOOKUP({2,4,40},{1,2,3;4,5,6},{1;2;3})[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 3, "Result of HLOOKUP({2,4,40},{1,2,3;4,5,6},{1;2;3})[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 3, "Result of HLOOKUP({2,4,40},{1,2,3;4,5,6},{1;2;3})[0,2]");

		// Case #36: Number, Area, Number
		oParser = new parserFormula("HLOOKUP(2,A501:J503,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 1.71);

		// Case #37: Empty, Area, Number. Area contains zeros
		oParser = new parserFormula('HLOOKUP(,C1101:Y1102,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(,C1101:Y1102,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Result of HLOOKUP(,C1101:Y1102,2,TRUE)');

		// Case #38: Number, Area, Number
		oParser = new parserFormula('HLOOKUP(2.4,C1101:Y1102,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(2.4,C1101:Y1102,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of HLOOKUP(2.4,C1101:Y1102,2,TRUE)');

		// Case #39: String, Area, Number. Area not contains exact match, but contains < seachValue
		oParser = new parserFormula('HLOOKUP("VIOLET",C1101:Y1102,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP("VIOLET",C1101:Y1102,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), 21, 'Result of HLOOKUP("VIOLET",C1101:Y1102,2,TRUE)');

		// Case #40: Number, Area, Number. Area not contains exact match, but contains value < seachValue
		oParser = new parserFormula('HLOOKUP(2.3,C1101:Y1102,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(2.3,C1101:Y1102,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Result of HLOOKUP(2.3,C1101:Y1102,2,TRUE)');

		// Case #41: String, Area, Number. Area contains exact match
		oParser = new parserFormula('HLOOKUP("CIANO",C1101:Y1102,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP("CIANO",C1101:Y1102,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), 18, 'Result of HLOOKUP("CIANO",C1101:Y1102,2,TRUE)');

		// Case #42: Boolean, Area, Number. Area contains exact match
		oParser = new parserFormula('HLOOKUP(FALSE,C1101:Y1102,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(FALSE,C1101:Y1102,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), 22, 'Result of HLOOKUP(FALSE,C1101:Y1102,2,TRUE)');

		// Case #43: Number, Area, Number. For bug 63026. cEmpty tests.
		oParser = new parserFormula('HLOOKUP(576,K100:X101,2)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(576,K100:X101,2)');
		assert.strictEqual(oParser.calculate().getValue(), 0.3477, 'Result of HLOOKUP(576,K100:X101,2)');

		// Case #44: Number, Area, Number. For bug 63026. cEmpty tests.
		oParser = new parserFormula('HLOOKUP(576,K103:Y104,2)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(576,K103:Y104,2)');
		assert.strictEqual(oParser.calculate().getValue(), 0.21, 'Result of HLOOKUP(576,K103:Y104,2)');

		// Case #45.1: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(G303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(G303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Aa", 'Result of HLOOKUP(G303,G303:V303,1)');

		// Case #45.2: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(H303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(H303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ae", 'Result of HLOOKUP(H303,G303:V303,1)');

		// Case #45.3: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(I303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(I303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ba", 'Result of HLOOKUP(I303,G303:V303,1)');

		// Case #45.4: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(J303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(J303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Be", 'Result of HLOOKUP(J303,G303:V303,1)');

		// Case #45.5: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(K303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(K303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "CA", 'Result of HLOOKUP(K303,G303:V303,1)');

		// Case #45.6: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(L303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(L303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "CE", 'Result of HLOOKUP(L303,G303:V303,1)');

		// Case #45.7: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(M303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(M303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "DA", 'Result of HLOOKUP(M303,G303:V303,1)');

		// Case #45.8: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(N303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(N303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "DE", 'Result of HLOOKUP(N303,G303:V303,1)');

		// Case #45.9: String, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP("Ha",G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP("Ha",G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ha", 'Result of HLOOKUP("Ha",G303:V303,1)');

		// Case #45.10: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(O303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(O303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ha", 'Result of HLOOKUP(O303,G303:V303,1)');

		// Case #45.11: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(P303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(P303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "HE", 'Result of HLOOKUP(P303,G303:V303,1)');

		// Case #45.12: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(Q303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(Q303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ia", 'Result of HLOOKUP(Q303,G303:V303,1)');

		// Case #45.13: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(R303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(R303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ie", 'Result of HLOOKUP(R303,G303:V303,1)');

		// Case #45.14: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(S303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(S303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ja", 'Result of HLOOKUP(S303,G303:V303,1)');

		// Case #45.15: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(T303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(T303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Je", 'Result of HLOOKUP(T303,G303:V303,1)');

		// Case #45.16: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(U303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(U303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ka", 'Result of HLOOKUP(U303,G303:V303,1)');

		// Case #45.17: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('HLOOKUP(V303,G303:V303,1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(V303,G303:V303,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ke", 'Result of HLOOKUP(V303,G303:V303,1)');

		// Case #46: Number, Area, Number. For bug 67099.
		oParser = new parserFormula('HLOOKUP(3,AA201:AH202,2)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(3,AA201:AH202,2)');
		assert.strictEqual(oParser.calculate().getValue(), "Looked result(3)", 'Result of HLOOKUP(3,AA201:AH202,2)');

		// Case #47: Ref, Area, Number. For bug 67099.
		oParser = new parserFormula('HLOOKUP(AC201,AA201:AH202,2)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(AC201,AA201:AH202,2)');
		assert.strictEqual(oParser.calculate().getValue(), "Looked result(3)", 'Result of HLOOKUP(AC201,AA201:AH202,2)');

		// Case #48: Number, Area, Number. Area contains same values in second half.
		oParser = new parserFormula('HLOOKUP(1,AA1101:AJ1102,2)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(1,AA1101:AJ1102,2)');
		assert.strictEqual(oParser.calculate().getValue(), 10, 'Result of HLOOKUP(1,AA1101:AJ1102,2)');

		// Case #49: Number, Area, Number. Area contains same values in first half.
		oParser = new parserFormula('HLOOKUP(1,AA1111:AJ1112,2)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(1,AA1111:AJ1112,2)');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Result of HLOOKUP(1,AA1111:AJ1112,2)');

		// Case #50: Number, Area, Number. Area contains same values in second half and has error
		oParser = new parserFormula('HLOOKUP(1,AA1121:AJ1122,2)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(1,AA1121:AJ1122,2)');
		assert.strictEqual(oParser.calculate().getValue(), 10, 'Result of HLOOKUP(1,AA1121:AJ1122,2)');

		// Case #51: Number, Area, Number. Area contains <= value in first half and exact match as first element
		oParser = new parserFormula('HLOOKUP(1,AA1131:AJ1132,2)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(1,AA1131:AJ1132,2)');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Result of HLOOKUP(1,AA1131:AJ1132,2)');

		// Case #52: Area, Area, Ref
		oParser = new parserFormula("HLOOKUP(A8100:C8100,A8100:C8101,F8100)", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP(A8100:C8100,A8100:C8101,F8100)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), 1, "Result of HLOOKUP(A8100:C8100,A8100:C8101,F8100)[0,0]");

		// Case #53: Number, Area, Number
		oParser = new parserFormula('HLOOKUP(2.24,A1401:M1402,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(2.24,A1401:M1402,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Result of HLOOKUP("2.24",A1401:M1402,2,FALSE)');

		// Case #54: Number, Area, Number
		oParser = new parserFormula('HLOOKUP("AnyStringValue2",A1401:M1402,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP("AnyStringValue2",A1401:M1402,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of HLOOKUP("AnyStringValue2",A1401:M1402,2,FALSE)');

		// Case #55: Number, Area, Number
		oParser = new parserFormula('HLOOKUP("Sandra",A1401:M1402,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP("Sandra",A1401:M1402,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 9, 'Result of HLOOKUP("Sandra",A1401:M1402,2,FALSE)');

		// Case #56: Number, Area, Number
		oParser = new parserFormula('HLOOKUP(,A1401:M1402,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(,A1401:M1402,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 12, 'Result of HLOOKUP(,A1401:M1402,2,FALSE)');

		// Case #57: String, Area, Number. For bug 65016
		oParser = new parserFormula('HLOOKUP("SANDRA",E301:Q302,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP("SANDRA",E301:Q302,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 9, 'Result of HLOOKUP("SANDRA",E301:Q302,2,FALSE)');

		// Case #58: Boolean, Area, Number. For bug 65016
		oParser = new parserFormula('HLOOKUP(TRUE,E301:Q302,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(TRUE,E301:Q302,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Result of HLOOKUP(TRUE,E301:Q302,2,FALSE)');

		// Case #59: Number, Area, Number. For bug 65016
		oParser = new parserFormula('HLOOKUP(5,E301:Q302,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(5,E301:Q302,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 13, 'Result of HLOOKUP(5,E301:Q302,2,FALSE)');

		// Case #60: Name3D, Name3D, Name3D, Boolean
		oParser = new parserFormula('HLOOKUP(HLOOKUPTestName3D,HLOOKUPTestNameArea3D,HLOOKUPTestName3D2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(HLOOKUPTestName3D,HLOOKUPTestNameArea3D,HLOOKUPTestName3D2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 17, 'Result of HLOOKUP(HLOOKUPTestName3D,HLOOKUPTestNameArea3D,HLOOKUPTestName3D2,FALSE)');

		// Case #61: Ref3D, Area3D, Area3D, Boolean
		oParser = new parserFormula('HLOOKUP('+ ws.getName() + '!$S$1101,'+ ws.getName() + '!$C$1101:$Y$1102,' + ws.getName() + '!$D$1102,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP('+ ws.getName() + '!$S$1101,'+ ws.getName() + '!$C$1101:$Y$1102,' + ws.getName() + '!$D$1102,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 17, 'Result of HLOOKUP('+ ws.getName() + '!$S$1101,'+ ws.getName() + '!$C$1101:$Y$1102,' + ws.getName() + '!$D$1102,FALSE)');

		// Case #62: Formula, Name3D, Formula, Formula
		oParser = new parserFormula('HLOOKUP(ABS(2),HLOOKUPTestNameArea3D,ABS(2),1=1)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(ABS(2),HLOOKUPTestNameArea3D,ABS(2),1=1)');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Result of HLOOKUP(ABS(2),HLOOKUPTestNameArea3D,ABS(2),1=1)');

		// Case #63: String, Array, Number, Boolean. For bug 76652.
		oParser = new parserFormula('HLOOKUP("Aîné",{"Aine","Ainé","Aîné","Aîné";111,222,333,333},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 333);

		// Negative Cases:
		// Case #1: Array, Array, Array with wrong data
		oParser = new parserFormula("HLOOKUP({2,3,4},{1,2;2,3;3,4},{4,5,6})", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP({2,3,4},{1,2;2,3;3,4},{4,5,6})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), "#REF!", "Result of HLOOKUP({2,3,4},{1,2;2,3;3,4},{4,5,6})[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), "#REF!", "Result of HLOOKUP({2,3,4},{1,2;2,3;3,4},{4,5,6})[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), "#REF!", "Result of HLOOKUP({2,3,4},{1,2;2,3;3,4},{4,5,6})[0,2]");

		// Case #2: Number, Array, Number. Out of range arg3
		oParser = new parserFormula("HLOOKUP(4,{1,2,6;2,3,7;3,4,8},5)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		// Case #3: String, Array, Number. Array not contains search type
		oParser = new parserFormula('HLOOKUP("a",{1,2,6;2,3,7;3,4,8},3)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #4: Boolean, Array, Number. Array not contains search type
		oParser = new parserFormula('HLOOKUP(FALSE,{1,2,6;2,3,7;3,4,8},3)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #5: Error, Array, Number. Search value is Error
		oParser = new parserFormula('HLOOKUP(#N/A,{1,2,6;2,3,7;3,4,8},3)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #6: Empty, Array, Number. Array not contains value <= 0 (Empty -> Zero)
		oParser = new parserFormula('HLOOKUP(,{1,2,3},1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #7: Error, Array, Number. Array contains error. Returning Error
		oParser = new parserFormula('HLOOKUP(#VALUE!,{0,#N/A,2},1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		// Case #8: Empty, Array, Number. Array contains Errors, not zero
		oParser = new parserFormula('HLOOKUP(,{#N/A,#N/A,#N/A,#N/A,#N/A,#N/A,#N/A;1,2,3,4,5,6,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #9: Boolean, Array, Number. Array contains Errors
		oParser = new parserFormula('HLOOKUP(FALSE,{#N/A,#N/A,#N/A,#N/A,#N/A,#N/A,#N/A;1,2,3,4,5,6,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #10: Boolean, Array, Number. Array contains Empty strings
		oParser = new parserFormula('HLOOKUP(FALSE,{"","","","","","","";1,2,3,4,5,6,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #11: Boolean, Array, Number. Array contains zeros and empty, errors
		oParser = new parserFormula('HLOOKUP(FALSE,{"",0,"",0,0,0,#N/A;1,2,3,4,5,6,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #12: Boolean, Array, Number. Array contains any other data
		oParser = new parserFormula('HLOOKUP(TRUE,{"asdac",2,"a",5,6,7,"8";1,2,3,4,5,6,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #13: Number, Array, Number. Array contains only string
		oParser = new parserFormula('HLOOKUP("item",{123;1},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #14: String, Array, Number, Number, Boolean. Array not contains string
		oParser = new parserFormula('HLOOKUP("a",{5,8,3,-20,1;1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #15: Error, Array, Number, Number, Boolean. Returning error = search value
		oParser = new parserFormula('HLOOKUP(#N/A,{5,8,3,-20,1;1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #16: Error, Array, Number, Number, Boolean. Returning error = search value
		oParser = new parserFormula('HLOOKUP(#VALUE!,{5,8,3,-20,1;1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		// Case #17: String, Array, Number, Number, Boolean. Array not contains string
		oParser = new parserFormula('HLOOKUP("5",{5,8,3,-20,1;1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #18: String, Array, Number, Boolean. Trying to find empty string
		oParser = new parserFormula('HLOOKUP("",{" "," ",0," ",#N/A;1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #19: Empty, Array, Number, Boolean. Array contains Booleans
		oParser = new parserFormula('HLOOKUP(,{FALSE,FALSE,FALSE,FALSE,FALSE;1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #20: Empty, Array, Number, Boolean. Array contains Booleans and empty strings
		oParser = new parserFormula('HLOOKUP(,{"",FALSE,"",FALSE,"";1,2,3,4,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #21: Error, Array, Number
		oParser = new parserFormula('HLOOKUP(#N/A,{"",0,#N/A,#N/A,"","","";1,2,3,4,5,6,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #22: Number, Area, Area
		oParser = new parserFormula("HLOOKUP(5,A8100:C8101,E8100:G8100)", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP(5,A8100:C8101,E8100:G8100)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of HLOOKUP(5,A8100:C8101,E8100:G8100)");

		// Case #23: Number, Area, Array
		oParser = new parserFormula("HLOOKUP(5,A8100:C8101,{1;2;3})", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP(5,A8100:C8101,{1;2;3})");
		assert.strictEqual(oParser.calculate().getValue(), "#REF!", "Result of HLOOKUP(5,A8100:C8101,{1;2;3})");

		// Case #24: Number, Area, Area
		oParser = new parserFormula("HLOOKUP(5,A8100:C8101,E8101:G8101)", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP(5,A8100:C8101,E8101:G8101)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of HLOOKUP(5,A8100:C8101,E8101:G8101)[0,0]");

		// Case #25: Area, Area, Area
		oParser = new parserFormula("HLOOKUP(A8100:C8100,A8100:C8101,E8100:G8100)", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP(A8100:C8100,A8100:C8101,E8100:G8100)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of HLOOKUP(A8100:C8100,A8100:C8101,E8100:G8100)");

		// Case #26: Area, Area, Area
		oParser = new parserFormula("HLOOKUP(A8100:C8100,A8100:C8101,E8100:G8101)", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP(A8100:C8100,A8100:C8101,E8100:G8101)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of HLOOKUP(A8100:C8100,A8100:C8101,E8100:G8101)[0,0]");

		// Case #27: Area, Area, Area
		oParser = new parserFormula("HLOOKUP(A8100:B8100,A8100:C8101,F8100:G8101)", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP(A8100:B8100,A8100:C8101,F8100:G8101)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of HLOOKUP(A8100:B8100,A8100:C8101,F8100:G8101)[0,0]");

		// Case #28: Area, Area, Area
		oParser = new parserFormula("HLOOKUP(A8100:C8100,A8100:C8101,G8100:G8101)", "A2", ws);
		assert.ok(oParser.parse(), "Parse HLOOKUP(A8100:C8100,A8100:C8101,G8100:G8101)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of HLOOKUP(A8100:C8100,A8100:C8101,G8100:G8101)[0,0]");

		// Case #29: Empty, Area, Number. Area not contains value <= 0
		oParser = new parserFormula('HLOOKUP(,A501:J503,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #30: Ref, Area, Number. Area not contains empty string ""
		oParser = new parserFormula('HLOOKUP(A504,A501:J503,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #31: Error, Area, Number. Return SearchVal Error.
		oParser = new parserFormula('HLOOKUP(#N/A,C1101:Y1102,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(#N/A,C1101:Y1102,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of HLOOKUP(#N/A,C1101:Y1102,2,TRUE)');

		// Case #32: Error, Area, Number. Return SearchVal Error.
		oParser = new parserFormula('HLOOKUP(#VALUE!,C1101:Y1102,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(#VALUE!,C1101:Y1102,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of HLOOKUP(#VALUE!,C1101:Y1102,2,TRUE)');

		// Case #33: Number, Area, Number. Area not contains value <= searchValue
		oParser = new parserFormula('HLOOKUP(-1,C1101:Y1102,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(-1,C1101:Y1102,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of HLOOKUP(-1,C1101:Y1102,2,TRUE)');

		// Case #34: String, Area, Number. Area not contains strings
		oParser = new parserFormula('HLOOKUP("2",A501:J503,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #35: Number, Area, Number
		oParser = new parserFormula('HLOOKUP(#DIV/0!,A1401:M1402,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(#DIV/0!,A1401:M1402,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), "#DIV/0!", 'Result of HLOOKUP(#DIV/0!,A1401:M1402,2,FALSE)');

		// Case #36: Number, Area, Number
		oParser = new parserFormula('HLOOKUP("",A1401:M1402,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP("",A1401:M1402,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of HLOOKUP("",A1401:M1402,2,FALSE)');

		// Case #37: Ref, Area, Number. For bug 65016. Searchval = Error, should return Error
		oParser = new parserFormula('HLOOKUP(K301,E301:Q302,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'HLOOKUP(K301,E301:Q302,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), "#DIV/0!", 'Result of HLOOKUP(K301,E301:Q302,2,FALSE)');

		// Case #38: String, Area, Number. Area not contains strings
		oParser = new parserFormula('HLOOKUP("2",A501:J503,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		wb.delDefinesNames(defName3D);
		wb.delDefinesNames(defNameArea3D);
		wb.delDefinesNames(defName3D2);

	});

	QUnit.test("Test: \"HYPERLINK\"", function (assert) {

		ws.getRange2("D101").setValue("");
		ws.getRange2("D102").setValue("123");

		oParser = new parserFormula('HYPERLINK("http://example.microsoft.com/report/budget report.xlsx", "Click for report")', "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "Click for report");
		assert.strictEqual(oParser.value.hyperlink, "http://example.microsoft.com/report/budget report.xlsx");

		oParser = new parserFormula('HYPERLINK("[http://example.microsoft.com/report/budget report.xlsx]Annual!F10", D1)', "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue() - 0, 0);
		assert.strictEqual(oParser.value.hyperlink, "[http://example.microsoft.com/report/budget report.xlsx]Annual!F10");

		oParser = new parserFormula('HYPERLINK("http://example.microsoft.com/Annual Report.docx]QrtlyProfits", "Quarterly Profit Report")', "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "Quarterly Profit Report");
		assert.strictEqual(oParser.value.hyperlink, 'http://example.microsoft.com/Annual Report.docx]QrtlyProfits');

		oParser = new parserFormula('HYPERLINK("\\FINANCE\\Statements\\1stqtr.xlsx",D101)', "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue() - 0, 0);
		assert.strictEqual(oParser.value.hyperlink, '\\FINANCE\\Statements\\1stqtr.xlsx');

		oParser = new parserFormula('HYPERLINK("http://test.com")', "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "http://test.com");
		assert.strictEqual(oParser.value.hyperlink, "http://test.com");

		oParser = new parserFormula('HYPERLINK(D101,111)', "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 111);
		assert.strictEqual(oParser.value.hyperlink - 0, 0);

		oParser = new parserFormula('HYPERLINK(D102,111)', "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 111);
		assert.strictEqual(oParser.value.hyperlink, "123");

		oParser = new parserFormula('HYPERLINK(D102)', "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "123");
		assert.strictEqual(oParser.value.hyperlink - 0, 123);

		oParser = new parserFormula('HYPERLINK(D101,TRUE)', "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "TRUE");
		assert.strictEqual(oParser.value.hyperlink - 0, 0);

		ws.getRange2("A1:C214").cleanAll();
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("https://www.onlyoffice.com/");
		ws.getRange2("A101").setValue("2");
		ws.getRange2("A104").setValue("2");
		// For area
		ws.getRange2("A102").setValue("3");
		ws.getRange2("A103").setValue("Text");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 5);
		ws.getRange2("A601").setValue("-1000"); // Num (Column1)
		ws.getRange2("B601").setValue("https://www.onlyoffice.com/"); // Text (Column2)
		ws.getRange2("C601").setValue("Text"); // Text (Column3)

		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2


		// Positive cases:
		// Case #1: String(2). Valid URL with friendly name. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://example.com","Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://example.com","Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Positive case: String(2). Valid URL with friendly name. 2 of 2 arguments used.');
		// Case #2: String. Valid URL, friendly_name omitted (displays link_location). 1 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://example.com")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://example.com") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'http://example.com', 'Test: Positive case: String. Valid URL, friendly_name omitted (displays link_location). 1 of 2 arguments used.');
		// Case #3: Formula, String. link_location as formula, valid URL. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(CONCATENATE("http://","example.com"),"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(CONCATENATE("http://","example.com"),"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Positive case: Formula, String. link_location as formula, valid URL. 2 of 2 arguments used.');
		// Case #4: String, Number. Valid URL, numeric friendly_name. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://example.com",123)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://example.com",123) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 123, 'Test: Positive case: String, Number. Valid URL, numeric friendly_name. 2 of 2 arguments used.');
		// Case #5: Reference link(2). Reference links to valid URL and friendly name. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(A100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'https://www.onlyoffice.com/', 'Test: Positive case: Reference link(2). Reference links to valid URL and friendly name. 2 of 2 arguments used.');
		// Case #6: Area(2). Single-cell ranges for URL and friendly name. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(A100:A100,A101:A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(A100:A100,A101:A101) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Area(2). Single-cell ranges for URL and friendly name. 2 of 2 arguments used.');
		// Case #7: Array(2). Single-element array for link_location. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK({"http://example.com"},"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK({"http://example.com"},"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Positive case: Array(2). Single-element array for link_location. 2 of 2 arguments used.');
		// Case #8: Name(2). Named ranges for URL and friendly name. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(TestName,TestName1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(TestName,TestName1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 0.5, 'Test: Positive case: Name(2). Named ranges for URL and friendly name. 2 of 2 arguments used.');
		// Case #9: Name3D(2). 3D named ranges for URL and friendly name. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(TestName3D,TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(TestName3D,TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), -0.5, 'Test: Positive case: Name3D(2). 3D named ranges for URL and friendly name. 2 of 2 arguments used.');
		// Case #10: Ref3D(2). 3D references to URL and friendly name. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(Sheet2!A1,Sheet2!A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(Sheet2!A1,Sheet2!A2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Ref3D(2). 3D references to URL and friendly name. 2 of 2 arguments used.');
		// Case #11: Area3D(2). 3D single-cell ranges for URL and friendly name. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(Sheet2!A1:A1,Sheet2!A2:A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(Sheet2!A1:A1,Sheet2!A2:A2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Area3D(2). 3D single-cell ranges for URL and friendly name. 2 of 2 arguments used.');
		// Case #12: Table(2). Table structured references for URL and friendly name. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(Table1[Column1],Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(Table1[Column1],Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'https://www.onlyoffice.com/', 'Test: Positive case: Table(2). Table structured references for URL and friendly name. 2 of 2 arguments used.');
		// Case #13: Formula(2). Both arguments as formulas. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(IF(TRUE,"http://example.com","http://test.com"),CONCATENATE("Click ","Here"))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(IF(TRUE,"http://example.com","http://test.com"),CONCATENATE("Click ","Here")) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Positive case: Formula(2). Both arguments as formulas. 2 of 2 arguments used.');
		// Case #14: Date, String. friendly_name as date serial (displays as date). 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://example.com",DATE(2025,1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://example.com",DATE(2025,1,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 45658, 'Test: Positive case: Date, String. friendly_name as date serial (displays as date). 2 of 2 arguments used.');
		// Case #15: Time, String. friendly_name as time value (displays as time). 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://example.com",TIME(12,0,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://example.com",TIME(12,0,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 0.5, 'Test: Positive case: Time, String. friendly_name as time value (displays as time). 2 of 2 arguments used.');
		// Case #16: String(2). Cell reference as link_location (desktop Excel). 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("A1","Cell A1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("A1","Cell A1") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Cell A1', 'Test: Positive case: String(2). Cell reference as link_location (desktop Excel). 2 of 2 arguments used.');
		// Case #17: String(2). 3D cell reference as link_location (desktop Excel). 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("Sheet2!A1","Sheet2 A1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("Sheet2!A1","Sheet2 A1") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Sheet2 A1', 'Test: Positive case: String(2). 3D cell reference as link_location (desktop Excel). 2 of 2 arguments used.');
		// Case #18: String(2). File path as link_location (desktop Excel). 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("C:\test.xlsx","Test File")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("C:\test.xlsx","Test File") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Test File', 'Test: Positive case: String(2). File path as link_location (desktop Excel). 2 of 2 arguments used.');
		// Case #19: Reference link, String. Reference link to URL, fixed friendly name. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(A100,"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(A100,"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Positive case: Reference link, String. Reference link to URL, fixed friendly name. 2 of 2 arguments used.');
		// Case #20: Name, String. Named range for URL, fixed friendly name. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(TestName,"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(TestName,"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Positive case: Name, String. Named range for URL, fixed friendly name. 2 of 2 arguments used.');
		// Case #21: String, Formula. friendly_name as IF formula. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://example.com",IF(TRUE,"Click","Go"))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://example.com",IF(TRUE,"Click","Go")) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click', 'Test: Positive case: String, Formula. friendly_name as IF formula. 2 of 2 arguments used.');

		// Negative cases:
		// Case #1: String(2). Invalid URL protocol returns error on click. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("invalid://url","Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("invalid://url","Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Negative case: String(2). Invalid URL protocol returns error on click. 2 of 2 arguments used.');
		// Case #2: Number, String. Non-text link_location returns #VALUE!. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(123,"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(123,"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Negative case: Number, String. Non-text link_location returns #VALUE!. 2 of 2 arguments used.');
		// Case #3: Boolean, String. Boolean link_location returns #VALUE!. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(FALSE,"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(FALSE,"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Negative case: Boolean, String. Boolean link_location returns #VALUE!. 2 of 2 arguments used.');
		// Case #4: String, Error. friendly_name as #N/A propagates #N/A. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://example.com",NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://example.com",NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: String, Error. friendly_name as #N/A propagates #N/A. 2 of 2 arguments used.');
		// Case #5: Error, String. link_location as #N/A propagates #N/A. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(NA(),"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(NA(),"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error, String. link_location as #N/A propagates #N/A. 2 of 2 arguments used.');
		// Case #6: Area(2). Multi-cell range for link_location returns #VALUE!. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(A100:A101,A101:A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(A100:A101,A101:A101) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Negative case: Area(2). Multi-cell range for link_location returns #VALUE!. 2 of 2 arguments used.');
		// Case #7: Reference link, String. Reference to invalid URL returns error on click. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(A104,"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(A104,"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Negative case: Reference link, String. Reference to invalid URL returns error on click. 2 of 2 arguments used.');
		// Case #8: String. Missing link_location returns #VALUE!. 0 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(".")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(".") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '.', 'Test: Negative case: String. Missing link_location returns #VALUE!. 0 of 2 arguments used.');
		// Case #9: String, Boolean. Boolean friendly_name returns #VALUE!. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://example.com",FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://example.com",FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'FALSE', 'Test: Negative case: String, Boolean. Boolean friendly_name returns #VALUE!. 2 of 2 arguments used.');
		// Case #10: Ref3D, String. 3D reference to invalid URL returns error on click. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(Sheet2!A3,"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(Sheet2!A3,"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Negative case: Ref3D, String. 3D reference to invalid URL returns error on click. 2 of 2 arguments used.');
		// Case #11: Name, String. Named range with invalid URL returns error on click. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(TestNameArea2,"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(TestNameArea2,"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Negative case: Name, String. Named range with invalid URL returns error on click. 2 of 2 arguments used.');
		// Case #12: Name3D, String. 3D named range with invalid URL returns error on click. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(TestNameArea3D2,"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(TestNameArea3D2,"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Negative case: Name3D, String. 3D named range with invalid URL returns error on click. 2 of 2 arguments used.');
		// Case #13: Table, String. Table with invalid URL returns error on click. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(Table1[Column3],"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(Table1[Column3],"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Negative case: Table, String. Table with invalid URL returns error on click. 2 of 2 arguments used.');
		// Case #14: Formula, String. link_location as #NUM! formula returns #NUM!. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK(SQRT(-1),"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK(SQRT(-1),"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula, String. link_location as #NUM! formula returns #NUM!. 2 of 2 arguments used.');
		// Case #15: String, Formula. friendly_name as #NUM! formula propagates #NUM!. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://example.com",SQRT(-1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://example.com",SQRT(-1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: String, Formula. friendly_name as #NUM! formula propagates #NUM!. 2 of 2 arguments used.');
		// Case #16: Array, String. Multi-element array for link_location returns #VALUE!. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK({"http://example.com","http://test.com"},"Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK({"http://example.com","http://test.com"},"Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Negative case: Array, String. Multi-element array for link_location returns #VALUE!. 2 of 2 arguments used.');
		// Case #17: String, Array. Multi-element array for friendly_name returns #VALUE!. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://example.com",{"Click","Here"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://example.com",{"Click","Here"}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click', 'Test: Negative case: String, Array. Multi-element array for friendly_name returns #VALUE!. 2 of 2 arguments used.');
		// Case #18: Empty, String. Empty link_location returns error on click. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("","Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("","Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Negative case: Empty, String. Empty link_location returns error on click. 2 of 2 arguments used.');
		// Case #19: String, Empty. Empty friendly_name displays link_location. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://example.com",)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://example.com",) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Negative case: String, Empty. Empty friendly_name displays link_location. 2 of 2 arguments used.');
		// Case #20: String(2). Inaccessible URL returns error on click. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://nonexistent.com","Click Here")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://nonexistent.com","Click Here") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Click Here', 'Test: Negative case: String(2). Inaccessible URL returns error on click. 2 of 2 arguments used.');

		// Bounded cases:
		// Case #1: String(2). Minimal valid URL. 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://a","Short Link")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://a","Short Link") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Short Link', 'Test: Bounded case: String(2). Minimal valid URL. 2 of 2 arguments used.');
		// Case #2: String(2). Long URL (approaching Excel cell limit). 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://example.com/very/long/path/"&REPT("x",1000),"Long Link")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://example.com/very/long/path/"&REPT("x",1000),"Long Link") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Long Link', 'Test: Bounded case: String(2). Long URL (approaching Excel cell limit). 2 of 2 arguments used.');
		// Case #3: String, Number. Minimal numeric friendly_name (0). 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("http://example.com",0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("http://example.com",0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Bounded case: String, Number. Minimal numeric friendly_name (0). 2 of 2 arguments used.');
		// Case #4: String(2). Cell reference to Excelâ??s last row (desktop Excel). 2 of 2 arguments used.
		oParser = new parserFormula('HYPERLINK("A1048576","Last Cell")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HYPERLINK("A1048576","Last Cell") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'Last Cell', 'Test: Bounded case: String(2). Cell reference to Excelâ??s last row (desktop Excel). 2 of 2 arguments used.');

		// Need to fix:
		// Case #6: Area(2). Multi-cell range for link_location returns #VALUE!. 2 of 2 arguments used. - area handle

	});

	QUnit.test("Test: \"INDEX\"", function (assert) {
		let array;

		ws.getRange2("A651").setValue("1");
		ws.getRange2("A652").setValue("2");
		ws.getRange2("A653").setValue("3");
		ws.getRange2("A654").setValue("4");
		ws.getRange2("A655").setValue("5");

		ws.getRange2("B651").setValue("6");
		ws.getRange2("B652").setValue("7");
		ws.getRange2("B653").setValue("8");
		ws.getRange2("B654").setValue("9");
		ws.getRange2("B655").setValue("10");

		ws.getRange2("C651").setValue("11");
		ws.getRange2("C652").setValue("12");
		ws.getRange2("C653").setValue("13");
		ws.getRange2("C654").setValue("14");
		ws.getRange2("C655").setValue("15");

		oParser = new parserFormula("INDEX({\"Apples\",\"Lemons\";\"Bananas\",\"Pears\"},2,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "Pears");

		oParser = new parserFormula("INDEX({\"Apples\",\"Lemons\";\"Bananas\",\"Pears\"},1,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "Lemons");

		oParser = new parserFormula("INDEX(\"Apples\",2,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		oParser = new parserFormula("INDEX({\"Apples\",\"Lemons\"},,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "Lemons");

		//данная функция возвращает area а далее уже в функции simplifyRefType находится резальтат
		// - пересечение а ячейкой, где располагается формула
		oParser = new parserFormula("INDEX(A651:C655,,2)", "A2", ws);
		assert.ok(oParser.parse());
		var parent = AscCommonExcel.g_oRangeCache.getAscRange(oParser.parent);
		assert.strictEqual(oParser.simplifyRefType(oParser.calculate(), ws, parent.r1, parent.c1).getValue(), "#VALUE!");

		oParser = new parserFormula("INDEX(A651:C655,,2)", "D651", ws);
		assert.ok(oParser.parse());
		parent = AscCommonExcel.g_oRangeCache.getAscRange(oParser.parent);
		assert.strictEqual(oParser.simplifyRefType(oParser.calculate(), ws, parent.r1, parent.c1).getValue(), 6);

		oParser = new parserFormula("INDEX(A651:C655,,2)", "D652", ws);
		assert.ok(oParser.parse());
		parent = AscCommonExcel.g_oRangeCache.getAscRange(oParser.parent);
		assert.strictEqual(oParser.simplifyRefType(oParser.calculate(), ws, parent.r1, parent.c1).getValue(), 7);

		oParser = new parserFormula("INDEX(A651:C655,,3)", "E652", ws);
		assert.ok(oParser.parse());
		parent = AscCommonExcel.g_oRangeCache.getAscRange(oParser.parent);
		assert.strictEqual(oParser.simplifyRefType(oParser.calculate(), ws, parent.r1, parent.c1).getValue(), 12);

		oParser = new parserFormula("INDEX(A651:C655,,4)", "E652", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		oParser = new parserFormula("INDEX(A651:C655,,14)", "E652", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");


		oParser = new parserFormula("INDEX(A651:C655,3,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), 8);

		oParser = new parserFormula("INDEX(A651:C655,10,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		oParser = new parserFormula("INDEX(A651:C651,1,3)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), 11);

		oParser = new parserFormula("INDEX(A651:C651,1,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), 6);

		oParser = new parserFormula("INDEX(A651:C651,0,1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), 1);

		oParser = new parserFormula("INDEX(A651:C651,1,1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), 1);

		oParser = new parserFormula("INDEX(A651:C651,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), 6);

		oParser = new parserFormula("INDEX(A651:C651,3)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), 11);

		oParser = new parserFormula("INDEX(A651:C651,4)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		oParser = new parserFormula("INDEX(A651:C652,1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		oParser = new parserFormula("INDEX(A651:C652,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		oParser = new parserFormula("INDEX(A651:C652,0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		oParser = new parserFormula("INDEX(A651:C651,1,1,1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), 1);

		oParser = new parserFormula("INDEX(A651:C651,1,1,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		oParser = new parserFormula("INDEX(A651:A655,A651,0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), 1);

		// val from arr
		oParser = new parserFormula('INDEX({"",1,2,3,4,5},1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "");

		oParser = new parserFormula('INDEX({"",1,2,3,4,5},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 1);

		oParser = new parserFormula('INDEX({"",1,2,3,4,5},5)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 4);

		oParser = new parserFormula('INDEX({1,2,3,4,5},,1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 1);

		oParser = new parserFormula('INDEX({1,2,3,4,5},,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		oParser = new parserFormula('INDEX({1,2,3,4,5},,10)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		oParser = new parserFormula('INDEX({"";1;2;3;4;5},1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "");

		oParser = new parserFormula('INDEX({"";1;2;3;4;5},5)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 4);

		// arr
		oParser = new parserFormula('INDEX({"";1;2;3;4;5},,1)', "A2", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "", 'Result of INDEX({"";1;2;3;4;5},,1)[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 1, 'Result of INDEX({"";1;2;3;4;5},,1)[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 2, 'Result of INDEX({"";1;2;3;4;5},,1)[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 3, 'Result of INDEX({"";1;2;3;4;5},,1)[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 4, 'Result of INDEX({"";1;2;3;4;5},,1)[4,0]');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), 5, 'Result of INDEX({"";1;2;3;4;5},,1)[5,0]');
		
		oParser = new parserFormula('INDEX({"";1;2;3;4;5},,)', "A2", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "", 'Result of INDEX({"";1;2;3;4;5},,)[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 1, 'Result of INDEX({"";1;2;3;4;5},,)[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 2, 'Result of INDEX({"";1;2;3;4;5},,)[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 3, 'Result of INDEX({"";1;2;3;4;5},,)[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 4, 'Result of INDEX({"";1;2;3;4;5},,)[4,0]');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), 5, 'Result of INDEX({"";1;2;3;4;5},,)[5,0]');

		oParser = new parserFormula('INDEX({"";1;2;3;4;5},,55)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");
		
		// arr two dimensional
		oParser = new parserFormula('INDEX({"Apples","Lemons";"Apple","Lemon"},,)', "A2", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "Apples", 'Result of INDEX({"Apples","Lemons";"Apple","Lemon"},,)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "Lemons", 'Result of INDEX({"Apples","Lemons";"Apple","Lemon"},,)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "Apple", 'Result of INDEX({"Apples","Lemons";"Apple","Lemon"},,)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "Lemon", 'Result of INDEX({"Apples","Lemons";"Apple","Lemon"},,)[1,1]');

		oParser = new parserFormula('INDEX({"Apples","Lemons";"Apple","Lemon"},1,)', "A2", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "Apples", 'Result of INDEX({"Apples","Lemons";"Apple","Lemon"},1,)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "Lemons", 'Result of INDEX({"Apples","Lemons";"Apple","Lemon"},1,)[0,1]');

		oParser = new parserFormula('INDEX({"Apples","Lemons";"Apple","Lemon"},2,)', "A2", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "Apple", 'Result of INDEX({"Apples","Lemons";"Apple","Lemon"},2,)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "Lemon", 'Result of INDEX({"Apples","Lemons";"Apple","Lemon"},2,)[0,1]');

		oParser = new parserFormula('INDEX({"Apples","Lemons";"Apple","Lemon"},,1)', "A2", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "Apples", 'Result of INDEX({"Apples","Lemons";"Apple","Lemon"},,1)[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "Apple", 'Result of INDEX({"Apples","Lemons";"Apple","Lemon"},,1)[1,0]');

		oParser = new parserFormula('INDEX({"Apples","Lemons";"Apple","Lemon"},3,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		ws.getRange2("A100").setValue("1")
		ws.getRange2("B100").setValue("2")
		ws.getRange2("A101").setValue("3")
		ws.getRange2("B101").setValue("4")

		// the behavior with array and range is different in these case(when arg2 is ommited)
		oParser = new parserFormula('INDEX({1,2;3,4},)', "A2", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of INDEX({1,2;3,4},)[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 3, 'Result of INDEX({1,2;3,4},)[1,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 2, 'Result of INDEX({1,2;3,4},)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 4, 'Result of INDEX({1,2;3,4},)[1,1]');

		oParser = new parserFormula('INDEX({"";1;2;3;4;5},#REF!)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		oParser = new parserFormula('INDEX({1,2;3,4},1,#VALUE!)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		oParser = new parserFormula('INDEX({1,2;3,4},1,#NUM!)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#NUM!");

		oParser = new parserFormula('INDEX(A100:B101,)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");


		ws.getRange2("A100:C214").cleanAll();
		// Data for reference link. Use A100-A115
		ws.getRange2("A100").setValue("Dates:");
		ws.getRange2("A101").setValue("43466");
		ws.getRange2("A102").setValue("43497");
		ws.getRange2("A103").setValue("43525");
		ws.getRange2("A104").setValue("43556");
		ws.getRange2("A105").setValue("43586");
		ws.getRange2("A106").setValue("43617");
		ws.getRange2("A107").setValue("43647");
		ws.getRange2("A108").setValue("43678");
		ws.getRange2("A109").setValue("43709");
		ws.getRange2("A110").setValue("43739");
		ws.getRange2("A111").setValue("43770");
		ws.getRange2("A112").setValue("43800");
		ws.getRange2("A113").setValue("43831");
		ws.getRange2("A114").setValue("43862");

		ws.getRange2("B100").setValue("Values:");
		ws.getRange2("B101").setValue("1000");
		ws.getRange2("B102").setValue("1100");
		ws.getRange2("B103").setValue("1200");
		ws.getRange2("B104").setValue("1500");
		ws.getRange2("B105").setValue("2100");
		ws.getRange2("B106").setValue("2000");
		ws.getRange2("B107").setValue("2200");
		ws.getRange2("B108").setValue("2300");
		ws.getRange2("B109").setValue("2400");
		ws.getRange2("B110").setValue("2650");
		ws.getRange2("B111").setValue("2789");
		ws.getRange2("B112").setValue("3000");
		ws.getRange2("B113").setValue("2999");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 5);
		ws.getRange2("A601").setValue("5"); // Num (Column1)
		ws.getRange2("B601").setValue("10"); // Num (Column2)
		ws.getRange2("C601").setValue("20"); // Num (Column3)
		ws.getRange2("D601").setValue("30"); // Num (Column4)
		ws.getRange2("E601").setValue("1"); // Num (Column5)
		ws.getRange2("F601").setValue("Text"); // Text (Column6)

		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2


		// Positive cases:
		// Case #1: Area, Number(2). Basic valid input: 2x2 range, row_num=1, column_num=1. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 'Dates:', 'Test: Positive case: Area, Number(2). Basic valid input: 2x2 range, row_num=1, column_num=1. 3 of 3 arguments used.');
		// Case #2: Area, Number. 1D range (column), row_num=1, column_num omitted. 2 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Positive case: Area, Number. 1D range (column), row_num=1, column_num omitted. 2 of 3 arguments used.');
		// Case #3: Formula, Number(2). row_num as IF formula, 2x2 range. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,IF(TRUE,1,2),2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,IF(TRUE,1,2),2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "Values:", 'Test: Positive case: Formula, Number(2). row_num as IF formula, 2x2 range. 3 of 3 arguments used.');
		// Case #4: String(3). Array literal as string, numeric string arguments. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX("1,2;3,4","1","1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX("1,2;3,4","1","1") is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '1,2;3,4', 'Test: Positive case: String(3). Array literal as string, numeric string arguments. 3 of 3 arguments used.');
		// Case #5: Reference link, Number(2). Single-cell reference link, row_num=1, column_num=1. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), "Dates:", 'Test: Positive case: Reference link, Number(2). Single-cell reference link, row_num=1, column_num=1. 3 of 3 arguments used.');
		// Case #6: Area, Number(2). Single-column range, row_num=1, column_num=1. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:A101,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:A101,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "Dates:", 'Test: Positive case: Area, Number(2). Single-column range, row_num=1, column_num=1. 3 of 3 arguments used.');
		// Case #7: Array, Number(2). Array literal, row_num=1, column_num=1. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX({1,2;3,4},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX({1,2;3,4},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Array, Number(2). Array literal, row_num=1, column_num=1. 3 of 3 arguments used.');
		// Case #8: Name, Number(2). Named range, row_num=1, column_num=1. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(TestName,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(TestName,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), -0.5, 'Test: Positive case: Name, Number(2). Named range, row_num=1, column_num=1. 3 of 3 arguments used.');
		// Case #9: Name3D, Number(2). 3D named range, row_num=1, column_num=1. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(TestName3D,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(TestName3D,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), -0.5, 'Test: Positive case: Name3D, Number(2). 3D named range, row_num=1, column_num=1. 3 of 3 arguments used.');
		// Case #10: Ref3D, Number(2). 3D reference to 2x2 range, row_num=1, column_num=1. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(Sheet2!A1:A2,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(Sheet2!A1:A2,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 1, 'Test: Positive case: Ref3D, Number(2). 3D reference to 2x2 range, row_num=1, column_num=1. 3 of 3 arguments used.');
		// Case #11: Area3D, Number(2). 3D range, row_num=1, column_num=1. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(Sheet2!A100:B102,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(Sheet2!A100:B102,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "", 'Test: Positive case: Area3D, Number(2). 3D range, row_num=1, column_num=1. 3 of 3 arguments used.');
		// Case #12: Table, Number(2). Table column, row_num=1, column_num omitted. 2 of 3 arguments used.
		oParser = new parserFormula('INDEX(Table1[Column1],1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(Table1[Column1],1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Test: Positive case: Table, Number(2). Table column, row_num=1, column_num omitted. 2 of 3 arguments used.');
		// Case #13: Formula, Number(2). Array as formula (CHOOSE), row_num=1, column_num=1. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(CHOOSE(1,A100:B102),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(CHOOSE(1,A100:B102),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "Dates:", 'Test: Positive case: Formula, Number(2). Array as formula (CHOOSE), row_num=1, column_num=1. 3 of 3 arguments used.');
		// Case #14: Area, Date, Number. row_num as date serial divided to 1. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,DATE(2025,1,1)/1E6,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,DATE(2025,1,1)/1E6,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue().getValue(), "Dates:", 'Test: Positive case: Area, Date, Number. row_num as date serial divided to 1. 3 of 3 arguments used.');
		// Case #15: Area, Time, Number. row_num as time value (0.5*2=1). 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,TIME(12,0,0)*2,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,TIME(12,0,0)*2,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "Dates:", 'Test: Positive case: Area, Time, Number. row_num as time value (0.5*2=1). 3 of 3 arguments used.');
		// Case #16: Area, Number. 2x2 range, row_num=1, column_num omitted (returns first row). 2 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Positive case: Area, Number. 2x2 range, row_num=1, column_num omitted (returns first row). 2 of 3 arguments used.');
		// Case #17: Array, Number(2). Array literal, maximum row_num and column_num for 2x2 array. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX({1,2;3,4},2,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX({1,2;3,4},2,2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Test: Positive case: Array, Number(2). Array literal, maximum row_num and column_num for 2x2 array. 3 of 3 arguments used.');
		// Case #18: Formula, Number(2). row_num and column_num as formulas. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,SQRT(1),ROUND(1.2,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,SQRT(1),ROUND(1.2,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "Dates:", 'Test: Positive case: Formula, Number(2). row_num and column_num as formulas. 3 of 3 arguments used.');
		// Case #19: Area, Number(2). row_num=0 returns entire first column as array. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,0,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), "Dates:", 'Test: Positive case: Area, Number(2). row_num=0 returns entire first column as array. 3 of 3 arguments used.');
		// Case #20: Area, Number(2). column_num=0 returns entire first row as array. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,1,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,1,0) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), "Dates:", 'Test: Positive case: Area, Number(2). column_num=0 returns entire first row as array. 3 of 3 arguments used.');
		// Case #21: Name, Formula, Number. Named range, row_num as IF formula. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(TestName,IF(TRUE,1,2),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(TestName,IF(TRUE,1,2),1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), -0.5, 'Test: Positive case: Name, Formula, Number. Named range, row_num as IF formula. 3 of 3 arguments used.');

		// Negative cases:
		// Case #1: Area, Number(2). row_num out of bounds (3 > 2) returns #REF!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,3,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,3,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 43497, 'Test: Negative case: Area, Number(2). row_num out of bounds (3 > 2) returns #REF!. 3 of 3 arguments used.');
		// Case #2: Area, Number(2). column_num out of bounds (3 > 2) returns #REF!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,1,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,1,3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Area, Number(2). column_num out of bounds (3 > 2) returns #REF!. 3 of 3 arguments used.');
		// Case #3: Area, String(2). Non-numeric row_num returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,"abc",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,"abc",1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, String(2). Non-numeric row_num returns #VALUE!. 3 of 3 arguments used.');
		// Case #4: Area, Number, String. Non-numeric column_num returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,1,"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,1,"abc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number, String. Non-numeric column_num returns #VALUE!. 3 of 3 arguments used.');
		// Case #5: Error, Number(2). Array as #N/A propagates #N/A error. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(NA(),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(NA(),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error, Number(2). Array as #N/A propagates #N/A error. 3 of 3 arguments used.');
		// Case #6: Area(2), Number. Multi-cell range with valid row_num, column_num omitted. 2 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:A101,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:A101,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "Dates:", 'Test: Negative case: Area(2), Number. Multi-cell range with valid row_num, column_num omitted. 2 of 3 arguments used.');
		// Case #7: Reference link, Number(2). Reference to text value returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A104,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A104,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 43556, 'Test: Negative case: Reference link, Number(2). Reference to text value returns #VALUE!. 3 of 3 arguments used.');
		// Case #8: Area. Missing row_num returns #VALUE!. 1 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Area. Missing row_num returns #VALUE!. 1 of 3 arguments used.');
		// Case #9: Area, Boolean, Number. Boolean row_num returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,FALSE,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,FALSE,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Negative case: Area, Boolean, Number. Boolean row_num returns #VALUE!. 3 of 3 arguments used.');
		// Case #10: Ref3D, Number(2). 3D reference to text value returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(Sheet2!A5,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(Sheet2!A5,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), "", 'Test: Negative case: Ref3D, Number(2). 3D reference to text value returns #VALUE!. 3 of 3 arguments used.');
		// Case #11: Name, Number(2). Named range with text returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(TestNameArea2,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(TestNameArea2,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 0.8, 'Test: Negative case: Name, Number(2). Named range with text returns #VALUE!. 3 of 3 arguments used.');
		// Case #12: Name3D, Number(2). 3D named range with text returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(TestNameArea3D2,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(TestNameArea3D2,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 0.8, 'Test: Negative case: Name3D, Number(2). 3D named range with text returns #VALUE!. 3 of 3 arguments used.');
		// Case #13: Table, Number(2). Table with text value returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(Table1[Column3],1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(Table1[Column3],1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 20, 'Test: Negative case: Table, Number(2). Table with text value returns #VALUE!. 3 of 3 arguments used.');
		// Case #14: Formula, Number(2). Array as #NUM! formula returns #NUM!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(SQRT(-1),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(SQRT(-1),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula, Number(2). Array as #NUM! formula returns #NUM!. 3 of 3 arguments used.');
		// Case #15: Area, Number(2). Negative row_num returns #REF!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,-1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,-1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number(2). Negative row_num returns #REF!. 3 of 3 arguments used.');
		// Case #16: Area, Number(2). Negative column_num returns #REF!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,1,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,1,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number(2). Negative column_num returns #REF!. 3 of 3 arguments used.');
		// Case #17: Array, String(2). Non-numeric row_num in array literal returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX({1,2;3,4},"abc","1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX({1,2;3,4},"abc","1") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, String(2). Non-numeric row_num in array literal returns #VALUE!. 3 of 3 arguments used.');
		// Case #18: Area, Number. row_num=0 on 1D range returns #VALUE! (requires column_num=0 for array output). 2 of 3 arguments used.
		oParser = new parserFormula('INDEX(A1:A102,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A1:A102,0) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Negative case: Area, Number. row_num=0 on 1D range returns #VALUE! (requires column_num=0 for array output). 2 of 3 arguments used.');
		// Case #19: Area3D, Number(2). 3D range with out-of-bounds row_num returns #REF!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(Sheet2!A100:B102,3,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(Sheet2!A100:B102,3,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "", 'Test: Negative case: Area3D, Number(2). 3D range with out-of-bounds row_num returns #REF!. 3 of 3 arguments used.');
		// Case #20: Area, Empty, Number. Empty row_num returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), "Dates:", 'Test: Negative case: Area, Empty, Number. Empty row_num returns #VALUE!. 3 of 3 arguments used.');

		// Bounded cases:
		// Case #1: Area, Number(2). Minimum valid row_num and column_num (1). 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "Dates:", 'Test: Bounded case: Area, Number(2). Minimum valid row_num and column_num (1). 3 of 3 arguments used.');
		// Case #2: Area, Number(2). Maximum valid row_num and column_num for 2x2 array. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,2,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,2,2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 1000, 'Test: Bounded case: Area, Number(2). Maximum valid row_num and column_num for 2x2 array. 3 of 3 arguments used.');
		// Case #3: Area, Number(2). row_num=0 returns entire first column as array. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,0,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), "Dates:", 'Test: Bounded case: Area, Number(2). row_num=0 returns entire first column as array. 3 of 3 arguments used.');
		// Case #4: Area, Number(2). column_num=0 returns entire first row as array. 3 of 3 arguments used.
		oParser = new parserFormula('INDEX(A100:B102,1,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDEX(A100:B102,1,0) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), "Dates:", 'Test: Bounded case: Area, Number(2). column_num=0 returns entire first row as array. 3 of 3 arguments used.');

		// Need to fix: method to check result in tests?
		// Case #4: String(3). Array literal as string, numeric string arguments. 3 of 3 arguments used.
		// Case #19: Area, Number(2). row_num=0 returns entire first column as array. 3 of 3 arguments used. - array?
		// Case #20: Area, Number(2). column_num=0 returns entire first row as array. 3 of 3 arguments used. - array?
		// Case #14: Area, Date, Number. row_num as date serial divided to 1. 3 of 3 arguments used.
		// Case #19: Area, Number(2). row_num=0 returns entire first column as array. 3 of 3 arguments used.
		// Case #20: Area, Number(2). column_num=0 returns entire first row as array. 3 of 3 arguments used.
		// Case #9: Area, Boolean, Number. Boolean row_num returns #VALUE!. 3 of 3 arguments used.
		// Case #18: Area, Number. row_num=0 on 1D range returns #VALUE! (requires column_num=0 for array output). 2 of 3 arguments used.
		// Case #20: Area, Empty, Number. Empty row_num returns #VALUE!. 3 of 3 arguments used.
		// Case #3: Area, Number(2). row_num=0 returns entire first column as array. 3 of 3 arguments used.
		// Case #4: Area, Number(2). column_num=0 returns entire first row as array. 3 of 3 arguments used.

	});

	QUnit.test("Test: \"INDIRECT\"", function (assert) {

		ws.getRange2("A22").setValue("B22");
		ws.getRange2("B22").setValue("1.333");

		ws.getRange2("A23").setValue("B23");
		ws.getRange2("B23").setValue("45");

		ws.getRange2("A24").setValue("George");
		ws.getRange2("B24").setValue("10");

		ws.getRange2("A25").setValue("25");
		ws.getRange2("B25").setValue("62");


		oParser = new parserFormula("INDIRECT(A22)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), 1.333);

		oParser = new parserFormula("INDIRECT(A23)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), 45);

		ws.getRange2("A100:A102").cleanAll();

		oParser = new parserFormula("INDIRECT(A100:A102)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		/*oParser = new parserFormula( "INDIRECT(A24)", "A2", ws );
		assert.ok( oParser.parse() );
		assert.strictEqual( oParser.calculate().getValue().getValue(), 10 );*/

		oParser = new parserFormula('INDIRECT("B"&A25)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), 62);

		// 	Data for reference link. Use A100-A111
		ws.getRange2("A1:C214").cleanAll();
		ws.getRange2("A1").setValue("0.1");
		ws.getRange2("A100").setValue("A108");
		ws.getRange2("A101").setValue("A109");
		ws.getRange2("A104").setValue("123S");
		// For area
		ws.getRange2("A102").setValue("A110");
		ws.getRange2("A103").setValue("ABCD");
		ws.getRange2("A105").setValue("123");
		ws.getRange2("A106").setValue("123st");
		ws.getRange2("A107").setValue("");
		ws.getRange2("A108").setValue("ABCD");
		ws.getRange2("A109").setValue("ABCD2");
		ws.getRange2("A110").setValue("ABCD3");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 1);
		ws.getRange2("A601").setValue("A108"); // TextRef (Column1)
		ws.getRange2("B601").setValue("123s"); // Text (Column2)
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:D10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("-1");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2

		// Positive cases:
		// Case #1: String. Valid A1-style reference as string. 1 argument used.
		oParser = new parserFormula('INDIRECT("A100")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("A100") is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 'A108', 'Test: Positive case: String. Valid A1-style reference as string. 1 argument used.');
		// Case #2: String. Valid R1C1-style reference with a1=FALSE. 2 arguments used.
		oParser = new parserFormula('INDIRECT("R100C1", FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("R100C1", FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 'A108', 'Test: Positive case: String. Valid R1C1-style reference with a1=FALSE. 2 arguments used.');
		// Case #3: Formula. Nested CONCAT formula creating valid A1 reference. 1 argument used.
		oParser = new parserFormula('INDIRECT(CONCAT("A", 100))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(CONCAT("A", 1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 'A108', 'Test: Positive case: Formula. Nested CONCAT formula creating valid A1 reference. 1 argument used.');
		// Case #4: Reference link. Reference to cell containing valid A1 reference. 1 argument used.
		oParser = new parserFormula('INDIRECT(A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(A100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 'ABCD', 'Test: Positive case: Reference link. Reference to cell containing valid A1 reference. 1 argument used.');
		// Case #5: Area. Single-cell range containing valid A1 reference. 1 argument used.
		oParser = new parserFormula('INDIRECT(A101:A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(A101:A101) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 'ABCD2', 'Test: Positive case: Area. Single-cell range containing valid A1 reference. 1 argument used.');
		// Case #6: Array. Array with single valid A1 reference. 1 argument used.
		oParser = new parserFormula('INDIRECT({"A100"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT({"A100"}) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Positive case: Array. Array with single valid A1 reference. 1 argument used.');
		// Case #7: Name. Named range containing valid reference. 1 argument used.
		oParser = new parserFormula('INDIRECT(TestName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(TestName) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Positive case: Name. Named range containing valid reference. 1 argument used.');
		// Case #8: Name3D. 3D named range containing valid reference. 1 argument used.
		oParser = new parserFormula('INDIRECT(TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Positive case: Name3D. 3D named range containing valid reference. 1 argument used.');
		// Case #9: Ref3D. 3D reference to cell with valid A1 reference. 1 argument used.
		oParser = new parserFormula('INDIRECT(Sheet2!A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(Sheet2!A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Positive case: Ref3D. 3D reference to cell with valid A1 reference. 1 argument used.');
		// Case #10: Area3D. 3D single-cell range with valid A1 reference. 1 argument used.
		oParser = new parserFormula('INDIRECT(Sheet2!A2:A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(Sheet2!A2:A2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Positive case: Area3D. 3D single-cell range with valid A1 reference. 1 argument used.');
		// Case #11: Table. Table structured reference with valid A1 reference. 1 argument used.
		oParser = new parserFormula('INDIRECT(Table1[Column1])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(Table1[Column1]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 'ABCD', 'Test: Positive case: Table. Table structured reference with valid A1 reference. 1 argument used.');
		// Case #12: Formula. Nested IF formula returning valid A1 reference. 1 argument used.
		oParser = new parserFormula('INDIRECT(IF(TRUE, "A100", "A109"))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(IF(TRUE, "A100", "A109")) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 'A108', 'Test: Positive case: Formula. Nested IF formula returning valid A1 reference. 1 argument used.');
		// Case #13: String. Valid 3D reference as string. 1 argument used.
		oParser = new parserFormula('INDIRECT("Sheet2!A1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("Sheet2!A1") is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 1, 'Test: Positive case: String. Valid 3D reference as string. 1 argument used.');
		// Case #14: Formula. INDIRECT inside SUM formula. 1 argument used.
		oParser = new parserFormula('SUM(INDIRECT("A110"), 1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SUM(INDIRECT("A110"), 1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Formula. INDIRECT inside SUM formula. 1 argument used.');
		// Case #15: String. A1-style reference with a1=TRUE. 2 arguments used.
		oParser = new parserFormula('INDIRECT("A100", TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("A100", TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 'A108', 'Test: Positive case: String. A1-style reference with a1=TRUE. 2 arguments used.');
		// Case #16: Reference link. Reference to cell with R1C1 reference, a1=FALSE. 2 arguments used.
		oParser = new parserFormula('INDIRECT(A102, FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(A102, FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Positive case: Reference link. Reference to cell with R1C1 reference, a1=FALSE. 2 arguments used.');
		// Case #17: Formula. Nested TEXT formula creating valid A1 reference. 1 argument used.
		oParser = new parserFormula('INDIRECT(TEXT(100, "A0000"))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(TEXT(100, "A0000")) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 'A108', 'Test: Positive case: Formula. Nested TEXT formula creating valid A1 reference. 1 argument used.');
		// Case #18: Array. Multi-element array with valid A1 references. 1 argument used.
		oParser = new parserFormula('INDIRECT({"A100", "A101"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT({"A100", "A101"}) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Positive case: Array. Multi-element array with valid A1 references. 1 argument used.');
		// Case #19: String. String referencing named range. 1 argument used.
		oParser = new parserFormula('INDIRECT("TestName")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("TestName") is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), -0.5, 'Test: Positive case: String. String referencing named range. 1 argument used.');
		// Case #20: Formula. Nested CONCAT creating valid 3D reference. 1 argument used.
		oParser = new parserFormula('INDIRECT(CONCAT("Sheet2!A", 2))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(CONCAT("Sheet2!A", 2)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 2, 'Test: Positive case: Formula. Nested CONCAT creating valid 3D reference. 1 argument used.');
		// Case #21: Date. Date used in formula to create valid A1 reference. 1 argument used.
		oParser = new parserFormula('INDIRECT(TEXT(DATE(2025,1,1), "A0"))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(TEXT(DATE(2025,1,1), "A0")) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "", 'Test: Positive case: Date. Date used in formula to create valid A1 reference. 1 argument used.');
		// Case #22: Time. Time used in formula to create valid A1 reference. 1 argument used.
		oParser = new parserFormula('INDIRECT(TEXT(TIME(0,0,0)+1, "A0"))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(TEXT(TIME(0,0,0)+1, "A0")) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 0.1, 'Test: Positive case: Time. Time used in formula to create valid A1 reference. 1 argument used.');

		// Negative cases:
		// Case #1: String. Invalid A1 reference (column Z1 exceeds XFD). Returns #REF!. 1 argument used.
		oParser = new parserFormula('INDIRECT("Z1Z")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("Z1Z") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: String. Invalid A1 reference (column Z1 exceeds XFD). Returns #REF!. 1 argument used.');
		// Case #2: Number. Non-string input returns #VALUE!. 1 argument used.
		oParser = new parserFormula('INDIRECT(1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Number. Non-string input returns #VALUE!. 1 argument used.');
		// Case #3: Formula. Propagates #N/A error. 1 argument used.
		oParser = new parserFormula('INDIRECT(NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(NA()) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Formula. Propagates #N/A error. 1 argument used.');
		// Case #4: String. Row exceeds 1048576 limit. Returns #REF!. 1 argument used.
		oParser = new parserFormula('INDIRECT("A1048577")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("A1048577") is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), '#REF!', 'Test: Negative case: String. Row exceeds 1048576 limit. Returns #REF!. 1 argument used.');
		// Case #5: Reference link. Reference to cell with invalid A1 reference. Returns #REF!. 1 argument used.
		oParser = new parserFormula('INDIRECT(A103)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(A103) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Reference link. Reference to cell with invalid A1 reference. Returns #REF!. 1 argument used.');
		// Case #6: Area. Multi-cell range returns #REF!. 1 argument used.
		oParser = new parserFormula('INDIRECT(A104:A105)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(A104:A105) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Area. Multi-cell range returns #REF!. 1 argument used.');
		// Case #7: Empty. Reference to empty cell returns #VALUE!. 1 argument used.
		oParser = new parserFormula('INDIRECT(A106)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(A106) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Empty. Reference to empty cell returns #VALUE!. 1 argument used.');
		// Case #8: String. Empty string returns #REF!. 1 argument used.
		oParser = new parserFormula('INDIRECT("")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: String. Empty string returns #REF!. 1 argument used.');
		// Case #9: Boolean. Boolean input returns #VALUE!. 1 argument used.
		oParser = new parserFormula('INDIRECT(FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Boolean. Boolean input returns #VALUE!. 1 argument used.');
		// Case #10: Ref3D. 3D reference to cell with invalid reference. Returns #REF!. 1 argument used.
		oParser = new parserFormula('INDIRECT(Sheet2!A3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(Sheet2!A3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Ref3D. 3D reference to cell with invalid reference. Returns #REF!. 1 argument used.');
		// Case #11: Name. Named range with invalid reference. Returns #REF!. 1 argument used.
		oParser = new parserFormula('INDIRECT(TestNameArea2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(TestNameArea2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Name. Named range with invalid reference. Returns #REF!. 1 argument used.');
		// Case #12: Table. Table column with invalid reference. Returns #REF!. 1 argument used.
		oParser = new parserFormula('INDIRECT(Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Table. Table column with invalid reference. Returns #REF!. 1 argument used.');
		// Case #13: Formula. Formula resulting in #NUM! error. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('INDIRECT(SQRT(-1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(SQRT(-1)) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula. Formula resulting in #NUM! error. Returns #VALUE!. 1 argument used.');
		// Case #14: String. Reference to non-existent sheet. Returns #REF!. 1 argument used.
		oParser = new parserFormula('INDIRECT("NonExistentSheet!A1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("NonExistentSheet!A1") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: String. Reference to non-existent sheet. Returns #REF!. 1 argument used.');
		// Case #15: Array. Array with boolean value. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('INDIRECT({FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT({FALSE}) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Array. Array with boolean value. Returns #VALUE!. 1 argument used.');
		// Case #16: String. Multi-cell range reference. Returns #REF!. 1 argument used.
		oParser = new parserFormula('INDIRECT("A100:A102")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("A100:A102") is parsed.');
		assert.strictEqual(oParser.calculate().getValueByRowCol(0,0).getValue(), 'A108', 'Test: Negative case: String. Multi-cell range reference. Returns #REF!. 1 argument used.');
		assert.strictEqual(oParser.calculate().getValueByRowCol(1,0).getValue(), 'A109', 'Test: Negative case: String. Multi-cell range reference. Returns #REF!. 1 argument used.');
		// Case #17: Formula. Nested formula creating invalid reference. Returns #REF!. 1 argument used.
		oParser = new parserFormula('INDIRECT(CONCAT("A", -1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(CONCAT("A", -1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Formula. Nested formula creating invalid reference. Returns #REF!. 1 argument used.');
		// Case #18: Name3D. 3D named range with invalid reference. Returns #REF!. 1 argument used.
		oParser = new parserFormula('INDIRECT(TestNameArea3D2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(TestNameArea3D2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Name3D. 3D named range with invalid reference. Returns #REF!. 1 argument used.');
		// Case #19: Area3D. 3D multi-cell range. Returns #REF!. 1 argument used.
		oParser = new parserFormula('INDIRECT(Sheet2!A4:A5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(Sheet2!A4:A5) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Area3D. 3D multi-cell range. Returns #REF!. 1 argument used.');
		// Case #20: Reference link. Invalid a1 argument type (string instead of boolean). Returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('INDIRECT(A107, "TRUE")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT(A107, "TRUE") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Reference link. Invalid a1 argument type (string instead of boolean). Returns #VALUE!. 2 arguments used.');
		// Case #21: String. R1C1 reference exceeding column limit (16384). Returns #REF!. 2 arguments used.
		oParser = new parserFormula('INDIRECT("R1C16385", FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("R1C16385", FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: String. R1C1 reference exceeding column limit (16384). Returns #REF!. 2 arguments used.');

		// Bounded cases:
		// Case #1: String. Minimum valid A1 reference (first cell). 1 argument used.
		oParser = new parserFormula('INDIRECT("A1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("A1") is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 0.1, 'Test: Bounded case: String. Minimum valid A1 reference (first cell). 1 argument used.');
		// Case #2: String. Maximum valid A1 reference (last cell). 1 argument used.
		oParser = new parserFormula('INDIRECT("XFD1048576")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("XFD1048576") is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), '', 'Test: Bounded case: String. Maximum valid A1 reference (last cell). 1 argument used.');
		// Case #3: String. Minimum valid R1C1 reference. 2 arguments used.
		oParser = new parserFormula('INDIRECT("R1C1", FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("R1C1", FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 0.1, 'Test: Bounded case: String. Minimum valid R1C1 reference. 2 arguments used.');
		// Case #4: String. Maximum valid R1C1 reference. 2 arguments used.
		oParser = new parserFormula('INDIRECT("R1048576C16384", FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: INDIRECT("R1048576C16384", FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "", 'Test: Bounded case: String. Maximum valid R1C1 reference. 2 arguments used.');

		// Need to fix: arrays and error handle
		// Case #6: Array. Array with single valid A1 reference. 1 argument used. - array handle
		// Case #18: Array. Multi-element array with valid A1 references. 1 argument used. - array handle
		// Case #3: Formula. Propagates #N/A error. 1 argument used. - error handle
		// Case #13: Formula. Formula resulting in #NUM! error. Returns #VALUE!. 1 argument used. - error handle
		// Case #15: Array. Array with boolean value. Returns #VALUE!. 1 argument used. - array handle
	});

	QUnit.test("Test: \"LOOKUP\"", function (assert) {
		let array;

		ws.getRange2("A1000").setValue("4.14");
		ws.getRange2("A1001").setValue("4.19");
		ws.getRange2("A1002").setValue("5.17");
		ws.getRange2("A1003").setValue("5.77");
		ws.getRange2("A1004").setValue("6.39");

		ws.getRange2("B1000").setValue("red");
		ws.getRange2("B1001").setValue("orange");
		ws.getRange2("B1002").setValue("yellow");
		ws.getRange2("B1003").setValue("green");
		ws.getRange2("B1004").setValue("blue");

		ws.getRange2("C1020").setValue("4.14");
		ws.getRange2("D1020").setValue("4.19");
		ws.getRange2("E1020").setValue("5.17");
		ws.getRange2("F1020").setValue("5.77");
		ws.getRange2("G1020").setValue("6.39");
		ws.getRange2("H1020").setValue("7.99");

		ws.getRange2("C1021").setValue("red");
		ws.getRange2("D1021").setValue("orange");
		ws.getRange2("E1021").setValue("yellow");
		ws.getRange2("F1021").setValue("green");
		ws.getRange2("G1021").setValue("blue");
		ws.getRange2("H1021").setValue("black");

		ws.getRange2("A1040").setValue("0");
		ws.getRange2("A1041").setValue("1");
		ws.getRange2("A1042").setValue("");
		ws.getRange2("A1043").setValue("3");
		ws.getRange2("A1044").setValue("3");
		ws.getRange2("A1045").setValue("3");
		ws.getRange2("A1046").setValue("TRUE");
		ws.getRange2("A1047").setValue("FALSE");

		ws.getRange2("B1041").setValue("a");
		ws.getRange2("B1042").setValue("b");
		ws.getRange2("B1043").setValue("c");
		ws.getRange2("B1044").setValue("d");
		ws.getRange2("B1045").setValue("e");
		ws.getRange2("B1046").setValue("f");
		ws.getRange2("B1047").setValue("g");
		ws.getRange2("B1048").setValue("h");
		ws.getRange2("B1049").setValue("i");

		ws.getRange2("C1041").setValue("1");
		ws.getRange2("C1042").setValue("2");
		ws.getRange2("C1043").setValue("3");
		ws.getRange2("C1044").setValue("4");
		ws.getRange2("C1045").setValue("5");
		ws.getRange2("C1046").setValue("6");
		ws.getRange2("C1047").setValue("7");
		ws.getRange2("C1048").setValue("8");
		ws.getRange2("C1049").setValue("9");

		ws.getRange2("G1070").setValue("0");
		ws.getRange2("G1071").setValue("1");
		ws.getRange2("G1072").setValue("2");
		ws.getRange2("G1073").setValue("3");
		ws.getRange2("G1074").setValue("3");
		ws.getRange2("G1075").setValue("TRUE");
		ws.getRange2("G1076").setValue("FALSE");

		ws.getRange2("H1070").setValue("a");
		ws.getRange2("H1071").setValue("b");
		ws.getRange2("H1072").setValue("c");
		ws.getRange2("H1073").setValue("d");
		ws.getRange2("H1074").setValue("e");
		ws.getRange2("H1075").setValue("f");
		ws.getRange2("H1076").setValue("g");

		ws.getRange2("C1090").setValue("2");
		ws.getRange2("D1090").setValue("");
		ws.getRange2("E1090").setValue("4");
		ws.getRange2("F1090").setValue("5");
		ws.getRange2("G1090").setValue("");
		ws.getRange2("H1090").setValue("");
		ws.getRange2("I1090").setValue("6");
		ws.getRange2("J1090").setValue("");
		ws.getRange2("K1090").setValue("7");

		ws.getRange2("C1091").setValue("a");
		ws.getRange2("D1091").setValue("b");
		ws.getRange2("E1091").setValue("c");
		ws.getRange2("F1091").setValue("d");
		ws.getRange2("G1091").setValue("e");
		ws.getRange2("H1091").setValue("f");
		ws.getRange2("I1091").setValue("g");
		ws.getRange2("J1091").setValue("h");
		ws.getRange2("K1091").setValue("i");

		ws.getRange2("A1110").setValue("1");
		ws.getRange2("A1111").setValue("2");
		ws.getRange2("A1112").setValue("3");
		ws.getRange2("A1113").setValue("4");
		ws.getRange2("A1114").setValue("5");
		ws.getRange2("B1110").setValue("2");
		ws.getRange2("B1111").setValue("4");
		ws.getRange2("B1112").setValue("6");
		ws.getRange2("B1113").setValue("8");
		ws.getRange2("B1114").setValue("11");
		ws.getRange2("C1110").setValue("3");
		ws.getRange2("C1111").setValue("6");
		ws.getRange2("C1112").setValue("9");
		ws.getRange2("C1113").setValue("12");
		ws.getRange2("C1114").setValue("16");
		ws.getRange2("D1110").setValue("4");
		ws.getRange2("D1111").setValue("8");
		ws.getRange2("D1112").setValue("12");
		ws.getRange2("D1113").setValue("16");
		ws.getRange2("D1114").setValue("20");
		ws.getRange2("E1110").setValue("5");
		ws.getRange2("E1111").setValue("10");
		ws.getRange2("E1112").setValue("14");
		ws.getRange2("E1113").setValue("20");
		ws.getRange2("E1114").setValue("25");

		ws.getRange2("A1130").setValue("a");
		ws.getRange2("A1131").setValue("b");
		ws.getRange2("A1132").setValue("c");
		ws.getRange2("A1133").setValue("d");

		ws.getRange2("B1130").setValue("b");
		ws.getRange2("C1130").setValue("c");
		ws.getRange2("D1130").setValue("d");

		ws.getRange2("A1150").setValue("1");
		ws.getRange2("A1151").setValue("1");
		ws.getRange2("A1152").setValue("#DIV/0!");
		ws.getRange2("A1153").setValue("#DIV/0!");
		ws.getRange2("A1154").setValue("#DIV/0!");
		ws.getRange2("A1155").setValue("#DIV/0!");
		ws.getRange2("A1156").setValue("#DIV/0!");

		ws.getRange2("B1150").setValue("1");
		ws.getRange2("B1151").setValue("2");
		ws.getRange2("B1152").setValue("3");
		ws.getRange2("B1153").setValue("4");
		ws.getRange2("B1154").setValue("5");
		ws.getRange2("B1155").setValue("6");
		ws.getRange2("B1156").setValue("7");

		ws.getRange2("C1150").setValue("1");
		ws.getRange2("C1151").setValue("1");
		ws.getRange2("C1152").setValue("0");
		ws.getRange2("C1153").setValue("0");
		ws.getRange2("C1154").setValue("0");
		ws.getRange2("C1155").setValue("0");
		ws.getRange2("C1156").setValue("0");

		ws.getRange2("C1150").setValue("10");
		ws.getRange2("C1151").setValue("1");
		ws.getRange2("C1152").setValue("2");
		ws.getRange2("C1153").setValue("3");
		ws.getRange2("C1154").setValue("4");
		ws.getRange2("C1155").setValue("5");
		ws.getRange2("C1156").setValue("10");

		ws.getRange2("A1180").setValue("2");
		ws.getRange2("A1181").setValue("1");
		ws.getRange2("A1185").setValue("1");
		ws.getRange2("A1186").setValue("3");
		ws.getRange2("B1180").setValue("0");
		ws.getRange2("B1181").setValue("1");
		ws.getRange2("B1182").setValue("2");
		ws.getRange2("B1183").setValue("3");
		ws.getRange2("B1184").setValue("4");
		ws.getRange2("B1185").setValue("5");
		ws.getRange2("B1186").setValue("6");
		ws.getRange2("B1187").setValue("7");
		ws.getRange2("B1188").setValue("8");
		ws.getRange2("B1189").setValue("9");
		ws.getRange2("B1190").setValue("10");

		ws.getRange2("A1200").setValue("2");
		ws.getRange2("A1201").setValue("4");
		ws.getRange2("A1202").setValue("40");
		ws.getRange2("B1200").setValue("1");
		ws.getRange2("C1200").setValue("2");
		ws.getRange2("D1200").setValue("3");

		let currentSheet = ws.getName();

		ws.getRange2("E1210").setValue("3");
		ws.getRange2("A1210:A1220").setValue("4000");
		ws.getRange2("A1215").setValue("3");
		ws.getRange2("B1210:B1220").setValue("1000");
		ws.getRange2("B1210").setValue("1");
		ws.getRange2("B1215").setValue("55");

		ws.getRange2("A1300:B1350").cleanAll();
		ws.getRange2("A1300").setValue("0");
		ws.getRange2("A1301").setValue("0");
		ws.getRange2("A1302").setValue("2.1");
		ws.getRange2("A1303").setValue("2.4");
		ws.getRange2("A1304").setValue("2.4");
		ws.getRange2("A1305").setValue("9");
		ws.getRange2("A1306").setValue("10");
		ws.getRange2("A1307").setValue("11");
		ws.getRange2("A1308").setValue("11");
		ws.getRange2("A1309").setValue("11");
		ws.getRange2("A1310").setValue("12");
		ws.getRange2("A1311").setValue("12");
		ws.getRange2("A1312").setValue("12");
		ws.getRange2("A1313").setValue("67");
		ws.getRange2("A1314").setValue("");
		ws.getRange2("A1315").setValue("ALDEBARAN");
		ws.getRange2("A1316").setValue("BLUE");
		ws.getRange2("A1317").setValue("CIANO");
		ws.getRange2("A1318").setValue("RED");
		ws.getRange2("A1319").setValue("#N/A");
		ws.getRange2("A1320").setValue("Vega");
		ws.getRange2("A1321").setValue("FALSE");
		ws.getRange2("A1322").setValue("TRUE");

		ws.getRange2("A1323").setValue("BLUE");

		ws.getRange2("B1300").setValue("1");
		ws.getRange2("B1301").setValue("2");
		ws.getRange2("B1302").setValue("3");
		ws.getRange2("B1303").setValue("4");
		ws.getRange2("B1304").setValue("5");
		ws.getRange2("B1305").setValue("6");
		ws.getRange2("B1306").setValue("7");
		ws.getRange2("B1307").setValue("8");
		ws.getRange2("B1308").setValue("9");
		ws.getRange2("B1309").setValue("10");
		ws.getRange2("B1310").setValue("11");
		ws.getRange2("B1311").setValue("12");
		ws.getRange2("B1312").setValue("13");
		ws.getRange2("B1313").setValue("14");
		ws.getRange2("B1314").setValue("15");
		ws.getRange2("B1315").setValue("16");
		ws.getRange2("B1316").setValue("17");
		ws.getRange2("B1317").setValue("18");
		ws.getRange2("B1318").setValue("19");
		ws.getRange2("B1319").setValue("20");
		ws.getRange2("B1320").setValue("21");
		ws.getRange2("B1321").setValue("22");
		ws.getRange2("B1322").setValue("23");

		const defName3D = new Asc.asc_CDefName('LOOKUPTestName3D', ws.getName() + '!$A$1323');
		const defNameArea3D = new Asc.asc_CDefName('LOOKUPTestNameArea3D', ws.getName() + '!$A$1300:$B$1322');

		wb.editDefinesNames(null, defName3D);
		wb.editDefinesNames(null, defNameArea3D);

		AscCommonExcel.g_oLOOKUPCache.clean();

		// Positive Cases:
		// Case #1: Number, Array, Array. Bug 65722 - lookup value in large sorted array with mixed types
		oParser = new parserFormula('LOOKUP(20,{0,1,49.75,55.75,61.75,67.75,72.75,78.75,84.75,89.75,94.75,97.75},{"KP";"NB";4;3.7;3.3;3;2.7;2.3;2;1.7;1.3;1})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(20,{0,1,49.75,55.75,61.75,67.75,72.75,78.75,84.75,89.75,94.75,97.75},{"KP";"NB";4;3.7;3.3;3;2.7;2.3;2;1.7;1.3;1})');
		assert.strictEqual(oParser.calculate().getValue(), "NB", 'Result of LOOKUP(20,{0,1,49.75,55.75,61.75,67.75,72.75,78.75,84.75,89.75,94.75,97.75},{"KP";"NB";4;3.7;3.3;3;2.7;2.3;2;1.7;1.3;1})');

		// Case #2: Number, Array, Array. Lookup value in shorter sorted array
		oParser = new parserFormula('LOOKUP(20,{0,1,49.75,55.75},{"KP";"NB";4;3.7;3.3;3;2.7})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(20,{0,1,49.75,55.75},{"KP";"NB";4;3.7;3.3;3;2.7})');
		assert.strictEqual(oParser.calculate().getValue(), "NB", 'Result of LOOKUP(20,{0,1,49.75,55.75},{"KP";"NB";4;3.7;3.3;3;2.7})');

		// Case #3: Number, Array, Array. Lookup value in minimal sorted array
		oParser = new parserFormula('LOOKUP(20,{0,1,49.75},{"KP";"NB";4})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(20,{0,1,49.75},{"KP";"NB";4})');
		assert.strictEqual(oParser.calculate().getValue(), "NB", 'Result of LOOKUP(20,{0,1,49.75},{"KP";"NB";4})');

		// Case #4: Number, Array, Array. Lookup array shorter than result array
		oParser = new parserFormula('LOOKUP(20,{0,1},{"KP";"NB";4;3.7;3.3;3;2.7})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(20,{0,1},{"KP";"NB";4;3.7;3.3;3;2.7})');
		assert.strictEqual(oParser.calculate().getValue(), "NB", 'Result of LOOKUP(20,{0,1},{"KP";"NB";4;3.7;3.3;3;2.7})');

		// Case #5: String, Array. Bug 67640 - array mode lookup by first row, return from last row
		oParser = new parserFormula('LOOKUP("C",{"a","b","c","d";1,2,3,4})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP("C",{"a","b","c","d";1,2,3,4})');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Result of LOOKUP("C",{"a","b","c","d";1,2,3,4})');

		// Case #6: String, Array. Lookup string value greater than available, returns last match
		oParser = new parserFormula('LOOKUP("bump",{"a",1;"b",2;"c",3})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP("bump",{"a",1;"b",2;"c",3})');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Result of LOOKUP("bump",{"a",1;"b",2;"c",3})');

		// Case #7: Number, Array. Lookup in 2D array by first row, return from last row
		oParser = new parserFormula('LOOKUP(20,{0,1,2;3,4,5;11,12,13;14,15,16})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(20,{0,1,2;3,4,5;11,12,13;14,15,16})');
		assert.strictEqual(oParser.calculate().getValue(), 16, 'Result of LOOKUP(20,{0,1,2;3,4,5;11,12,13;14,15,16})');

		// Case #8: Number, Array. Array mode lookup by first column, return from last column
		oParser = new parserFormula('LOOKUP(20,{0,1;49.75,55.75;12,13})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(20,{0,1;49.75,55.75;12,13})');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of LOOKUP(20,{0,1;49.75,55.75;12,13})');

		// Case #9: Number, Array. Lookup by first column with mixed types, return string from last column
		oParser = new parserFormula('LOOKUP(20,{0,1;2,55.75;12,13;15,"ds"})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(20,{0,1;2,55.75;12,13;15,"ds"})');
		assert.strictEqual(oParser.calculate().getValue(), "ds", 'Result of LOOKUP(20,{0,1;2,55.75;12,13;15,"ds"})');

		// Case #10: Number, Array, Array. 2D lookup array with single row result array
		oParser = new parserFormula('LOOKUP(20,{0,1;1,1},{"KP","NB","sd"})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(20,{0,1;1,1},{"KP","NB","sd"})');
		assert.strictEqual(oParser.calculate().getValue(), "NB", 'Result of LOOKUP(20,{0,1;1,1},{"KP","NB","sd"})');

		// Case #11: Number, Array, Number. Bug 67743 - exact match found in 2D array
		oParser = new parserFormula('LOOKUP(10,{10,11,12;2,3,4},2)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(10,{10,11,12;2,3,4},2)');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Result of LOOKUP(10,{10,11,12;2,3,4},2)');

		// Case #12: Boolean, Array, Array. TRUE lookup in boolean array
		oParser = new parserFormula('LOOKUP(TRUE,{FALSE,TRUE},{0,1})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(TRUE,{FALSE,TRUE},{0,1})');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of LOOKUP(TRUE,{FALSE,TRUE},{0,1})');

		// Case #13: Boolean, Array, Array. TRUE lookup when only FALSE exists
		oParser = new parserFormula('LOOKUP(TRUE,{FALSE,FALSE},{1,2})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(TRUE,{FALSE,FALSE},{1,2})');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Result of LOOKUP(TRUE,{FALSE,FALSE},{1,2})');

		// Case #14: Number, Array, Array. Lookup with negative numbers in sorted array
		oParser = new parserFormula('LOOKUP(0,{-10,-5,0,5,10},{"A","B","C","D","E"})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(0,{-10,-5,0,5,10},{"A","B","C","D","E"})');
		assert.strictEqual(oParser.calculate().getValue(), "C", 'Result of LOOKUP(0,{-10,-5,0,5,10},{"A","B","C","D","E"})');

		// Case #15: Number, Array, Array. Lookup with decimal precision
		oParser = new parserFormula('LOOKUP(3.14159,{1.1,2.2,3.14,4.4},{10,20,30,40})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(3.14159,{1.1,2.2,3.14,4.4},{10,20,30,40})');
		assert.strictEqual(oParser.calculate().getValue(), 30, 'Result of LOOKUP(3.14159,{1.1,2.2,3.14,4.4},{10,20,30,40})');

		// Case #16: Number, Array, Array. Lookup with single element arrays
		oParser = new parserFormula('LOOKUP(5,{5},{"found"})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(5,{5},{"found"})');
		assert.strictEqual(oParser.calculate().getValue(), "found", 'Result of LOOKUP(5,{5},{"found"})');

		// Case #17: Number, Array, Array. Lookup with mixed numeric types (integers and decimals)
		oParser = new parserFormula('LOOKUP(2.5,{1,2,3,4},{100,200,300,400})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(2.5,{1,2,3,4},{100,200,300,400})');
		assert.strictEqual(oParser.calculate().getValue(), 200, 'Result of LOOKUP(2.5,{1,2,3,4},{100,200,300,400})');

		// Case #18: String, Array. Lookup in 2D array with strings by first column, return from last column
		oParser = new parserFormula('LOOKUP("M",{"A","apple";"M","mango";"Z","zebra"})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP("M",{"A","apple";"M","mango";"Z","zebra"})');
		assert.strictEqual(oParser.calculate().getValue(), "mango", 'Result of LOOKUP("M",{"A","apple";"M","mango";"Z","zebra"})');

		// Case #19: Number, Array, Array. Lookup with zero in array
		oParser = new parserFormula('LOOKUP(0,{-1,0,1},{"negative","zero","positive"})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(0,{-1,0,1},{"negative","zero","positive"})');
		assert.strictEqual(oParser.calculate().getValue(), "zero", 'Result of LOOKUP(0,{-1,0,1},{"negative","zero","positive"})');

		// Case #20: Number, Array, Array. Lookup with large numbers
		oParser = new parserFormula('LOOKUP(1000000,{100,1000,10000,100000,1000000},{1,2,3,4,5})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(1000000,{100,1000,10000,100000,1000000},{1,2,3,4,5})');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of LOOKUP(1000000,{100,1000,10000,100000,1000000},{1,2,3,4,5})');

		// Case #21: String, Array, Array. Lookup with special characters in strings
		oParser = new parserFormula('LOOKUP("@",{"!","#","@","$"},{1,2,3,4})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP("@",{"!","#","@","$"},{1,2,3,4})');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Result of LOOKUP("@",{"!","#","@","$"},{1,2,3,4})');

		// Case #22: Number, Array. Lookup in 3D-like array structure (multiple rows, single lookup)
		oParser = new parserFormula('LOOKUP(15,{5,10,15,20;100,200,300,400;1000,2000,3000,4000})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(15,{5,10,15,20;100,200,300,400;1000,2000,3000,4000})');
		assert.strictEqual(oParser.calculate().getValue(), 3000, 'Result of LOOKUP(15,{5,10,15,20;100,200,300,400;1000,2000,3000,4000})');

		// Case #23: Number, Array, Array. Lookup with fractional numbers in scientific notation
		oParser = new parserFormula('LOOKUP(0.001,{0.0001,0.001,0.01,0.1},{1,2,3,4})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(0.001,{0.0001,0.001,0.01,0.1},{1,2,3,4})');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Result of LOOKUP(0.001,{0.0001,0.001,0.01,0.1},{1,2,3,4})');

		// Case #24: Boolean, Array, Array. FALSE lookup in mixed boolean array
		oParser = new parserFormula('LOOKUP(FALSE,{FALSE,TRUE,TRUE},{10,20,30})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(FALSE,{FALSE,TRUE,TRUE},{10,20,30})');
		assert.strictEqual(oParser.calculate().getValue(), 10, 'Result of LOOKUP(FALSE,{FALSE,TRUE,TRUE},{10,20,30})');

		// Case #25: String, Array, Array. Lookup with empty string in array
		oParser = new parserFormula('LOOKUP("",{"","a","b"},{"empty","first","second"})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP("",{"","a","b"},{"empty","first","second"})');
		assert.strictEqual(oParser.calculate().getValue(), "empty", 'Result of LOOKUP("",{"","a","b"},{"empty","first","second"})');

		// Case #26: Number, Array, Array. Lookup with mismatched array sizes
		oParser = new parserFormula('LOOKUP(2,{1,2,3},{10,20})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(2,{1,2,3},{10,20})');
		assert.strictEqual(oParser.calculate().getValue(), 20, 'Result of LOOKUP(2,{1,2,3},{10,20})');

		// Case #27: Number, Array, Array. Unsorted lookup array
		oParser = new parserFormula('LOOKUP(3,{5,1,3,2},{50,10,30,20})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(3,{5,1,3,2},{50,10,30,20})');
		assert.strictEqual(oParser.calculate().getValue(), 30, 'Result of LOOKUP(3,{5,1,3,2},{50,10,30,20})');

		// Case #28: Number, Array, Array. Lookup with error values in lookup array
		oParser = new parserFormula('LOOKUP(2,{1,#DIV/0!,3},{10,20,30})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(2,{1,#DIV/0!,3},{10,20,30})');
		assert.strictEqual(oParser.calculate().getValue(), 10, 'Result of LOOKUP(2,{1,#DIV/0!,3},{10,20,30})');

		// Case #29: Number, Array, Array. Lookup with very large array where value not found, returns last match
		oParser = new parserFormula('LOOKUP(999,{1,2,3,4,5,6,7,8,9,10,11,12,13,14,15},{10,20,30,40,50,60,70,80,90,100,110,120,130,140,150})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(999,{1,2,3,4,5,6,7,8,9,10,11,12,13,14,15},{10,20,30,40,50,60,70,80,90,100,110,120,130,140,150})');
		assert.strictEqual(oParser.calculate().getValue(), 150, 'Result of LOOKUP(999,{1,2,3,4,5,6,7,8,9,10,11,12,13,14,15},{10,20,30,40,50,60,70,80,90,100,110,120,130,140,150})');

		// Case #30: Number, Array, Array. Lookup with duplicate values in lookup array, returns last match
		oParser = new parserFormula('LOOKUP(2,{1,2,2,3},{10,20,25,30})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(2,{1,2,2,3},{10,20,25,30})');
		assert.strictEqual(oParser.calculate().getValue(), 25, 'Result of LOOKUP(2,{1,2,2,3},{10,20,25,30})');

		// Case #31: Number, Array. Lookup in single-element array smaller than lookup value
		oParser = new parserFormula('LOOKUP(10,{5})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(10,{5})');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of LOOKUP(10,{5})');

		// Case #32: Number, Area, Area. Lookup decimal value in sorted numeric Area
		oParser = new parserFormula("LOOKUP(4.19, A1000:A1004, B1000:B1004)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "orange");

		// Case #33: Number, Area, Area. Lookup value between sorted decimals, returns closest match
		oParser = new parserFormula("LOOKUP(5.75, A1000:A1004, B1000:B1004)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), "yellow");

		// Case #34: Number, Area, Area. Lookup value greater than max, returns last match
		oParser = new parserFormula("LOOKUP(7.66, A1000:A1004, B1000:B1004)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), "blue");

		// Case #35: Number, Area, Area. Horizontal lookup in sorted Area
		oParser = new parserFormula("LOOKUP(4.19,C1020:H1020,C1021:H1021)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), "orange");

		// Case #36: Number, Area, Area. Horizontal lookup with approximate match
		oParser = new parserFormula("LOOKUP(5.75,C1020:H1020,C1021:H1021)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), "yellow");

		// Case #37: Number, Area, Area. Horizontal lookup greater than max value
		oParser = new parserFormula("LOOKUP(7.66,C1020:H1020,C1021:H1021)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), "blue");

		// Case #38: Number, Area, Area. Exact match in horizontal Area
		oParser = new parserFormula("LOOKUP(5.17,C1020:H1020,C1021:H1021)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), "yellow");

		// Case #39: Number, Area, Area. Lookup value greater than all in horizontal Area
		oParser = new parserFormula("LOOKUP(9,C1020:H1020,C1021:H1021)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), "black");

		// Case #40: Number, Area, Area. Exact match with integer value
		oParser = new parserFormula("LOOKUP(1,A1041:A1044,B1041:B1044)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), "a");

		// Case #41: Area, Area, Area. Single cell range lookup
		oParser = new parserFormula("LOOKUP(A1041:A1041,A1041:A1044,B1041:B1044)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(A1041:A1041,A1041:A1044,B1041:B1044)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue().getValue(), "a", "Result of LOOKUP(A1041:A1041,A1041:A1044,B1041:B1044)");

		// Case #42: Area, Area, Boolean. Single cell range with boolean result
		oParser = new parserFormula("LOOKUP(A1041:A1041,A1041:A1044,TRUE)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(A1041:A1041,A1041:A1044,TRUE)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "TRUE", "Result of LOOKUP(A1041:A1041,A1041:A1044,TRUE)");

		// Case #43: Area, Area, Number. Single cell range with numeric result
		oParser = new parserFormula("LOOKUP(A1041:A1041,A1041:A1044,1)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(A1041:A1041,A1041:A1044,1)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), 1, "Result of LOOKUP(A1041:A1041,A1041:A1044,1)");

		// Case #44: Area, Area, Area. Single cell ranges with matching positions
		oParser = new parserFormula("LOOKUP(A1041:A1041,A1041:A1044,A1041:A1041)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(A1041:A1041,A1041:A1044,A1041:A1041)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), 1, "Result of LOOKUP(A1041:A1041,A1041:A1044,A1041:A1041)");

		// Case #45: Area, Area, Area. Single cell ranges with empty result
		oParser = new parserFormula("LOOKUP(A1041:A1041,A1041:A1044,A1042:A1042)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(A1041:A1041,A1041:A1044,A1042:A1042)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "", "Result of LOOKUP(A1041:A1041,A1041:A1044,A1042:A1042)");

		// Case #46: Area, Area, Area. Single cell ranges with numeric result
		oParser = new parserFormula("LOOKUP(A1041:A1041,A1041:A1044,A1043:A1043)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(A1041:A1041,A1041:A1044,A1043:A1043)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), 3, "Result of LOOKUP(A1041:A1041,A1041:A1044,A1043:A1043)");

		// Case #47: Ref, Area, Area. Single cell lookup with range result
		oParser = new parserFormula("LOOKUP(A1041,A1041:A1044,A1041)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(1,A1041:A1044,1)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), 1, "Result of LOOKUP(1,A1041:A1044,1)");

		// Case #48: Array, Area, Area. Array lookup returning multiple results
		oParser = new parserFormula("LOOKUP({2,13,14,15},A1041:A1044,B1041:B1044)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP({2,13,14,15},A1041:A1044,B1041:B1044)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue().getValue(), "a", "Result of LOOKUP({2,13,14,15},A1041:A1044,B1041:B1044)");
		assert.strictEqual(array.getElementRowCol(0,1).getValue().getValue(), "d", "Result of LOOKUP({2,13,14,15},A1041:A1044,B1041:B1044)");
		assert.strictEqual(array.getElementRowCol(0,2).getValue().getValue(), "d", "Result of LOOKUP({2,13,14,15},A1041:A1044,B1041:B1044)");
		assert.strictEqual(array.getElementRowCol(0,3).getValue().getValue(), "d", "Result of LOOKUP({2,13,14,15},A1041:A1044,B1041:B1044)");

		// Case #49: Array, Area, Area. Array lookup with exact matches
		oParser = new parserFormula("LOOKUP({3,13,14,15},A1041:A1044,B1041:B1044)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP({3,13,14,15},A1041:A1044,B1041:B1044)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue().getValue(), "d", "Result of LOOKUP({3,13,14,15},A1041:A1044,B1041:B1044)");
		assert.strictEqual(array.getElementRowCol(0,1).getValue().getValue(), "d", "Result of LOOKUP({3,13,14,15},A1041:A1044,B1041:B1044)");
		assert.strictEqual(array.getElementRowCol(0,2).getValue().getValue(), "d", "Result of LOOKUP({3,13,14,15},A1041:A1044,B1041:B1044)");
		assert.strictEqual(array.getElementRowCol(0,3).getValue().getValue(), "d", "Result of LOOKUP({3,13,14,15},A1041:A1044,B1041:B1044)");

		// Case #50: Array, Area, Area. Array lookup with values greater than max
		oParser = new parserFormula("LOOKUP({12,13,14,15},A1041:A1044,B1041:B1044)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP({12,13,14,15},A1041:A1044,B1041:B1044)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue().getValue(), "d", "Result of LOOKUP({12,13,14,15},A1041:A1044,B1041:B1044)");
		assert.strictEqual(array.getElementRowCol(0,1).getValue().getValue(), "d", "Result of LOOKUP({12,13,14,15},A1041:A1044,B1041:B1044)");
		assert.strictEqual(array.getElementRowCol(0,2).getValue().getValue(), "d", "Result of LOOKUP({12,13,14,15},A1041:A1044,B1041:B1044)");
		assert.strictEqual(array.getElementRowCol(0,3).getValue().getValue(), "d", "Result of LOOKUP({12,13,14,15},A1041:A1044,B1041:B1044)");

		// Case #51: Array, Area, Area. Array lookup with zero value
		oParser = new parserFormula("LOOKUP({0},A1040:A1044,A1040:A1044)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP({0},A1040:A1044,A1040:A1044)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue().getValue(), 0, "Result of LOOKUP({0},A1040:A1044,A1040:A1044)");

		// Case #52: Array, Array, Array. Array lookup with exact match
		oParser = new parserFormula("LOOKUP({2},{0,1,2,3,4},{10,11,12,13,14})", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP({2},{0,1,2,3,4},{10,11,12,13,14})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 12, "Result of LOOKUP({2},{0,1,2,3,4},{10,11,12,13,14})");

		// Case #53: Number, Area, Area. Lookup with extended range
		oParser = new parserFormula("LOOKUP(3,A1041:A1045,B1041:B1045)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(3,A1041:A1045,B1041:B1045)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), "e", "Result of LOOKUP(3,A1041:A1045,B1041:B1045)");

		// Case #54: Ref, Area, Area. Range reference lookup
		oParser = new parserFormula("LOOKUP(A1043,A1041:A1045,B1041:B1045)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(A1043,A1041:A1045,B1041:B1045)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), "e", "Result of LOOKUP(3,A1041:A1045,B1041:B1045)");

		// Case #55: Boolean, Area, Area. TRUE lookup in mixed range
		oParser = new parserFormula("LOOKUP(TRUE,A1041:A1047,B1041:B1047)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(TRUE,A1041:A1047,B1041:B1047)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), "f", "Result of LOOKUP(TRUE,A1041:A1047,B1041:B1047)");

		// Case #56: Ref, Area, Area. Range reference with TRUE value
		oParser = new parserFormula("LOOKUP(A1046,A1041:A1047,B1041:B1047)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(TRUE,A1041:A1047,B1041:B1047)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), "f", "Result of LOOKUP(TRUE,A1041:A1047,B1041:B1047)");

		// Case #57: Boolean, Area, Area. TRUE lookup in different range
		oParser = new parserFormula("LOOKUP(TRUE,G1070:G1076,H1070:H1076)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(TRUE,G1070:G1076,H1070:H1076)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), "f", "Result of LOOKUP(TRUE,G1070:G1076,H1070:H1076)");

		// Case #58: Ref, Area, Area. Range reference with TRUE in different location
		oParser = new parserFormula("LOOKUP(G1075,G1070:G1076,H1070:H1076)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(TRUE,G1070:G1076,H1070:H1076)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), "f", "Result of LOOKUP(TRUE,G1070:G1076,H1070:H1076)");

		// Case #59: Number, Area, Area. Lookup in sparse range with empty cells
		oParser = new parserFormula("LOOKUP(3,C1090:K1090,C1091:K1091)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), "a");

		// Case #60: Number, Area, Area. Lookup exact match in sparse range
		oParser = new parserFormula("LOOKUP(2,C1090:K1090,C1091:K1091)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), "a");

		// Case #61: Number, Area, Area. Lookup max value in sparse range
		oParser = new parserFormula("LOOKUP(7,C1090:K1090,C1091:K1091)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), "i");

		// Case #62: Number, Area, Area. Lookup value greater than max in sparse range
		oParser = new parserFormula("LOOKUP(10,C1090:K1090,C1091:K1091)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue().getValue(), "i");

		// Case #63: Number, Area. 2D range lookup by first row, return from last row
		oParser = new parserFormula("LOOKUP(3,A1110:E1112)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(3,A1110:E1112)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), 9, "Result of LOOKUP(3,A1110:E1112)");

		// Case #64: Ref, Area. Range reference in 2D lookup
		oParser = new parserFormula("LOOKUP(A1112,A1110:E1112)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(A1112,A1110:E1112)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), 9, "Result of LOOKUP(3,A1110:E1112)");

		// Case #65: Number, Area. Lookup value greater than available in 2D range
		oParser = new parserFormula("LOOKUP(6,A1110:E1112)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(6,A1110:E1112)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), 14, "Result of LOOKUP(6,A1110:E1112)");

		// Case #66: Number, Area. 2D range lookup by first column, return from last column
		oParser = new parserFormula("LOOKUP(2,A1110:C1114)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(2,A1110:C1114)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), 6, "Result of LOOKUP(2,A1110:C1114)");

		// Case #67: Ref, Area. Range reference in 2D column lookup
		oParser = new parserFormula("LOOKUP(B1110,A1110:C1114)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(B1110,A1110:C1114)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), 6, "Result of LOOKUP(2,A1110:C1114)");

		// Case #68: Number, Area. Lookup value greater than max in 2D column range
		oParser = new parserFormula("LOOKUP(6,A1110:C1114)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(6,A1110:C1114)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), 16, "Result of LOOKUP(6,A1110:C1114)");

		// Case #69: Number, Area. 2D range lookup with wider result area
		oParser = new parserFormula("LOOKUP(2,A1110:E1114)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(2,A1110:E1114)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), 10, "Result of LOOKUP(2,A1110:E1114)");

		// Case #70: Number, Area. Another 2D range lookup with wider result area
		oParser = new parserFormula("LOOKUP(3,A1110:E1114)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(3,A1110:E1114)");
		assert.strictEqual(oParser.calculate().getValue().getValue(), 14, "Result of LOOKUP(3,A1110:E1114)");

		// Case #71: Number, Array, Area. Array lookup with horizontal range result
		oParser = new parserFormula("LOOKUP(1,{1,0,0,1},A1130:D1130)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(1,{1,0,0,1},A1130:D1130)");
		assert.strictEqual(oParser.calculate().getValue(), "d", "Result of LOOKUP(1,{1,0,0,1},A1130:D1130)");

		// Case #72: Number, Array, Area. Array lookup with vertical array and horizontal range
		oParser = new parserFormula("LOOKUP(1,{1;0;0;1},A1130:D1130)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(1,{1;0;0;1},A1130:D1130)");
		assert.strictEqual(oParser.calculate().getValue(), "d", "Result of LOOKUP(1,{1;0;0;1},A1130:D1130)");

		// Case #73: Number, Array, Area. Array lookup with vertical range result
		oParser = new parserFormula("LOOKUP(1,{1;0;0;1},A1130:A1133)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(1,{1;0;0;1},A1130:A1133)");
		assert.strictEqual(oParser.calculate().getValue(), "d", "Result of LOOKUP(1,{1;0;0;1},A1130:A1133)");

		// Case #74: Number, Array, Area. Array lookup with horizontal array and vertical range
		oParser = new parserFormula("LOOKUP(1,{1,0,0,1},A1130:A1133)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(1,{1,0,0,1},A1130:A1133)");
		assert.strictEqual(oParser.calculate().getValue(), "d", "Result of LOOKUP(1,{1,0,0,1},A1130:A1133)");

		// Case #75: Number, Area, Area. Lookup with error values in range
		oParser = new parserFormula("LOOKUP(1,A1150:A1156,B1150:B1156)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(1,A1150:A1156,B1150:B1156)");
		oParser.setArrayFormulaRef(ws.getRange2("A2").bbox);
		assert.strictEqual(oParser.calculate().getValue().getValue(), 2, "Result of LOOKUP(1,A1150:A1156,B1150:B1156)");

		// Case #76: Number, Area, Area. Lookup in range with first and last value test
		oParser = new parserFormula("LOOKUP(3,C1150:C1156,B1150:B1156)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(3,C1150:C1156,B1150:B1156) - first and last value test");
		oParser.setArrayFormulaRef(ws.getRange2("A2").bbox);
		assert.strictEqual(oParser.calculate().getValue().getValue(), 4, "Result of LOOKUP(3,C1150:C1156,B1150:B1156)");

		// Case #77: String, String, Array. Single value lookup with array result
		oParser = new parserFormula('LOOKUP("b","a",{1,2,3,4,5})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP("b","a",{1,2,3,4,5})');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of LOOKUP("b","a",{1,2,3,4,5})');

		// Case #78: String, String, Number. Single value lookup with numeric result
		oParser = new parserFormula('LOOKUP("b","a",-1)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP("b","a",-1)');
		assert.strictEqual(oParser.calculate().getValue(), -1, 'Result of LOOKUP("b","a",-1)');

		// Case #79: Boolean, Boolean, Boolean. Boolean lookup with boolean result
		oParser = new parserFormula('LOOKUP(FALSE,FALSE,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(FALSE,FALSE,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), "TRUE", 'Result of LOOKUP(FALSE,FALSE,TRUE)');

		// Case #80: Boolean, Boolean, String. Boolean lookup with string result
		oParser = new parserFormula('LOOKUP(TRUE,FALSE,"a")', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(TRUE,FALSE,"a")');
		assert.strictEqual(oParser.calculate().getValue(), "a", 'Result of LOOKUP(TRUE,FALSE,"a")');

		// Case #81: Number, Number, String. Numeric lookup with single value and string result
		oParser = new parserFormula('LOOKUP(3,1,"a")', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(3,1,"a")');
		assert.strictEqual(oParser.calculate().getValue(), "a", 'Result of LOOKUP(3,1,"a")');

		// Case #82: Number, Number, String. Exact match numeric lookup
		oParser = new parserFormula('LOOKUP(3,3,"a")', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(3,3,"a")');
		assert.strictEqual(oParser.calculate().getValue(), "a", 'Result of LOOKUP(3,3,"a")');

		// Case #83: Empty, Formula, Area. Bug 65306 - lookup with empty value and CODE function
		ws.getRange2("N1160").setValue("янв");
		ws.getRange2("O1160").setValue("0")
		oParser = new parserFormula("LOOKUP(,-CODE(N1160:O1160),N1160:O1160)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(,-CODE(N1160:O1160),N1160:O1160)");
		assert.strictEqual(oParser.calculate().getValue(), 0, "Result of LOOKUP(,-CODE(N1160:O1160),N1160:O1160)");

		// Case #84: Number, Area, Area. Bug 62730 - lookup with range arithmetic in lookup array
		oParser = new parserFormula('LOOKUP(1,A1180:A1190+A1180:A1190,B1180:B1190)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(1,A1180:A1190+A1180:A1190,B1180:B1190)');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Result of LOOKUP(1,A1180:A1190+A1180:A1190,B1180:B1190)');

		// Case #85: Number, Area, Area. Bug 62730 - lookup with range arithmetic, different value
		oParser = new parserFormula('LOOKUP(2,A1180:A1190+A1180:A1190,B1180:B1190)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(2,A1180:A1190+A1180:A1190,B1180:B1190)');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of LOOKUP(2,A1180:A1190+A1180:A1190,B1180:B1190)');

		// Case #86: Number, Area, Area. Bug 62730 - lookup with arithmetic in both ranges
		oParser = new parserFormula('LOOKUP(1,A1180:A1190+A1180:A1190,B1180:B1190+B1180:B1190)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(1,A1180:A1190+A1180:A1190,B1180:B1190+B1180:B1190)');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Result of LOOKUP(1,A1180:A1190+A1180:A1190,B1180:B1190+B1180:B1190)');

		// Case #87: Number, Area, Area. Bug 62730 - lookup with arithmetic and compatible range sizes
		oParser = new parserFormula('LOOKUP(1,A1180:A1190+A1180:A1190,B1180:B1187+B1180:B1185)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(1,A1180:A1190+A1180:A1190,B1180:B1187+B1180:B1185)');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Result of LOOKUP(1,A1180:A1190+A1180:A1190,B1180:B1187+B1180:B1185)');

		// Case #88: Number, Area, Array. Bug 67743 - lookup with range arithmetic and array result
		oParser = new parserFormula('LOOKUP(3,A1200:A1202+{1},{1})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(3,A1200:A1202+{1},{1})');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of LOOKUP(3,A1200:A1202+{1},{1})');

		// Case #89: Number, Area, Array. Lookup with range and array result
		oParser = new parserFormula('LOOKUP(5,A1200:A1202,{1,2})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(5,A1200:A1202,{1,2})');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Result of LOOKUP(5,A1200:A1202,{1,2})');

		// Case #90: Number, Area, Area. Lookup with range arithmetic and range result
		oParser = new parserFormula('LOOKUP(5,A1200:A1202+{1},A1200:A1201)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(5,A1200:A1202+{1},A1200:A1201)');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Result of LOOKUP(5,A1200:A1202+{1},A1200:A1201)');

		// Case #91: Number, Area, Area. Lookup with range arithmetic and horizontal result
		oParser = new parserFormula('LOOKUP(5,A1200:A1202+{1},A1200:D1200)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(5,A1200:A1202+{1},A1200:D1200)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of LOOKUP(5,A1200:A1202+{1},A1200:D1200)');

		// Case #92: Ref3D, Area, Area. Bug 69527 - lookup with sheet reference in lookup value
		oParser = new parserFormula('LOOKUP(' + currentSheet + '!E1210,A1210:A1220,B1210:B1220)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(' + currentSheet + '!E1210,A1210:A1220,B1210:B1220)');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 55, 'Result of LOOKUP(' + currentSheet + '!E1210,A1210:A1220,B1210:B1220)');

		// Case #93: Ref, Ref3D, Area. Bug 69527 - lookup with sheet reference in lookup array
		oParser = new parserFormula('LOOKUP(E1210,' + currentSheet + '!A1215,B1210:B1220)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(E1210,' + currentSheet + '!A1215,B1210:B1220)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of LOOKUP(E1210,' + currentSheet + '!A1215,B1210:B1220)');

		// Case #94: Ref, Area, Ref3D. Bug 69527 - lookup with sheet reference in result array
		oParser = new parserFormula('LOOKUP(E1210,A1210:A1220,' + currentSheet + '!A1215)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(E1210,A1210:A1220,' + currentSheet + '!A1215)');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 3, 'Result of LOOKUP(E1210,A1210:A1220,' + currentSheet + '!A1215)');

		// Case #95: Number, Area. 2D range lookup with mixed data types
		oParser = new parserFormula('LOOKUP(2.3,A1300:B1322)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(2.3,A1300:B1322)');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 3, 'Result of LOOKUP(2.3,A1300:B1322)');

		// Case #96: String, Area. String lookup in 2D range with mixed types
		oParser = new parserFormula('LOOKUP("CIANO",A1300:B1322)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP("CIANO",A1300:B1322)');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 18, 'Result of LOOKUP("CIANO",A1300:B1322)');

		// Case #97: Boolean, Area. FALSE lookup in 2D range with mixed types
		oParser = new parserFormula('LOOKUP(FALSE,A1300:B1322)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(FALSE,A1300:B1322)');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 22, 'Result of LOOKUP(FALSE,A1300:B1322)');

		// Case #98: Boolean, Area3D. FALSE lookup in 2D range with mixed types
		oParser = new parserFormula('LOOKUP(FALSE,' + currentSheet + '!A1300:B1322)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(FALSE,' + currentSheet + '!A1300:B1322)');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 22, 'Result of LOOKUP(FALSE,' + currentSheet + '!A1300:B1322)');

		// Case #99: Boolean, Name3D. FALSE lookup in 3D Named range with mixed types
		oParser = new parserFormula('LOOKUP(FALSE,LOOKUPTestNameArea3D)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(FALSE,LOOKUPTestNameArea3D)');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 22, 'Result of LOOKUP(FALSE,LOOKUPTestNameArea3D)');

		// Case #100: Name3D, Name3D. lookup Name in 3DNameArea with mixed types
		oParser = new parserFormula('LOOKUP(LOOKUPTestName3D,LOOKUPTestNameArea3D)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(LOOKUPTestName3D,LOOKUPTestNameArea3D)');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 17, 'Result of LOOKUP(LOOKUPTestName3D,LOOKUPTestNameArea3D)');

		// Case #101: Ref3D, Name3D. lookup Name in 3DNameArea with mixed types
		oParser = new parserFormula('LOOKUP(' + currentSheet + '!$A$1323,LOOKUPTestNameArea3D)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(' + currentSheet + '!$A$1323,LOOKUPTestNameArea3D)');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 17, 'Result of LOOKUP(LOOKUP(' + currentSheet + '!$A$1323,LOOKUPTestNameArea3D))');

		// Case #102: Formula, Name3D. lookup Name in 3DNameArea with mixed types
		oParser = new parserFormula('LOOKUP(1+1,LOOKUPTestNameArea3D)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(1+1,LOOKUPTestNameArea3D))');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 2, 'Result of LOOKUP(1+1,LOOKUPTestNameArea3D)');

		// Case #103: Formula, Name3D. lookup Name in 3DNameArea with mixed types
		oParser = new parserFormula('LOOKUP(ABS(2),LOOKUPTestNameArea3D)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(ABS(2),LOOKUPTestNameArea3D))');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 2, 'Result of LOOKUP(ABS(2),LOOKUPTestNameArea3D)');

		// Negative Cases:
		// Case #1: Number, Array, Array. Result array shorter than lookup array, returns #N/A
		oParser = new parserFormula('LOOKUP(50,{0,1,2,3,49.75,55.75},{"KP";"NB"})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(50,{0,1,2,3,49.75,55.75},{"KP";"NB"})');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(50,{0,1,2,3,49.75,55.75},{"KP";"NB"})');

		// Case #2: Number, Number, Array. Single value lookup with 2D result array, returns #N/A
		oParser = new parserFormula('LOOKUP(1,1,{"KP","NB";1,2})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(1,1,{"KP","NB";1,2})');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(1,1,{"KP","NB";1,2})');

		// Case #3: Number, Array, Array. 1D lookup array with 2D result array, returns #N/A
		oParser = new parserFormula('LOOKUP(20,{0,1,49.75,55.75},{"KP","NB";1,2})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(20,{0,1,49.75,55.75},{"KP","NB";1,2})');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(20,{0,1,49.75,55.75},{"KP","NB";1,2})');

		// Case #4: Number, Array, Array. 2D lookup array with 2D result array, returns #N/A
		oParser = new parserFormula('LOOKUP(2,{1,2;1,2},{"KP","NB";1,2})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(2,{1,2;1,2},{"KP","NB";1,2})');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(2,{1,2;1,2},{"KP","NB";1,2})');

		// Case #5: Number, Array, Array. Single row lookup array with 2D result array, returns #N/A
		oParser = new parserFormula('LOOKUP(20,{-1,20},{"KP","NB";"sd","sf"})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(20,{-1,20},{"KP","NB";"sd","sf"})');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(20,{-1,20},{"KP","NB";"sd","sf"})');

		// Case #6: Number, Array, Array. 2D lookup array with 2D result array, returns #N/A
		oParser = new parserFormula('LOOKUP(20,{0,1;1,1},{"KP","NB";"sd","sf"})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(20,{0,1;1,1},{"KP","NB";"sd","sf"})');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(20,{0,1;1,1},{"KP","NB";"sd","sf"})');

		// Case #7: Number, Array, Number. Bug 67743 - no exact match in 2D array, returns #N/A
		oParser = new parserFormula('LOOKUP(11,{10,11,12;2,3,4},2)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(11,{10,11,12;2,3,4},2)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(11,{10,11,12;2,3,4},2)');

		// Case #8: Number, Array, Array. Lookup value smaller than minimum in array, returns #N/A
		oParser = new parserFormula('LOOKUP(-5,{0,1,2,3},{10,20,30,40})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(-5,{0,1,2,3},{10,20,30,40})');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(-5,{0,1,2,3},{10,20,30,40})');

		// Case #9: String, Array, Array. String lookup smaller than minimum, returns #N/A
		oParser = new parserFormula('LOOKUP("A",{"B","C","D"},{"second","third","fourth"})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP("A",{"B","C","D"},{"second","third","fourth"})');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP("A",{"B","C","D"},{"second","third","fourth"})');

		// Case #10: Number, Array, Array. Lookup with error values in result array, returns error
		oParser = new parserFormula('LOOKUP(2,{1,2,3},{10,#VALUE!,30})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(2,{1,2,3},{10,#VALUE!,30})');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of LOOKUP(2,{1,2,3},{10,#VALUE!,30})');

		// Case #11: Number, Array, Array. Lookup with mismatched array sizes, index beyond result array, returns #N/A
		oParser = new parserFormula('LOOKUP(5,{1,2,3},{10,20})', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(5,{1,2,3},{10,20})');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(5,{1,2,3},{10,20})');

		// Case #12: Number, Area, Area. Lookup value smaller than minimum, returns #N/A
		oParser = new parserFormula("LOOKUP(0, A1000:A1004, B1000:B1004)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #13: Number, Area, Area. Horizontal lookup value smaller than minimum, returns #N/A
		oParser = new parserFormula("LOOKUP(0,C1020:H1020,C1021:H1021)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #14: Empty, Area, Area. Empty lookup value in range, returns #N/A
		oParser = new parserFormula("LOOKUP(,A1041:A1044,B1041:B1044)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #15: Area, Area, Area. Multi-cell range as lookup value, returns #VALUE!
		oParser = new parserFormula("LOOKUP(A1041:A1042,A1041:A1044,B1041:B1044)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(A1041:A1042,A1041:A1044,B1041:B1044)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of LOOKUP(A1041:A1042,A1041:A1044,B1041:B1044)");

		// Case #16: Area, Area, String. Range lookup with undefined variable, returns #NAME?
		oParser = new parserFormula("LOOKUP(A1041:A1041,A1041:A1044,a)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(A1041:A1041,A1041:A1044,a)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#NAME?", "Result of LOOKUP(A1041:A1041,A1041:A1044,a)");

		// Case #17: Ref, Area, Empty. Range lookup with empty result parameter, returns #VALUE!
		oParser = new parserFormula("LOOKUP(A1041,A1041:A1044,)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(1,A1041:A1044,)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of LOOKUP(1,A1041:A1044,)");

		// Case #18: Ref, Ref, Empty. Single cell lookup with empty result parameter, returns #VALUE!
		oParser = new parserFormula("LOOKUP(A1041,A1041,)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(1,A1041,)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of LOOKUP(1,A1041,)");

		// Case #19: Ref, Ref, Empty. Different single cell lookup with empty result parameter, returns #VALUE!
		oParser = new parserFormula("LOOKUP(A1041,A1044,)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(1,A1044,)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of LOOKUP(1,A1044,)");

		// Case #20: Boolean, Area, Area. FALSE lookup in mixed range, returns #N/A
		oParser = new parserFormula("LOOKUP(FALSE,A1041:A1047,B1041:B1047)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(FALSE,A1041:A1047,B1041:B1047)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of LOOKUP(FALSE,A1041:A1047,B1041:B1047)");

		// Case #21: Ref, Area, Area. Range reference with FALSE value, returns #N/A
		oParser = new parserFormula("LOOKUP(A1047,A1041:A1047,B1041:B1047)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(FALSE,A1041:A1047,B1041:B1047)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of LOOKUP(FALSE,A1041:A1047,B1041:B1047)");

		// Case #22: Boolean, Area, Area. FALSE lookup in different range, returns #N/A
		oParser = new parserFormula("LOOKUP(FALSE,G1070:G1076,H1070:H1076)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(FALSE,G1070:G1076,H1070:H1076)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of LOOKUP(FALSE,G1070:G1076,H1070:H1076)");

		// Case #23: Ref, Area, Area. Range reference with FALSE in different location, returns #N/A
		oParser = new parserFormula("LOOKUP(G1076,G1070:G1076,H1070:H1076)", "A2", ws);
		assert.ok(oParser.parse(), "LOOKUP(FALSE,G1070:G1076,H1070:H1076)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of LOOKUP(FALSE,G1070:G1076,H1070:H1076)");

		// Case #24: Number, Area, Area. Lookup value smaller than minimum in sparse range, returns #N/A
		oParser = new parserFormula("LOOKUP(1,C1090:K1090,C1091:K1091)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #25: Number, Area, Area. Bug 62730 - lookup with arithmetic and incompatible range sizes, returns #N/A
		oParser = new parserFormula('LOOKUP(1,A1180:A1190+A1180:A1190,B1180:B1187+B1180:B1181)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(1,A1180:A1190+A1180:A1190,B1180:B1187+B1180:B1181)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(1,A1180:A1190+A1180:A1190,B1180:B1187+B1180:B1181)');

		// Case #26: Number, Area, Area. Bug 67743 - lookup with range arithmetic and incompatible result range, returns #N/A
		oParser = new parserFormula('LOOKUP(5,A1200:A1202+{1},A1200:D1201)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(5,A1200:A1202+{1},A1200:D1201)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(5,A1200:A1202+{1},A1200:D1201)');

		// Case #27: Number, Number, String. Lookup value greater than single lookup value, returns #VALUE!
		oParser = new parserFormula('LOOKUP(3,4,"a")', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(3,4,"a")');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of LOOKUP(3,4,"a")');

		// Case #28: Number, String, Number. Lookup with string in lookup array, returns #VALUE!
		oParser = new parserFormula('LOOKUP(3,"a",1)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(3,"a",1)');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of LOOKUP(3,"a",1)');

		// Case #29: Number, Area. Lookup value smaller than minimum in 2D range, returns #N/A
		oParser = new parserFormula('LOOKUP(-1,A1300:B1322)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(-1,A1300:B1322)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(-1,A1300:B1322)');

		// Case #30: Error, Area. Error value lookup in 2D range, returns #N/A
		oParser = new parserFormula('LOOKUP(#N/A,A1300:B1322)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP(#N/A,A1300:B1322)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(#N/A,A1300:B1322)');

		// Case #31: String, Area. 2D range lookup number as string
		oParser = new parserFormula('LOOKUP("2.3",A1300:B1322)', "A2", ws);
		assert.ok(oParser.parse(), 'LOOKUP("2.3",A1300:B1322)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of LOOKUP(2.3,A1300:B1322)');

		wb.delDefinesNames(defName3D);
		wb.delDefinesNames(defNameArea3D);

	});


	QUnit.test("Test: \"MATCH\"", function (assert) {

		AscCommonExcel.bIsSupportDynamicArrays = false;

		ws.getRange2("A551").setValue("28");
		ws.getRange2("A552").setValue("29");
		ws.getRange2("A553").setValue("31");
		ws.getRange2("A554").setValue("45");
		ws.getRange2("A555").setValue("89");

		ws.getRange2("B551").setValue("89");
		ws.getRange2("B552").setValue("45");
		ws.getRange2("B553").setValue("31");
		ws.getRange2("B554").setValue("29");
		ws.getRange2("B555").setValue("28");

		ws.getRange2("C551").setValue("89");
		ws.getRange2("C552").setValue("45");
		ws.getRange2("C553").setValue("31");
		ws.getRange2("C554").setValue("29");
		ws.getRange2("C555").setValue("28");

		oParser = new parserFormula("MATCH(30,A551:A555,-1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "MATCH_1");

		oParser = new parserFormula("MATCH(30,A551:A555,1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2, "MATCH_2");

		oParser = new parserFormula("MATCH(30,A551:A555,0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "MATCH_3");

		oParser = new parserFormula("MATCH(30,B551:B555)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "MATCH_4");

		oParser = new parserFormula("MATCH(30,B551:B555,-1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 3, "MATCH_5");

		oParser = new parserFormula("MATCH(30,B551:B555,0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "MATCH_6");

		oParser = new parserFormula("MATCH(31,C551:C555,0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 3, "MATCH_7");

		oParser = new parserFormula("MATCH(\"b\",{\"a\";\"b\";\"c\"},0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2, "MATCH_8");

		ws.getRange2("F3").setValue("");

		ws.getRange2("F106").setValue("1");
		ws.getRange2("F107").setValue("");
		ws.getRange2("F108").setValue("");
		ws.getRange2("F109").setValue("");
		ws.getRange2("F110").setValue("2");
		ws.getRange2("F111").setValue("123");
		ws.getRange2("F112").setValue("4");
		ws.getRange2("F113").setValue("5");
		ws.getRange2("F114").setValue("6");
		ws.getRange2("F115").setValue("0");
		ws.getRange2("F116").setValue("");
		ws.getRange2("F117").setValue("0");

		oParser = new parserFormula("MATCH(F3,F106:F114,0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "MATCH_9");

		oParser = new parserFormula("MATCH(F3,F106:F117,0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 10, "MATCH_10");

		oParser = new parserFormula("MATCH(0,F106:F114,0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "MATCH_11");

		oParser = new parserFormula("MATCH(0,F106:F117,0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 10, "MATCH_12");

		oParser = new parserFormula("MATCH(6,F106:F117,0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 9, "MATCH_13");

		oParser = new parserFormula("MATCH(6,F106:F117,1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 5, "MATCH_14");

		oParser = new parserFormula("MATCH(6,F106:F117,-1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "MATCH_15");

		oParser = new parserFormula("MATCH({6,2,3},F106:F117,1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 5, "MATCH_16");

		// bug 62332
		ws.getRange2("B200").setValue("P/N");
		ws.getRange2("B201").setValue("V-PS-TE-AW");
		ws.getRange2("B202").setValue("VA-ARM-PLL-D-A");
		ws.getRange2("B203").setValue("VA-ARM-PLL-U-A");
		ws.getRange2("B204").setValue("VA-ARM-U-P-SSS-C");
		ws.getRange2("B205").setValue("#N/A");
		ws.getRange2("B206").setValue("");

		ws.getRange2("C300").setValue("P/N");
		ws.getRange2("C301").setValue("V-PS-TE-AW");
		ws.getRange2("C302").setValue("VA-ARM-PLL-D-A");
		ws.getRange2("C303").setValue("VA-ARM-PLL-U-A");
		ws.getRange2("C304").setValue("VA-ARM-U-P-SSS-C");
		ws.getRange2("C305").setValue("#N/A");
		ws.getRange2("C306").setValue("");


		let bbox = ws.getRange2("D200").bbox;
		let cellWithFormula = new window['AscCommonExcel'].CCellWithFormula(ws, bbox.r1, bbox.c1);
		oParser = new parserFormula("MATCH(B200:B206,C300:C306,0)", cellWithFormula, ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 1, "MATCH_17");

		bbox = ws.getRange2("D201").bbox;
		cellWithFormula = new window['AscCommonExcel'].CCellWithFormula(ws, bbox.r1, bbox.c1);
		oParser = new parserFormula("MATCH(B200:B206,C300:C306,0)", cellWithFormula, ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2, "MATCH_18");

		bbox = ws.getRange2("D202").bbox;
		cellWithFormula = new window['AscCommonExcel'].CCellWithFormula(ws, bbox.r1, bbox.c1);
		oParser = new parserFormula("MATCH(B200:B206,C300:C306,0)", cellWithFormula, ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 3, "MATCH_19");
		
		oParser = new parserFormula("MATCH(B200:B206,C300:C306,0)", "D202", ws);
		oParser.setArrayFormulaRef(ws.getRange2("A100").bbox);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1);
		assert.strictEqual(oParser.calculate().getElementRowCol(1,0).getValue(), 2);
		assert.strictEqual(oParser.calculate().getElementRowCol(2,0).getValue(), 3);
		assert.strictEqual(oParser.calculate().getElementRowCol(3,0).getValue(), 4);
		assert.strictEqual(oParser.calculate().getElementRowCol(4,0).getValue(), 5);
		assert.strictEqual(oParser.calculate().getElementRowCol(5,0).getValue(), "#N/A");
		assert.strictEqual(oParser.calculate().getElementRowCol(6,0).getValue(), 7);

		oParser = new parserFormula("MATCH(B200:B206,C300:C306,0)", "D202", ws);
		oParser.setArrayFormulaRef(ws.getRange2("D200").bbox);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1);
		assert.strictEqual(oParser.calculate().getElementRowCol(1,0).getValue(), 2);
		assert.strictEqual(oParser.calculate().getElementRowCol(2,0).getValue(), 3);
		assert.strictEqual(oParser.calculate().getElementRowCol(3,0).getValue(), 4);
		assert.strictEqual(oParser.calculate().getElementRowCol(4,0).getValue(), 5);
		assert.strictEqual(oParser.calculate().getElementRowCol(5,0).getValue(), "#N/A");
		assert.strictEqual(oParser.calculate().getElementRowCol(6,0).getValue(), 7);

		oParser = new parserFormula('MATCH("str","str",0)', "A2", ws);
		assert.ok(oParser.parse(), 'MATCH("str","str",0)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of MATCH("str","str",0)');

		oParser = new parserFormula('MATCH("str",{"str"},0)', "A2", ws);
		assert.ok(oParser.parse(), 'MATCH("str",{"str"},0)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of MATCH("str",{"str"},0)');

		oParser = new parserFormula('MATCH(1,1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'MATCH(1,1,-1)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of MATCH(1,1,-1)');

		oParser = new parserFormula('MATCH(1,1,0)', "A2", ws);
		assert.ok(oParser.parse(), 'MATCH(1,1,0)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of MATCH(1,1,0)');

		oParser = new parserFormula('MATCH(1,1,1)', "A2", ws);
		assert.ok(oParser.parse(), 'MATCH(1,1,1)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of MATCH(1,1,1)');

		oParser = new parserFormula('MATCH(1,{1},1)', "A2", ws);
		assert.ok(oParser.parse(), 'MATCH(1,{1},1)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of MATCH(1,{1},1)');

		oParser = new parserFormula('MATCH(1,{2,1,1},0)', "A2", ws);
		assert.ok(oParser.parse(), 'MATCH(1,{2,1,1},0)');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Result of MATCH(1,{2,1,1},0)');

		oParser = new parserFormula('MATCH(TRUE,TRUE,0)', "A2", ws);
		assert.ok(oParser.parse(), 'MATCH(TRUE,TRUE,0)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of MATCH(TRUE,TRUE,0)');

		oParser = new parserFormula('MATCH(TRUE,{TRUE},0)', "A2", ws);
		assert.ok(oParser.parse(), 'MATCH(TRUE,{TRUE},0)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of MATCH(TRUE,{TRUE},0)');


		oParser = new parserFormula("MATCH({6,2,3},F106:F117,1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 5, "MATCH_16");

		oParser = new parserFormula("MATCH(#REF!,{123,2})", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!", "#REF!");

		oParser = new parserFormula("MATCH({6,2,3},#VALUE!)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "#VALUE!");

		ws.getRange2("B300").setValue("#REF!");

		oParser = new parserFormula("MATCH(B300,{1,2,3})", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!", "#REF!");

		ws.getRange2("A100:C214").cleanAll();
		// Data for reference link. Use A100-A115
		ws.getRange2("A100").setValue("1");
		ws.getRange2("A101").setValue("2");
		ws.getRange2("A102").setValue("3");
		ws.getRange2("A103").setValue("4");
		ws.getRange2("A104").setValue("5");
		ws.getRange2("A105").setValue("6");
		ws.getRange2("A106").setValue("7");
		ws.getRange2("A107").setValue("10");
		ws.getRange2("A108").setValue("9000");
		ws.getRange2("A109").setValue("10000");

		ws.getRange2("B100").setValue("a");
		ws.getRange2("B101").setValue("b");
		ws.getRange2("B102").setValue("app");
		ws.getRange2("B103").setValue("d");
		ws.getRange2("B104").setValue("e");
		ws.getRange2("B105").setValue("aaa");
		ws.getRange2("B106").setValue("g");
		ws.getRange2("B107").setValue("h");
		ws.getRange2("B108").setValue("i");
		ws.getRange2("B109").setValue("j");
		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 5);
		ws.getRange2("A601").setValue("10"); // Num (Column1)
		ws.getRange2("B601").setValue("10000"); // Num (Column2)
		ws.getRange2("C601").setValue("Text"); // Text (Column3)
		// 3D links. Use A1:Z10
		ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2


		// Positive cases:
		// Case #1: Number, Area, Number. Exact match with number in numeric range, match_type 0. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,A100:A110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,A100:A110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Positive case: Number, Area, Number. Exact match with number in numeric range, match_type 0. 3 of 3 arguments used.');
		// Case #2: Number, Area, Number. Ascending match in numeric range, match_type 1. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(5,A100:A110,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(5,A100:A110,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Number, Area, Number. Ascending match in numeric range, match_type 1. 3 of 3 arguments used.');
		// Case #3: Number, Area, Number. Descending match in numeric range, match_type -1. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(15,A100:A110,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(15,A100:A110,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Positive case: Number, Area, Number. Descending match in numeric range, match_type -1. 3 of 3 arguments used.');
		// Case #4: String, Area, Number. Exact match with text in text range, match_type 0. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH("a",B100:B110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH("a",B100:B110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: String, Area, Number. Exact match with text in text range, match_type 0. 3 of 3 arguments used.');
		// Case #5: Formula, Area, Number. Lookup_value from formula, exact match in numeric range. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(SUM(5,5),A100:A110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(SUM(5,5),A100:A110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Positive case: Formula, Area, Number. Lookup_value from formula, exact match in numeric range. 3 of 3 arguments used.');
		// Case #6: Number, Reference link, Number. Exact match with reference link, match_type 0. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(A100,A100,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(A100,A100,0) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Number, Reference link, Number. Exact match with reference link, match_type 0. 3 of 3 arguments used.');
		// Case #7: Number, Array, Number. Exact match in numeric array, match_type 0. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,{10,20,30},0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,{10,20,30},0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Number, Array, Number. Exact match in numeric array, match_type 0. 3 of 3 arguments used.');
		// Case #8: Number, Array, Number. Ascending match in numeric array, match_type 1. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(15,{10,15,20},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(15,{10,15,20},1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Number, Array, Number. Ascending match in numeric array, match_type 1. 3 of 3 arguments used.');
		// Case #9: Number, Array, Number. Descending match in numeric array, match_type -1. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(25,{30,25,20},-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(25,{30,25,20},-1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Number, Array, Number. Descending match in numeric array, match_type -1. 3 of 3 arguments used.');
		// Case #10: String, Array, Number. Exact match in text array, match_type 0, case-insensitive. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH("b",{"a","b","c"},0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH("b",{"a","b","c"},0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: String, Array, Number. Exact match in text array, match_type 0, case-insensitive. 3 of 3 arguments used.');
		// Case #11: Number, Table, Number. Exact match in table column (numeric), match_type 0. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(Table1[Column1],A100:A110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(Table1[Column1],A100:A110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Positive case: Number, Table, Number. Exact match in table column (numeric), match_type 0. 3 of 3 arguments used.');
		// Case #12: Date, Area, Number. Exact match with date as serial number, match_type 0. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(DATE(2025,1,1),A100:A110,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(DATE(2025,1,1),A100:A110,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 10, 'Test: Positive case: Date, Area, Number. Exact match with date as serial number, match_type 0. 3 of 3 arguments used.');
		// Case #13: Time, Area, Number. Exact match with time as fraction, match_type 0. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(TIME(12,0,0),A100:A110,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(TIME(12,0,0),A100:A110,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 10, 'Test: Positive case: Time, Area, Number. Exact match with time as fraction, match_type 0. 3 of 3 arguments used.');
		// Case #14: Number, Ref3D, Number. Exact match with 3D reference, match_type 0. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,Sheet2!A1,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,Sheet2!A1,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Number, Ref3D, Number. Exact match with 3D reference, match_type 0. 3 of 3 arguments used.');
		// Case #15: Number, Area3D, Number. Exact match with 3D range, match_type 0. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,Sheet2!A2:A3,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,Sheet2!A2:A3,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Number, Area3D, Number. Exact match with 3D range, match_type 0. 3 of 3 arguments used.');
		// Case #16: Number, Name, Number. Exact match with named range, match_type 0. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,TestName,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,TestName,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Number, Name, Number. Exact match with named range, match_type 0. 3 of 3 arguments used.');
		// Case #17: Number, Name3D, Number. Exact match with 3D named range, match_type 0. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,TestName3D,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,TestName3D,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Number, Name3D, Number. Exact match with 3D named range, match_type 0. 3 of 3 arguments used.');
		// Case #18: String, Area, Number. Wildcard match with text, match_type 0. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH("a*",B100:B110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH("a*",B100:B110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: String, Area, Number. Wildcard match with text, match_type 0. 3 of 3 arguments used.');
		// Case #19: Formula, Area, Number. MATCH as parent formula with nested ACOSH, exact match. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(SUM(ACOSH(2),8),A100:A110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(SUM(ACOSH(2),8),A100:A110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Formula, Area, Number. MATCH as parent formula with nested ACOSH, exact match. 3 of 3 arguments used.');
		// Case #20: String, Area, Number. Case-insensitive text match, match_type 0. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH("APP",B100:B110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH("APP",B100:B110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Test: Positive case: String, Area, Number. Case-insensitive text match, match_type 0. 3 of 3 arguments used.');

		// Negative cases:
		// Case #1: Number, Area, Number. Lookup_value not in array, returns #N/A. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(99,A100:A110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(99,A100:A110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Area, Number. Lookup_value not in array, returns #N/A. 3 of 3 arguments used.');
		// Case #2: Empty, Area, Number. Empty lookup_value, returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(,A100:A110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(,A100:A110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Empty, Area, Number. Empty lookup_value, returns #VALUE!. 3 of 3 arguments used.');
		// Case #3: Error, Area, Number. Error lookup_value propagates #N/A. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(NA(),A100:A110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(NA(),A100:A110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error, Area, Number. Error lookup_value propagates #N/A. 3 of 3 arguments used.');
		// Case #4: Number, Area, Boolean. Boolean match_type, returns #N/A. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,A100:A110,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,A100:A110,TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Negative case: Number, Area, Boolean. Boolean match_type, returns #N/A. 3 of 3 arguments used.');
		// Case #5: Number, Empty, Number. Empty lookup_array, returns #N/A. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Empty, Number. Empty lookup_array, returns #N/A. 3 of 3 arguments used.');
		// Case #6: Number, Area, Number. Non-ascending text array with match_type 1, returns #N/A. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,B100:B110,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,B100:B110,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Area, Number. Non-ascending text array with match_type 1, returns #N/A. 3 of 3 arguments used.');
		// Case #7: Number, Area, Number. Non-descending text array with match_type -1, returns #N/A. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,B100:B110,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,B100:B110,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Area, Number. Non-descending text array with match_type -1, returns #N/A. 3 of 3 arguments used.');
		// Case #8: String, Area, Number. String not in array, returns #N/A. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH("xyz",B100:B110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH("xyz",B100:B110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: String, Area, Number. String not in array, returns #N/A. 3 of 3 arguments used.');
		// Case #9: Number, Area, String. Non-numeric string match_type, returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,A100:A110,"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,A100:A110,"abc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Area, String. Non-numeric string match_type, returns #VALUE!. 3 of 3 arguments used.');
		// Case #10: Boolean, Area, Number. Boolean lookup_value not in array, returns #N/A. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(FALSE,A100:A110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(FALSE,A100:A110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Boolean, Area, Number. Boolean lookup_value not in array, returns #N/A. 3 of 3 arguments used.');
		// Case #11: Number, Area, Number. Invalid match_type (2), returns #N/A. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,A100:A110,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,A100:A110,2) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Negative case: Number, Area, Number. Invalid match_type (2), returns #N/A. 3 of 3 arguments used.');
		// Case #12: Number, Ref3D, Number. Ref3D to text data, returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,Sheet2!A4,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,Sheet2!A4,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Ref3D, Number. Ref3D to text data, returns #VALUE!. 3 of 3 arguments used.');
		// Case #13: Number, Name, Number. Named range with text, returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,TestNameArea2,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,TestNameArea2,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Name, Number. Named range with text, returns #VALUE!. 3 of 3 arguments used.');
		// Case #14: Number, Name3D, Number. 3D named range with text, returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,TestNameArea3D2,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,TestNameArea3D2,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Name3D, Number. 3D named range with text, returns #VALUE!. 3 of 3 arguments used.');
		// Case #15: Number, Table, Number. Table column with text, returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,Table1[Column2],0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,Table1[Column2],0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Table, Number. Table column with text, returns #VALUE!. 3 of 3 arguments used.');
		// Case #16: Array, Area, Number. Array with boolean lookup_value, returns #N/A. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH({TRUE},A100:A110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH({TRUE},A100:A110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Array, Area, Number. Array with boolean lookup_value, returns #N/A. 3 of 3 arguments used.');
		// Case #17: Number, Area3D, Number. 3D range with text data, returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(10,Sheet2!A5:A6,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(10,Sheet2!A5:A6,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Area3D, Number. 3D range with text data, returns #VALUE!. 3 of 3 arguments used.');
		// Case #18: Formula, Area, Number. Formula resulting in #NUM!, propagates error. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(SQRT(-1),A100:A110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(SQRT(-1),A100:A110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula, Area, Number. Formula resulting in #NUM!, propagates error. 3 of 3 arguments used.');
		// Case #19: String, Area, Number. Empty string lookup_value, returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH("",B100:B110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH("",B100:B110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: String, Area, Number. Empty string lookup_value, returns #VALUE!. 3 of 3 arguments used.');
		// Case #20: String, Area, Number. Wildcard with no match, returns #N/A. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH("app?",B100:B110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH("app?",B100:B110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: String, Area, Number. Wildcard with no match, returns #N/A. 3 of 3 arguments used.');

		// Bounded cases:
		// Case #1: Number, Area, Number. Minimum valid lookup_value, exact match. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(1,A100:A110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(1,A100:A110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Bounded case: Number, Area, Number. Minimum valid lookup_value, exact match. 3 of 3 arguments used.');
		// Case #2: Number, Area, Number. Maximum valid Excel number, exact match. 3 of 3 arguments used.
		oParser = new parserFormula('MATCH(9.99999999999999E+307,A100:A110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(9.99999999999999E+307,A100:A110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Bounded case: Number, Area, Number. Maximum valid Excel number, exact match. 3 of 3 arguments used.');
		// Case #3: Number, Area, Number. Smallest positive number, exact match, match_type 0. 3 arguments used.
		oParser = new parserFormula('MATCH(1E-307, A105:A107, 0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: MATCH(1E-307, A105:A107, 0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Bounded case: Number, Area, Number. Smallest positive number, exact match, match_type 0. 3 arguments used.');

		// Need to fix:
		// Case #6: Number, Reference link, Number. Exact match with reference link, match_type 0. 3 of 3 arguments used.
		// Case #11: Number, Area, Number. Invalid match_type (2), returns #N/A. 3 of 3 arguments used.

		//TODO excel по-другому работает
		/*oParser = new parserFormula( "MATCH(123,F106:F117,1)", "A2", ws );
		assert.ok( oParser.parse() );
		assert.strictEqual( oParser.calculate().getValue(), 6 );*/

	});

	QUnit.test("Test: \"OFFSET\"", function (assert) {

		ws.getRange2("C150").setValue("1");
		ws.getRange2("D150").setValue("2");
		ws.getRange2("E150").setValue("3");

		ws.getRange2("C151").setValue("2");
		ws.getRange2("D151").setValue("3");
		ws.getRange2("E151").setValue("4");

		ws.getRange2("C152").setValue("3");
		ws.getRange2("D152").setValue("4");
		ws.getRange2("E152").setValue("5");

		oParser = new parserFormula("OFFSET(C3,2,3,1,1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "F5");

		oParser = new parserFormula("SUM(OFFSET(C151:E155,-1,0,3,3))", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 27);

		oParser = new parserFormula("OFFSET(B3, -2, 0, 1, 1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "B1");

		oParser = new parserFormula("OFFSET(B3, 0, 0, -1, 1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "B3");

		oParser = new parserFormula("OFFSET(B3, 0, 0, -1, -1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "B3");

		oParser = new parserFormula("OFFSET(B3, 0, 0,,)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "B3");

		oParser = new parserFormula("OFFSET(B3, 0, 0, 1,)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "B3");

		oParser = new parserFormula("OFFSET(B3, 0, 0, -2, -2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "A2:B3");

		oParser = new parserFormula("OFFSET(B3, 0, 0, -1, -2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "A3:B3");

		oParser = new parserFormula("OFFSET(B3, 0, 0, 0, -2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "#REF!");

		oParser = new parserFormula("OFFSET(B3, 0, 0, 2, 0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "#REF!");

		oParser = new parserFormula("OFFSET(C3:D4, 0, 0, 2, 2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "C3:D4");

		oParser = new parserFormula("OFFSET(C3:D4, 0, 0, 3, 3)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "C3:E5");

		oParser = new parserFormula("OFFSET(C3:D4, 2, 2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "E5:F6");

		oParser = new parserFormula("OFFSET(C3:D4,2,2,3,3)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "E5:G7");

		oParser = new parserFormula("OFFSET(C3:E6, 0, 0, 3, 3)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "C3:E5");


		oParser = new parserFormula("OFFSET(C3:D4, 0, 0, -2, -2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "B2:C3");

		oParser = new parserFormula("OFFSET(C3:D4, 0, 0, -3, -3)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "A1:C3");

		oParser = new parserFormula("OFFSET(C3:E6, 0, 0, -3, -3)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "A1:C3");

		oParser = new parserFormula("OFFSET(F10:M17, 0, 0, -7,-5)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().toString(), "B4:F10");

		// Data for reference link. Use A100-A111
		ws.getRange2("A1:C214").cleanAll();
		ws.getRange2("A100").setValue("1");
		ws.getRange2("A101").setValue("2");
		ws.getRange2("A104").setValue("5");
		// For area
		ws.getRange2("A102").setValue("3");
		ws.getRange2("A103").setValue("4");
		ws.getRange2("A105").setValue("6");
		ws.getRange2("A106").setValue("7");
		ws.getRange2("A107").setValue("8");
		ws.getRange2("A108").setValue("9");
		ws.getRange2("A109").setValue("10");
		ws.getRange2("A110").setValue("11");
		ws.getRange2("A111").setValue("11");

		ws.getRange2("B100").setValue("1");
		ws.getRange2("B101").setValue("2");
		ws.getRange2("B102").setValue("3");
		ws.getRange2("B103").setValue("4");
		ws.getRange2("B104").setValue("4");
		ws.getRange2("B105").setValue("6");
		ws.getRange2("B106").setValue("7");
		ws.getRange2("B107").setValue("8");
		ws.getRange2("B108").setValue("9");
		ws.getRange2("B109").setValue("10");
		ws.getRange2("B110").setValue("11");
		ws.getRange2("B111").setValue("11");


		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 1);
		ws.getRange2("A601").setValue("1"); // Number (Column1)
		ws.getRange2("B601").setValue("123"); // Number (Column2)
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:D10").cleanAll();
		ws2.getRange2("A1").setValue("0.5");
		ws2.getRange2("A2").setValue("1.5");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("-1");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2


		// Positive cases:
		// Case #1: Reference link, Number, Number. Valid reference with integer offsets. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 2, 'Test: Positive case: Reference link, Number, Number. Valid reference with integer offsets. 3 of 5 arguments used.');
		// Case #2: Reference link, Number, Number, Number, Number. Valid reference with single-cell range output. 5 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,2,2,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,2,2,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "", 'Test: Positive case: Reference link, Number, Number, Number, Number. Valid reference with single-cell range output. 5 of 5 arguments used.');
		// Case #3: Reference link, Formula, Formula. Nested ROUND formulas for rows and cols. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,ROUND(1.6,0),ROUND(1.6,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,ROUND(1.6,0),ROUND(1.6,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "", 'Test: Positive case: Reference link, Formula, Formula. Nested ROUND formulas for rows and cols. 3 of 5 arguments used.');
		// Case #4: Reference link, String, String. String convertible to number for rows and cols. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,"2","2")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,"2","2") is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "", 'Test: Positive case: Reference link, String, String. String convertible to number for rows and cols. 3 of 5 arguments used.');
		// Case #5: Area, Number, Number. Single-cell range as reference. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A101:A101,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A101:A101,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 3, 'Test: Positive case: Area, Number, Number. Single-cell range as reference. 3 of 5 arguments used.');
		// Case #6: Area, Number, Number, Number, Number. Single-cell range with valid height and width. 5 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A101:A101,0,0,2,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A101:A101,0,0,2,2) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue().getValue(), 2, 'Test: Positive case: Area, Number, Number, Number, Number. Single-cell range with valid height and width. 5 of 5 arguments used.');
		// Case #7: Ref3D, Number, Number. 3D reference to valid cell. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(Sheet2!A1,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(Sheet2!A1,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "", 'Test: Positive case: Ref3D, Number, Number. 3D reference to valid cell. 3 of 5 arguments used.');
		// Case #8: Area3D, Number, Number. 3D single-cell range. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(Sheet2!A1:A1,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(Sheet2!A1:A1,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "", 'Test: Positive case: Area3D, Number, Number. 3D single-cell range. 3 of 5 arguments used.');
		// Case #9: Name, Number, Number. Named range with valid number. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(TestName,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(TestName,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "", 'Test: Positive case: Name, Number, Number. Named range with valid number. 3 of 5 arguments used.');
		// Case #10: Name3D, Number, Number. 3D named range. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(TestName3D,1,1)', 'A2', ws);
		//? assert.ok(oParser.parse(), 'Test: OFFSET(TestName3D,1,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#NAME?', 'Test: Positive case: Name3D, Number, Number. 3D named range. 3 of 5 arguments used.');
		// Case #11: Table, Number, Number. Table structured reference with valid number. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(Table1[Column1],1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(Table1[Column1],1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "", 'Test: Positive case: Table, Number, Number. Table structured reference with valid number. 3 of 5 arguments used.');
		// Case #12: Formula, Number, Number. Nested IF formula for reference. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(IF(TRUE,A100,A101),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(IF(TRUE,A100,A101),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 2, 'Test: Positive case: Formula, Number, Number. Nested IF formula for reference. 3 of 5 arguments used.');
		// Case #13: Reference link, Date, Number. Date formula resulting in valid offset (31). 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,DATE(2025,2,1)-DATE(2025,1,1),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,DATE(2025,2,1)-DATE(2025,1,1),1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "", 'Test: Positive case: Reference link, Date, Number. Date formula resulting in valid offset (31). 3 of 5 arguments used.');
		// Case #14: Reference link, Time, Number. Time formula resulting in valid offset (1). 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,TIME(1,0,0)*24,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,TIME(1,0,0)*24,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 2, 'Test: Positive case: Reference link, Time, Number. Time formula resulting in valid offset (1). 3 of 5 arguments used.');
		// Case #15: Reference link, Number, Number, Number. Height specified, width omitted. 4 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1,1,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1,1,2) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue().getValue(), 0, 'Test: Positive case: Reference link, Number, Number, Number. Height specified, width omitted. 4 of 5 arguments used.');
		// Case #16: Reference link, String, Number. String convertible to float for rows. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,"1.0",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,"1.0",1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 2, 'Test: Positive case: Reference link, String, Number. String convertible to float for rows. 3 of 5 arguments used.');
		// Case #17: Array, Number, Number. Single-element array as reference. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET({""},1,1)', 'A2', ws);
		//? assert.ok(oParser.parse(), 'Test: OFFSET({""},1,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=OFFSET({""},1,1)', 'Test: Positive case: Array, Number, Number. Single-element array as reference. 3 of 5 arguments used.');
		// Case #18: Reference link, Formula, Number. Formula resolving to positive number for rows. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,ABS(-2),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,ABS(-2),1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 3, 'Test: Positive case: Reference link, Formula, Number. Formula resolving to positive number for rows. 3 of 5 arguments used.');
		// Case #19: Reference link, Number, Number, Array. Array for height. 4 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1,1,{2})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1,1,{2}) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Positive case: Reference link, Number, Number, Array. Array for height. 4 of 5 arguments used.');
		// Case #20: Area3D, Number, Number, Number, Number. 3D multi-cell range (1x2) with valid output. 5 of 5 arguments used.
		oParser = new parserFormula('OFFSET(Sheet2!A1:B1,0,0,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(Sheet2!A1:B1,0,0,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 0.5, 'Test: Positive case: Area3D, Number, Number, Number, Number. 3D multi-cell range (1x2) with valid output. 5 of 5 arguments used.');
		// Case #21: Reference link, Number, Number. Zero offsets, returns original reference. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,0,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,0,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 1, 'Test: Positive case: Reference link, Number, Number. Zero offsets, returns original reference. 3 of 5 arguments used.');
		// Case #22: Reference link, Number, Number, Number, Number. Moderate offsets with valid range output. 5 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,10,10,2,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,10,10,2,2) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Positive case: Reference link, Number, Number, Number, Number. Moderate offsets with valid range output. 5 of 5 arguments used.');

		// Negative cases:
		// Case #1: Reference link, Number, Number. Rows offset exceeds sheet limit (1,048,576 rows). 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1048577,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1048577,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Reference link, Number, Number. Rows offset exceeds sheet limit (1,048,576 rows). 3 of 5 arguments used.');
		// Case #2: Reference link, Number, Number. Cols offset exceeds sheet limit (16,384 columns). 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1,16385)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1,16385) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Reference link, Number, Number. Cols offset exceeds sheet limit (16,384 columns). 3 of 5 arguments used.');
		// Case #3: Reference link, String, Number. Non-numeric string for rows. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,"abc",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,"abc",1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Reference link, String, Number. Non-numeric string for rows. 3 of 5 arguments used.');
		// Case #4: Reference link, Number, String. Non-numeric string for cols. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1,"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1,"abc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Reference link, Number, String. Non-numeric string for cols. 3 of 5 arguments used.');
		// Case #5: Error, Number, Number. Propagates #N/A error. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(NA(),1,1)', 'A2', ws);
		//? assert.ok(oParser.parse(), 'Test: OFFSET(NA(),1,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=OFFSET(NA(),1,1)', 'Test: Negative case: Error, Number, Number. Propagates #N/A error. 3 of 5 arguments used.');
		// Case #6: Area, Number, Number. Multi-cell range (2 cells) as reference. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A102:A103,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A102:A103,1,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue().getValue(), 0, 'Test: Negative case: Area, Number, Number. Multi-cell range (2 cells) as reference. 3 of 5 arguments used.');
		// Case #7: Empty, Number, Number. Reference to empty cell. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A103,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A103,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 4, 'Test: Negative case: Empty, Number, Number. Reference to empty cell. 3 of 5 arguments used.');
		// Case #8: Reference link, Number, Number, Number. Negative height. 4 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1,1,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1,1,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 2, 'Test: Negative case: Reference link, Number, Number, Number. Negative height. 4 of 5 arguments used.');
		// Case #9: Reference link, Number, Number, Number. Zero height. 4 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1,1,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1,1,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Reference link, Number, Number, Number. Zero height. 4 of 5 arguments used.');
		// Case #10: Reference link, Number, Number, Number. Height exceeds sheet limit. 4 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1,1,1048577)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1,1,1048577) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Reference link, Number, Number, Number. Height exceeds sheet limit. 4 of 5 arguments used.');
		// Case #11: Reference link, Number, Number, Number, Number. Width exceeds sheet limit. 5 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1,1,1,16385)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1,1,1,16385) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Reference link, Number, Number, Number, Number. Width exceeds sheet limit. 5 of 5 arguments used.');
		// Case #12: Ref3D, Number, Number. 3D reference to text cell. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(Sheet2!A2,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(Sheet2!A2,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), "", 'Test: Negative case: Ref3D, Number, Number. 3D reference to text cell. 3 of 5 arguments used.');
		// Case #13: Name, Number, Number. Named range with text. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(TestNameArea2,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(TestNameArea2,1,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue().getValue(), -0.8, 'Test: Negative case: Name, Number, Number. Named range with text. 3 of 5 arguments used.');
		// Case #14: Table, Number, Number. Table column with text. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(Table1[Column2],1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(Table1[Column2],1,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue().getValue(), '=OFFSET(Table1[Column2],1,1)', 'Test: Negative case: Table, Number, Number. Table column with text. 3 of 5 arguments used.');
		// Case #15: Reference link, Boolean, Number. Boolean FALSE for rows. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,FALSE,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,FALSE,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 1, 'Test: Negative case: Reference link, Boolean, Number. Boolean FALSE for rows. 3 of 5 arguments used.');
		// Case #16: Reference link, Number, Boolean. Boolean FALSE for cols. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1,FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 2, 'Test: Negative case: Reference link, Number, Boolean. Boolean FALSE for cols. 3 of 5 arguments used.');
		// Case #17: Reference link, Number, Number, String. Non-numeric string for height. 4 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1,1,"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1,1,"abc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Reference link, Number, Number, String. Non-numeric string for height. 4 of 5 arguments used.');
		// Case #18: Reference link, Number, Number, Number, String. Non-numeric string for width. 5 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1,1,1,"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1,1,1,"abc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Reference link, Number, Number, Number, String. Non-numeric string for width. 5 of 5 arguments used.');
		// Case #19: Reference link, Formula, Number. Formula resulting in #NUM! error. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,SQRT(-1),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,SQRT(-1),1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Reference link, Formula, Number. Formula resulting in #NUM! error. 3 of 5 arguments used.');
		// Case #20: Area3D, Number, Number. 3D multi-cell range (2x2) as reference. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(Sheet2!A1:B2,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(Sheet2!A1:B2,1,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), "", 'Test: Negative case: Area3D, Number, Number. 3D multi-cell range (2x2) as reference. 3 of 5 arguments used.');
		// Case #21: Reference link, Number, Number. Negative rows offset exceeds sheet limit. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,-1048577,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,-1048577,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Reference link, Number, Number. Negative rows offset exceeds sheet limit. 3 of 5 arguments used.');
		// Case #22: Reference link, Number, Number, Array. Array with boolean for height. 4 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1,1,{FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1,1,{FALSE}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Reference link, Number, Number, Array. Array with boolean for height. 4 of 5 arguments used.');

		// Bounded cases:
		// Case #1: Reference link, Number, Number. Minimum valid offsets (0 rows, 0 cols). 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,0,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,0,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 1, 'Test: Bounded case: Reference link, Number, Number. Minimum valid offsets (0 rows, 0 cols). 3 of 5 arguments used.');
		// Case #2: Reference link, Number, Number. Maximum valid offsets (1,048,576 rows, 16,384 cols). 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1048576,16384)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1048576,16384) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Bounded case: Reference link, Number, Number. Maximum valid offsets (1,048,576 rows, 16,384 cols). 3 of 5 arguments used.');
		// Case #3: Reference link, Number, Number, Number, Number. Maximum valid height and width. 5 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,0,0,1048576,16384)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,0,0,1048576,16384) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Bounded case: Reference link, Number, Number, Number, Number. Maximum valid height and width. 5 of 5 arguments used.');
		// Case #4: Reference link, Number, Number. Smallest positive number for rows and cols. 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,1E-307,1E-307)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,1E-307,1E-307) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 1, 'Test: Bounded case: Reference link, Number, Number. Smallest positive number for rows and cols. 3 of 5 arguments used.');
		// Case #5: Reference link, Date, Number. Minimum valid date offset (1 day). 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,DATE(1900,1,2)-DATE(1900,1,1),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,DATE(1900,1,2)-DATE(1900,1,1),1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 2, 'Test: Bounded case: Reference link, Date, Number. Minimum valid date offset (1 day). 3 of 5 arguments used.');
		// Case #6: Reference link, Date, Number. Maximum valid date offset (1 day). 3 of 5 arguments used.
		oParser = new parserFormula('OFFSET(A100,DATE(9999,12,31)-DATE(9999,12,30),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: OFFSET(A100,DATE(9999,12,31)-DATE(9999,12,30),1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue().getValue(), 2, 'Test: Bounded case: Reference link, Date, Number. Maximum valid date offset (1 day). 3 of 5 arguments used.');

		// Need to fix:
		// Case #6: Area, Number, Number, Number, Number. Single-cell range with valid height and width. 5 of 5 arguments used.
		// Case #15: Reference link, Number, Number, Number. Height specified, width omitted. 4 of 5 arguments used.
		// Case #6: Area, Number, Number. Multi-cell range (2 cells) as reference. 3 of 5 arguments used.
		// Case #17: Array, Number, Number. Single-element array as reference. 3 of 5 arguments used.
		// Case #19: Reference link, Number, Number, Array. Array for height. 4 of 5 arguments used.
		// Case #22: Reference link, Number, Number, Number, Number. Moderate offsets with valid range output. 5 of 5 arguments used. - empty array?
		// Case #5: Error, Number, Number. Propagates #N/A error. 3 of 5 arguments used.
		// Case #20: Area3D, Number, Number. 3D multi-cell range (2x2) as reference. 3 of 5 arguments used.


	});


	QUnit.test("Test: \"ROW\"", function (assert) {

		oParser = new parserFormula('ROW(B6)', "AA2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 6);

		oParser = new parserFormula('ROW(C16)', "AA2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 16);

		oParser = new parserFormula('ROW()', "AA2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 1);

		oParser = new parserFormula('ROW()+ROW()', "AA2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		testArrayFormulaEqualsValues(assert, "6,6,6,6;7,7,7,7;8,8,8,8", "ROW()");
		testArrayFormulaEqualsValues(assert, "1,1,1,1;2,2,2,2;#N/A,#N/A,#N/A,#N/A", "ROW(A1:C2)");
		testArrayFormulaEqualsValues(assert, "1,1,1,1;1,1,1,1;1,1,1,1", "ROW(A1:B1)");
		testArrayFormulaEqualsValues(assert, "1,1,1,1;1,1,1,1;1,1,1,1", "ROW(A1)");

		ws.getRange2("A100:C214").cleanAll();
		// Data for reference link. Use A100-A115
		ws.getRange2("A100").setValue("1");
		ws.getRange2("A101").setValue("2");
		ws.getRange2("A102").setValue("Text");
		ws.getRange2("A103").setValue("TRUE");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 2);
		ws.getRange2("A601").setValue("5"); // Num (Column1)
		ws.getRange2("B601").setValue("10"); // Num (Column2)
		ws.getRange2("C601").setValue("Text"); // Text (Column3)

		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2

		let bbox = ws.getRange2("A2").bbox;
		let cellWithFormula = new window['AscCommonExcel'].CCellWithFormula(ws, bbox.r1, bbox.c1);
		// Positive cases:
		// Case #1: Empty. No reference provided, returns row number of the cell containing the formula. 0 arguments used.
		oParser = new parserFormula('ROW()', cellWithFormula, ws);
		assert.ok(oParser.parse(), 'Test: ROW() is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Empty. No reference provided, returns row number of the cell containing the formula. 0 arguments used.');
		// Case #2: Reference link. Reference to a single cell. Returns row number of the referenced cell. 1 argument used.
		oParser = new parserFormula('ROW(A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(A100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 100, 'Test: Positive case: Reference link. Reference to a single cell. Returns row number of the referenced cell. 1 argument used.');
		// Case #3: Area. Single-cell range. Returns row number of the first cell in the range. 1 argument used.
		oParser = new parserFormula('ROW(A101:A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(A101:A102) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 101, 'Test: Positive case: Area. Single-cell range. Returns row number of the first cell in the range. 1 argument used.');
		// Case #4: Array. Array constant entered as vertical array formula. Returns array of row numbers. 1 argument used.
		oParser = new parserFormula('ROW({1;2;3})', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: ROW({1;2;3}) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=ROW({1;2;3})', 'Test: Positive case: Array. Array constant entered as vertical array formula. Returns array of row numbers. 1 argument used.');
		// Case #5: Name. Named range referring to a single cell. Returns row number. 1 argument used.
		oParser = new parserFormula('ROW(TestName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(TestName) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 201, 'Test: Positive case: Name. Named range referring to a single cell. Returns row number. 1 argument used.');
		// Case #6: Name3D. 3D named range referring to a single cell. Returns row number. 1 argument used.
		oParser = new parserFormula('ROW(TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 11, 'Test: Positive case: Name3D. 3D named range referring to a single cell. Returns row number. 1 argument used.');
		// Case #7: Ref3D. 3D reference to a single cell. Returns row number. 1 argument used.
		oParser = new parserFormula('ROW(Sheet2!A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(Sheet2!A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Ref3D. 3D reference to a single cell. Returns row number. 1 argument used.');
		// Case #8: Area3D. 3D single-cell range. Returns row number of the first cell. 1 argument used.
		oParser = new parserFormula('ROW(Sheet2!A1:A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(Sheet2!A1:A2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Area3D. 3D single-cell range. Returns row number of the first cell. 1 argument used.');
		// Case #9: Table. Table structured reference. Returns row number of the first cell in the column. 1 argument used.
		oParser = new parserFormula('ROW(Table1[Column1])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(Table1[Column1]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 601, 'Test: Positive case: Table. Table structured reference. Returns row number of the first cell in the column. 1 argument used.');
		// Case #10: Formula. Formula resolving to a single cell reference. Returns row number. 1 argument used.
		oParser = new parserFormula('ROW(IF(TRUE,A100,B100))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(IF(TRUE,A100,B100)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 100, 'Test: Positive case: Formula. Formula resolving to a single cell reference. Returns row number. 1 argument used.');
		// Case #11: Reference link. Reference to a cell with numeric value. Returns row number. 1 argument used.
		oParser = new parserFormula('ROW(A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(A101) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 101, 'Test: Positive case: Reference link. Reference to a cell with numeric value. Returns row number. 1 argument used.');
		// Case #12: Area. Single-cell range explicitly defined. Returns row number. 1 argument used.
		oParser = new parserFormula('ROW(A101:A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(A101:A101) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 101, 'Test: Positive case: Area. Single-cell range explicitly defined. Returns row number. 1 argument used.');
		// Case #13: Array. Horizontal array constant entered as array formula. Returns row number of first element. 1 argument used.
		oParser = new parserFormula('ROW({1,2,3})', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: ROW({1,2,3}) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=ROW({1,2,3})', 'Test: Positive case: Array. Horizontal array constant entered as array formula. Returns row number of first element. 1 argument used.');
		// Case #14: Formula. Formula resolving to a cell reference via INDIRECT. Returns row number. 1 argument used.
		oParser = new parserFormula('ROW(INDIRECT("A"&2))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(INDIRECT("A"&2)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Formula. Formula resolving to a cell reference via INDIRECT. Returns row number. 1 argument used.');
		// Case #15: Reference link. Reference to a cell with string value. Returns row number. 1 argument used.
		oParser = new parserFormula('ROW(A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(A102) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 102, 'Test: Positive case: Reference link. Reference to a cell with string value. Returns row number. 1 argument used.');
		// Case #16: Formula. ROW inside SUM formula, returns sum of row numbers for range. 1 argument used.
		oParser = new parserFormula('SUM(ROW(A1:A3))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SUM(ROW(A1:A3)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 6, 'Test: Positive case: Formula. ROW inside SUM formula, returns sum of row numbers for range. 1 argument used.');
		// Case #17: Area. Vertical range entered as array formula. Returns array of row numbers {1;2;3}. 1 argument used.
		oParser = new parserFormula('ROW(A1:A3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(A1:A3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Area. Vertical range entered as array formula. Returns array of row numbers {1;2;3}. 1 argument used.');
		// Case #18: Date. Date value treated as serial number, but ROW expects a reference. Returns #VALUE! as it’s not a reference, but included for type testing. 1 argument used.
		oParser = new parserFormula('ROW(DATE(2025,1,1))', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: ROW(DATE(2025,1,1)) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=ROW(DATE(2025,1,1))', 'Test: Positive case: Date. Date value treated as serial number, but ROW expects a reference. Returns #VALUE! as it’s not a reference, but included for type testing. 1 argument used.');
		// Case #19: Time. Time value treated as serial number, but ROW expects a reference. Returns #VALUE! as it’s not a reference, but included for type testing. 1 argument used.
		oParser = new parserFormula('ROW(TIME(12,0,0))', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: ROW(TIME(12,0,0)) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=ROW(TIME(12,0,0))', 'Test: Positive case: Time. Time value treated as serial number, but ROW expects a reference. Returns #VALUE! as it’s not a reference, but included for type testing. 1 argument used.');
		// Case #20: Name. Named range referring to a range. Returns row number of first cell. 1 argument used.
		oParser = new parserFormula('ROW(TestName1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(TestName1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 202, 'Test: Positive case: Name. Named range referring to a range. Returns row number of first cell. 1 argument used.');
		// Case #21: Name3D. 3D named range referring to a range. Returns row number of first cell. 1 argument used.
		oParser = new parserFormula('ROW(TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 11, 'Test: Positive case: Name3D. 3D named range referring to a range. Returns row number of first cell. 1 argument used.');
		// Case #22: Ref3D. 3D reference to a single cell. Returns row number. 1 argument used.
		oParser = new parserFormula('ROW(Sheet2!A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(Sheet2!A2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Ref3D. 3D reference to a single cell. Returns row number. 1 argument used.');

		// Negative cases:
		// Case #1: String. String not convertible to a cell reference. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('ROW("A1")', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: ROW("A1") is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=ROW("A1")', 'Test: Negative case: String. String not convertible to a cell reference. Returns #VALUE!. 1 argument used.');
		// Case #2: Number. Numeric value not a reference. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('ROW(5)', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: ROW(5) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=ROW(5)', 'Test: Negative case: Number. Numeric value not a reference. Returns #VALUE!. 1 argument used.');
		// Case #3: Error. Error input propagates #N/A. 1 argument used.
		oParser = new parserFormula('ROW(NA())', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: ROW(NA()) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=ROW(NA())', 'Test: Negative case: Error. Error input propagates #N/A. 1 argument used.');
		// Case #4: Area. Multi-cell range not entered as array formula. Returns row number of first cell, but included to test non-array behavior. 1 argument used.
		oParser = new parserFormula('ROW(A101:A103)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(A101:A103) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 101, 'Test: Negative case: Area. Multi-cell range not entered as array formula. Returns row number of first cell, but included to test non-array behavior. 1 argument used.');
		// Case #5: Empty. Reference to empty cell. Returns row number of the cell. 1 argument used.
		oParser = new parserFormula('ROW(A103)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(A103) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 103, 'Test: Negative case: Empty. Reference to empty cell. Returns row number of the cell. 1 argument used.');
		// Case #6: Name. Named range with text value. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('ROW(TestNameArea2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(TestNameArea2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 208, 'Test: Negative case: Name. Named range with text value. Returns #VALUE!. 1 argument used.');
		// Case #7: Name3D. 3D named range with text value. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('ROW(TestNameArea3D2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(TestNameArea3D2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 18, 'Test: Negative case: Name3D. 3D named range with text value. Returns #VALUE!. 1 argument used.');
		// Case #8: Ref3D. 3D reference to cell with text value. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('ROW(Sheet2!A10)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(Sheet2!A10) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 10, 'Test: Negative case: Ref3D. 3D reference to cell with text value. Returns #VALUE!. 1 argument used.');
		// Case #9: Table. Table column with text values. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('ROW(Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 601, 'Test: Negative case: Table. Table column with text values. Returns #VALUE!. 1 argument used.');
		// Case #10: Area. Multi-cell range not entered as array formula. Returns row number of first cell, but included to test non-array behavior. 1 argument used.
		oParser = new parserFormula('ROW(A101:A104)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(A101:A104) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 101, 'Test: Negative case: Area. Multi-cell range not entered as array formula. Returns row number of first cell, but included to test non-array behavior. 1 argument used.');
		// Case #11: Array. Multi-row array not entered as vertical array formula. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('ROW({1,2;3,4})', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: ROW({1,2;3,4}) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=ROW({1,2;3,4})', 'Test: Negative case: Array. Multi-row array not entered as vertical array formula. Returns #VALUE!. 1 argument used.');
		// Case #12: Formula. Formula resulting in #NUM! propagates error. 1 argument used.
		oParser = new parserFormula('ROW(SQRT(-1))', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: ROW(SQRT(-1)) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=ROW(SQRT(-1))', 'Test: Negative case: Formula. Formula resulting in #NUM! propagates error. 1 argument used.');
		// Case #13: Boolean. Boolean value not a reference. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('ROW(TRUE)', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: ROW(TRUE) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=ROW(TRUE)', 'Test: Negative case: Boolean. Boolean value not a reference. Returns #VALUE!. 1 argument used.');
		// Case #14: Area3D. 3D multi-cell range (multiple areas). Returns #VALUE! as ROW cannot refer to multiple areas. 1 argument used.
		oParser = new parserFormula('ROW(Sheet2!A1:B2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(Sheet2!A1:B2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Area3D. 3D multi-cell range (multiple areas). Returns #VALUE! as ROW cannot refer to multiple areas. 1 argument used.');
		// Case #15: Reference link. Reference to cell with error value (#DIV/0!). Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('ROW(A104)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(A104) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 104, 'Test: Negative case: Reference link. Reference to cell with error value (#DIV/0!). Returns #VALUE!. 1 argument used.');
		// Case #16: String. Date string not a reference. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('ROW("01.01.2025")', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: ROW("01.01.2025") is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=ROW("01.01.2025")', 'Test: Negative case: String. Date string not a reference. Returns #VALUE!. 1 argument used.');
		// Case #17: Formula. Formula resolving to invalid date (#NUM!). Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('ROW(DATE(2025,13,1))', 'A2', ws);
		//? assert.ok(oParser.parse() === false, 'Test: ROW(DATE(2025,13,1)) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '=ROW(DATE(2025,13,1))', 'Test: Negative case: Formula. Formula resolving to invalid date (#NUM!). Returns #VALUE!. 1 argument used.');
		// Case #18: Name. Named range referring to invalid reference. Returns #REF!. 1 argument used.
		oParser = new parserFormula('ROW(TestName2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(TestName2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 203, 'Test: Negative case: Name. Named range referring to invalid reference. Returns #REF!. 1 argument used.');
		// Case #19: Name3D. 3D named range referring to invalid reference. Returns #REF!. 1 argument used.
		oParser = new parserFormula('ROW(TestName3D22)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(TestName3D22) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#REF!', 'Test: Negative case: Name3D. 3D named range referring to invalid reference. Returns #REF!. 1 argument used.');
		// Case #20: Ref3D. 3D reference to non-existent cell. Returns #REF!. 1 argument used.
		oParser = new parserFormula('ROW(Sheet2!Z1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(Sheet2!Z1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Ref3D. 3D reference to non-existent cell. Returns #REF!. 1 argument used.');

		// Bounded cases:
		// Case #1: Reference link. Reference to the first row in Excel. Returns 1. 1 argument used.
		oParser = new parserFormula('ROW(A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Bounded case: Reference link. Reference to the first row in Excel. Returns 1. 1 argument used.');
		// Case #2: Reference link. Reference to the last row in Excel. Returns 1048576. 1 argument used.
		oParser = new parserFormula('ROW(XFD1048576)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(XFD1048576) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1048576, 'Test: Bounded case: Reference link. Reference to the last row in Excel. Returns 1048576. 1 argument used.');
		// Case #3: Area. Single-cell range at minimum row. Returns 1. 1 argument used.
		oParser = new parserFormula('ROW(A1:A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(A1:A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Bounded case: Area. Single-cell range at minimum row. Returns 1. 1 argument used.');
		// Case #4: Area. Single-cell range at maximum row. Returns 1048576. 1 argument used.
		oParser = new parserFormula('ROW(XFD1048576:XFD1048576)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROW(XFD1048576:XFD1048576) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1048576, 'Test: Bounded case: Area. Single-cell range at maximum row. Returns 1048576. 1 argument used.');

		// Need to fix: формула не должна парситься если используется тип аргумента отличный от reference

	});

	QUnit.test("Test: \"ROWS\"", function (assert) {

		oParser = new parserFormula('ROWS(C1:E4)', "AA2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 4);

		oParser = new parserFormula('ROWS({1,2,3;4,5,6})', "AA2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		ws.getRange2("A1:C214").cleanAll();
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("0.5");
		ws.getRange2("A101").setValue("1.5");
		ws.getRange2("A104").setValue("-1");
		// For area
		ws.getRange2("A102").setValue("0.5");
		ws.getRange2("A103").setValue("");
		ws.getRange2("A105").setValue("1");
		ws.getRange2("A110").setValue("TRUE");
		ws.getRange2("A111").setValue("FALSE");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 1);
		ws.getRange2("A601").setValue("1"); // Number (Column1)
		ws.getRange2("B601").setValue("Text"); // Text (Column2)
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2

		// Positive cases:
		// Case #1: Reference link. Single cell reference (1 row). 1 argument used.
		oParser = new parserFormula('ROWS(A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(A100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Reference link. Single cell reference (1 row). 1 argument used.');
		// Case #2: Area. Two-cell range (2 rows). 1 argument used.
		oParser = new parserFormula('ROWS(A100:A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(A100:A101) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Area. Two-cell range (2 rows). 1 argument used.');
		// Case #3: Array. 2x1 array (2 rows, 1 column). 1 argument used.
		oParser = new parserFormula('ROWS({1;2})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS({1;2}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Array. 2x1 array (2 rows, 1 column). 1 argument used.');
		// Case #4: Array. 1x2 array (1 row, 2 columns). 1 argument used.
		oParser = new parserFormula('ROWS({1,2})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS({1,2}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Array. 1x2 array (1 row, 2 columns). 1 argument used.');
		// Case #5: Array. 2x2 array (2 rows, 2 columns). 1 argument used.
		oParser = new parserFormula('ROWS({1,2;3,4})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS({1,2;3,4}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Array. 2x2 array (2 rows, 2 columns). 1 argument used.');
		// Case #6: Array. 1x1 array (1 row, 1 column). 1 argument used.
		oParser = new parserFormula('ROWS({1})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS({1}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Array. 1x1 array (1 row, 1 column). 1 argument used.');
		// Case #7: Formula. Range defined by INDIRECT formula (2 rows). 1 argument used.
		oParser = new parserFormula('ROWS(INDIRECT("A100:A101"))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(INDIRECT("A100:A101")) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Formula. Range defined by INDIRECT formula (2 rows). 1 argument used.');
		// Case #8: Name. Named range referring to a single row. 1 argument used.
		oParser = new parserFormula('ROWS(TestName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(TestName) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Name. Named range referring to a single row. 1 argument used.');
		// Case #9: Name. Named range referring to two rows. 1 argument used.
		oParser = new parserFormula('ROWS(TestName1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(TestName1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Name. Named range referring to two rows. 1 argument used.');
		// Case #10: Ref3D. 3D reference to a single cell (1 row). 1 argument used.
		oParser = new parserFormula('ROWS(Sheet2!A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(Sheet2!A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Ref3D. 3D reference to a single cell (1 row). 1 argument used.');
		// Case #11: Area3D. 3D range with two cells (2 rows). 1 argument used.
		oParser = new parserFormula('ROWS(Sheet2!A1:A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(Sheet2!A1:A2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Area3D. 3D range with two cells (2 rows). 1 argument used.');
		// Case #12: Table. Table column with one row. 1 argument used.
		oParser = new parserFormula('ROWS(Table1[Column1])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(Table1[Column1]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Table. Table column with one row. 1 argument used.');
		// Case #13: Table. Table column with two rows. 1 argument used.
		oParser = new parserFormula('ROWS(Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Table. Table column with two rows. 1 argument used.');
		// Case #14: Formula. Range defined by ADDRESS formula (2 rows). 1 argument used.
		oParser = new parserFormula('ROWS(ADDRESS(2,2))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(ADDRESS(2,2)) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Formula. Range defined by ADDRESS formula (2 rows). 1 argument used.');
		// Case #15: Reference link. Single cell reference, reused value (1 row). 1 argument used.
		oParser = new parserFormula('ROWS(A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(A101) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Reference link. Single cell reference, reused value (1 row). 1 argument used.');
		// Case #16: Name3D. 3D named range with one row. 1 argument used.
		oParser = new parserFormula('ROWS(TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Name3D. 3D named range with one row. 1 argument used.');
		// Case #17: Name3D. 3D named range with two rows. 1 argument used.
		oParser = new parserFormula('ROWS(TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Name3D. 3D named range with two rows. 1 argument used.');
		// Case #18: Area. Two-cell range, reused values (2 rows). 1 argument used.
		oParser = new parserFormula('ROWS(A102:A103)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(A102:A103) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Area. Two-cell range, reused values (2 rows). 1 argument used.');
		// Case #19: Array. 2x1 array with reused values (2 rows). 1 argument used.
		oParser = new parserFormula('ROWS({38777;38838})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS({38777;38838}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Array. 2x1 array with reused values (2 rows). 1 argument used.');
		// Case #20: Formula. Nested IF returning a two-row range. 1 argument used.
		oParser = new parserFormula('ROWS(IF(TRUE,A100:A101,A102:A103))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(IF(TRUE,A100:A101,A102:A103)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Formula. Nested IF returning a two-row range. 1 argument used.');
		// Case #21: Reference link. Single cell reference, new value (1 row). 1 argument used.
		oParser = new parserFormula('ROWS(A104)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(A104) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Reference link. Single cell reference, new value (1 row). 1 argument used.');
		// Case #22: Area3D. 3D range with two cells, new values (2 rows). 1 argument used.
		oParser = new parserFormula('ROWS(Sheet2!A3:A4)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(Sheet2!A3:A4) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Area3D. 3D range with two cells, new values (2 rows). 1 argument used.');

		// Negative cases:
		// Case #1: Empty. No argument provided, returns #N/A.
		oParser = new parserFormula('ROWS("")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS("") is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Empty. No argument provided, returns #N/A.');
		// Case #2: String. String not convertible to range, returns #VALUE!.
		oParser = new parserFormula('ROWS("A1:A2")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS("A1:A2") is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: String. String not convertible to range, returns #VALUE!.');
		// Case #3: Error. Propagates #N/A error.
		oParser = new parserFormula('ROWS(NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(NA()) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error. Propagates #N/A error.');
		// Case #4: Number. Number not a valid range, returns #VALUE!.
		oParser = new parserFormula('ROWS(38777)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(38777) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Number. Number not a valid range, returns #VALUE!.');
		// Case #5: Boolean. Boolean not a valid range, returns #VALUE!.
		oParser = new parserFormula('ROWS(TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(TRUE) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Boolean. Boolean not a valid range, returns #VALUE!.');
		// Case #6: Date. Date (serial number) not a valid range, returns #VALUE!.
		oParser = new parserFormula('ROWS(DATE(2025,1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(DATE(2025,1,1)) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Date. Date (serial number) not a valid range, returns #VALUE!.');
		// Case #7: Time. Time (fraction) not a valid range, returns #VALUE!.
		oParser = new parserFormula('ROWS(TIME(12,0,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(TIME(12,0,0)) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Time. Time (fraction) not a valid range, returns #VALUE!.');
		// Case #8: Area. Three-cell range (invalid for Area type, max 2 cells), returns #VALUE!.
		oParser = new parserFormula('ROWS(A100:A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(A100:A102) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Test: Negative case: Area. Three-cell range (invalid for Area type, max 2 cells), returns #VALUE!.');
		// Case #9: Name. Named range with multiple cells, returns #VALUE!.
		oParser = new parserFormula('ROWS(TestNameArea)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(TestNameArea) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Negative case: Name. Named range with multiple cells, returns #VALUE!.');
		// Case #10: Name3D. 3D named range with multiple cells, returns #VALUE!.
		oParser = new parserFormula('ROWS(TestNameArea3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(TestNameArea3D) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Negative case: Name3D. 3D named range with multiple cells, returns #VALUE!.');
		// Case #11: Ref3D. 3D range with three cells (invalid for Area3D, max 2 cells), returns #VALUE!.
		oParser = new parserFormula('ROWS(Sheet2!A1:A3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(Sheet2!A1:A3) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Test: Negative case: Ref3D. 3D range with three cells (invalid for Area3D, max 2 cells), returns #VALUE!.');
		// Case #12: Area3D. 3D range with text data, returns #VALUE!.
		oParser = new parserFormula('ROWS(Sheet2!A5:A6)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(Sheet2!A5:A6) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Negative case: Area3D. 3D range with text data, returns #VALUE!.');
		// Case #13: Array. 2x1 array with non-numeric elements, returns #VALUE!.
		oParser = new parserFormula('ROWS({TRUE;FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS({TRUE;FALSE}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Negative case: Array. 2x1 array with non-numeric elements, returns #VALUE!.');
		// Case #14: Table. Table column with text data, returns #VALUE!.
		oParser = new parserFormula('ROWS(Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Table. Table column with text data, returns #VALUE!.');
		// Case #15: Reference link. Reference to cell with text, returns #VALUE!.
		oParser = new parserFormula('ROWS(A105)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(A105) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Reference link. Reference to cell with text, returns #VALUE!.');
		// Case #16: Formula. Formula resulting in #NUM! error, propagates error.
		oParser = new parserFormula('ROWS(SQRT(-1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(SQRT(-1)) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula. Formula resulting in #NUM! error, propagates error.');
		// Case #17: Area. Range with error values, returns #VALUE!.
		oParser = new parserFormula('ROWS(A106:A107)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(A106:A107) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Negative case: Area. Range with error values, returns #VALUE!.');
		// Case #18: Name. Named range with text, returns #VALUE!.
		oParser = new parserFormula('ROWS(TestName2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(TestName2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Name. Named range with text, returns #VALUE!.');
		// Case #19: Ref3D. 3D reference to cell with text, returns #VALUE!.
		oParser = new parserFormula('ROWS(Sheet2!A7)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(Sheet2!A7) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Ref3D. 3D reference to cell with text, returns #VALUE!.');
		// Case #20: Formula. Formula returning a string, returns #VALUE!.
		oParser = new parserFormula('ROWS(IF(TRUE,"A1","A2"))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(IF(TRUE,"A1","A2")) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Formula. Formula returning a string, returns #VALUE!.');

		// Bounded cases:
		// Case #1: Reference link. Single cell (minimum valid range, 1 row). 1 argument used.
		oParser = new parserFormula('ROWS(A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Bounded case: Reference link. Single cell (minimum valid range, 1 row). 1 argument used.');
		// Case #2: Area. Full column range (maximum valid rows in Excel, 1,048,576 rows). 1 argument used.
		oParser = new parserFormula('ROWS(A1:A1048576)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS(A1:A1048576) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1048576, 'Test: Bounded case: Area. Full column range (maximum valid rows in Excel, 1,048,576 rows). 1 argument used.');
		// Case #3: Array. 1x1 array (minimum valid array size, 1 row). 1 argument used.
		oParser = new parserFormula('ROWS({1})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS({1}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Bounded case: Array. 1x1 array (minimum valid array size, 1 row). 1 argument used.');
		// Case #4: Array. Large array (5 rows, testing upper bound of small arrays). 1 argument used.
		oParser = new parserFormula('ROWS({1;2;3;4;5})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: ROWS({1;2;3;4;5}) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Test: Bounded case: Array. Large array (5 rows, testing upper bound of small arrays). 1 argument used.');

		// Need to fix: empty handle, string handle, formula/single num handle
		// Case #14: Formula. Range defined by ADDRESS formula (2 rows). 1 argument used.
		// Case #1: Empty. No argument provided, returns #N/A.
		// Case #2: String. String not convertible to range, returns #VALUE!.
		// Case #3: Error. Propagates #N/A error.
		// Case #4: Number. Number not a valid range, returns #VALUE!.
		// Case #5: Boolean. Boolean not a valid range, returns #VALUE!.
		// Case #6: Date. Date (serial number) not a valid range, returns #VALUE!.
		// Case #7: Time. Time (fraction) not a valid range, returns #VALUE!.
		// Case #16: Formula. Formula resulting in #NUM! error, propagates error.
		// Case #20: Formula. Formula returning a string, returns #VALUE!.

		//TODO нужна другая функция для тестирования
		//testArrayFormula2(assert, "COLUMNS", 1, 1);
	});

	QUnit.test("Test: \"SORT\"", function (assert) {
		let array;

		ws.getRange2("B20").setValue("");
		ws.getRange2("B21").setValue();
		ws.getRange2("C20").setValue("");
		ws.getRange2("C21").setValue("1");
		ws.getRange2("C22").cleanAll();

		ws.getRange2("C30").setValue("12");
		ws.getRange2("C30").setNumFormat("@");

		ws.getRange2("D10").setValue("19");
		ws.getRange2("D11").setValue("#N/A");
		ws.getRange2("D12").setValue("0");
		ws.getRange2("E10").setValue("str");
		ws.getRange2("E11").setValue("TRUE");
		ws.getRange2("E12").setValue("1");

		ws.getRange2("F10").setValue("string1");
		ws.getRange2("F11").setValue("string2");
		ws.getRange2("F12").setValue("1string");
		ws.getRange2("F13").setValue("2string");
		ws.getRange2("G10").setValue("Strung1");
		ws.getRange2("G11").setValue("sTrung2");
		ws.getRange2("G12").setValue("strunG33");
		ws.getRange2("G13").setValue("1String");

		ws.getRange2("F100").setValue("1s");
		ws.getRange2("F101").setValue("Родион");
		ws.getRange2("F102").setValue("222Gleb222");
		ws.getRange2("F103").setValue("20");
		ws.getRange2("F104").setValue("1");

		ws.getRange2("H10").setValue("25");
		ws.getRange2("H11").setValue("3");
		ws.getRange2("H12").setValue("27");
		ws.getRange2("I10").setValue("-23");
		ws.getRange2("I11").setValue("-1");
		ws.getRange2("I12").setValue("-3");
		
		ws.getRange2("J10").setValue("2");
		ws.getRange2("J11").setValue("6");
		ws.getRange2("J12").setValue("9");
		ws.getRange2("K10").setValue("4");
		ws.getRange2("K11").setValue("6");
		ws.getRange2("K12").setValue("1");
		
		oParser = new parserFormula('SORT(J10:K12,2,1,D10:E12)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(J10:K12,2,1,D10:E12)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, 'Result of SORT(J10:K12,2,1,D10:E12)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#VALUE!", 'Result of SORT(J10:K12,2,1,D10:E12)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#N/A", 'Result of SORT(J10:K12,2,1,D10:E12)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 0, 'Result of SORT(J10:K12,2,1,D10:E12)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#VALUE!", 'Result of SORT(J10:K12,2,1,D10:E12)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "#VALUE!", 'Result of SORT(J10:K12,2,1,D10:E12)[2,1]');

		oParser = new parserFormula('SORT(J10:K12,1,1,D10:E12)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(J10:K12,1,1,D10:E12)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, 'Result of SORT(J10:K12,1,1,D10:E12)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#VALUE!", 'Result of SORT(J10:K12,1,1,D10:E12)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#N/A", 'Result of SORT(J10:K12,1,1,D10:E12)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 0, 'Result of SORT(J10:K12,1,1,D10:E12)[1,1]');			// #VALUE!
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#VALUE!", 'Result of SORT(J10:K12,1,1,D10:E12)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "#VALUE!", 'Result of SORT(J10:K12,1,1,D10:E12)[2,1]');

		
		oParser = new parserFormula('SORT(H10:I12,C21:C22)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(H10:I12,C21:C22)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORT(H10:I12,C21:C22)');

		oParser = new parserFormula('SORT(H10:I12)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(H10:I12)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 3, 'Result of SORT(H10:I12)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), -1, 'Result of SORT(H10:I12)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 25, 'Result of SORT(H10:I12)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), -23, 'Result of SORT(H10:I12)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 27, 'Result of SORT(H10:I12)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), -3, 'Result of SORT(H10:I12)[2,1]');

		oParser = new parserFormula('SORT(H10:I12,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(H10:I12,2)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORT(H10:I12,2)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), -23, 'Result of SORT(H10:I12,2)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 27, 'Result of SORT(H10:I12,2)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), -3, 'Result of SORT(H10:I12,2)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 3, 'Result of SORT(H10:I12,2)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), -1, 'Result of SORT(H10:I12,2)[2,1]');

		oParser = new parserFormula('SORT(H10:I12,,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(H10:I12,,-1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 27, 'Result of SORT(H10:I12,,-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), -3, 'Result of SORT(H10:I12,,-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 25, 'Result of SORT(H10:I12,,-1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), -23, 'Result of SORT(H10:I12,,-1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 3, 'Result of SORT(H10:I12,,-1)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), -1, 'Result of SORT(H10:I12,,-1)[2,1]');

		oParser = new parserFormula('SORT(H10:I12,2,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(H10:I12,2,-1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 3, 'Result of SORT(H10:I12,2,-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), -1, 'Result of SORT(H10:I12,2,-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 27, 'Result of SORT(H10:I12,2,-1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), -3, 'Result of SORT(H10:I12,2,-1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 25, 'Result of SORT(H10:I12,2,-1)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), -23, 'Result of SORT(H10:I12,2,-1)[2,1]');

		oParser = new parserFormula('SORT(H10:I12,,,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(H10:I12,,,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), -23, 'Result of SORT(H10:I12,,,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 25, 'Result of SORT(H10:I12,,,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), -1, 'Result of SORT(H10:I12,,,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 3, 'Result of SORT(H10:I12,,,TRUE)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), -3, 'Result of SORT(H10:I12,,,TRUE)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 27, 'Result of SORT(H10:I12,,,TRUE)[2,1]');

		oParser = new parserFormula('SORT(H10:I12,2,-1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(H10:I12,2,-1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORT(H10:I12,2,-1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), -23, 'Result of SORT(H10:I12,2,-1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 3, 'Result of SORT(H10:I12,2,-1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), -1, 'Result of SORT(H10:I12,2,-1,TRUE)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 27, 'Result of SORT(H10:I12,2,-1,TRUE)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), -3, 'Result of SORT(H10:I12,2,-1,TRUE)[2,1]');

		oParser = new parserFormula('SORT(H10:I12,3,-1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(H10:I12,3,-1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORT(H10:I12,3,-1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), -23, 'Result of SORT(H10:I12,3,-1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 3, 'Result of SORT(H10:I12,3,-1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), -1, 'Result of SORT(H10:I12,3,-1,TRUE)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 27, 'Result of SORT(H10:I12,3,-1,TRUE)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), -3, 'Result of SORT(H10:I12,3,-1,TRUE)[2,1]');

		oParser = new parserFormula('SORT(H10:I12,3,-1,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(H10:I12,3,-1,FALSE)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORT(H10:I12,3,-1,FALSE)');

		oParser = new parserFormula('SORT(H10:I12,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(H10:I12,3)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORT(H10:I12,3)');

		oParser = new parserFormula('SORT(F10:G13,1,1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(F10:G13,1,1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "string1", 'Result of SORT(F10:G13,1,1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "Strung1", 'Result of SORT(F10:G13,1,1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "string2", 'Result of SORT(F10:G13,1,1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "sTrung2", 'Result of SORT(F10:G13,1,1,TRUE)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "1string", 'Result of SORT(F10:G13,1,1,TRUE)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "strunG33", 'Result of SORT(F10:G13,1,1,TRUE)[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "2string", 'Result of SORT(F10:G13,1,1,TRUE)[3,0]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), "1String", 'Result of SORT(F10:G13,1,1,TRUE)[3,1]');

		oParser = new parserFormula('SORT(F10:G13,2,1,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(F10:G13,2,1,FALSE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "2string", 'Result of SORT(F10:G13,1,1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "1String", 'Result of SORT(F10:G13,1,1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "string1", 'Result of SORT(F10:G13,1,1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "Strung1", 'Result of SORT(F10:G13,1,1,TRUE)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "string2", 'Result of SORT(F10:G13,1,1,TRUE)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "sTrung2", 'Result of SORT(F10:G13,1,1,TRUE)[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "1string", 'Result of SORT(F10:G13,1,1,TRUE)[3,0]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), "strunG33", 'Result of SORT(F10:G13,1,1,TRUE)[3,1]');

		oParser = new parserFormula('SORT(B20:C21,1,1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(B20:C21,1,1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "", 'Result of SORT(B20:C21,1,1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORT(B20:C21,1,1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", 'Result of SORT(B20:C21,1,1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 1, 'Result of SORT(B20:C21,1,1,TRUE)[1,1]');

		oParser = new parserFormula('SORT(D10:E12,1,1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(D10:E12,1,1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 19, 'Result of SORT(D10:E12,1,1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "str", 'Result of SORT(D10:E12,1,1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), "", 'Result of SORT(D10:E12,1,1,TRUE)[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#N/A", 'Result of SORT(D10:E12,1,1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "TRUE", 'Result of SORT(D10:E12,1,1,TRUE)[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), "", 'Result of SORT(D10:E12,1,1,TRUE)[1,2]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 0, 'Result of SORT(D10:E12,1,1,TRUE)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 1, 'Result of SORT(D10:E12,1,1,TRUE)[2,1]');
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), "", 'Result of SORT(D10:E12,1,1,TRUE)[2,2]');

		oParser = new parserFormula('SORT(25,-1,1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(25,-1,1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORT(25,-1,1,TRUE)');

		oParser = new parserFormula('SORT(25,0,1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(25,0,1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORT(25,0,1,TRUE)');

		oParser = new parserFormula('SORT(25,1,1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(25,1,1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORT(25,1,1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORT(25,1,1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", 'Result of SORT(25,1,1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of SORT(25,1,1,TRUE)[1,1]');

		oParser = new parserFormula('SORT(25,2,1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(25,2,1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORT(25,2,1,TRUE)');

		oParser = new parserFormula('SORT(25,1,-1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(25,1,-1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORT(25,1,-1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORT(25,1,-1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", 'Result of SORT(25,1,-1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of SORT(25,1,-1,TRUE)[1,1]');

		oParser = new parserFormula('SORT(25,1,0,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(25,1,0,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORT(25,1,0,TRUE)');

		oParser = new parserFormula('SORT(25,1,1,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(25,1,1,FALSE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORT(25,1,1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORT(25,1,1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", 'Result of SORT(25,1,1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of SORT(25,1,1,TRUE)[1,1]');

		// arrays
		oParser = new parserFormula('SORT({2,3,4;6,6,6;9,2,1},,-1,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,3,4;6,6,6;9,2,1},,-1,FALSE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 9, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,FALSE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 2, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,FALSE)[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 1, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,FALSE)[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 6, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,FALSE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 6, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,FALSE)[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 6, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,FALSE)[1,2]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 2, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,FALSE)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 3, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,FALSE)[2,1]');
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), 4, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,FALSE)[2,2]');

		oParser = new parserFormula('SORT({2,3,4;6,6,6;9,2,1},,1,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,3,4;6,6,6;9,2,1},,1,FALSE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,FALSE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 3, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,FALSE)[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 4, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,FALSE)[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 6, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,FALSE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 6, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-,FALSE)[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 6, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,FALSE)[1,2]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 9, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,FALSE)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 2, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,FALSE)[2,1]');
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), 1, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,FALSE)[2,2]');

		oParser = new parserFormula('SORT({2,3,4;6,6,6;9,2,1},,-1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,3,4;6,6,6;9,2,1},,-1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 4, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 3, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 2, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,TRUE)[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 6, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 6, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,TRUE)[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 6, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,TRUE)[1,2]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 1, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,TRUE)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 2, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,TRUE)[2,1]');
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), 9, 'Result of SORT({2,3,4;6,6,6;9,2,1},,-1,TRUE)[2,2]');

		oParser = new parserFormula('SORT({2,3,4;6,6,6;9,2,1},,1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,3,4;6,6,6;9,2,1},,1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 3, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 4, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,TRUE)[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 6, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 6, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,TRUE)[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 6, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,TRUE)[1,2]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 9, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,TRUE)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 2, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,TRUE)[2,1]');
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), 1, 'Result of SORT({2,3,4;6,6,6;9,2,1},,1,TRUE)[2,2]');

		oParser = new parserFormula('SORT({2,4;6,6;9,1},{2,3},1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,4;6,6;9,1},{2,3},1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, 'Result of SORT({2,4;6,6;9,1},{3,3},1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 4, 'Result of SORT({2,4;6,6;9,1},{3,3},1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 6, 'Result of SORT({2,4;6,6;9,1},{3,3},1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 6, 'Result of SORT({2,4;6,6;9,1},{3,3},1,TRUE)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 9, 'Result of SORT({2,4;6,6;9,1},{3,3},1,TRUE)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 1, 'Result of SORT({2,4;6,6;9,1},{3,3},1,TRUE)[2,1]');

		oParser = new parserFormula('SORT({2,4;6,6;9,1},{2,3},1,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,4;6,6;9,1},{2,3},1,FALSE)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORT({2,4;6,6;9,1},{3,3},1,FALSE)');

		oParser = new parserFormula('SORT({2,4;6,6;9,1},1,1,{TRUE,FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,4;6,6;9,1},1,1,{TRUE,FALSE})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, 'Result of SORT({2,4;6,6;9,1},1,1,{TRUE,FALSE})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, 'Result of SORT({2,4;6,6;9,1},1,1,{TRUE,FALSE})[0,1]');		// #VALUE!

		oParser = new parserFormula('SORT({2,4;6,6;9,1},1,-1,{TRUE,FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,4;6,6;9,1},1,-1,{TRUE,FALSE})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 4, 'Result of SORT({2,4;6,6;9,1},1,-1,{TRUE,FALSE})[0,0]');			
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, 'Result of SORT({2,4;6,6;9,1},1,-1,{TRUE,FALSE})[0,1]');		// #VALUE!

		oParser = new parserFormula('SORT({2,4;6,6;9,1},2,1,{TRUE,FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,4;6,6;9,1},2,1,{TRUE,FALSE})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, 'Result of SORT({2,4;6,6;9,1},2,1,{TRUE,FALSE})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, 'Result of SORT({2,4;6,6;9,1},2,1,{TRUE,FALSE})[0,1]');

		oParser = new parserFormula('SORT({2,4;6,6;9,1},2,-1,{TRUE,FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,4;6,6;9,1},2,-1,{TRUE,FALSE})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, 'Result of SORT({2,4;6,6;9,1},2,-1,{TRUE,FALSE})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, 'Result of SORT({2,4;6,6;9,1},2,-1,{TRUE,FALSE})[0,1]');		

		oParser = new parserFormula('SORT({2,4;6,6;9,1},1,1,{FALSE,TRUE})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,4;6,6;9,1},1,1,{FALSE,TRUE})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, 'Result of SORT({2,4;6,6;9,1},1,1,{FALSE,TRUE})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, 'Result of SORT({2,4;6,6;9,1},1,1,{FALSE,TRUE})[0,1]');	// #VALUE!

		oParser = new parserFormula('SORT({2,4;6,6;9,1},1,-1,{FALSE,TRUE})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,4;6,6;9,1},1,-1,{FALSE,TRUE})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 9, 'Result of SORT({2,4;6,6;9,1},1,-1,{FALSE,TRUE})[0,0]');			
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, 'Result of SORT({2,4;6,6;9,1},1,-1,{FALSE,TRUE})[0,1]');

		oParser = new parserFormula('SORT({2,4;6,6;9,1},2,1,{FALSE,TRUE})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,4;6,6;9,1},2,1,{FALSE,TRUE})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 9, 'Result of SORT({2,4;6,6;9,1},2,1,{FALSE,TRUE})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, 'Result of SORT({2,4;6,6;9,1},2,1,{FALSE,TRUE})[0,1]');	

		oParser = new parserFormula('SORT({2,4;6,6;9,1},2,-1,{FALSE,TRUE})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT({2,4;6,6;9,1},2,-1,{FALSE,TRUE})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 6, 'Result of SORT({2,4;6,6;9,1},2,-1,{FALSE,TRUE})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, 'Result of SORT({2,4;6,6;9,1},2,-1,{FALSE,TRUE})[0,1]');	

		oParser = new parserFormula('SORT(25,1.9,1.9,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(25,1.9,1.9,FALSE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, "Result of SORT(25,1.9,1.9,FALSE)");
		
		oParser = new parserFormula('SORT(25,0.9,1.9,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(25,0.9,1.9,FALSE)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of SORT(25,0.9,1.9,FALSE)");

		oParser = new parserFormula('SORT(25,1.9,0.9,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(25,1.9,0.9,FALSE)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of SORT(25,1.9,0.9,FALSE)");

		oParser = new parserFormula('SORT(25,1.9,-1.9,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(25,1.9,-1.9,FALSE)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of SORT(25,1.9,-1.9,FALSE)");

		oParser = new parserFormula('SORT(25,1.9,-0.9,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(25,1.9,-0.9,FALSE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, "Result of SORT(25,1.9,-0.9,FALSE)");

		ws.getRange2("AB101").setValue("a");
		ws.getRange2("AB102").setValue("1");

		oParser = new parserFormula('SORT(AB101:AB102,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(AB101:AB102,1,1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORT(AB101:AB102,1,1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORT(AB101:AB102,1,1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "a", 'Result of SORT(AB101:AB102,1,1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of SORT(AB101:AB102,1,1)[1,1]');

		oParser = new parserFormula('SORT(AB101:AB102,1,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(AB101:AB102,1,-1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "a", 'Result of SORT(AB101:AB102,1,-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORT(AB101:AB102,1,-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 1, 'Result of SORT(AB101:AB102,1,-1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of SORT(AB101:AB102,1,-1)[1,1]');

		ws.getRange2("A101").setValue("a");
		ws.getRange2("A102").setValue("1");

		oParser = new parserFormula('SORT(A101:A102,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(A101:A102,1,1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORT(A101:A102,1,1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORT(A101:A102,1,1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "a", 'Result of SORT(A101:A102,1,1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of SORT(A101:A102,1,1)[1,1]');

		ws.getRange2("B101").setValue("");
		ws.getRange2("B102").setValue("");
		ws.getRange2("B103").setValue("");
		ws.getRange2("B104").setValue("");
		ws.getRange2("B105").setValue("");
		ws.getRange2("C101").setValue("str");
		ws.getRange2("C102").setValue("99999");
		ws.getRange2("C103").setValue("#NUM!");
		ws.getRange2("C104").setValue("FALSE");
		ws.getRange2("C105").setValue("");

		oParser = new parserFormula('SORT(B101:C105,1,1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(B101:C105,1,1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "str", 'Result of SORT(B101:C105,1,1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORT(B101:C105,1,1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 99999, 'Result of SORT(B101:C105,1,1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of SORT(B101:C105,1,1,TRUE)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#NUM!", 'Result of SORT(B101:C105,1,1,TRUE)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "", 'Result of SORT(B101:C105,1,1,TRUE)[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "FALSE", 'Result of SORT(B101:C105,1,1,TRUE)[3,0]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), "", 'Result of SORT(B101:C105,1,1,TRUE)[3,1]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), "", 'Result of SORT(B101:C105,1,1,TRUE)[4,0]');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), "", 'Result of SORT(B101:C105,1,1,TRUE)[4,1]');

		oParser = new parserFormula('SORT(B101:C104,2,1,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(A101:A102,2,1,FALSE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "", 'Result of SORT(B101:C105,1,1,TRUE)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 99999, 'Result of SORT(B101:C105,1,1,TRUE)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", 'Result of SORT(B101:C105,1,1,TRUE)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "str", 'Result of SORT(B101:C105,1,1,TRUE)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", 'Result of SORT(B101:C105,1,1,TRUE)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), "FALSE", 'Result of SORT(B101:C105,1,1,TRUE)[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "", 'Result of SORT(B101:C105,1,1,TRUE)[3,0]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), "#NUM!", 'Result of SORT(B101:C105,1,1,TRUE)[3,1]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), "", 'Result of SORT(B101:C105,1,1,TRUE)[4,0]');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), "", 'Result of SORT(B101:C105,1,1,TRUE)[4,1]');

		ws.getRange2("B1:C2").cleanAll();

		oParser = new parserFormula('SORT(B1:B2,C1:C2)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORT(B1:B2,C1:C2)');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of SORT(B1:B2,C1:C2)');

		ws.getRange2("A1:C214").cleanAll();
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("0.5");
		ws.getRange2("A101").setValue("1.5");
		ws.getRange2("A104").setValue("-1");
		// For area
		ws.getRange2("A102").setValue("0.5");
		ws.getRange2("A103").setValue("");
		ws.getRange2("A105").setValue("1");
		ws.getRange2("A110").setValue("TRUE");
		ws.getRange2("A111").setValue("FALSE");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 1);
		ws.getRange2("A601").setValue("1"); // Number (Column1)
		ws.getRange2("B601").setValue("1s"); // Text (Column2)
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll("");
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2

		// Positive cases:
		// Case #1: Area, Number. Sorts a single-column range in ascending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A100:A101,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A100:A101,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.5, 'Test: Positive case: Area, Number. Sorts a single-column range in ascending order. 3 of 4 arguments used.');
		// Case #2: Area, Number. Sorts a single-column range in descending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A102:A103,1,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A102:A103,1,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '', 'Test: Positive case: Area, Number. Sorts a single-column range in descending order. 3 of 4 arguments used.');
		// Case #3: Area, Number, Number, Boolean. Sorts a single-column range by column in ascending order. 4 of 4 arguments used.
		oParser = new parserFormula('SORT(A104:A105,1,1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A104:A105,1,1,TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), -1, 'Test: Positive case: Area, Number, Number, Boolean. Sorts a single-column range by column in ascending order. 4 of 4 arguments used.');
		// Case #4: Area, Number, Number, Boolean. Sorts a multi-column range by second column in ascending order. 4 of 4 arguments used.
		oParser = new parserFormula('SORT(A106:A107,2,1,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A106:A107,2,1,FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Positive case: Area, Number, Number, Boolean. Sorts a multi-column range by second column in ascending order. 4 of 4 arguments used.');
		// Case #5: Array, Number. Sorts a single-column array in ascending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT({5,2,8},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT({5,2,8},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 5, 'Test: Positive case: Array, Number. Sorts a single-column array in ascending order. 3 of 4 arguments used.');
		// Case #6: Array, Number. Sorts a single-column string array in descending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT({"z","a","m"},1,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT({"z","a","m"},1,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'z', 'Test: Positive case: Array, Number. Sorts a single-column string array in descending order. 3 of 4 arguments used.');
		// Case #7: Formula, Number. Sorts a range with nested IF formula in ascending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(IF(TRUE,A108:A109,{1,2}),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(IF(TRUE,A108:A109,{1,2}),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0, 'Test: Positive case: Formula, Number. Sorts a range with nested IF formula in ascending order. 3 of 4 arguments used.');
		// Case #8: Reference link, Number. Sorts a single-cell reference as an array in ascending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A100,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A100,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.5, 'Test: Positive case: Reference link, Number. Sorts a single-cell reference as an array in ascending order. 3 of 4 arguments used.');
		// Case #9: Table, Number. Sorts a table column in ascending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(Table1[Column1],1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(Table1[Column1],1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Table, Number. Sorts a table column in ascending order. 3 of 4 arguments used.');
		// Case #10: Ref3D, Number. Sorts a 3D reference range in ascending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(Sheet2!A1:A2,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(Sheet2!A1:A2,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Ref3D, Number. Sorts a 3D reference range in ascending order. 3 of 4 arguments used.');
		// Case #11: Area3D, Number. Sorts a 3D single-column range in ascending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(Sheet2!A3:A4,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(Sheet2!A3:A4,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'Text', 'Test: Positive case: Area3D, Number. Sorts a 3D single-column range in ascending order. 3 of 4 arguments used.');
		// Case #12: Name, Number. Sorts a named range in ascending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(TestName,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(TestName,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), -0.5, 'Test: Positive case: Name, Number. Sorts a named range in ascending order. 3 of 4 arguments used.');
		// Case #13: Name3D, Number. Sorts a 3D named range in ascending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(TestName3D,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(TestName3D,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), -0.5, 'Test: Positive case: Name3D, Number. Sorts a 3D named range in ascending order. 3 of 4 arguments used.');
		// Case #14: Area, Number. Sorts a range with omitted sort_order (defaults to ascending). 2 of 4 arguments used.
		oParser = new parserFormula('SORT(A110:A111,1,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A110:A111,1,) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0, 'Test: Positive case: Area, Number. Sorts a range with omitted sort_order (defaults to ascending). 2 of 4 arguments used.');
		// Case #15: Array, Formula. Sorts an array with sort_index as a formula. 3 of 4 arguments used.
		oParser = new parserFormula('SORT({10,5,1},SQRT(1),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT({10,5,1},SQRT(1),1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 10, 'Test: Positive case: Array, Formula. Sorts an array with sort_index as a formula. 3 of 4 arguments used.');
		// Case #16: Formula, Number. SORT inside a SUM formula, sorting in ascending order. 3 of 4 arguments used.
		oParser = new parserFormula('SUM(SORT(A100:A101,1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SUM(SORT(A100:A101,1,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Formula, Number. SORT inside a SUM formula, sorting in ascending order. 3 of 4 arguments used.');
		// Case #17: Date, Number. Sorts an array of dates in ascending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT({45658,45292},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT({45658,45292},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 45658, 'Test: Positive case: Date, Number. Sorts an array of dates in ascending order. 3 of 4 arguments used.');
		// Case #18: Time, Number. Sorts an array of times in ascending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT({0.6,0.5},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT({0.6,0.5},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.6, 'Test: Positive case: Time, Number. Sorts an array of times in ascending order. 3 of 4 arguments used.');
		// Case #19: String, Number. Sorts a string array of dates in ascending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT({"01/01/2025","01/01/2024"},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT({"01/01/2025","01/01/2024"},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '01/01/2025', 'Test: Positive case: String, Number. Sorts a string array of dates in ascending order. 3 of 4 arguments used.');
		// Case #20: Area, Number, Number. Sorts a mixed-type range (numbers and strings) in descending order. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A100:A101,1,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A100:A101,1,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1.5, 'Test: Positive case: Area, Number, Number. Sorts a mixed-type range (numbers and strings) in descending order. 3 of 4 arguments used.');

		// Negative cases:
		// Case #1: Empty. Empty array argument returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '', 'Test: Negative case: Empty. Empty array argument returns #VALUE!. 3 of 4 arguments used.');
		// Case #2: Area, Empty. Empty sort_index returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A100:A101,,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A100:A101,,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.5, 'Test: Negative case: Area, Empty. Empty sort_index returns #VALUE!. 3 of 4 arguments used.');
		// Case #3: Area, Number, Empty. Empty sort_order with valid array and sort_index; defaults to ascending. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A102:A103,1,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A102:A103,1,) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.5, 'Test: Negative case: Area, Number, Empty. Empty sort_order with valid array and sort_index; defaults to ascending. 3 of 4 arguments used.');
		// Case #4: Area, Number, Boolean. Invalid sort_order (boolean) returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A104:A105,1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A104:A105,1,TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), -1, 'Test: Negative case: Area, Number, Boolean. Invalid sort_order (boolean) returns #VALUE!. 3 of 4 arguments used.');
		// Case #5: Area, Number, Number. sort_index out of range returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A106:A107,3,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A106:A107,3,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number, Number. sort_index out of range returns #VALUE!. 3 of 4 arguments used.');
		// Case #6: Error, Number. Error in array propagates #N/A. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(NA(),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(NA(),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error, Number. Error in array propagates #N/A. 3 of 4 arguments used.');
		// Case #7: Area, Number. sort_index of 0 returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A100:A101,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A100:A101,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number. sort_index of 0 returns #VALUE!. 3 of 4 arguments used.');
		// Case #8: Area, String. Non-numeric sort_index returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A102:A103,"1",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A102:A103,"1",1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.5, 'Test: Negative case: Area, String. Non-numeric sort_index returns #VALUE!. 3 of 4 arguments used.');
		// Case #9: Table, Number. Invalid sort_index (0) for table column returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(Table1[Column2],1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(Table1[Column2],1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '1s', 'Test: Negative case: Table, Number. Invalid sort_index (0) for table column returns #VALUE!. 3 of 4 arguments used.');
		// Case #10: Ref3D, Number. 3D reference with invalid data (text) returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(Sheet2!A5:A6,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(Sheet2!A5:A6,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '', 'Test: Negative case: Ref3D, Number. 3D reference with invalid data (text) returns #VALUE!. 3 of 4 arguments used.');
		// Case #11: Name, Number. Named range with multi-cell area returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(TestNameArea2,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(TestNameArea2,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.8, 'Test: Negative case: Name, Number. Named range with multi-cell area returns #VALUE!. 3 of 4 arguments used.');
		// Case #12: Name3D, Number. 3D named range with multi-cell area returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(TestNameArea3D2,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(TestNameArea3D2,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.8, 'Test: Negative case: Name3D, Number. 3D named range with multi-cell area returns #VALUE!. 3 of 4 arguments used.');
		// Case #13: Area3D, Number. 3D range with error value returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(Sheet2!A7:A8,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(Sheet2!A7:A8,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '', 'Test: Negative case: Area3D, Number. 3D range with error value returns #VALUE!. 3 of 4 arguments used.');
		// Case #14: Array, Number. Array with boolean values returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT({TRUE,FALSE},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT({TRUE,FALSE},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'TRUE', 'Test: Negative case: Array, Number. Array with boolean values returns #VALUE!. 3 of 4 arguments used.');
		// Case #15: Area, Number. Range with error value returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A108:A109,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A108:A109,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '', 'Test: Negative case: Area, Number. Range with error value returns #VALUE!. 3 of 4 arguments used.');
		// Case #16: Formula, Number. Formula resulting in #NUM! returns #NUM!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(SQRT(-1),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(SQRT(-1),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula, Number. Formula resulting in #NUM! returns #NUM!. 3 of 4 arguments used.');
		// Case #17: Area, Number, Number. Negative sort_index returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A110:A111,-1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A110:A111,-1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number, Number. Negative sort_index returns #VALUE!. 3 of 4 arguments used.');
		// Case #18: Array, Number. Empty array returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT({"."},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT({"."},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '.', 'Test: Negative case: Array, Number. Empty array returns #VALUE!. 3 of 4 arguments used.');
		// Case #19: Area, Number, String. String sort_order returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A100:A101,1,"1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A100:A101,1,"1") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.5, 'Test: Negative case: Area, Number, String. String sort_order returns #VALUE!. 3 of 4 arguments used.');
		// Case #20: Area, Number, Number. sort_order of 0 returns #VALUE!. 3 of 4 arguments used.
		oParser = new parserFormula('SORT(A102:A103,1,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT(A102:A103,1,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Area, Number, Number. sort_order of 0 returns #VALUE!. 3 of 4 arguments used.');

		// Bounded cases:
		// Case #1: Array, Number. Single-element array (minimum valid array size). 3 of 4 arguments used.
		oParser = new parserFormula('SORT({1},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT({1},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Bounded case: Array, Number. Single-element array (minimum valid array size). 3 of 4 arguments used.');
		// Case #2: Array, Number. Array with max/min Excel numbers. 3 of 4 arguments used.
		oParser = new parserFormula('SORT({9.99999999999999E+307;-9.99999999999999E+307},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORT({9.99999999999999E+307;-9.99999999999999E+307},1,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), -1e+308, 'Test: Bounded case: Array, Number. Array with max/min Excel numbers. 3 of 4 arguments used.');

		// Need to fix:
		// Case #14: Area, Number. Sorts a range with omitted sort_order (defaults to ascending). 2 of 4 arguments used.
		// Case #2: Array, Number. Array with max/min Excel numbers. 3 of 4 arguments used.
	});

	QUnit.test("Test: \"SORTBY\"", function (assert) {
		let array;

		ws.getRange2("B20").setValue("");
		ws.getRange2("B21").setValue();
		ws.getRange2("C20").setValue("");
		ws.getRange2("C21").setValue("1");
		ws.getRange2("B20:C21").cleanAll();

		ws.getRange2("C30").setValue("12");
		ws.getRange2("C30").setNumFormat("@");

		ws.getRange2("D10").setValue("19");
		ws.getRange2("D11").setValue("#N/A");
		ws.getRange2("D12").setValue("0");
		ws.getRange2("E10").setValue("str");
		ws.getRange2("E11").setValue("TRUE");
		ws.getRange2("E12").setValue("1");

		ws.getRange2("F10").setValue("1s");
		ws.getRange2("F11").setValue("Родион");
		ws.getRange2("F12").setValue("222Gleb222");
		ws.getRange2("F13").setValue("20");
		ws.getRange2("F14").setValue("1");

		ws.getRange2("H10").setValue("25");
		ws.getRange2("H11").setValue("3");
		ws.getRange2("H12").setValue("27");
		ws.getRange2("I10").setValue("-23");
		ws.getRange2("I11").setValue("-1");
		ws.getRange2("I12").setValue("-3");

		ws.getRange2("J10").setValue("#N/A");
		ws.getRange2("J11").setValue("#NUM!");
		ws.getRange2("J12").setValue("#DIV/0!");

		oParser = new parserFormula('SORTBY(H10,,E11)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10,,E11)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORTBY(H10,,E11)');

		oParser = new parserFormula('SORTBY(H10,H12,E11)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10,H12,E11)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORTBY(H10,H12,E11)');

		oParser = new parserFormula('SORTBY(J10,H12,E11)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(J10,H12,E11)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue().getValue(), "#N/A", 'Result of SORTBY(J10,H12,E11)');

		oParser = new parserFormula('SORTBY(J10,J11,E11)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(J10,J11,E11)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue().getValue(), "#N/A", 'Result of SORTBY(J10,J11,E11)');

		oParser = new parserFormula('SORTBY(J10,J11,J12)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(J10,J11,J12)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue().getValue(), "#N/A", 'Result of SORTBY(J10,J11,J12)');

		oParser = new parserFormula('SORTBY(25,,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(25,,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORTBY(25,,TRUE)');

		oParser = new parserFormula('SORTBY(25,27,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(25,27,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORTBY(25,27,TRUE)');

		oParser = new parserFormula('SORTBY(#N/A,27,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(#N/A,27,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#N/A", 'Result of SORTBY(#N/A,27,TRUE)');

		oParser = new parserFormula('SORTBY(25,#NUM!,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(25,#NUM!,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#NUM!", 'Result of SORTBY(25,#NUM!,TRUE)');

		oParser = new parserFormula('SORTBY(25,24,#DIV/0!)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(25,24,#DIV/0!)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#DIV/0!", 'Result of SORTBY(25,27,#DIV/0!)');

		oParser = new parserFormula('SORTBY(#N/A,#NUM!,#DIV/0!)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(#N/A,#NUM!,#DIV/0!)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#N/A", 'Result of SORTBY(#N/A,#NUM!,#DIV/0!)');

		oParser = new parserFormula('SORTBY(,B21:B21)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(,B21:B21)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "", 'Result of SORTBY(,B21:B21)[0,0]');

		oParser = new parserFormula('SORTBY(D10:D10,B21:B21)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(D10:D10,B21:B21)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 19, 'Result of SORTBY(D10:D10,B21:B21)[0,0]');

		oParser = new parserFormula('SORTBY(F10:F14,F10:F14)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(F10:F14,F10:F14)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY(F10:F14,F10:F14)[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 20, 'Result of SORTBY(F10:F14,F10:F14)[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "1s", 'Result of SORTBY(F10:F14,F10:F14)[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "222Gleb222", 'Result of SORTBY(F10:F14,F10:F14)[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), "Родион", 'Result of SORTBY(F10:F14,F10:F14)[4,0]');

		oParser = new parserFormula('SORTBY(F10:F14,F10:F14,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(F10:F14,F10:F14,-1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "Родион", 'Result of SORTBY(F10:F14,F10:F14)[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "222Gleb222", 'Result of SORTBY(F10:F14,F10:F14)[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "1s", 'Result of SORTBY(F10:F14,F10:F14)[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 20, 'Result of SORTBY(F10:F14,F10:F14)[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 1, 'Result of SORTBY(F10:F14,F10:F14)[4,0]');

		oParser = new parserFormula('SORTBY(H10:I12,H10:H12)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,H10:H12)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 3, 'Result of SORTBY(H10:I12,H10:H12)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), -1, 'Result of SORTBY(H10:I12,H10:H12)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 25, 'Result of SORTBY(H10:I12,H10:H12)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), -23, 'Result of SORTBY(H10:I12,H10:H12)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 27, 'Result of SORTBY(H10:I12,H10:H12)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), -3, 'Result of SORTBY(H10:I12,H10:H12)[2,1]');

		oParser = new parserFormula('SORTBY(H10:I12,H10:H12,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,H10:H12,-1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 27, 'Result of SORTBY(H10:I12,H10:H12,-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), -3, 'Result of SORTBY(H10:I12,H10:H12,-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 25, 'Result of SORTBY(H10:I12,H10:H12,-1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), -23, 'Result of SORTBY(H10:I12,H10:H12,-1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 3, 'Result of SORTBY(H10:I12,H10:H12,-1)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), -1, 'Result of SORTBY(H10:I12,H10:H12,-1)[2,1]');

		oParser = new parserFormula('SORTBY(H10:I12,H10:I10)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,H10:I10)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), -23, 'Result of SORTBY(H10:I12,H10:I10)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 25, 'Result of SORTBY(H10:I12,H10:I10)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), -1, 'Result of SORTBY(H10:I12,H10:I10)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 3, 'Result of SORTBY(H10:I12,H10:I10)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), -3, 'Result of SORTBY(H10:I12,H10:I10)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 27, 'Result of SORTBY(H10:I12,H10:I10)[2,1]');

		oParser = new parserFormula('SORTBY(H10:I12,H10:I10,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,H10:I10,-1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORTBY(H10:I12,H10:I10,-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), -23, 'Result of SORTBY(H10:I12,H10:I10,-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 3, 'Result of SORTBY(H10:I12,H10:I10,-1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), -1, 'Result of SORTBY(H10:I12,H10:I10,-1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 27, 'Result of SORTBY(H10:I12,H10:I10,-1)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), -3, 'Result of SORTBY(H10:I12,H10:I10,-1)[2,1]');

		oParser = new parserFormula('SORTBY(H10:I12,H10:I10,E12)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,H10:I10,E12)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), -23, 'Result of SORTBY(H10:I12,H10:I10,1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 25, 'Result of SORTBY(H10:I12,H10:I10,1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), -1, 'Result of SORTBY(H10:I12,H10:I10,1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 3, 'Result of SORTBY(H10:I12,H10:I10,1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), -3, 'Result of SORTBY(H10:I12,H10:I10,1)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 27, 'Result of SORTBY(H10:I12,H10:I10,1)[2,1]');

		oParser = new parserFormula('SORTBY(H10:I12,H10:I10,E12:E12)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,H10:I10,E12:E12)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), -23, 'Result of SORTBY(H10:I12,H10:I10,1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 25, 'Result of SORTBY(H10:I12,H10:I10,1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), -1, 'Result of SORTBY(H10:I12,H10:I10,1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 3, 'Result of SORTBY(H10:I12,H10:I10,1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), -3, 'Result of SORTBY(H10:I12,H10:I10,1)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 27, 'Result of SORTBY(H10:I12,H10:I10,1)[2,1]');

		oParser = new parserFormula('SORTBY(H10:I12,H10:I10,I11)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,H10:I10,I11)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORTBY(H10:I12,H10:I10,-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), -23, 'Result of SORTBY(H10:I12,H10:I10,-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 3, 'Result of SORTBY(H10:I12,H10:I10,-1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), -1, 'Result of SORTBY(H10:I12,H10:I10,-1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 27, 'Result of SORTBY(H10:I12,H10:I10,-1)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), -3, 'Result of SORTBY(H10:I12,H10:I10,-1)[2,1]');

		oParser = new parserFormula('SORTBY(H10:I12,H10:I10,I11:I11)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,H10:I10,I11:I11)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORTBY(H10:I12,H10:I10,-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), -23, 'Result of SORTBY(H10:I12,H10:I10,-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 3, 'Result of SORTBY(H10:I12,H10:I10,-1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), -1, 'Result of SORTBY(H10:I12,H10:I10,-1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 27, 'Result of SORTBY(H10:I12,H10:I10,-1)[2,0]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), -3, 'Result of SORTBY(H10:I12,H10:I10,-1)[2,1]');

		ws.getRange2("C101").setValue("1");
		ws.getRange2("C102").setValue("2");
		ws.getRange2("C103").setValue("2");
		ws.getRange2("C104").setValue("2");
		ws.getRange2("C105").setValue("4");
		ws.getRange2("C106").setValue("5");
		ws.getRange2("D101").setValue("8");
		ws.getRange2("D102").setValue("3");
		ws.getRange2("D103").setValue("4");
		ws.getRange2("D104").setValue("4");
		ws.getRange2("D105").setValue("7");	
		ws.getRange2("D106").setValue("4");
		ws.getRange2("E101").setValue("0");
		ws.getRange2("E102").setValue("3");
		ws.getRange2("E103").setValue("2");
		ws.getRange2("E104").setValue("1");
		ws.getRange2("E105").setValue("2");
		ws.getRange2("E106").setValue("3");
		ws.getRange2("F101").setValue("0");
		ws.getRange2("F102").setValue("5");
		ws.getRange2("F103").setValue("0");
		ws.getRange2("F104").setValue("0");
		ws.getRange2("F105").setValue("0");
		ws.getRange2("F106").setValue("6");

		oParser = new parserFormula('SORTBY(C101:D101,{1,2,3,4,5},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(C101:D101,{1,2,3,4,5},1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 1, 'Result of SORTBY(C101:D101,{1,2,3,4,5},1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 8, 'Result of SORTBY(C101:D101,{1,2,3,4,5},1)[0,1]');
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), "", 'Result of SORTBY(C101:D101,{1,2,3,4,5},1)[0,2]');

		oParser = new parserFormula('SORTBY(C101:D101,{1,2,3,4,5},-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(C101:D101,{1,2,3,4,5},-1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 1, 'Result of SORTBY(C101:D101,{1,2,3,4,5},-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 8, 'Result of SORTBY(C101:D101,{1,2,3,4,5},-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), "", 'Result of SORTBY(C101:D101,{1,2,3,4,5},-1)[0,2]');

		// two conditions(by_row)
		// let bbox = ws.getRange2("C2").bbox;
		// let cellWithFormula = new window['AscCommonExcel'].CCellWithFormula(ws, bbox.r1, bbox.c1);
		oParser = new parserFormula('SORTBY(C101:F106,C101:F101,1,C103:F103,-1)', "C2", ws);
		// oParser.setArrayFormulaRef(ws.getRange2("C2").bbox);
		assert.ok(oParser.parse(), 'SORTBY(C101:F106,C101:F101,1,C103:F103,-1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 0, 'Result of SORTBY(C101:F106,C101:F101,1,C103:F103,-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 3, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 2, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 1, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 2, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[4,0]');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), 3, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[5,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 5, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 0, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), 0, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[3,1]');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), 0, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[4,1]');
		assert.strictEqual(array.getElementRowCol(5, 1).getValue(), 6, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[5,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 1, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 2, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[1,2]');
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), 2, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[2,2]');
		assert.strictEqual(array.getElementRowCol(3, 2).getValue(), 2, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[3,2]');
		assert.strictEqual(array.getElementRowCol(4, 2).getValue(), 4, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[4,2]');
		assert.strictEqual(array.getElementRowCol(5, 2).getValue(), 5, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[5,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 8, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), 3, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[1,3]');
		assert.strictEqual(array.getElementRowCol(2, 3).getValue(), 4, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[2,3]');
		assert.strictEqual(array.getElementRowCol(3, 3).getValue(), 4, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[3,3]');
		assert.strictEqual(array.getElementRowCol(4, 3).getValue(), 7, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[4,3]');
		assert.strictEqual(array.getElementRowCol(5, 3).getValue(), 4, 'Result of SORTBY(C101:F106,D101:D106,1,F101:F106,-1)[5,3]');

		oParser = new parserFormula('SORTBY(C101:F106,C101:F101,,C103:F103,)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(C101:F106,C101:F101,1,C103:F103,1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 0, 'Result of SORTBY(C101:F106,C101:F101,,C103:F103,)[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 5, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 0, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 0, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 0, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[4,0]');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), 6, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[5,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 3, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 2, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), 1, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[3,1]');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), 2, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[4,1]');
		assert.strictEqual(array.getElementRowCol(5, 1).getValue(), 3, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[5,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 1, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 2, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[1,2]');
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), 2, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[2,2]');
		assert.strictEqual(array.getElementRowCol(3, 2).getValue(), 2, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[3,2]');
		assert.strictEqual(array.getElementRowCol(4, 2).getValue(), 4, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[4,2]');
		assert.strictEqual(array.getElementRowCol(5, 2).getValue(), 5, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[5,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 8, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), 3, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[1,3]');
		assert.strictEqual(array.getElementRowCol(2, 3).getValue(), 4, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[2,3]');
		assert.strictEqual(array.getElementRowCol(3, 3).getValue(), 4, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[3,3]');
		assert.strictEqual(array.getElementRowCol(4, 3).getValue(), 7, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[4,3]');
		assert.strictEqual(array.getElementRowCol(5, 3).getValue(), 4, 'Result of SORTBY(C101:F106,D101:D106,,F101:F106,)[5,3]');

		// two conditions(by_col) 
		oParser = new parserFormula('SORTBY(C101:F106,D101:D106,1,F101:F106,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(C101:F106,D101:D106,1,F101:F106,-1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 5, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 4, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[4,0]');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), 1, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[5,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 3, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 4, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 4, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), 4, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[3,1]');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), 7, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[4,1]');
		assert.strictEqual(array.getElementRowCol(5, 1).getValue(), 8, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[5,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 3, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 3, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[1,2]');
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[2,2]');
		assert.strictEqual(array.getElementRowCol(3, 2).getValue(), 1, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[3,2]');
		assert.strictEqual(array.getElementRowCol(4, 2).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[4,2]');
		assert.strictEqual(array.getElementRowCol(5, 2).getValue(), 0, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[5,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 5, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), 6, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[1,3]');
		assert.strictEqual(array.getElementRowCol(2, 3).getValue(), 0, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[2,3]');
		assert.strictEqual(array.getElementRowCol(3, 3).getValue(), 0, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[3,3]');
		assert.strictEqual(array.getElementRowCol(4, 3).getValue(), 0, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[4,3]');
		assert.strictEqual(array.getElementRowCol(5, 3).getValue(), 0, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,-1)[5,3]');

		oParser = new parserFormula('SORTBY(C101:F106,D101:D106,1,F101:F106,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(C101:F106,D101:D106,1,F101:F106,1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 5, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 4, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[4,0]');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), 1, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[5,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 3, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 4, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 4, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), 4, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[3,1]');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), 7, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[4,1]');
		assert.strictEqual(array.getElementRowCol(5, 1).getValue(), 8, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[5,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 3, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[1,2]');
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), 1, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[2,2]');
		assert.strictEqual(array.getElementRowCol(3, 2).getValue(), 3, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[3,2]');
		assert.strictEqual(array.getElementRowCol(4, 2).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[4,2]');
		assert.strictEqual(array.getElementRowCol(5, 2).getValue(), 0, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[5,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 5, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), 0, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[1,3]');
		assert.strictEqual(array.getElementRowCol(2, 3).getValue(), 0, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[2,3]');
		assert.strictEqual(array.getElementRowCol(3, 3).getValue(), 6, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[3,3]');
		assert.strictEqual(array.getElementRowCol(4, 3).getValue(), 0, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[4,3]');
		assert.strictEqual(array.getElementRowCol(5, 3).getValue(), 0, 'Result of SORTBY(C101:E106,D101:D106,1,F101:F106,1)[5,3]');


		oParser = new parserFormula('SORTBY(C101:E106,C101:C106,1,D101:D106,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(C101:E106,C101:C106,1,D101:D106,-1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1)[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 2, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1)[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 2, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1)[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 4, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1)[4,0]');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), 5, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1)[5,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 8, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 4, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 4, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1)[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), 3, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1)[3,1]');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), 7, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1)[4,1]');
		assert.strictEqual(array.getElementRowCol(5, 1).getValue(), 4, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1)[5,1]');

		// three conditions(by_col)
		oParser = new parserFormula('SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 2, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 2, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 4, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[4,0]');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), 5, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[5,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 8, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 4, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 4, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), 3, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[3,1]');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), 7, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[4,1]');
		assert.strictEqual(array.getElementRowCol(5, 1).getValue(), 4, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[5,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 0, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 1, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[1,2]');
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), 2, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[2,2]');
		assert.strictEqual(array.getElementRowCol(3, 2).getValue(), 3, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[3,2]');
		assert.strictEqual(array.getElementRowCol(4, 2).getValue(), 2, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[4,2]');
		assert.strictEqual(array.getElementRowCol(5, 2).getValue(), 3, 'Result of SORTBY(C101:E106,C101:C106,1,D101:D106,-1,E101:E106,1)[5,2]');

		oParser = new parserFormula('SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 5, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[1,0]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[2,0]');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[3,0]');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 4, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[4,0]');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), 1, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[5,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 3, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 4, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 4, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[2,1]');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), 4, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[3,1]');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), 7, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[4,1]');
		assert.strictEqual(array.getElementRowCol(5, 1).getValue(), 8, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[5,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 3, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[0,2]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 3, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[1,2]');
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[2,2]');
		assert.strictEqual(array.getElementRowCol(3, 2).getValue(), 1, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[3,2]');
		assert.strictEqual(array.getElementRowCol(4, 2).getValue(), 2, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[4,2]');
		assert.strictEqual(array.getElementRowCol(5, 2).getValue(), 0, 'Result of SORTBY(C101:E106,D101:D106,1,C101:C106,-1,E101:E106,-1)[5,2]');

		oParser = new parserFormula('SORTBY(1,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(1,1,1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY(1,1,1)');

		oParser = new parserFormula('SORTBY(1,1,)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(1,1,)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY(1,1,)');

		oParser = new parserFormula('SORTBY(1,,)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(1,,)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY(1,,)');

		oParser = new parserFormula('SORTBY(,,)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(,,)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "", 'Result of SORTBY(,,)');

		oParser = new parserFormula('SORTBY("str",1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY("str",1,1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "str", 'Result of SORTBY("str",1,1)');

		oParser = new parserFormula('SORTBY("str","1",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY("str","1",1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "str", 'Result of SORTBY("str","1",1)');

		oParser = new parserFormula('SORTBY("str","1s",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY("str","1s",1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "str", 'Result of SORTBY("str","1s",1)');

		oParser = new parserFormula('SORTBY("str","1s","1s")', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY("str","1s","1s")');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORTBY("str","1s","1s")');

		oParser = new parserFormula('SORTBY(TRUE,1,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(TRUE,1,TRUE)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "TRUE", 'Result of SORTBY(TRUE,1,TRUE)');

		oParser = new parserFormula('SORTBY(TRUE,1,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(TRUE,1,FALSE)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORTBY(TRUE,1,FALSE)');

		// ???
		oParser = new parserFormula('SORTBY(TRUE,{1,2},"1")', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(TRUE,{1,2},"1")');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), "TRUE", 'Result of SORTBY(TRUE,{1,2},"1")');

		oParser = new parserFormula('SORTBY(H10:I12,I10:I12,{1,#N/A;2,-2})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,I10:I12,{1,#N/A;2,-2})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORTBY(H10:I12,I10:I12,{1,#N/A;2,-2})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#N/A", 'Result of SORTBY(H10:I12,I10:I12,{1,#N/A;2,-2})[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", 'Result of SORTBY(H10:I12,I10:I12,{1,#N/A;2,-2})[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#VALUE!", 'Result of SORTBY(H10:I12,I10:I12,{1,#N/A;2,-2})[1,1]');

		oParser = new parserFormula('SORTBY(H10:I12,I10:I12,{1,#N/A;2,-2})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,I10:I12,{1,#N/A;2,-2})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 25, 'Result of SORTBY(H10:I12,I10:I12,{1,#N/A;2,-2})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#N/A", 'Result of SORTBY(H10:I12,I10:I12,{1,#N/A;2,-2})[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", 'Result of SORTBY(H10:I12,I10:I12,{1,#N/A;2,-2})[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#VALUE!", 'Result of SORTBY(H10:I12,I10:I12,{1,#N/A;2,-2})[1,1]');

		oParser = new parserFormula('SORTBY(H10:I12,I10:I12,{2,1;2,-2})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,I10:I12,{2,1;2,-2})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", 'Result of SORTBY(H10:I12,I10:I12,{2,1;2,-2}[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 25, 'Result of SORTBY(H10:I12,I10:I12,{2,1;2,-2}[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", 'Result of SORTBY(H10:I12,I10:I12,{2,1;2,-2}[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#VALUE!", 'Result of SORTBY(H10:I12,I10:I12,{2,1;2,-2}[1,1]');

		oParser = new parserFormula('SORTBY(H10:I12,I10:I12,{2,-1;2,-2})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,I10:I12,{2,-1;2,-2})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", 'Result of SORTBY(H10:I12,I10:I12,{2,-1;2,-2}[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 3, 'Result of SORTBY(H10:I12,I10:I12,{2,-1;2,-2}[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", 'Result of SORTBY(H10:I12,I10:I12,{2,-1;2,-2}[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#VALUE!", 'Result of SORTBY(H10:I12,I10:I12,{2,-1;2,-2}[1,1]');

		oParser = new parserFormula('SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"1","1s"})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"1","1s"})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#NUM!", 'Result of SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"1","1s"})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#N/A", 'Result of SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"1","1s"})[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 25, 'Result of SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"1","1s"})[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#VALUE!", 'Result of SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"1","1s"})[1,1]');

		oParser = new parserFormula('SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"-1","1s"})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"-1","1s"})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#NUM!", 'Result of SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"-1","1s"})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#N/A", 'Result of SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"-1","1s"})[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 3, 'Result of SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"-1","1s"})[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#VALUE!", 'Result of SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"-1","1s"})[1,1]');

		oParser = new parserFormula('SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"-2","1"})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"-2","1"})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#NUM!", 'Result of SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"-2","1"})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#N/A", 'Result of SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"-2","1"})[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", 'Result of SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"-2","1"})[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 25, 'Result of SORTBY(H10:I12,I10:I12,{#NUM!,#N/A;"-2","1"})[1,1]');

		oParser = new parserFormula('SORTBY(B20:C21,C20:C21,{#NUM!,#N/A;"-1","1s"})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(B20:C21,C20:C21,{#NUM!,#N/A;"-1","1s"})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#NUM!", 'Result of SORTBY(B20:C21,C20:C21,{#NUM!,#N/A;"-1","1s"})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#N/A", 'Result of SORTBY(B20:C21,C20:C21,{#NUM!,#N/A;"-1","1s"})[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", 'Result of SORTBY(B20:C21,C20:C21,{#NUM!,#N/A;"-1","1s"})[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "#VALUE!", 'Result of SORTBY(B20:C21,C20:C21,{#NUM!,#N/A;"-1","1s"})[1,1]');

		oParser = new parserFormula('SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 2, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 3, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[0,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 4, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 4, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 6, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[1,2]');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), 8, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[1,3]');

		oParser = new parserFormula('SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 4, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 3, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 2, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[0,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 1, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 8, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 6, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 4, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[1,2]');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), 2, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[1,3]');

		oParser = new parserFormula('SORTBY({1,2,3,4;2,4,6,8},{1,2;3,4},-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY({1,2,3,4;2,4,6,8},{1,2;3,4},-1)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2;3,4},-1)');

		oParser = new parserFormula('SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},E12)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},E12)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 2, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 3, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[0,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 4, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 4, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 6, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[1,2]');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), 8, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},1)[1,3]');

		oParser = new parserFormula('SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},I11)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},I11)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 4, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 3, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 2, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[0,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 1, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[0,3]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 8, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 6, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[1,1]');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 4, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[1,2]');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), 2, 'Result of SORTBY({1,2,3,4;2,4,6,8},{1,2,3,4},-1)[1,3]');

		oParser = new parserFormula('SORTBY(TRUE,FALSE,{1,1,1,-1})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(TRUE,FALSE,{1,1,1,-1})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "TRUE", 'Result of SORTBY(TRUE,FALSE,{1,1,1,-1})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, 'Result of SORTBY(TRUE,FALSE,{1,1,1,-1})[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 0, 'Result of SORTBY(TRUE,FALSE,{1,1,1,-1})[0,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 0, 'Result of SORTBY(TRUE,FALSE,{1,1,1,-1})[0,3]');

		oParser = new parserFormula('SORTBY(TRUE,FALSE,{1,2,1,-1})', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(TRUE,FALSE,{1,2,1,-1})');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "TRUE", 'Result of SORTBY(TRUE,FALSE,{1,2,1,-1})[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#VALUE!", 'Result of SORTBY(TRUE,FALSE,{1,2,1,-1})[0,1]');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 0, 'Result of SORTBY(TRUE,FALSE,{1,2,1,-1})[0,2]');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 0, 'Result of SORTBY(TRUE,FALSE,{1,2,1,-1})[0,3]');

		ws.getRange2("C4").setValue("Глеб");
		ws.getRange2("C5").setValue("Максим");
		ws.getRange2("C6").setValue("Елена");
		ws.getRange2("D4").setValue("52");
		ws.getRange2("D5").setValue("19");
		ws.getRange2("D6").setValue("18");

		oParser = new parserFormula('SORTBY(C4:D11,C4:D4)', 'A2', ws);
		assert.ok(oParser.parse(), 'SORTBY(C4:D11,C4:D4)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 52, 'Result of SORTBY(C4:D11,C4:D4)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "Глеб", 'Result of SORTBY(C4:D11,C4:D4)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 19, 'Result of SORTBY(C4:D11,C4:D4)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "Максим", 'Result of SORTBY(C4:D11,C4:D4)[1,1]');

		// rows tests(single col)
		ws.getRange2("A101").setValue("1");
		ws.getRange2("A102").setValue("2");
		ws.getRange2("B101").setValue("a");
		ws.getRange2("B102").setValue("b");
		ws.getRange2("A104").setValue("2");
		ws.getRange2("A105").setValue("1");

		oParser = new parserFormula('SORTBY(A101:A102,B101:B102)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A101:A102,B101:B102)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, "Result of SORTBY(A101:A102,B101:B102)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, "Result of SORTBY(A101:A102,B101:B102)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", "Result of SORTBY(A101:A102,B101:B102)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", "Result of SORTBY(A101:A102,B101:B102)[3,0]");
		}

		oParser = new parserFormula('SORTBY(A101:A102,B101:B102,-1)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A101:A102,B101:B102,-1)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of SORTBY(A101:A102,B101:B102,-1)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 1, "Result of SORTBY(A101:A102,B101:B102,-1)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", "Result of SORTBY(A101:A102,B101:B102,-1)[3,0]");
		}

		oParser = new parserFormula('SORTBY(A101:A102,,-1)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A101:A102,,-1)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, "Result of SORTBY(A101:A102,,-1)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(A101:A102,,-1)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, "Result of SORTBY(A101:A102,,-1)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A101:A102,,-1)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", "Result of SORTBY(A101:A102,,-1)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", "Result of SORTBY(A101:A102,,-1)[3,0]");
		}

		oParser = new parserFormula('SORTBY(A101:A102,B101:B102,,B101:B102,A101:A102)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A101:A102,B101:B102,,B101:B102,A101:A102)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, "Result of SORTBY(A101:A102,B101:B102,,B101:B102,A101:A102)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,,B101:B102,A101:A102)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", "Result of SORTBY(A101:A102,B101:B102,,B101:B102,A101:A102)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,,B101:B102,A101:A102)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,,B101:B102,A101:A102)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", "Result of SORTBY(A101:A102,B101:B102,,B101:B102,A101:A102)[3,0]");
		}

		oParser = new parserFormula('SORTBY(A101:A102,B101:B102,-1,B101:B102,A101:A102)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A101:A102,B101:B102,-1,B101:B102,A101:A102)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of SORTBY(A101:A102,B101:B102,-1,B101:B102,A101:A102)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,B101:B102,A101:A102)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", "Result of SORTBY(A101:A102,B101:B102,-1,B101:B102,A101:A102)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,B101:B102,A101:A102)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,B101:B102,A101:A102)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", "Result of SORTBY(A101:A102,B101:B102,-1,B101:B102,A101:A102)[3,0]");
		}

		oParser = new parserFormula('SORTBY(A101:A102,B101:B102,,A101:A102,B101:B102)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A101:A102,B101:B102,,A101:A102,B101:B102)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", "Result of SORTBY(A101:A102,B101:B102,,A101:A102,B101:B102)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,,A101:A102,B101:B102)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", "Result of SORTBY(A101:A102,B101:B102,,A101:A102,B101:B102)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,,A101:A102,B101:B102)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,,A101:A102,B101:B102)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", "Result of SORTBY(A101:A102,B101:B102,,A101:A102,B101:B102)[3,0]");
		}

		oParser = new parserFormula('SORTBY(A101:A102,B101:B102,-1,A101:A102,B101:B102)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A101:A102,B101:B102,-1,A101:A102,B101:B102)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", "Result of SORTBY(A101:A102,B101:B102,-1,A101:A102,B101:B102)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,A101:A102,B101:B102)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", "Result of SORTBY(A101:A102,B101:B102,-1,A101:A102,B101:B102)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,A101:A102,B101:B102)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,A101:A102,B101:B102)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", "Result of SORTBY(A101:A102,B101:B102,-1,A101:A102,B101:B102)[3,0]");
		}

		oParser = new parserFormula('SORTBY(A101:A102,B101:B102,-1,A101:A102,)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A101:A102,B101:B102,-1,A101:A102,)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of SORTBY(A101:A102,B101:B102,-1,A101:A102,)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,A101:A102,)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 1, "Result of SORTBY(A101:A102,B101:B102,-1,A101:A102,)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,A101:A102,)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,A101:A102,)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", "Result of SORTBY(A101:A102,B101:B102,-1,A101:A102,)[3,0]");
		}

		oParser = new parserFormula('SORTBY(A101:A102,B101:B102,-1,,B101:B102)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A101:A102,B101:B102,-1,,B101:B102)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", "Result of SORTBY(A101:A102,B101:B102,-1,,B101:B102)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,,B101:B102)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", "Result of SORTBY(A101:A102,B101:B102,-1,,B101:B102)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,,B101:B102)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,,B101:B102)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", "Result of SORTBY(A101:A102,B101:B102,-1,,B101:B102)[3,0]");
		}

		oParser = new parserFormula('SORTBY(A101:A102,B101:B102,-1,,)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A101:A102,B101:B102,-1,,)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", "Result of SORTBY(A101:A102,B101:B102,-1,,)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,,)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", "Result of SORTBY(A101:A102,B101:B102,-1,,)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,,)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", "Result of SORTBY(A101:A102,B101:B102,-1,,)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", "Result of SORTBY(A101:A102,B101:B102,-1,,)[3,0]");
		}

		oParser = new parserFormula('SORTBY(A101:A102,,-1,A101:A102,B101:B102)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A101:A102,,-1,A101:A102,B101:B102)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", "Result of SORTBY(A101:A102,,-1,A101:A102,B101:B102)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(A101:A102,,-1,A101:A102,B101:B102)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", "Result of SORTBY(A101:A102,,-1,A101:A102,B101:B102)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A101:A102,,-1,A101:A102,B101:B102)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", "Result of SORTBY(A101:A102,,-1,A101:A102,B101:B102)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", "Result of SORTBY(A101:A102,,-1,A101:A102,B101:B102)[3,0]");
		}

		// rows tests(single col)
		ws.getRange2("P10").setValue("1");
		ws.getRange2("P11").setValue("8");
		ws.getRange2("P12").setValue("0");
		ws.getRange2("P13").setValue("0");
		ws.getRange2("P14").setValue("1");
		ws.getRange2("P15").setValue("1");
		ws.getRange2("Q10").setValue("3");
		ws.getRange2("Q11").setValue("2");
		ws.getRange2("Q12").setValue("1");
		ws.getRange2("Q13").setValue("-1");
		ws.getRange2("Q14").setValue("1");
		ws.getRange2("Q15").setValue("1");

		oParser = new parserFormula('SORTBY(P10:P13,Q10:Q13,1,P10:P13,Q10:Q13)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(P10:P13,Q10:Q13,1,P10:P13,Q10:Q13)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P13,Q10:Q13,1,P10:P13,Q10:Q13)[0,0]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P13,Q10:Q13,1,P10:P13,Q10:Q13)[1,0]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 0, "Result of SORTBY(P10:P13,Q10:Q13,1,P10:P13,Q10:Q13)[2,0]");	
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P13,Q10:Q13,1,P10:P13,Q10:Q13)[3,0]");
			assert.strictEqual(array.getElementRowCol(4, 0).getValue(), "", "Result of SORTBY(P10:P13,Q10:Q13,1,P10:P13,Q10:Q13)[4,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(P10:P13,Q10:Q13,1,P10:P13,Q10:Q13)[0,1]");
		}

		oParser = new parserFormula('SORTBY(P10:P13,Q10:Q13,-1,P10:P13,Q10:Q13)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(P10:P13,Q10:Q13,-1,P10:P13,Q10:Q13)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P13,Q10:Q13,-1,P10:P13,Q10:Q13)[0,0]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P13,Q10:Q13,-1,P10:P13,Q10:Q13)[1,0]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 1, "Result of SORTBY(P10:P13,Q10:Q13,-1,P10:P13,Q10:Q13)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P13,Q10:Q13,-1,P10:P13,Q10:Q13)[3,0]");
			assert.strictEqual(array.getElementRowCol(4, 0).getValue(), "", "Result of SORTBY(P10:P13,Q10:Q13,-1,P10:P13,Q10:Q13)[4,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(P10:P13,Q10:Q13,-1,P10:P13,Q10:Q13)[0,1]");
		}

		oParser = new parserFormula('SORTBY(P10:P15,Q10:Q15,1,P10:P15,Q10:Q15)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(P10:P15,Q10:Q15,1,P10:P15,Q10:Q15)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P15,Q10:Q15,1,P10:P15,Q10:Q15)[0,0]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P15,Q10:Q15,1,P10:P15,Q10:Q15)[1,0]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 0, "Result of SORTBY(P10:P15,Q10:Q15,1,P10:P15,Q10:Q15)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P15,Q10:Q15,1,P10:P15,Q10:Q15)[3,0]");
			assert.strictEqual(array.getElementRowCol(4, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P15,Q10:Q15,1,P10:P15,Q10:Q15)[4,0]");
			assert.strictEqual(array.getElementRowCol(5, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P15,Q10:Q15,1,P10:P15,Q10:Q15)[5,0]");
			assert.strictEqual(array.getElementRowCol(6, 0).getValue(), "", "Result of SORTBY(P10:P15,Q10:Q15,1,P10:P15,Q10:Q15)[6,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(P10:P15,Q10:Q15,1,P10:P15,Q10:Q15)[0,1]");
		}

		oParser = new parserFormula('SORTBY(P10:P15,Q10:Q15,-1,P10:P15,Q10:Q15)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(P10:P15,Q10:Q15,-1,P10:P15,Q10:Q15)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P15,Q10:Q15,-1,P10:P15,Q10:Q15)[0,0]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P15,Q10:Q15,-1,P10:P15,Q10:Q15)[1,0]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 1, "Result of SORTBY(P10:P15,Q10:Q15,-1,P10:P15,Q10:Q15)[2,0]");
			assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P15,Q10:Q15,-1,P10:P15,Q10:Q15)[3,0]");
			assert.strictEqual(array.getElementRowCol(4, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P15,Q10:Q15,-1,P10:P15,Q10:Q15)[4,0]");
			assert.strictEqual(array.getElementRowCol(5, 0).getValue(), "#VALUE!", "Result of SORTBY(P10:P15,Q10:Q15,-1,P10:P15,Q10:Q15)[5,0]");
			assert.strictEqual(array.getElementRowCol(6, 0).getValue(), "", "Result of SORTBY(P10:P15,Q10:Q15,-1,P10:P15,Q10:Q15)[6,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(P10:P15,Q10:Q15,-1,P10:P15,Q10:Q15)[0,1]");
		}

		// cols tests (single row)
		ws.getRange2("A114").setValue("1");
		ws.getRange2("B114").setValue("2");
		ws.getRange2("A115").setValue("a");
		ws.getRange2("B115").setValue("b");

		oParser = new parserFormula('SORTBY(A114:B114,A115:B115)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A114:B114,A115:B115)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, "Result of SORTBY(A114:B114,A115:B115)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 2, "Result of SORTBY(A114:B114,A115:B115)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of SORTBY(A114:B114,A115:B115)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A114:B114,A115:B115)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", "Result of SORTBY(A114:B114,A115:B115)[2,0]");
		}

		oParser = new parserFormula('SORTBY(A114:B114,A115:B115,-1)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A114:B114,A115:B115,-1)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of SORTBY(A114:B114,A115:B115,-1)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 1, "Result of SORTBY(A114:B114,A115:B115,-1)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of SORTBY(A114:B114,A115:B115,-1)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A114:B114,A115:B115,-1)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", "Result of SORTBY(A114:B114,A115:B115,-1)[2,0]");
		}

		oParser = new parserFormula('SORTBY(A114:B114,A115:B115,,A115:B115,A114:B114)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A114:B114,A115:B115,,A115:B115,A114:B114)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, "Result of SORTBY(A114:B114,A115:B115,,A115:B115,A114:B114)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#VALUE!", "Result of SORTBY(A114:B114,A115:B115,,A115:B115,A114:B114)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of SORTBY(A114:B114,A115:B115,,A115:B115,A114:B114)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A114:B114,A115:B115,,A115:B115,A114:B114)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", "Result of SORTBY(A114:B114,A115:B115,,A115:B115,A114:B114)[2,0]");
		}

		oParser = new parserFormula('SORTBY(A114:B114,A115:B115,-1,A115:B115,A114:B114)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:D103").bbox);
		assert.ok(oParser.parse(), 'SORTBY(A114:B114,A115:B115,-1,A115:B115,A114:B114)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of SORTBY(A114:B114,A115:B115,-1,A115:B115,A114:B114)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#VALUE!", "Result of SORTBY(A114:B114,A115:B115,-1,A115:B115,A114:B114)[0,1]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of SORTBY(A114:B114,A115:B115,-1,A115:B115,A114:B114)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A114:B114,A115:B115,-1,A115:B115,A114:B114)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", "Result of SORTBY(A114:B114,A115:B115,-1,A115:B115,A114:B114)[2,0]");
		}

		// cols tests (single row)
		ws.getRange2("P1").setValue("1");
		ws.getRange2("Q1").setValue("8");
		ws.getRange2("R1").setValue("0");
		ws.getRange2("S1").setValue("0");
		ws.getRange2("T1").setValue("1");
		ws.getRange2("U1").setValue("1");
		ws.getRange2("P2").setValue("3");
		ws.getRange2("Q2").setValue("2");
		ws.getRange2("R2").setValue("1");
		ws.getRange2("S2").setValue("-1");
		ws.getRange2("T2").setValue("1");
		ws.getRange2("U2").setValue("1");

		oParser = new parserFormula('SORTBY(P1:S1;P2:S2;1;P1:S1;P2:S2)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:I110").bbox);
		assert.ok(oParser.parse(), 'SORTBY(P1:S1;P2:S2;1;P1:S1;P2:S2)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", "Result of SORTBY(P1:S1;P2:S2;1;P1:S1;P2:S2)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#VALUE!", "Result of SORTBY(P1:S1;P2:S2;1;P1:S1;P2:S2)[0,1]");
			assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 0, "Result of SORTBY(P1:S1;P2:S2;1;P1:S1;P2:S2)[0,2]");
			assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 0, "Result of SORTBY(P1:S1;P2:S2;1;P1:S1;P2:S2)[0,3]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of SORTBY(P1:S1;P2:S2;1;P1:S1;P2:S2)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(P1:S1;P2:S2;1;P1:S1;P2:S2)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", "Result of SORTBY(P1:S1;P2:S2;1;P1:S1;P2:S2)[2,0]");
		}

		oParser = new parserFormula('SORTBY(P1:S1;P2:S2;-1;P1:S1;P2:S2)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:I110").bbox);
		assert.ok(oParser.parse(), 'SORTBY(P1:S1;P2:S2;-1;P1:S1;P2:S2)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", "Result of SORTBY(P1:S1;P2:S2;-1;P1:S1;P2:S2)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#VALUE!", "Result of SORTBY(P1:S1;P2:S2;-1;P1:S1;P2:S2)[0,1]");
			assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 1, "Result of SORTBY(P1:S1;P2:S2;-1;P1:S1;P2:S2)[0,2]");
			assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 0, "Result of SORTBY(P1:S1;P2:S2;-1;P1:S1;P2:S2)[0,3]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of SORTBY(P1:S1;P2:S2;-1;P1:S1;P2:S2)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(P1:S1;P2:S2;-1;P1:S1;P2:S2)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", "Result of SORTBY(P1:S1;P2:S2;-1;P1:S1;P2:S2)[2,0]");
		}

		oParser = new parserFormula('SORTBY(P1:U1;P2:U2;1;P1:U1;P2:U2)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:I110").bbox);
		assert.ok(oParser.parse(), 'SORTBY(P1:U1;P2:U2;1;P1:U1;P2:U2)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", "Result of SORTBY(P1:U1;P2:U2;1;P1:U1;P2:U2)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#VALUE!", "Result of SORTBY(P1:U1;P2:U2;1;P1:U1;P2:U2)[0,1]");
			assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 0, "Result of SORTBY(P1:U1;P2:U2;1;P1:U1;P2:U2)[0,2]");
			assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 0, "Result of SORTBY(P1:U1;P2:U2;1;P1:U1;P2:U2)[0,3]");
			assert.strictEqual(array.getElementRowCol(0, 4).getValue(), 0, "Result of SORTBY(P1:U1;P2:U2;1;P1:U1;P2:U2)[0,4]");
			assert.strictEqual(array.getElementRowCol(0, 5).getValue(), 0, "Result of SORTBY(P1:U1;P2:U2;1;P1:U1;P2:U2)[0,5]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of SORTBY(P1:U1;P2:U2;1;P1:U1;P2:U2)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(P1:U1;P2:U2;1;P1:U1;P2:U2)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", "Result of SORTBY(P1:U1;P2:U2;1;P1:U1;P2:U2)[2,0]");
		}

		oParser = new parserFormula('SORTBY(P1:U1;P2:U2;-1;P1:U1;P2:U2)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:I110").bbox);
		assert.ok(oParser.parse(), 'SORTBY(P1:U1;P2:U2;-1;P1:U1;P2:U2)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "#VALUE!", "Result of SORTBY(P1:U1;P2:U2;-1;P1:U1;P2:U2)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "#VALUE!", "Result of SORTBY(P1:U1;P2:U2;-1;P1:U1;P2:U2)[0,1]");
			assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 1, "Result of SORTBY(P1:U1;P2:U2;-1;P1:U1;P2:U2)[0,2]");
			assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 0, "Result of SORTBY(P1:U1;P2:U2;-1;P1:U1;P2:U2)[0,3]");
			assert.strictEqual(array.getElementRowCol(0, 4).getValue(), 0, "Result of SORTBY(P1:U1;P2:U2;-1;P1:U1;P2:U2)[0,4]");
			assert.strictEqual(array.getElementRowCol(0, 5).getValue(), 0, "Result of SORTBY(P1:U1;P2:U2;-1;P1:U1;P2:U2)[0,5]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of SORTBY(P1:U1;P2:U2;-1;P1:U1;P2:U2)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(P1:U1;P2:U2;-1;P1:U1;P2:U2)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", "Result of SORTBY(P1:U1;P2:U2;-1;P1:U1;P2:U2)[2,0]");
		}

		// cols tests (single row)
		ws.getRange2("V1").setValue("2");
		ws.getRange2("W1").setValue("3");
		ws.getRange2("X1").setValue("1");
		ws.getRange2("Y1").setValue("4");
		ws.getRange2("V2").setValue("-1");
		ws.getRange2("W2").setValue("1");
		ws.getRange2("X2").setValue("-1");
		ws.getRange2("Y2").setValue("1");

		oParser = new parserFormula('SORTBY(V1:Y1,V2:Y2,1,V1:Y1,V2:Y2)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:I110").bbox);
		assert.ok(oParser.parse(), 'SORTBY(V1:Y1,V2:Y2,1,V1:Y1,V2:Y2)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of SORTBY(V1:Y1,V2:Y2,1,V1:Y1,V2:Y2)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, "Result of SORTBY(V1:Y1,V2:Y2,1,V1:Y1,V2:Y2)[0,1]");
			assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 0, "Result of SORTBY(V1:Y1,V2:Y2,1,V1:Y1,V2:Y2)[0,2]");
			assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 0, "Result of SORTBY(V1:Y1,V2:Y2,1,V1:Y1,V2:Y2)[0,3]");
			assert.strictEqual(array.getElementRowCol(0, 4).getValue(), "", "Result of SORTBY(V1:Y1,V2:Y2,1,V1:Y1,V2:Y2)[0,4]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of SORTBY(V1:Y1,V2:Y2,1,V1:Y1,V2:Y2)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(V1:Y1,V2:Y2,1,V1:Y1,V2:Y2)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", "Result of SORTBY(V1:Y1,V2:Y2,1,V1:Y1,V2:Y2)[2,0]");
		}

		oParser = new parserFormula('SORTBY(V1:Y1,V2:Y2,-1,V1:Y1,V2:Y2)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C101:I110").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(V1:Y1,V2:Y2,-1,V1:Y1,V2:Y2)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 3, "Result of SORTBY(V1:Y1,V2:Y2,-1,V1:Y1,V2:Y2)[0,0]");	// 4
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, "Result of SORTBY(V1:Y1,V2:Y2,-1,V1:Y1,V2:Y2)[0,1]");
			assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 0, "Result of SORTBY(V1:Y1,V2:Y2,-1,V1:Y1,V2:Y2)[0,2]");
			assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 0, "Result of SORTBY(V1:Y1,V2:Y2,-1,V1:Y1,V2:Y2)[0,3]");
			assert.strictEqual(array.getElementRowCol(0, 4).getValue(), "", "Result of SORTBY(V1:Y1,V2:Y2,-1,V1:Y1,V2:Y2)[0,4]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of SORTBY(V1:Y1,V2:Y2,-1,V1:Y1,V2:Y2)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(V1:Y1,V2:Y2,-1,V1:Y1,V2:Y2)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", "Result of SORTBY(V1:Y1,V2:Y2,-1,V1:Y1,V2:Y2)[2,0]");
		}

		oParser = new parserFormula('SORTBY(V1:Y1,V2:Y2,1)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(V1:Y1,V2:Y2,1)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of SORTBY(V1:Y1,V2:Y2,1)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 1, "Result of SORTBY(V1:Y1,V2:Y2,1)[0,1]");
			assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 3, "Result of SORTBY(V1:Y1,V2:Y2,1)[0,2]");
			assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 4, "Result of SORTBY(V1:Y1,V2:Y2,1)[0,3]");
			assert.strictEqual(array.getElementRowCol(0, 4).getValue(), "", "Result of SORTBY(V1:Y1,V2:Y2,1)[0,4]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of SORTBY(V1:Y1,V2:Y2,1)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(V1:Y1,V2:Y2,1)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", "Result of SORTBY(V1:Y1,V2:Y2,1)[2,0]");
		}

		oParser = new parserFormula('SORTBY(V1:Y1,V2:Y2,-1)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(V1:Y1,V2:Y2,-1)');
		array = oParser.calculate();
		if (AscCommonExcel.cElementType.array === array.type) {
			assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 3, "Result of SORTBY(V1:Y1,V2:Y2,-1)[0,0]");
			assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 4, "Result of SORTBY(V1:Y1,V2:Y2,-1)[0,1]");
			assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 2, "Result of SORTBY(V1:Y1,V2:Y2,-1)[0,2]");
			assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 1, "Result of SORTBY(V1:Y1,V2:Y2,-1)[0,3]");
			assert.strictEqual(array.getElementRowCol(0, 4).getValue(), "", "Result of SORTBY(V1:Y1,V2:Y2,-1)[0,4]");
			assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of SORTBY(V1:Y1,V2:Y2,-1)[1,0]");
			assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(V1:Y1,V2:Y2,-1)[1,1]");
			assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "#N/A", "Result of SORTBY(V1:Y1,V2:Y2,-1)[2,0]");
		}

		// For bug 64072
		ws.getRange2("A1:Z100").cleanAll();
		ws.getRange2("A1").setValue("1");
		ws.getRange2("A2").setValue("2");
		ws.getRange2("A3").setValue("3");

		oParser = new parserFormula('SORTBY(A1:A3,)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(A1:A3,)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, "Result of SORTBY(A1:A3,)[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(A1:A3,)[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, "Result of SORTBY(A1:A3,)[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A1:A3,)[1,1]");
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 3, "Result of SORTBY(A1:A3,)[2,0]");

		oParser = new parserFormula('SORTBY(A1:A3,1)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(A1:A3,1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, "Result of SORTBY(A1:A3,1)[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of SORTBY(A1:A3,1)[0,1]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, "Result of SORTBY(A1:A3,1)[1,0]");
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", "Result of SORTBY(A1:A3,1)[1,1]");
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 3, "Result of SORTBY(A1:A3,1)[2,0]");

		oParser = new parserFormula('SORTBY(A1:A3,"str")', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(A1:A3,"str")');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY(A1:A3,"str")[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORTBY(A1:A3,"str")[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, 'Result of SORTBY(A1:A3,"str")[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of SORTBY(A1:A3,"str")[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 3, 'Result of SORTBY(A1:A3,"str")[2,0]');

		oParser = new parserFormula('SORTBY(A1:A3,#DIV/0!)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(A1:A3,#DIV/0!)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#DIV/0!", 'Result of SORTBY(A1:A3,#DIV/0!)');

		oParser = new parserFormula('SORTBY(A1:A3,,)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(A1:A3,,)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY(A1:A3,,)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORTBY(A1:A3,,)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, 'Result of SORTBY(A1:A3,,)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of SORTBY(A1:A3,,)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 3, 'Result of SORTBY(A1:A3,,)[2,0]');
		
		oParser = new parserFormula('SORTBY(A1:A3,A2:A3)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(A1:A3,A2:A3)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORTBY(A1:A3,A2:A3)');

		oParser = new parserFormula('SORTBY(A1:A3,{1,2,3})', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(A1:A3,{1,2,3})');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORTBY(A1:A3,{1,2,3})');

		oParser = new parserFormula('SORTBY(A1:A3,,1,2,1)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(A1:A3,,1,2,1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY(A1:A3,,1,2,1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORTBY(A1:A3,,1,2,1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, 'Result of SORTBY(A1:A3,,1,2,1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of SORTBY(A1:A3,,1,2,1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 3, 'Result of SORTBY(A1:A3,,1,2,1)[2,0]');

		oParser = new parserFormula('SORTBY(A1:A3,,1,"str",1)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(A1:A3,,1,"str",1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY(A1:A3,,1,"str",1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORTBY(A1:A3,,1,"str",1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, 'Result of SORTBY(A1:A3,,1,"str",1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of SORTBY(A1:A3,,1,"str",1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 3, 'Result of SORTBY(A1:A3,,1,"str",1)[2,0]');

		oParser = new parserFormula('SORTBY(A1:A3,,1,{2;3;1},1)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(A1:A3,,1,{2;3;1},1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY(A1:A3,,1,{2;3;1},1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORTBY(A1:A3,,1,{2;3;1},1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, 'Result of SORTBY(A1:A3,,1,{2;3;1},1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of SORTBY(A1:A3,,1,{2;3;1},1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 3, 'Result of SORTBY(A1:A3,,1,{2;3;1},1)[2,0]');

		oParser = new parserFormula('SORTBY(A1:A3,1,1,{3;2;1},1)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(A1:A3,1,1,{3;2;1},1)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, 'Result of SORTBY(A1:A3,1,1,{3;2;1},1)[0,0]');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", 'Result of SORTBY(A1:A3,1,1,{3;2;1},1)[0,1]');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2, 'Result of SORTBY(A1:A3,1,1,{3;2;1},1)[1,0]');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), "", 'Result of SORTBY(A1:A3,1,1,{3;2;1},1)[1,1]');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 3, 'Result of SORTBY(A1:A3,1,1,{3;2;1},1)[2,0]');

		oParser = new parserFormula('SORTBY(A1:A3,{3;2;1},1,1,1)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("C201:I210").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(A1:A3,{3;2;1},1,1,1)');
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", 'Result of SORTBY(A1:A3,{3;2;1},1,1,1)');

		ws.getRange2("A1:C3").cleanAll();
		oParser = new parserFormula('SORTBY(C1:C3,C1:C3)', "A1", ws);
		oParser.setArrayFormulaRef(ws.getRange2("A1:A3").bbox);	
		assert.ok(oParser.parse(), 'SORTBY(C1:C3,C1:C3)');
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), "", 'Result of SORTBY(C1:C3,C1:C3)[0,0]');	// cEmpty
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", 'Result of SORTBY(C1:C3,C1:C3)[1,0]');	// cEmpty
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", 'Result of SORTBY(C1:C3,C1:C3)[2,0]');	// cEmpty

		// oParser = new parserFormula('SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,1)', 'A2', ws);
		// assert.ok(oParser.parse(), 'SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,1)');
		// array = oParser.calculate();
		// assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 52, 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,1)[0,0]');
		// assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,1)[0,1]');
		// assert.strictEqual(array.getElementRowCol(0, 2).getValue(), "", 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,1)[0,2]');
		// assert.strictEqual(array.getElementRowCol(0, 3).getValue(), "", 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,1)[0,3]');
		// assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 0, 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,1)[1,0]');
		// assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 0, 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,1)[1,1]');
		// assert.strictEqual(array.getElementRowCol(1, 2).getValue(), "", 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,1)[1,2]');
		// assert.strictEqual(array.getElementRowCol(1, 3).getValue(), "", 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,1)[1,3]');

		// oParser = new parserFormula('SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,{1,1,1,2})', 'A2', ws);
		// assert.ok(oParser.parse(), 'SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,{1,1,1,2})');
		// array = oParser.calculate();
		// assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 52, 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,{1,1,1,2})[0,0]');
		// assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 0, 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,{1,1,1,2})[0,1]');
		// assert.strictEqual(array.getElementRowCol(0, 2).getValue(), "#N/A", 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,{1,1,1,2})[0,2]');
		// assert.strictEqual(array.getElementRowCol(0, 3).getValue(), "#N/A", 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,{1,1,1,2})[0,3]');
		// assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 0, 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,{1,1,1,2})[1,0]');
		// assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 0, 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,{1,1,1,2})[1,1]');
		// assert.strictEqual(array.getElementRowCol(1, 2).getValue(), "#N/A", 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,{1,1,1,2})[1,2]');
		// assert.strictEqual(array.getElementRowCol(1, 3).getValue(), "#N/A", 'Result of SORTBY(C4:D6,C4:D4,{1,1;1,1},C5:D5,1,C6:D6,{1,1,1,2})[1,3]');

		// =SORTBY(C4:D6,C4:D4,{1,1,1,1},C5:D5,D24:E25,C6:D6,{-1,1,-2})	// 1row: #VALUE #VALUE #N/A #N/A  2row: #VALUE 52 #N/A #N/A

		ws.getRange2("A100:C214").cleanAll();
		// Data for reference link. Use A100-A115
		ws.getRange2("A100").setValue("1");
		ws.getRange2("A101").setValue("2");
		ws.getRange2("A102").setValue("3");
		ws.getRange2("A103").setValue("4");
		ws.getRange2("A104").setValue("5");
		ws.getRange2("A105").setValue("6");
		ws.getRange2("A106").setValue("7");
		ws.getRange2("A107").setValue("8");
		ws.getRange2("A108").setValue("9");
		ws.getRange2("A109").setValue("10");
		ws.getRange2("A110").setValue("11");
		ws.getRange2("A111").setValue("12");
		ws.getRange2("A112").setValue("13");
		ws.getRange2("A113").setValue("14");
		ws.getRange2("A114").setValue("15");
		ws.getRange2("A115").setValue("16");

		ws.getRange2("B100").setValue("1");
		ws.getRange2("B101").setValue("2");
		ws.getRange2("B102").setValue("3");
		ws.getRange2("B103").setValue("4");
		ws.getRange2("B104").setValue("5");
		ws.getRange2("B105").setValue("6");
		ws.getRange2("B106").setValue("7");
		ws.getRange2("B107").setValue("8");
		ws.getRange2("B108").setValue("9");
		ws.getRange2("B109").setValue("10");
		ws.getRange2("B110").setValue("11");
		ws.getRange2("B111").setValue("12");
		ws.getRange2("B112").setValue("13");
		ws.getRange2("B113").setValue("14");
		ws.getRange2("B114").setValue("15");
		ws.getRange2("B115").setValue("16");


		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 2);
		ws.getRange2("A601").setValue("5"); // Num (Column1)
		ws.getRange2("B601").setValue("10"); // Num (Column2)
		ws.getRange2("C601").setValue("Text"); // Text (Column3)

		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2


		// Positive cases:
		// Case #1: Number, Array, Number. Basic valid input: array sorted by another array, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY({1;3;2},{10;30;20},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;3;2},{10;30;20},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Number, Array, Number. Basic valid input: array sorted by another array, ascending order. 3 arguments used.');
		// Case #2: Number, Array, Number. Array sorted by another array, descending order. 3 arguments used.
		oParser = new parserFormula('SORTBY({1;3;2},{10;30;20},-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;3;2},{10;30;20},-1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 3, 'Test: Positive case: Number, Array, Number. Array sorted by another array, descending order. 3 arguments used.');
		// Case #3: Formula, Array, Number. Nested IF formula for array, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY(IF(TRUE,{1;3;2},{4;5;6}),{10;30;20},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(IF(TRUE,{1;3;2},{4;5;6}),{10;30;20},1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Formula, Array, Number. Nested IF formula for array, ascending order. 3 arguments used.');
		// Case #4: String, Array, Number. String convertible to array, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY("1;2;3",{10;20;30},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY("1;2;3",{10;20;30},1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Positive case: String, Array, Number. String convertible to array, ascending order. 3 arguments used.');
		// Case #5: Reference link, Reference link, Number. Reference link to single cells, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY(A100,A101,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(A100,A101,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Reference link, Reference link, Number. Reference link to single cells, ascending order. 3 arguments used.');
		// Case #6: Area, Area, Number. Single-cell range for array and by_array, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY(A100:A102,A103:A105,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(A100:A102,A103:A105,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Area, Area, Number. Single-cell range for array and by_array, ascending order. 3 arguments used.');
		// Case #7: Array, Array, Number. Array with different values, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY({4;2;1},{20;10;30},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({4;2;1},{20;10;30},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 2, 'Test: Positive case: Array, Array, Number. Array with different values, ascending order. 3 arguments used.');
		// Case #8: Name, Name, Number. Named range, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY(TestName,TestName1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(TestName,TestName1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), -0.5, 'Test: Positive case: Name, Name, Number. Named range, ascending order. 3 arguments used.');
		// Case #9: Name3D, Name3D, Number. 3D named range, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY(TestName3D,TestName3D,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(TestName3D,TestName3D,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), -0.5, 'Test: Positive case: Name3D, Name3D, Number. 3D named range, ascending order. 3 arguments used.');
		// Case #10: Ref3D, Ref3D, Number. 3D reference to cells, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY(Sheet2!A1,Sheet2!A2,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(Sheet2!A1,Sheet2!A2,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Ref3D, Ref3D, Number. 3D reference to cells, ascending order. 3 arguments used.');
		// Case #11: Area3D, Area3D, Number. 3D single-cell range, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY(Sheet2!A1:A1,Sheet2!A2:A2,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(Sheet2!A1:A1,Sheet2!A2:A2,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Area3D, Area3D, Number. 3D single-cell range, ascending order. 3 arguments used.');
		// Case #12: Table, Table, Number. Table structured reference, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY(Table1[Column1],Table1[Column2],1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(Table1[Column1],Table1[Column2],1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 5, 'Test: Positive case: Table, Table, Number. Table structured reference, ascending order. 3 arguments used.');
		// Case #13: Date, Array, Number. Date as serial number, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY(DATE(2025,1,1), {1;2;3},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(DATE(2025,1,1), {1;2;3},1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Positive case: Date, Array, Number. Date as serial number, ascending order. 3 arguments used.');
		// Case #14: Time, Array, Number. Time adjusted to valid number, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY(TIME(12,0,0)+1,{1;2;3},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(TIME(12,0,0)+1,{1;2;3},1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Positive case: Time, Array, Number. Time adjusted to valid number, ascending order. 3 arguments used.');
		// Case #15: Formula, Formula, Number. Nested formula for array and by_array, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY(SQRT(4),SQRT(9),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(SQRT(4),SQRT(9),1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 2, 'Test: Positive case: Formula, Formula, Number. Nested formula for array and by_array, ascending order. 3 arguments used.');
		// Case #16: Number, Number, Number, Number, Number. Multiple sort criteria with ascending and descending orders. 5 arguments used.
		oParser = new parserFormula('SORTBY({1;3;2},A100,1,A101,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;3;2},A100,1,A101,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Number, Number, Number, Number, Number. Multiple sort criteria with ascending and descending orders. 5 arguments used.');
		// Case #17: String, String, Number. String arrays convertible to numbers, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY("2;1;3","20;10;30",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY("2;1;3","20;10;30",1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '2;1;3', 'Test: Positive case: String, String, Number. String arrays convertible to numbers, ascending order. 3 arguments used.');
		// Case #18: Array, Array, Number. Small array with two elements, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY({1;2},{10;20},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;2},{10;20},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Array, Array, Number. Small array with two elements, ascending order. 3 arguments used.');
		// Case #19: Formula, Array, Number. Nested IF with array output, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY(IF({TRUE;FALSE},{1;2},{3;4}),{10;20},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(IF({TRUE;FALSE},{1;2},{3;4}),{10;20},1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Formula, Array, Number. Nested IF with array output, ascending order. 3 arguments used.');
		// Case #20: Area, Array, Number. Two-cell range sorted by array, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY(A100:A101,{10;20},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(A100:A101,{10;20},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Area, Array, Number. Two-cell range sorted by array, ascending order. 3 arguments used.');
		// Case #21: Array, Formula, Number. by_array as formula result, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY({1;2;3},SUM(10,20),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;2;3},SUM(10,20),1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Array, Formula, Number. by_array as formula result, ascending order. 3 arguments used.');
		// Case #22: Array, Array, Formula. sort_order as nested IF formula, ascending order. 3 arguments used.
		oParser = new parserFormula('SORTBY({1;2;3},{10;20;30},IF(TRUE,1,-1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;2;3},{10;20;30},IF(TRUE,1,-1)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Array, Array, Formula. sort_order as nested IF formula, ascending order. 3 arguments used.');

		// Negative cases:
		// Case #1: Number, Number, Number. by_array with single invalid value returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY({1;2;3},0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;2;3},0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Negative case: Number, Number, Number. by_array with single invalid value returns #VALUE!. 3 arguments used.');
		// Case #2: Number, Number, Number. by_array with negative value returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY({1;2;3},-1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;2;3},-1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Negative case: Number, Number, Number. by_array with negative value returns #VALUE!. 3 arguments used.');
		// Case #3: String, String, Number. Non-numeric string arrays return #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY("abc","def",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY("abc","def",1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'abc', 'Test: Negative case: String, String, Number. Non-numeric string arrays return #VALUE!. 3 arguments used.');
		// Case #4: Empty, Array, Number. Empty array reference returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY(A103,{10;20;30},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(A103,{10;20;30},1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Empty, Array, Number. Empty array reference returns #VALUE!. 3 arguments used.');
		// Case #5: Error, Array, Number. Propagates #N/A error. 3 arguments used.
		oParser = new parserFormula('SORTBY(NA(),{10;20;30},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(NA(),{10;20;30},1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error, Array, Number. Propagates #N/A error. 3 arguments used.');
		// Case #6: Area, Area, Number. Multi-cell range mismatch returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY(A100:A103,A101:A104,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(A100:A103,A101:A104,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Negative case: Area, Area, Number. Multi-cell range mismatch returns #VALUE!. 3 arguments used.');
		// Case #7: Array, Array, String. Invalid sort_order string returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY({1;2;3},{10;20;30},"asc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;2;3},{10;20;30},"asc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, Array, String. Invalid sort_order string returns #VALUE!. 3 arguments used.');
		// Case #8: Array, Array, Number. Invalid sort_order (0) returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY({1;2;3},{10;20;30},0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;2;3},{10;20;30},0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, Array, Number. Invalid sort_order (0) returns #VALUE!. 3 arguments used.');
		// Case #9: Boolean, Array, Number. Boolean array returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY(FALSE,{10;20;30},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(FALSE,{10;20;30},1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Boolean, Array, Number. Boolean array returns #VALUE!. 3 arguments used.');
		// Case #10: Ref3D, Ref3D, Number. 3D ref to text returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY(Sheet2!A3,Sheet2!A4,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(Sheet2!A3,Sheet2!A4,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'Text', 'Test: Negative case: Ref3D, Ref3D, Number. 3D ref to text returns #VALUE!. 3 arguments used.');
		// Case #11: Name, Name, Number. Named range with text returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY(TestNameArea,TestNameArea2,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(TestNameArea,TestNameArea2,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Name, Name, Number. Named range with text returns #VALUE!. 3 arguments used.');
		// Case #12: Table, Table, Number. Table column with text returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY(Table1[Column3],Table1[Column2],1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(Table1[Column3],Table1[Column2],1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'Text', 'Test: Negative case: Table, Table, Number. Table column with text returns #VALUE!. 3 arguments used.');
		// Case #13: Formula, Array, Number. Formula resulting in #NUM! error. 3 arguments used.
		oParser = new parserFormula('SORTBY(SQRT(-1),{10;20;30},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(SQRT(-1),{10;20;30},1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula, Array, Number. Formula resulting in #NUM! error. 3 arguments used.');
		// Case #14: Array, Array, Number. Mismatched array sizes return #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY({1;2},{10},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;2},{10},1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Array, Array, Number. Mismatched array sizes return #VALUE!. 3 arguments used.');
		// Case #15: Array, Array, Number. Array with booleans returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY({FALSE;TRUE},{10;20},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({FALSE;TRUE},{10;20},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'FALSE', 'Test: Negative case: Array, Array, Number. Array with booleans returns #VALUE!. 3 arguments used.');
		// Case #16: Array, Number, Number. by_array as multi-cell range returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY({1;2;3},A100:A101,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;2;3},A100:A101,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array, Number, Number. by_array as multi-cell range returns #VALUE!. 3 arguments used.');
		// Case #17: Array, Array, Number. by_array with overflow value returns #NUM!. 3 arguments used.
		oParser = new parserFormula('SORTBY({1;2;3},{1E+307;2;3},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;2;3},{1E+307;2;3},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 2, 'Test: Negative case: Array, Array, Number. by_array with overflow value returns #NUM!. 3 arguments used.');
		// Case #18: String, Array, Number. Array with negative string value returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY("-1;2;3",{10;20;30},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY("-1;2;3",{10;20;30},1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: String, Array, Number. Array with negative string value returns #VALUE!. 3 arguments used.');
		// Case #19: Area3D, Area3D, Number. 3D multi-cell range returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY(Sheet2!A1:B1,Sheet2!A2:B2,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY(Sheet2!A1:B1,Sheet2!A2:B2,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Negative case: Area3D, Area3D, Number. 3D multi-cell range returns #VALUE!. 3 arguments used.');
		// Case #20: Array, Empty, Number. Empty by_array reference returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('SORTBY({1;2;3},A103,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1;2;3},A103,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Negative case: Array, Empty, Number. Empty by_array reference returns #VALUE!. 3 arguments used.');

		// Bounded cases:
		// Case #1: Number, Number, Number. Minimum valid array size (single element). 3 arguments used.
		oParser = new parserFormula('SORTBY({1},{1},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1},{1},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Bounded case: Number, Number, Number. Minimum valid array size (single element). 3 arguments used.');
		// Case #2: Number, Number, Number. Minimum valid numeric values. 3 arguments used.
		oParser = new parserFormula('SORTBY({1E-307;2;3},{1E-307;2;3},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({1E-307;2;3},{1E-307;2;3},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1e-307, 'Test: Bounded case: Number, Number, Number. Minimum valid numeric values. 3 arguments used.');
		// Case #3: Number, Number, Number. Maximum valid Excel number. 3 arguments used.
		oParser = new parserFormula('SORTBY({9.99999999999999E+307;2;3},{9.99999999999999E+307;2;3},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SORTBY({9.99999999999999E+307;2;3},{9.99999999999999E+307;2;3},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 2, 'Test: Bounded case: Number, Number, Number. Maximum valid Excel number. 3 arguments used.');

		// TODO
		// Need to fix: different results from MS
		// Case #3: Formula, Array, Number. Nested IF formula for array, ascending order. 3 arguments used.
		// Case #19: Formula, Array, Number. Nested IF with array output, ascending order. 3 arguments used.
		// Case #14: Array, Array, Number. Mismatched array sizes return #VALUE!. 3 arguments used.

	});

	QUnit.test("Test: \"TRANSPOSE\"", function (assert) {

		ws.getRange2("A1:C214").cleanAll();
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("0.5");
		ws.getRange2("A101").setValue("1.5");
		ws.getRange2("A104").setValue("-1");
		// For area
		ws.getRange2("A102").setValue("0.5");
		ws.getRange2("A103").setValue("");
		ws.getRange2("A105").setValue("1");
		ws.getRange2("A110").setValue("TRUE");
		ws.getRange2("A111").setValue("FALSE");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 1);
		ws.getRange2("A601").setValue("1"); // Number (Column1)
		ws.getRange2("B601").setValue("1s"); // Text (Column2)
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2


		// Positive cases:
		// Case #1: Array. {1,2} to {1;2}
		oParser = new parserFormula('TRANSPOSE({1,2})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({1,2}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array. {1,2} to {1;2}');
		// Case #2: Array. {1;2} to {1,2}
		oParser = new parserFormula('TRANSPOSE({1;2})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({1;2}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array. {1;2} to {1,2}');
		// Case #3: Number. {1}
		oParser = new parserFormula('TRANSPOSE({1})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({1}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number. {1}');
		// Case #4: Reference link. {1,2}
		oParser = new parserFormula('TRANSPOSE(A100:A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(A100:A101) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0.5, 'Test: Positive case: Reference link. {1,2}');
		// Case #5: Area. {1}
		oParser = new parserFormula('TRANSPOSE(A100:A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(A100:A100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 0.5, 'Test: Positive case: Area. {1}');
		// Case #6: String. {"a";"b"}
		oParser = new parserFormula('TRANSPOSE({"a","b"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({"a","b"}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'a', 'Test: Positive case: String. {"a";"b"}');
		// Case #7: Formula. {1,2}
		oParser = new parserFormula('TRANSPOSE(IF(TRUE,{1,2},{3,4}))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(IF(TRUE,{1,2},{3,4})) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Formula. {1,2}');
		// Case #8: Date. {44197,44198}
		oParser = new parserFormula('TRANSPOSE({44197,44198})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({44197,44198}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 44197, 'Test: Positive case: Date. {44197,44198}');
		// Case #9: Time. {0.5,0.541666667}
		oParser = new parserFormula('TRANSPOSE({0.5,0.541666667})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({0.5,0.541666667}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Time. {0.5,0.541666667}');
		// Case #10: Reference link. {10,20}
		oParser = new parserFormula('TRANSPOSE(A102:A103)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(A102:A103) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0.5, 'Test: Positive case: Reference link. {10,20}');
		// Case #11: Area. {"x","y"}
		oParser = new parserFormula('TRANSPOSE(A104:A105)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(A104:A105) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), -1, 'Test: Positive case: Area. {"x","y"}');
		// Case #12: Name. {1,2}
		oParser = new parserFormula('TRANSPOSE(TestName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(TestName) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), -0.5, 'Test: Positive case: Name. {1,2}');
		// Case #13: Name3D. {3,4}
		oParser = new parserFormula('TRANSPOSE(TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), -0.5, 'Test: Positive case: Name3D. {3,4}');
		// Case #14: Ref3D. {5,6}
		oParser = new parserFormula('TRANSPOSE(Sheet2!A1:A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(Sheet2!A1:A2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Ref3D. {5,6}');
		// Case #15: Area3D. {7,8}
		oParser = new parserFormula('TRANSPOSE(Sheet2!A3:A4)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(Sheet2!A3:A4) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'Text', 'Test: Positive case: Area3D. {7,8}');
		// Case #16: Table. {100,200}
		oParser = new parserFormula('TRANSPOSE(Table1[Column1])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(Table1[Column1]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Table. {100,200}');
		// Case #17: Formula. 4
		oParser = new parserFormula('SUM(TRANSPOSE({1,2}),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SUM(TRANSPOSE({1,2}),1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Test: Positive case: Formula. 4');
		// Case #18: Array. {TRUE,FALSE}
		oParser = new parserFormula('TRANSPOSE({TRUE,FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({TRUE,FALSE}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'TRUE', 'Test: Positive case: Array. {TRUE,FALSE}');
		// Case #19: Reference link. {TRUE}
		oParser = new parserFormula('TRANSPOSE(A106)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(A106) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Positive case: Reference link. {TRUE}');
		// Case #20: Area. {0.1,0.2}
		oParser = new parserFormula('TRANSPOSE(A107:A108)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(A107:A108) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Positive case: Area. {0.1,0.2}');
		// Case #21: Name. {10,20}
		oParser = new parserFormula('TRANSPOSE(TestName1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(TestName1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 0.5, 'Test: Positive case: Name. {10,20}');
		// Case #22: Ref3D. {9}
		oParser = new parserFormula('TRANSPOSE(Sheet2!A5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(Sheet2!A5) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Positive case: Ref3D. {9}');
		// Case #23: Array. {1.5,2.5}
		oParser = new parserFormula('TRANSPOSE({1.5,2.5})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({1.5,2.5}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1.5, 'Test: Positive case: Array. {1.5,2.5}');
		// Case #24: Formula. {1,2}
		oParser = new parserFormula('TRANSPOSE(VALUE({"1","2"}))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(VALUE({"1","2"})) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Formula. {1,2}');
		// Case #25: Area3D. {100}
		oParser = new parserFormula('TRANSPOSE(Sheet2!A6:A6)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(Sheet2!A6:A6) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0, 'Test: Positive case: Area3D. {100}');

		// Negative cases:
		// Case #1: Empty. #VALUE!
		oParser = new parserFormula('TRANSPOSE(A109)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(A109) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Negative case: Empty. #VALUE!');
		// Case #2: Error. #N/A
		oParser = new parserFormula('TRANSPOSE(NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error. #N/A');
		// Case #3: String. #VALUE!
		oParser = new parserFormula('TRANSPOSE("abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE("abc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'abc', 'Test: Negative case: String. #VALUE!');
		// Case #4: Boolean. #VALUE!
		oParser = new parserFormula('TRANSPOSE(FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'FALSE', 'Test: Negative case: Boolean. #VALUE!');
		// Case #5: Area. #VALUE!
		oParser = new parserFormula('TRANSPOSE(A110:A111)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(A110:A111) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Negative case: Area. #VALUE!');
		// Case #6: Array. #VALUE!
		oParser = new parserFormula('TRANSPOSE({"abc",1})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({"abc",1}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'abc', 'Test: Negative case: Array. #VALUE!');
		// Case #7: Formula. #DIV/0!
		oParser = new parserFormula('TRANSPOSE(MMULT(1,2))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(MMULT(1,2)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 2, 'Test: Negative case: Formula. #DIV/0!');
		// Case #8: Reference link. #VALUE!
		oParser = new parserFormula('TRANSPOSE(A110)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(A110) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Negative case: Reference link. #VALUE!');
		// Case #9: Name. #VALUE!
		oParser = new parserFormula('TRANSPOSE(TestNameArea2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(TestNameArea2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name. #VALUE!');
		// Case #10: Name3D. #VALUE!
		oParser = new parserFormula('TRANSPOSE(TestNameArea3D2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(TestNameArea3D2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name3D. #VALUE!');
		// Case #11: Ref3D. #VALUE!
		oParser = new parserFormula('TRANSPOSE(Sheet2!A7)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(Sheet2!A7) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Negative case: Ref3D. #VALUE!');
		// Case #12: Area3D. #VALUE!
		oParser = new parserFormula('TRANSPOSE(Sheet2!A8:A9)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(Sheet2!A8:A9) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0, 'Test: Negative case: Area3D. #VALUE!');
		// Case #13: Table. #VALUE!
		oParser = new parserFormula('TRANSPOSE(Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '1s', 'Test: Negative case: Table. #VALUE!');
		// Case #14: Formula. #VALUE!
		oParser = new parserFormula('TRANSPOSE(IF(FALSE,1,"abc"))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(IF(FALSE,1,"abc")) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'abc', 'Test: Negative case: Formula. #VALUE!');
		// Case #15: Array. #DIV/0!
		oParser = new parserFormula('TRANSPOSE({#DIV/0!})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({#DIV/0!}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '#DIV/0!', 'Test: Negative case: Array. #DIV/0!');
		// Case #16: Reference link. #VALUE!
		oParser = new parserFormula('TRANSPOSE(A111)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(A111) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0, 'Test: Negative case: Reference link. #VALUE!');
		// Case #17: Area. #VALUE!
		oParser = new parserFormula('TRANSPOSE(A100:A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(A100:A102) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0.5, 'Test: Negative case: Area. #VALUE!');
		// Case #18: Array. #VALUE!
		oParser = new parserFormula('TRANSPOSE({1,TRUE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({1,TRUE}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array. #VALUE!');
		// Case #19: Formula. #NUM!
		oParser = new parserFormula('TRANSPOSE(DATE(2025,13,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(DATE(2025,13,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 46023, 'Test: Negative case: Formula. #NUM!');
		// Case #20: Name. #VALUE!
		oParser = new parserFormula('TRANSPOSE(TestName2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(TestName2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 10.5, 'Test: Negative case: Name. #VALUE!');
		// Case #21: Ref3D. #VALUE!
		oParser = new parserFormula('TRANSPOSE(Sheet2!A10:A11)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(Sheet2!A10:A11) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0, 'Test: Negative case: Ref3D. #VALUE!');
		// Case #22: Array. #VALUE!
		oParser = new parserFormula('TRANSPOSE({".1"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({".1"}) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.1, 'Test: Negative case: Array. #VALUE!');

		// Bounded cases:
		// Case #1: Array. {1E-307}
		oParser = new parserFormula('TRANSPOSE({1E-307})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({1E-307}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1e-307, 'Test: Bounded case: Array. {1E-307}');
		// Case #2: Array. {9.99999999999999E+307}
		oParser = new parserFormula('TRANSPOSE({9.99999999999999E+307})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE({9.99999999999999E+307}) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1e+308, 'Test: Bounded case: Array. {9.99999999999999E+307}');
		// Case #3: Area. {1E-307,9.99999999999999E+307}
		oParser = new parserFormula('TRANSPOSE(A100:A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TRANSPOSE(A100:A101) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0.5, 'Test: Bounded case: Area. {1E-307,9.99999999999999E+307}');

		// Need to fix: empty handle, diff results from MS
		// Cases: #4,10,11,19,20,22,25,1,5,8,11,12,16,17,21,22

	});


	QUnit.test("Test: \"TAKE\"", function (assert) {
		//1. добавляем общие тесты

		ws.getRange2("A1").setValue("1");
		ws.getRange2("A2").setValue("2");
		ws.getRange2("A3").setValue("");
		ws.getRange2("A4").setValue("4");
		ws.getRange2("A5").setValue("#N/A");
		ws.getRange2("A6").setValue("f");

		ws.getRange2("B1").setValue("q");
		ws.getRange2("B2").setValue("w");
		ws.getRange2("B3").setValue("e");
		ws.getRange2("B4").setValue("test");
		ws.getRange2("B5").setValue("hhh");
		ws.getRange2("B6").setValue("g");

		ws.getRange2("C1").setValue("r");
		ws.getRange2("C2").setValue("3");
		ws.getRange2("C3").setValue("5");
		ws.getRange2("C4").setValue("");
		ws.getRange2("C5").setValue("6");
		ws.getRange2("C6").setValue("h");

		ws.getRange2("D1").setValue("");
		ws.getRange2("D2").setValue("");
		ws.getRange2("D3").setValue("");
		ws.getRange2("D4").setValue("");
		ws.getRange2("D5").setValue("");
		ws.getRange2("D6").setValue("");

		oParser = new parserFormula("TAKE(A1:C6,1,2)", "A1", ws);
		assert.ok(oParser.parse());
		let array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1);
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'q');

		oParser = new parserFormula("TAKE(A1:D5,100,100)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), '');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 4);
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), '#N/A');

		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'q');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 'w');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 'e');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), 'hhh');

		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 'r');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 3);
		assert.strictEqual(array.getElementRowCol(2, 2).getValue(), 5);
		assert.strictEqual(array.getElementRowCol(3, 2).getValue(), '');
		assert.strictEqual(array.getElementRowCol(4, 2).getValue(), 6);

		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), '');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), '');
		assert.strictEqual(array.getElementRowCol(2, 3).getValue(), '');
		assert.strictEqual(array.getElementRowCol(3, 3).getValue(), '');
		assert.strictEqual(array.getElementRowCol(4, 3).getValue(), '');


		oParser = new parserFormula("TAKE(A1:D5,-1,-4)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), '#N/A');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'hhh');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 6);
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), '');

		oParser = new parserFormula("TAKE(A1:D5,,-2)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 'r');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 3);
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 5);
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), '');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 6);

		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), '');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), '');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), '');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), '');
		assert.strictEqual(array.getElementRowCol(4, 1).getValue(), '');

		oParser = new parserFormula("TAKE(A1:D5,2,)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2);

		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'q');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 'w');

		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 'r');
		assert.strictEqual(array.getElementRowCol(1, 2).getValue(), 3);

		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), '');
		assert.strictEqual(array.getElementRowCol(1, 3).getValue(), '');

		oParser = new parserFormula("TAKE(A1:D5,2)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2);

		//2. аргументы - разные типы. нужно пербрать все аргументы
		//2.1 аргумент - number
		oParser = new parserFormula("TAKE(1,1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.2 аргумент - string
		oParser = new parserFormula("TAKE(\"test\",1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test");
		//2.3 аргумент - bool
		oParser = new parserFormula("TAKE(true,1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "TRUE");
		//2.4 аргумент - error
		oParser = new parserFormula("TAKE(#VALUE!,3)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.5 аргумент - empty
		oParser = new parserFormula("TAKE(,2)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.6 аргумент - cellsRange
		//2.7 аргумент - cell
		oParser = new parserFormula("TAKE(B1, 1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "q");

		//2.8 аргумент - array
		oParser = new parserFormula("TAKE({2;\"\";\"test\"},3)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), '');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 'test');

		oParser = new parserFormula("TAKE({1,2,3},2,1)", "A1", ws);
		assert.ok(oParser.parse(), "TAKE({1,2,3},2,1)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, "Result of TAKE({1,2,3},2,1)");

		oParser = new parserFormula("TAKE({1;2;3},1,2)", "A1", ws);
		assert.ok(oParser.parse(), "TAKE({1;2;3},1,2)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1, "Result of TAKE({1;2;3},1,2)");

		//2.2 аргумент - string
		oParser = new parserFormula("TAKE(1,\"test\")", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.3 аргумент - bool
		oParser = new parserFormula("TAKE(1,true)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.4 аргумент - error
		oParser = new parserFormula("TAKE(1, #VALUE!)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.5 аргумент - empty
		oParser = new parserFormula("TAKE(1,)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		//2.6 аргумент - cellsRange
		//2.7 аргумент - cell
		oParser = new parserFormula("TAKE(1,A1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("TAKE(1,A1:B5)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		//2.8 аргумент - array
		oParser = new parserFormula("TAKE(1,{2;\"\";\"test\"})", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		ws.getRange2("A1:C214").cleanAll();
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("0.5");
		ws.getRange2("A101").setValue("1.5");
		ws.getRange2("A104").setValue("-1");
		// For area
		ws.getRange2("A102").setValue("0.5");
		ws.getRange2("A103").setValue("");
		ws.getRange2("A105").setValue("1");
		ws.getRange2("A110").setValue("TRUE");
		ws.getRange2("A111").setValue("FALSE");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 1);
		ws.getRange2("A601").setValue("1"); // Number (Column1)
		ws.getRange2("B601").setValue("1s"); // Text (Column2)
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2

		// Positive cases:
		// Case #1: Number. Basic valid input: array with numbers, single row and column. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number. Basic valid input: array with numbers, single row and column. 3 of 3 arguments used.');
		// Case #2: Number. Array with rows, selecting 2 rows and 1 column. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1;2;3},2,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1;2;3},2,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number. Array with rows, selecting 2 rows and 1 column. 3 of 3 arguments used.');
		// Case #3: Formula, Number. Formula generating array string, valid row and column. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(ARRAYTOTEXT({1,2,3}),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(ARRAYTOTEXT({1,2,3}),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '1, 2, 3', 'Test: Positive case: Formula, Number. Formula generating array string, valid row and column. 3 of 3 arguments used.');
		// Case #4: String, Number. String convertible to array, single row and column. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE("1,2,3",1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE("1,2,3",1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '1,2,3', 'Test: Positive case: String, Number. String convertible to array, single row and column. 3 of 3 arguments used.');
		// Case #5: Reference link, Number. Reference to cell with valid array. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(A100,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(A100,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Reference link, Number. Reference to cell with valid array. 3 of 3 arguments used.');
		// Case #6: Area, Number. Single-cell range, valid row and column. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(A100:A101,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(A100:A101,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Area, Number. Single-cell range, valid row and column. 3 of 3 arguments used.');
		// Case #7: Array, Number. 2D array, selecting all rows and columns. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2;3,4},2,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2;3,4},2,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Number. 2D array, selecting all rows and columns. 3 of 3 arguments used.');
		// Case #8: Name, Number. Named range with valid array. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(TestName,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(TestName,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name, Number. Named range with valid array. 3 of 3 arguments used.');
		// Case #9: Name3D, Number. 3D named range with valid array. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(TestName3D,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(TestName3D,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name3D, Number. 3D named range with valid array. 3 of 3 arguments used.');
		// Case #10: Ref3D, Number. 3D reference to cell with valid array. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(Sheet2!A1,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(Sheet2!A1,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Ref3D, Number. 3D reference to cell with valid array. 3 of 3 arguments used.');
		// Case #11: Area3D, Number. 3D single-cell range. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(Sheet2!A1:A1,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(Sheet2!A1:A1,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Area3D, Number. 3D single-cell range. 3 of 3 arguments used.');
		// Case #12: Table, Number. Table structured reference with valid array. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(Table1[Column1],1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(Table1[Column1],1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Table, Number. Table structured reference with valid array. 3 of 3 arguments used.');
		// Case #13: Date, Number. Date as serial number, valid row and column. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(DATE(2025,1,1),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(DATE(2025,1,1),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 45658, 'Test: Positive case: Date, Number. Date as serial number, valid row and column. 3 of 3 arguments used.');
		// Case #14: Time, Number. Time as serial number, valid row and column. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(TIME(12,0,0),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(TIME(12,0,0),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Time, Number. Time as serial number, valid row and column. 3 of 3 arguments used.');
		// Case #15: Formula, Number. Nested formula returning valid array. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(SUM({1,2,3}),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(SUM({1,2,3}),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 6, 'Test: Positive case: Formula, Number. Nested formula returning valid array. 3 of 3 arguments used.');
		// Case #16: Formula, Number. Nested IF returning valid array. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(IF(TRUE, {1,2,3}, {4,5,6}),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(IF(TRUE, {1,2,3}, {4,5,6}),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula, Number. Nested IF returning valid array. 3 of 3 arguments used.');
		// Case #17: Number, Formula. Rows argument as formula. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},ABS(-1),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},ABS(-1),1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number, Formula. Rows argument as formula. 3 of 3 arguments used.');
		// Case #18: Number, Number, Formula. Columns argument as formula. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},1,ABS(-1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},1,ABS(-1)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number, Number, Formula. Columns argument as formula. 3 of 3 arguments used.');
		// Case #19: Formula. TAKE inside SUM formula. 3 of 3 arguments used.
		oParser = new parserFormula('SUM(TAKE({1,2,3},1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SUM(TAKE({1,2,3},1,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Formula. TAKE inside SUM formula. 3 of 3 arguments used.');
		// Case #20: Number. Larger 2D array, selecting all rows and columns. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3;4,5,6},2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3;4,5,6},2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number. Larger 2D array, selecting all rows and columns. 3 of 3 arguments used.');
		// Case #21: Area3D, Number. 3D multi-cell range (2 cells). 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(Sheet2!A1:A2,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(Sheet2!A1:A2,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Area3D, Number. 3D multi-cell range (2 cells). 3 of 3 arguments used.');
		// Case #22: Number, Number. Omitting optional columns argument. 2 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number, Number. Omitting optional columns argument. 2 of 3 arguments used.');

		// Negative cases:
		// Case #1: Number. Rows = 0 returns #NUM!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Number. Rows = 0 returns #NUM!. 3 of 3 arguments used.');
		// Case #2: Number. Negative rows returns #NUM!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},-1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},-1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Number. Negative rows returns #NUM!. 3 of 3 arguments used.');
		// Case #3: Number. Columns = 0 returns #NUM!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},1,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},1,0) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#CALC!', 'Test: Negative case: Number. Columns = 0 returns #NUM!. 3 of 3 arguments used.');
		// Case #4: Number. Negative columns returns #NUM!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},1,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},1,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 3, 'Test: Negative case: Number. Negative columns returns #NUM!. 3 of 3 arguments used.');
		// Case #5: String. Non-array string returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE("abc",1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE("abc",1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'abc', 'Test: Negative case: String. Non-array string returns #VALUE!. 3 of 3 arguments used.');
		// Case #6: Error, Number. Propagates #N/A error. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(NA(),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(NA(),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error, Number. Propagates #N/A error. 3 of 3 arguments used.');
		// Case #7: Area, Number. Multi-cell range exceeding array size returns #NUM!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(A100:A102,3,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(A100:A102,3,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Negative case: Area, Number. Multi-cell range exceeding array size returns #NUM!. 3 of 3 arguments used.');
		// Case #8: Empty, Number. Empty reference returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(A103,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(A103,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), "", 'Test: Negative case: Empty, Number. Empty reference returns #VALUE!. 3 of 3 arguments used.');
		// Case #9: Boolean, Number. Boolean input returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(FALSE,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(FALSE,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'FALSE', 'Test: Negative case: Boolean, Number. Boolean input returns #VALUE!. 3 of 3 arguments used.');
		// Case #10: Ref3D, Number. 3D ref to text returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(Sheet2!A2,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(Sheet2!A2,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 2, 'Test: Negative case: Ref3D, Number. 3D ref to text returns #VALUE!. 3 of 3 arguments used.');
		// Case #11: Name, Number. Named range with text returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(TestNameArea2,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(TestNameArea2,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name, Number. Named range with text returns #VALUE!. 3 of 3 arguments used.');
		// Case #12: Table, Number. Table column with text returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(Table1[Column2],1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(Table1[Column2],1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '1s', 'Test: Negative case: Table, Number. Table column with text returns #VALUE!. 3 of 3 arguments used.');
		// Case #13: Formula, Number. Formula resulting in #NUM! error. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(SQRT(-1),1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(SQRT(-1),1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula, Number. Formula resulting in #NUM! error. 3 of 3 arguments used.');
		// Case #14: Number, String. Non-numeric rows argument returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},"1",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},"1",1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Number, String. Non-numeric rows argument returns #VALUE!. 3 of 3 arguments used.');
		// Case #15: Number, Number, String. Non-numeric columns argument returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},1,"1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},1,"1") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Number, Number, String. Non-numeric columns argument returns #VALUE!. 3 of 3 arguments used.');
		// Case #16: Array, Number. Array with boolean returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({FALSE},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({FALSE},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'FALSE', 'Test: Negative case: Array, Number. Array with boolean returns #VALUE!. 3 of 3 arguments used.');
		// Case #17: Area3D, Number. 3D multi-cell range exceeding array size returns #NUM!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(Sheet2!A1:A3,3,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(Sheet2!A1:A3,3,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Area3D, Number. 3D multi-cell range exceeding array size returns #NUM!. 3 of 3 arguments used.');
		// Case #18: Number, Formula. Rows formula resulting in #NUM! error. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},SQRT(-1),1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},SQRT(-1),1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Number, Formula. Rows formula resulting in #NUM! error. 3 of 3 arguments used.');
		// Case #19: Number, Number, Formula. Columns formula resulting in #NUM! error. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},1,SQRT(-1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},1,SQRT(-1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Number, Number, Formula. Columns formula resulting in #NUM! error. 3 of 3 arguments used.');
		// Case #20: Name3D, Number. 3D named range with text returns #VALUE!. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE(TestName3DArea,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE(TestName3DArea,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NAME?', 'Test: Negative case: Name3D, Number. 3D named range with text returns #VALUE!. 3 of 3 arguments used.');

		// Bounded cases:
		// Case #1: Number. Minimum valid rows and columns (1). 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Number. Minimum valid rows and columns (1). 3 of 3 arguments used.');
		// Case #2: Number. Maximum valid rows (2^31-1), but limited by array size. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},2147483647,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},2147483647,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Number. Maximum valid rows (2^31-1), but limited by array size. 3 of 3 arguments used.');
		// Case #3: Number. Maximum valid columns (2^31-1), but limited by array size. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1,2,3},1,2147483647)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1,2,3},1,2147483647) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Number. Maximum valid columns (2^31-1), but limited by array size. 3 of 3 arguments used.');
		// Case #4: Number. Maximum rows matching array size. 3 of 3 arguments used.
		oParser = new parserFormula('TAKE({1;2;3},3,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TAKE({1;2;3},3,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Number. Maximum rows matching array size. 3 of 3 arguments used.');

		// Need to fix:
		// Case #3: Number. Columns = 0 returns #NUM!. 3 of 3 arguments used.


	});


	QUnit.test("Test: \"UNIQUE \"", function (assert) {

		ws.getRange2("A101").setValue("1");
		ws.getRange2("A102").setValue("2");
		ws.getRange2("A103").setValue("2");
		ws.getRange2("A104").setValue("-1");
		ws.getRange2("A105").setValue("-1");
		ws.getRange2("A106").setValue("ds");
		ws.getRange2("A107").setValue("ds");
		ws.getRange2("A108").setValue("#NUM!");
		ws.getRange2("A109").setValue("#NUM!");

		ws.getRange2("B101").setValue("1");
		ws.getRange2("B102").setValue("2");
		ws.getRange2("B103").setValue("2");
		ws.getRange2("B104").setValue("4");
		ws.getRange2("B105").setValue("5");
		ws.getRange2("B106").setValue("7");
		ws.getRange2("B107").setValue("7");
		ws.getRange2("B108").setValue("8");
		ws.getRange2("B109").setValue("8");

		ws.getRange2("C101").setValue("2");
		ws.getRange2("C102").setValue("2");
		ws.getRange2("C103").setValue("2");
		ws.getRange2("C104").setValue("1");
		ws.getRange2("C105").setValue("1");
		ws.getRange2("C106").setValue("2");
		ws.getRange2("C107").setValue("3");
		ws.getRange2("C108").setValue("8");
		ws.getRange2("C109").setValue("8");

		ws.getRange2("D101").setValue("2");
		ws.getRange2("D102").setValue("2");
		ws.getRange2("D103").setValue("2");
		ws.getRange2("D104").setValue("1");
		ws.getRange2("D105").setValue("1");
		ws.getRange2("D106").setValue("2");
		ws.getRange2("D107").setValue("3");
		ws.getRange2("D108").setValue("8");
		ws.getRange2("D109").setValue("8");

		oParser = new parserFormula("UNIQUE(A101:A109)", "F1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 0).getValue(), 2);
		assert.strictEqual(oParser.calculate().getElementRowCol(2, 0).getValue(), -1);
		assert.strictEqual(oParser.calculate().getElementRowCol(3, 0).getValue(), "ds");
		assert.strictEqual(oParser.calculate().getElementRowCol(4, 0).getValue(), "#NUM!");

		oParser = new parserFormula("UNIQUE(A101:A109)", "F1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 0).getValue(), 2);
		assert.strictEqual(oParser.calculate().getElementRowCol(2, 0).getValue(), -1);
		assert.strictEqual(oParser.calculate().getElementRowCol(3, 0).getValue(), "ds");
		assert.strictEqual(oParser.calculate().getElementRowCol(4, 0).getValue(), "#NUM!");

		oParser = new parserFormula("UNIQUE(A101:D101)", "F1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 1).getValue(), 1);
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 2).getValue(), 2);
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 3).getValue(), 2);

		oParser = new parserFormula("UNIQUE(A101:D101, true)", "F1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 1).getValue(), 2);

		oParser = new parserFormula("UNIQUE(A101:D101, true, true)", "F1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		ws.getRange2("F102").setValue("test");
		ws.getRange2("F103").setValue("#VALUE!");
		ws.getRange2("F104").setValue("test");
		ws.getRange2("F105").setValue("#VALUE!");
		ws.getRange2("F106").setValue("2");
		ws.getRange2("F107").setValue("-3");

		ws.getRange2("G102").setValue("2");
		ws.getRange2("G103").setValue("yyy");
		ws.getRange2("G104").setValue("4");
		ws.getRange2("G105").setValue("yyy");
		ws.getRange2("G106").setValue("asd");
		ws.getRange2("G107").setValue("7");

		ws.getRange2("H102").setValue("test");
		ws.getRange2("H103").setValue("#VALUE!");
		ws.getRange2("H104").setValue("test");
		ws.getRange2("H105").setValue("#VALUE!");
		ws.getRange2("H106").setValue("2");
		ws.getRange2("H107").setValue("-3");

		ws.getRange2("I102").setValue("2");
		ws.getRange2("I103").setValue("123");
		ws.getRange2("I104").setValue("4");
		ws.getRange2("I105").setValue("123");
		ws.getRange2("I106").setValue("6");
		ws.getRange2("I107").setValue("4");

		oParser = new parserFormula("UNIQUE(F102:I107)", "F1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 2).getValue(), "test");
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 2).getValue(), "#VALUE!");
		assert.strictEqual(oParser.calculate().getElementRowCol(2, 2).getValue(), "test");
		assert.strictEqual(oParser.calculate().getElementRowCol(3, 2).getValue(), 2);
		assert.strictEqual(oParser.calculate().getElementRowCol(4, 2).getValue(), -3);

		oParser = new parserFormula("UNIQUE(F102:I107, true)", "F1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 2).getValue(), 2);
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 2).getValue(), 123);
		assert.strictEqual(oParser.calculate().getElementRowCol(2, 2).getValue(), 4);
		assert.strictEqual(oParser.calculate().getElementRowCol(3, 2).getValue(), 123);
		assert.strictEqual(oParser.calculate().getElementRowCol(4, 2).getValue(), 6);
		assert.strictEqual(oParser.calculate().getElementRowCol(5, 2).getValue(), 4);

		oParser = new parserFormula("UNIQUE(F102:I107, false, true)", "F1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test");
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 1).getValue(), 4);
		assert.strictEqual(oParser.calculate().getElementRowCol(2, 2).getValue(), 2);
		assert.strictEqual(oParser.calculate().getElementRowCol(3, 3).getValue(), 4);

		oParser = new parserFormula("UNIQUE(F102:I107, true, true)", "F1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 1).getValue(), 2);
		assert.strictEqual(oParser.calculate().getElementRowCol(1, 1).getValue(), 123);
		assert.strictEqual(oParser.calculate().getElementRowCol(2, 1).getValue(), 4);
		assert.strictEqual(oParser.calculate().getElementRowCol(3, 1).getValue(), 123);
		assert.strictEqual(oParser.calculate().getElementRowCol(4, 1).getValue(), 6);
		assert.strictEqual(oParser.calculate().getElementRowCol(5, 1).getValue(), 4);

		ws.getRange2("A120").setValue("1");
		ws.getRange2("B120").setValue("2");

		oParser = new parserFormula("UNIQUE(A120:B120)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue().toFixed(8) - 0, 1);

		oParser = new parserFormula("UNIQUE({1;2})", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue().toFixed(8) - 0, 1);

		oParser = new parserFormula("UNIQUE({1,2})", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue().toFixed(8) - 0, 1);

		ws.getRange2("A1:C214").cleanAll();
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("0.5");
		ws.getRange2("A101").setValue("1.5");
		ws.getRange2("A104").setValue("-1");
		// For area
		ws.getRange2("A102").setValue("0.5");
		ws.getRange2("A103").setValue("");
		ws.getRange2("A105").setValue("1");
		ws.getRange2("A110").setValue("TRUE");
		ws.getRange2("A111").setValue("FALSE");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 1);
		ws.getRange2("A601").setValue("1"); // Number (Column1)
		ws.getRange2("B601").setValue("1s"); // Text (Column2)
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:F10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2

		// Positive cases:
		// Case #1: Array. Basic array with duplicate numbers. Returns {1,2,3}. 1 argument used.
		oParser = new parserFormula('UNIQUE({1,2,2,3})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({1,2,2,3}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array. Basic array with duplicate numbers. Returns {1,2,3}. 1 argument used.');
		// Case #2: Array. Array with duplicate strings. Returns {"a","b"}. 1 argument used.
		oParser = new parserFormula('UNIQUE({"a","b","a"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({"a","b","a"}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'a', 'Test: Positive case: Array. Array with duplicate strings. Returns {"a","b"}. 1 argument used.');
		// Case #3: Reference link. Reference to cell with number array. Returns {1,2,3}. 1 argument used.
		oParser = new parserFormula('UNIQUE(A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(A100) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 0.5, 'Test: Positive case: Reference link. Reference to cell with number array. Returns {1,2,3}. 1 argument used.');
		// Case #4: Area. Two-cell range with arrays. Returns unique values from range. 1 argument used.
		oParser = new parserFormula('UNIQUE(A100:A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(A100:A101) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Area. Two-cell range with arrays. Returns unique values from range. 1 argument used.');
		// Case #5: Formula. Nested IF formula returning array. Returns {1,2}. 1 argument used.
		oParser = new parserFormula('UNIQUE(IF(TRUE,{1,2,2},{3,3,3}))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(IF(TRUE,{1,2,2},{3,3,3})) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula. Nested IF formula returning array. Returns {1,2}. 1 argument used.');
		// Case #6: Date. Single date value. Returns {DATE(2025,1,1)}. 1 argument used.
		oParser = new parserFormula('UNIQUE(DATE(2025,1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(DATE(2025,1,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 45658, 'Test: Positive case: Date. Single date value. Returns {DATE(2025,1,1)}. 1 argument used.');
		// Case #7: Time. Single time value. Returns {TIME(12,0,0)}. 1 argument used.
		oParser = new parserFormula('UNIQUE(TIME(12,0,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(TIME(12,0,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 0.5, 'Test: Positive case: Time. Single time value. Returns {TIME(12,0,0)}. 1 argument used.');
		// Case #8: Array,Boolean. Column-wise unique values. Returns {1,2,3}. 2 arguments used.
		oParser = new parserFormula('UNIQUE({1,2,2,3},TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({1,2,2,3},TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array,Boolean. Column-wise unique values. Returns {1,2,3}. 2 arguments used.');
		// Case #9: Array,Boolean,Boolean. Returns values appearing exactly once. Returns {1,3}. 3 arguments used.
		oParser = new parserFormula('UNIQUE({1,2,2,3},FALSE,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({1,2,2,3},FALSE,TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array,Boolean,Boolean. Returns values appearing exactly once. Returns {1,3}. 3 arguments used.');
		// Case #10: Table. Table column with numbers. Returns {1,2,3}. 1 argument used.
		oParser = new parserFormula('UNIQUE(Table1[Column1])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(Table1[Column1]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Table. Table column with numbers. Returns {1,2,3}. 1 argument used.');
		// Case #11: Table. Table column with strings. Returns {"a","b"}. 1 argument used.
		oParser = new parserFormula('UNIQUE(Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '1s', 'Test: Positive case: Table. Table column with strings. Returns {"a","b"}. 1 argument used.');
		// Case #12: Name. Named range with numbers. Returns {1,2,3}. 1 argument used.
		oParser = new parserFormula('UNIQUE(TestName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(TestName) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), -0.5, 'Test: Positive case: Name. Named range with numbers. Returns {1,2,3}. 1 argument used.');
		// Case #13: Name3D. 3D named range. Returns {1,2}. 1 argument used.
		oParser = new parserFormula('UNIQUE(TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), -0.5, 'Test: Positive case: Name3D. 3D named range. Returns {1,2}. 1 argument used.');
		// Case #14: Ref3D. 3D reference to cell with array. Returns {1,2}. 1 argument used.
		oParser = new parserFormula('UNIQUE(Sheet2!A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(Sheet2!A1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Ref3D. 3D reference to cell with array. Returns {1,2}. 1 argument used.');
		// Case #15: Area3D. 3D range with arrays. Returns unique values from range. 1 argument used.
		oParser = new parserFormula('UNIQUE(Sheet2!A1:A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(Sheet2!A1:A2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Area3D. 3D range with arrays. Returns unique values from range. 1 argument used.');
		// Case #16: Formula. Nested SORT formula. Returns {1,2,3}. 1 argument used.
		oParser = new parserFormula('UNIQUE(SORT({1,2,2,3}))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(SORT({1,2,2,3})) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula. Nested SORT formula. Returns {1,2,3}. 1 argument used.');
		// Case #17: Array,String. String "0" converted to FALSE for by_col. Returns {"a","b"}. 2 arguments used.
		oParser = new parserFormula('UNIQUE({"a","a","b"},"0")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({"a","a","b"},"0") is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Positive case: Array,String. String "0" converted to FALSE for by_col. Returns {"a","b"}. 2 arguments used.');
		// Case #18: Array,Number. Number 1 converted to TRUE for by_col. Returns {1,2,3}. 2 arguments used.
		oParser = new parserFormula('UNIQUE({1,2,2,3},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({1,2,2,3},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array,Number. Number 1 converted to TRUE for by_col. Returns {1,2,3}. 2 arguments used.');
		// Case #19: Formula. UNIQUE inside SUM formula. Returns 6 (sum of {1,2,3}). 1 argument used.
		oParser = new parserFormula('SUM(UNIQUE({1,2,2,3}))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SUM(UNIQUE({1,2,2,3})) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Positive case: Formula. UNIQUE inside SUM formula. Returns 6 (sum of {1,2,3}). 1 argument used.');
		// Case #20: Array. Mixed number and string array. Returns {1,"a"}. 1 argument used.
		oParser = new parserFormula('UNIQUE({1,"a",1,"a"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({1,"a",1,"a"}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array. Mixed number and string array. Returns {1,"a"}. 1 argument used.');
		// Case #21: Area. Three-cell range. Returns unique values from range. 1 argument used.
		oParser = new parserFormula('UNIQUE(A100:A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(A100:A102) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Area. Three-cell range. Returns unique values from range. 1 argument used.');
		// Case #22: Array. Array with booleans. Returns {TRUE,FALSE}. 1 argument used.
		oParser = new parserFormula('UNIQUE({TRUE,FALSE,TRUE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({TRUE,FALSE,TRUE}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'TRUE', 'Test: Positive case: Array. Array with booleans. Returns {TRUE,FALSE}. 1 argument used.');

		// Negative cases:
		// Case #1: Empty. Reference to empty cell. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('UNIQUE(A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(A102) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 0.5, 'Test: Negative case: Empty. Reference to empty cell. Returns #VALUE!. 1 argument used.');
		// Case #2: String. Non-array string. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('UNIQUE("abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE("abc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'abc', 'Test: Negative case: String. Non-array string. Returns #VALUE!. 1 argument used.');
		// Case #3: Error. Propagates #N/A error. 1 argument used.
		oParser = new parserFormula('UNIQUE(NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error. Propagates #N/A error. 1 argument used.');
		// Case #4: Area. Multi-cell range with empty cells. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('UNIQUE(A102:A103)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(A102:A103) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Negative case: Area. Multi-cell range with empty cells. Returns #VALUE!. 1 argument used.');
		// Case #5: Boolean. Boolean input. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('UNIQUE(FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 'FALSE', 'Test: Negative case: Boolean. Boolean input. Returns #VALUE!. 1 argument used.');
		// Case #6: Ref3D. 3D reference to text cell. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('UNIQUE(Sheet2!A5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(Sheet2!A5) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), "", 'Test: Negative case: Ref3D. 3D reference to text cell. Returns #VALUE!. 1 argument used.');
		// Case #7: Name. Named range with area. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('UNIQUE(TestNameArea2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(TestNameArea2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name. Named range with area. Returns #VALUE!. 1 argument used.');
		// Case #8: Name3D. 3D named range with area. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('UNIQUE(TestNameArea3D2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(TestNameArea3D2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name3D. 3D named range with area. Returns #VALUE!. 1 argument used.');
		// Case #9: Table. Table column with text. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('UNIQUE(Table1[Column2],Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(Table1[Column2],Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '1s', 'Test: Negative case: Table. Table column with text. Returns #VALUE!. 1 argument used.');
		// Case #10: Formula. Formula resulting in #NUM! error. Returns #NUM!. 1 argument used.
		oParser = new parserFormula('UNIQUE(SQRT(-1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(SQRT(-1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula. Formula resulting in #NUM! error. Returns #NUM!. 1 argument used.');
		// Case #11: Array. Empty array. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('UNIQUE({"."})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({"."}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '.', 'Test: Negative case: Array. Empty array. Returns #VALUE!. 1 argument used.');
		// Case #12: Array,String. Invalid string for by_col. Returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('UNIQUE({1,2,2},"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({1,2,2},"abc") is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array,String. Invalid string for by_col. Returns #VALUE!. 2 arguments used.');
		// Case #13: Array,Empty. Empty by_col argument. Returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('UNIQUE({1,2,2},)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({1,2,2},) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array,Empty. Empty by_col argument. Returns #VALUE!. 2 arguments used.');
		// Case #14: Array,Boolean,String. Invalid string for exactly_once. Returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('UNIQUE({1,2,2},TRUE,"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({1,2,2},TRUE,"abc") is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array,Boolean,String. Invalid string for exactly_once. Returns #VALUE!. 3 arguments used.');
		// Case #15: Array,Empty. Empty exactly_once argument. Returns #VALUE!. 3 arguments used.
		oParser = new parserFormula('UNIQUE({1,2,2},TRUE,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({1,2,2},TRUE,) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array,Empty. Empty exactly_once argument. Returns #VALUE!. 3 arguments used.');
		// Case #16: Reference link. Reference to cell with #N/A. Returns #N/A. 1 argument used.
		oParser = new parserFormula('UNIQUE(A103)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(A103) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), "", 'Test: Negative case: Reference link. Reference to cell with #N/A. Returns #N/A. 1 argument used.');
		// Case #17: Area3D. 3D range with text. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('UNIQUE(Sheet2!A3:A5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(Sheet2!A3:A5) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'Text', 'Test: Negative case: Area3D. 3D range with text. Returns #VALUE!. 1 argument used.');
		// Case #18: Array. Array with single boolean value. Returns #VALUE!. 1 argument used.
		oParser = new parserFormula('UNIQUE({FALSE,FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({FALSE,FALSE}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'FALSE', 'Test: Negative case: Array. Array with single boolean value. Returns #VALUE!. 1 argument used.');
		// Case #19: Formula. Formula resulting in #DIV/0!. Returns #DIV/0!. 1 argument used.
		oParser = new parserFormula('UNIQUE(MMULT(3,2))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(MMULT(3,2)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 6, 'Test: Negative case: Formula. Formula resulting in #DIV/0!. Returns #DIV/0!. 1 argument used.');
		// Case #20: Array,Number. Invalid number for by_col (not 0 or 1). Returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('UNIQUE({1,2,2},2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({1,2,2},2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array,Number. Invalid number for by_col (not 0 or 1). Returns #VALUE!. 2 arguments used.');

		// Bounded cases:
		// Case #1: Array. Single-element array (minimum valid). Returns {1}. 1 argument used.
		oParser = new parserFormula('UNIQUE({1})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({1}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Array. Single-element array (minimum valid). Returns {1}. 1 argument used.');
		// Case #2: Area. Maximum Excel row range (1,048,576 rows). Returns unique values. 1 argument used.
		oParser = new parserFormula('UNIQUE(A100:A1048576)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE(A100:A1048576) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Bounded case: Area. Maximum Excel row range (1,048,576 rows). Returns unique values. 1 argument used.');
		// Case #3: Array,Number,Number. Boundary values for by_col and exactly_once (1 as TRUE). Returns {1,3}. 3 arguments used.
		oParser = new parserFormula('UNIQUE({1,2,2,3},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({1,2,2,3},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Array,Number,Number. Boundary values for by_col and exactly_once (1 as TRUE). Returns {1,3}. 3 arguments used.');
		// Case #4: Array,Number,Number. Boundary values for by_col and exactly_once (0 as FALSE). Returns {1,2,3}. 3 arguments used.
		oParser = new parserFormula('UNIQUE({1,2,2,3},0,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: UNIQUE({1,2,2,3},0,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Array,Number,Number. Boundary values for by_col and exactly_once (0 as FALSE). Returns {1,2,3}. 3 arguments used.');

		// TODO critical problem when enter this cases
		// Need to fix: types handle in each argument(toBool,toString etc. problems)
		// Case #17: Array,String. String "0" converted to FALSE for by_col. Returns {"a","b"}. 2 arguments used.
		// Case #12: Array,String. Invalid string for by_col. Returns #VALUE!. 2 arguments used.
		// Case #14: Array,Boolean,String. Invalid string for exactly_once. Returns #VALUE!. 3 arguments used.

	});


	QUnit.test("Test: \"VLOOKUP\"", function (assert) {
		let array;

		ws.getRange2("A501").setValue("Density");
		ws.getRange2("B501").setValue("Bearings");
		ws.getRange2("C501").setValue("Bolts");
		ws.getRange2("D501").setValue("");

		ws.getRange2("A502").setValue("0.457");
		ws.getRange2("B502").setValue("3.55");
		ws.getRange2("C502").setValue("500");
		ws.getRange2("A503").setValue("0.525");
		ws.getRange2("B503").setValue("3.25");
		ws.getRange2("C503").setValue("400");
		ws.getRange2("A504").setValue("0.616");
		ws.getRange2("B504").setValue("2.93");
		ws.getRange2("C504").setValue("300");
		ws.getRange2("A505").setValue("0.675");
		ws.getRange2("B505").setValue("2.75");
		ws.getRange2("C505").setValue("250");
		ws.getRange2("A506").setValue("0.746");
		ws.getRange2("B506").setValue("2.57");
		ws.getRange2("C506").setValue("200");
		ws.getRange2("A507").setValue("0.835");
		ws.getRange2("B507").setValue("2.38");
		ws.getRange2("C507").setValue("15");
		ws.getRange2("A508").setValue("0.946");
		ws.getRange2("B508").setValue("2.17");
		ws.getRange2("C508").setValue("100");
		ws.getRange2("A509").setValue("1.09");
		ws.getRange2("B509").setValue("1.95");
		ws.getRange2("C509").setValue("50");
		ws.getRange2("A510").setValue("1.29");
		ws.getRange2("B510").setValue("1.71");
		ws.getRange2("C510").setValue("0");

		ws.getRange2("BA100").setValue("2");
		ws.getRange2("BA101").setValue("4");
		ws.getRange2("BA102").setValue("40");
		ws.getRange2("BB100").setValue("1");
		ws.getRange2("BB101").setValue("2");
		ws.getRange2("BB102").setValue("3");
		ws.getRange2("BE100").setValue("1");
		ws.getRange2("BE101").setValue("1");
		ws.getRange2("BF100").setValue("2");
		ws.getRange2("BF101").setValue("1");
		ws.getRange2("BG100").setValue("3");
		ws.getRange2("BG101").setValue("1");

		ws.getRange2("A1101:B1120").cleanAll();
		ws.getRange2("A1101").setValue("AnyStringValue2");
		ws.getRange2("A1102").setValue("StringValue(Awesome)");
		ws.getRange2("A1103").setValue("1.12");
		ws.getRange2("A1104").setValue("2.24");
		ws.getRange2("A1105").setValue("#VALUE!");
		ws.getRange2("A1106").setValue("#NUM!");
		ws.getRange2("A1107").setValue("#DIV/0!");
		ws.getRange2("A1108").setValue("TRUE");
		ws.getRange2("A1109").setValue("Sandra");
		ws.getRange2("A1110").setValue("");
		ws.getRange2("A1111").setValue("Sandra");
		ws.getRange2("A1112").setValue("0");
		ws.getRange2("A1113").setValue("5,2");
		ws.getRange2("B1101").setValue("1");
		ws.getRange2("B1102").setValue("2");
		ws.getRange2("B1103").setValue("3");
		ws.getRange2("B1104").setValue("4");
		ws.getRange2("B1105").setValue("5");
		ws.getRange2("B1106").setValue("6");
		ws.getRange2("B1107").setValue("7");
		ws.getRange2("B1108").setValue("8");
		ws.getRange2("B1109").setValue("9");
		ws.getRange2("B1110").setValue("10");
		ws.getRange2("B1111").setValue("11");
		ws.getRange2("B1112").setValue("12");
		ws.getRange2("B1113").setValue("13");

		ws.getRange2("C1101:D1123").cleanAll();
		ws.getRange2("C1101").setValue("0");
		ws.getRange2("C1102").setValue("0");
		ws.getRange2("C1103").setValue("2.1");
		ws.getRange2("C1104").setValue("2.4");
		ws.getRange2("C1105").setValue("2.4");
		ws.getRange2("C1106").setValue("9");
		ws.getRange2("C1107").setValue("10");
		ws.getRange2("C1108").setValue("11");
		ws.getRange2("C1109").setValue("11");
		ws.getRange2("C1110").setValue("11");
		ws.getRange2("C1111").setValue("12");
		ws.getRange2("C1112").setValue("12");
		ws.getRange2("C1113").setValue("12");
		ws.getRange2("C1114").setValue("67");
		ws.getRange2("C1115").setValue("");
		ws.getRange2("C1116").setValue("ALDEBARAN");
		ws.getRange2("C1117").setValue("BLUE");
		ws.getRange2("C1118").setValue("CIANO");
		ws.getRange2("C1119").setValue("RED");
		ws.getRange2("C1120").setValue("#N/A");
		ws.getRange2("C1121").setValue("Vega");
		ws.getRange2("C1122").setValue("FALSE");
		ws.getRange2("C1123").setValue("TRUE");

		ws.getRange2("D1101").setValue("1");
		ws.getRange2("D1102").setValue("2");
		ws.getRange2("D1103").setValue("3");
		ws.getRange2("D1104").setValue("4");
		ws.getRange2("D1105").setValue("5");
		ws.getRange2("D1106").setValue("6");
		ws.getRange2("D1107").setValue("7");
		ws.getRange2("D1108").setValue("8");
		ws.getRange2("D1109").setValue("9");
		ws.getRange2("D1110").setValue("10");
		ws.getRange2("D1111").setValue("11");
		ws.getRange2("D1112").setValue("12");
		ws.getRange2("D1113").setValue("13");
		ws.getRange2("D1114").setValue("14");
		ws.getRange2("D1115").setValue("15");
		ws.getRange2("D1116").setValue("16");
		ws.getRange2("D1117").setValue("17");
		ws.getRange2("D1118").setValue("18");
		ws.getRange2("D1119").setValue("19");
		ws.getRange2("D1120").setValue("20");
		ws.getRange2("D1121").setValue("21");
		ws.getRange2("D1122").setValue("22");
		ws.getRange2("D1123").setValue("23");

		ws.getRange2("K100:Z200").cleanAll();
		ws.getRange2("K100").setValue("SCALE 1");
		ws.getRange2("K101").setValue("$");
		ws.getRange2("K102").setValue("");
		ws.getRange2("K103").setValue("0");
		ws.getRange2("K104").setValue("88");
		ws.getRange2("K105").setValue("371");
		ws.getRange2("K106").setValue("515");
		ws.getRange2("K107").setValue("932");
		ws.getRange2("K108").setValue("1957");
		ws.getRange2("K109").setValue("3111");
		ws.getRange2("K110").setValue("");
		ws.getRange2("K111").setValue("");
		ws.getRange2("K112").setValue("");
		ws.getRange2("K113").setValue("");

		ws.getRange2("L100").setValue("");
		ws.getRange2("L101").setValue("a");
		ws.getRange2("L102").setValue("");
		ws.getRange2("L103").setValue("0.19");
		ws.getRange2("L104").setValue("0.2348");
		ws.getRange2("L105").setValue("0.219");
		ws.getRange2("L106").setValue("0.3477");
		ws.getRange2("L107").setValue("0.345");
		ws.getRange2("L108").setValue("0.39");
		ws.getRange2("L109").setValue("0.47");
		ws.getRange2("L110").setValue("1");
		ws.getRange2("L111").setValue("2");
		ws.getRange2("L112").setValue("3");
		ws.getRange2("L113").setValue("4");

		ws.getRange2("N100").setValue("SCALE 2");
		ws.getRange2("N101").setValue("$");
		ws.getRange2("N102").setValue("");
		ws.getRange2("N103").setValue("0");
		ws.getRange2("N104").setValue("359");
		ws.getRange2("N105").setValue("438");
		ws.getRange2("N106").setValue("548");
		ws.getRange2("N107").setValue("721");
		ws.getRange2("N108").setValue("865");
		ws.getRange2("N109").setValue("1282");
		ws.getRange2("N110").setValue("2307");
		ws.getRange2("N111").setValue("3461");
		ws.getRange2("N112").setValue("");
		ws.getRange2("N113").setValue("");
		ws.getRange2("N114").setValue("");

		ws.getRange2("O100").setValue("");
		ws.getRange2("O101").setValue("a");
		ws.getRange2("O102").setValue("");
		ws.getRange2("O103").setValue("");
		ws.getRange2("O104").setValue("0.19");
		ws.getRange2("O105").setValue("0.29");
		ws.getRange2("O106").setValue("0.21");
		ws.getRange2("O107").setValue("0.219");
		ws.getRange2("O108").setValue("0.3477");
		ws.getRange2("O109").setValue("0.345");
		ws.getRange2("O110").setValue("0.39");
		ws.getRange2("O111").setValue("0.47");
		ws.getRange2("O112").setValue("1");
		ws.getRange2("O113").setValue("2");
		ws.getRange2("O114").setValue("3");

		ws.getRange2("AE101:AF120").cleanAll();
		ws.getRange2("AE101").setValue("String");
		ws.getRange2("AE102").setValue("1");
		ws.getRange2("AE103").setValue("2");
		ws.getRange2("AE104").setValue("3");
		ws.getRange2("AE105").setValue("#VALUE!");
		ws.getRange2("AE106").setValue("#NUM!");
		ws.getRange2("AE107").setValue("#DIV/0!");
		ws.getRange2("AE108").setValue("TRUE");
		ws.getRange2("AE109").setValue("Sandra");
		ws.getRange2("AE113").setValue("5");
		ws.getRange2("AF101").setValue("1");
		ws.getRange2("AF102").setValue("2");
		ws.getRange2("AF103").setValue("3");
		ws.getRange2("AF104").setValue("4");
		ws.getRange2("AF105").setValue("5");
		ws.getRange2("AF106").setValue("6");
		ws.getRange2("AF107").setValue("7");
		ws.getRange2("AF108").setValue("8");
		ws.getRange2("AF109").setValue("9");
		ws.getRange2("AF110").setValue("10");
		ws.getRange2("AF111").setValue("11");
		ws.getRange2("AF112").setValue("12");
		ws.getRange2("AF113").setValue("13");

		ws.getRange2("G101").setValue("Aa");
		ws.getRange2("G102").setValue("Ae");
		ws.getRange2("G103").setValue("Ba");
		ws.getRange2("G104").setValue("Be");
		ws.getRange2("G105").setValue("CA");
		ws.getRange2("G106").setValue("CE");
		ws.getRange2("G107").setValue("DA");
		ws.getRange2("G108").setValue("DE");
		ws.getRange2("G109").setValue("Ha");
		ws.getRange2("G110").setValue("HE");
		ws.getRange2("G111").setValue("Ia");
		ws.getRange2("G112").setValue("Ie");
		ws.getRange2("G113").setValue("Ja");
		ws.getRange2("G114").setValue("Je");
		ws.getRange2("G115").setValue("Ka");
		ws.getRange2("G116").setValue("Ke");

		ws.getRange2("M101:M134").setValue("W");
		ws.getRange2("M127").setValue("1");
		ws.getRange2("M128").setValue("2");
		ws.getRange2("M129").setValue("3");
		ws.getRange2("M130").setValue("4");
		ws.getRange2("M131").setValue("5");
		ws.getRange2("M132").setValue("6");
		ws.getRange2("M133").setValue("7");
		ws.getRange2("M134").setValue("8");
		ws.getRange2("N129").setValue("Looked result(3)");

		ws.getRange2("AA1101").setValue("1");
		ws.getRange2("AA1102").setValue("1");
		ws.getRange2("AA1103").setValue("1");
		ws.getRange2("AA1104").setValue("1");
		ws.getRange2("AA1105").setValue("#N/A");
		ws.getRange2("AA1106").setValue("1");
		ws.getRange2("AA1107").setValue("1");
		ws.getRange2("AA1108").setValue("1");
		ws.getRange2("AA1109").setValue("1");
		ws.getRange2("AA1110").setValue("1");

		ws.getRange2("AB1101").setValue("1");
		ws.getRange2("AB1102").setValue("2");
		ws.getRange2("AB1103").setValue("3");
		ws.getRange2("AB1104").setValue("4");
		ws.getRange2("AB1105").setValue("5");
		ws.getRange2("AB1106").setValue("6");
		ws.getRange2("AB1107").setValue("7");
		ws.getRange2("AB1108").setValue("8");
		ws.getRange2("AB1109").setValue("9");
		ws.getRange2("AB1110").setValue("10");

		ws.getRange2("AA1111").setValue("1");
		ws.getRange2("AA1112").setValue("1");
		ws.getRange2("AA1113").setValue("1");
		ws.getRange2("AA1114").setValue("1");
		ws.getRange2("AA1115").setValue("");
		ws.getRange2("AA1116").setValue("a");
		ws.getRange2("AA1117").setValue("2");
		ws.getRange2("AA1118").setValue("1");
		ws.getRange2("AA1119").setValue("1");
		ws.getRange2("AA1120").setValue("1");

		ws.getRange2("AB1111").setValue("1");
		ws.getRange2("AB1112").setValue("2");
		ws.getRange2("AB1113").setValue("3");
		ws.getRange2("AB1114").setValue("4");
		ws.getRange2("AB1115").setValue("5");
		ws.getRange2("AB1116").setValue("6");
		ws.getRange2("AB1117").setValue("7");
		ws.getRange2("AB1118").setValue("8");
		ws.getRange2("AB1119").setValue("9");
		ws.getRange2("AB1120").setValue("10");

		ws.getRange2("AA1121").setValue("2");
		ws.getRange2("AA1122").setValue("a");
		ws.getRange2("AA1123").setValue("#N/A");
		ws.getRange2("AA1124").setValue("7");
		ws.getRange2("AA1125").setValue("");
		ws.getRange2("AA1126").setValue("0");
		ws.getRange2("AA1127").setValue("0");
		ws.getRange2("AA1128").setValue("1");
		ws.getRange2("AA1129").setValue("1");
		ws.getRange2("AA1130").setValue("1");

		ws.getRange2("AB1121").setValue("1");
		ws.getRange2("AB1122").setValue("2");
		ws.getRange2("AB1123").setValue("3");
		ws.getRange2("AB1124").setValue("4");
		ws.getRange2("AB1125").setValue("5");
		ws.getRange2("AB1126").setValue("6");
		ws.getRange2("AB1127").setValue("7");
		ws.getRange2("AB1128").setValue("8");
		ws.getRange2("AB1129").setValue("9");
		ws.getRange2("AB1130").setValue("10");

		ws.getRange2("AA1131").setValue("1");
		ws.getRange2("AA1132").setValue("0");
		ws.getRange2("AA1133").setValue("0");
		ws.getRange2("AA1134").setValue("0");
		ws.getRange2("AA1135").setValue("");
		ws.getRange2("AA1136").setValue(" ");
		ws.getRange2("AA1137").setValue("a");
		ws.getRange2("AA1138").setValue("b");
		ws.getRange2("AA1139").setValue("c");
		ws.getRange2("AA1140").setValue("d");

		ws.getRange2("AB1131").setValue("1");
		ws.getRange2("AB1132").setValue("2");
		ws.getRange2("AB1133").setValue("3");
		ws.getRange2("AB1134").setValue("4");
		ws.getRange2("AB1135").setValue("5");
		ws.getRange2("AB1136").setValue("6");
		ws.getRange2("AB1137").setValue("7");
		ws.getRange2("AB1138").setValue("8");
		ws.getRange2("AB1139").setValue("9");
		ws.getRange2("AB1140").setValue("10");

		const defName3D = new Asc.asc_CDefName('VLOOKUPTestName3D', ws.getName() + '!$C$1117');
		const defName3D2 = new Asc.asc_CDefName('VLOOKUPTestName3D2', ws.getName() + '!$B$1102');
		const defNameArea3D = new Asc.asc_CDefName('VLOOKUPTestNameArea3D', ws.getName() + '!$C$1101:$D$1123');

		wb.editDefinesNames(null, defName3D);
		wb.editDefinesNames(null, defNameArea3D);
		wb.editDefinesNames(null, defName3D2);

		AscCommonExcel.g_oVLOOKUPCache.clean();

		// Positive сases:
		// Case #1: Number, Array, Number
		oParser = new parserFormula("VLOOKUP(1,{1,2,3;2,3,4},2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		// Case #2: Number, Array, Number, Number (Number -> Boolean, TRUE)
		oParser = new parserFormula("VLOOKUP(1,{1,2,3;2,3,4},3,1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 3);

		// Case #3: Array, Array, Number
		oParser = new parserFormula("VLOOKUP({2,3,4},{1,2,3;2,3,4},2)", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP({2,3,4},{1,2,3;2,3,4},2)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 3, "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4},2)[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 3, "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4},2)[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 3, "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4},2)[0,2]");

		// Case #4: Array, Array, Number, FALSE
		oParser = new parserFormula("VLOOKUP({2,3,4},{1,2,3;2,3,4},2,FALSE)", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP({2,3,4},{1,2,3;2,3,4},2,FALSE)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 3, "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4},2,FALSE)[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), "#N/A", "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4},2,FALSE)[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), "#N/A", "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4},2,FALSE)[0,2]");

		// Case #5: Array, Array, Array
		oParser = new parserFormula("VLOOKUP({2,3,4},{1,2,3;2,3,4},{1,5,6})", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP({2,3,4},{1,2,3;2,3,4},{1,5,6})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 2, "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4},{1,5,6})[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 2, "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4},{1,5,6})[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 2, "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4},{1,5,6})[0,2]");

		// Case #6: Array, Array, Array
		oParser = new parserFormula("VLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 2, "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 2, "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 2, "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})[0,2]");

		// Case #7: Array, Array, Array
		oParser = new parserFormula("VLOOKUP({5,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP({5,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 2, "Result of VLOOKUP({5,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 2, "Result of VLOOKUP({5,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 2, "Result of VLOOKUP({5,3,4},{1,2,3;2,3,4;6,7,8},{1,5,6})[0,2]");

		// Case #8: Array, Array, Number
		oParser = new parserFormula("VLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},1)", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},1)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 2, "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},1)[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 2, "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},1)[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 2, "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4;6,7,8},1)[0,2]");

		// Case #9: Number, Array, Number
		oParser = new parserFormula("VLOOKUP(4,{1,2,3;2,3,4;6,7,8},2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 3);

		// Case #10: Number, Array, Number
		oParser = new parserFormula("VLOOKUP(4,{1,2,3;2,3,4;6,7,8},3)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 4);

		// Case #11: Empty, Array, Number. Array contains zero (Empty -> Zero)
		oParser = new parserFormula('VLOOKUP(,{0;1;2},1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 0);

		// Case #12: Empty, Array, Number. Array contains <= zero (Empty -> Zero)
		oParser = new parserFormula('VLOOKUP(,{-1;2;3},1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), -1);

		// Case #13: Number, Array, Number. Array contains several suitable values
		oParser = new parserFormula('VLOOKUP(1,{0,1;1,2;"c",3;1,4;1,5;"b",6;2,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 5);

		// Case #14: String, Array, Number. Array contains several suitable values, Sorted only second half
		oParser = new parserFormula('VLOOKUP("a",{"c",1;"a",2;"5",3;"a",4;"a",5;"c",6;"a",7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 5);

		// Case #15: Empty, Array, Number. Array contains only empty strings
		oParser = new parserFormula('VLOOKUP(,{"",1;"",2;"",3;"",4;"",5;"",6;"",7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #16: Empty, Array, Number. Array contains only empty strings and zero in second half
		oParser = new parserFormula('VLOOKUP(,{"",1;"",2;"",3;"",4;"",5;0,6;"",7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 6);

		// Case #17: Empty, Array, Number. Array contains only empty strings and zero in fist half
		oParser = new parserFormula('VLOOKUP(,{"",1;0,2;"",3;"",4;"",5;"",6;"",7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		// Case #18: Error, Array, Number
		oParser = new parserFormula('VLOOKUP(#N/A,{"",1;0,2;#N/A,3;#N/A,4;"",5;"",6;"",7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #19: Number, Array, Number. Array not contains exact match, but contains value < seachValue
		oParser = new parserFormula('VLOOKUP(25,{26,1;66,2;13,3;24,4;70,5;"",6;"",7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 4);

		// Case #20: Number, Array, Number, Number (Number -> Boolean, FALSE)
		oParser = new parserFormula("VLOOKUP(1,{1,2,3;2,3,4},3,0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 3);

		// Case #21: Number, Array, Number, Boolean. Array not sorted
		oParser = new parserFormula("VLOOKUP(1,{5,1;8,2;3,3;-20,4;1,5},2,FALSE)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 5);

		// Case #22: String, Array, Number, Boolean. Array not sorted
		oParser = new parserFormula('VLOOKUP("a",{"b",1;"a",2;"-c",3;"k",4;1,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		// Case #23: Empty, Array, Number, Boolean. Array not sorted
		oParser = new parserFormula('VLOOKUP(,{0,1;0,2;1,3;"k",4;1,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 1);

		// Case #24: Number, Array, Number, Boolean. Array not sorted and contains similar values
		oParser = new parserFormula("VLOOKUP(1,{-1,1;2,2;5,3;1,4;1,5},2,FALSE)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 4);

		// Case #25: String, Array, Number, Boolean. Array not sorted and contains similar values
		oParser = new parserFormula('VLOOKUP("a",{"b",1;"a",2;"a",3;"a",4;"c",5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		// Case #26: Boolean, Array, Number, Boolean. Array not sorted and contains similar values
		oParser = new parserFormula('VLOOKUP(FALSE,{TRUE,1;FALSE,2;FALSE,3;"a",4;FALSE,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		// Case #27: Empty, Array, Number, Boolean. Array not sorted and contains errors, similar zero values
		oParser = new parserFormula('VLOOKUP(,{#N/A,1;2,2;0,3;0,4;#N/A,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 3);

		// Case #28: Empty, Array, Number, Boolean. Array not sorted and contains errors, similar zero values, Booleans
		oParser = new parserFormula('VLOOKUP(,{FALSE,1;TRUE,2;0,3;" ",4;#N/A,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 3);

		// Case #29: String, Array, Number, Boolean. Trying to find empty string
		oParser = new parserFormula('VLOOKUP("",{"",1;" ",2;0,3;" ",4;#N/A,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 1);

		// Case #30: String, Array, Number, Boolean. Trying to find string with space
		oParser = new parserFormula('VLOOKUP(" ",{"",1;" ",2;0,3;" ",4;#N/A,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2);

		// Case #31: Number, Area, Number
		oParser = new parserFormula("VLOOKUP(1,A502:C510,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 2.17);

		// Case #32: Number, Area, Number, TRUE
		oParser = new parserFormula("VLOOKUP(1,A502:C510,3,TRUE)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 100.00);

		// Case #33: Number, Area, Number, TRUE
		oParser = new parserFormula("VLOOKUP(2,A502:C510,2,TRUE)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 1.71);

		// Case #34: Number, Area, Array
		oParser = new parserFormula("VLOOKUP(5,BA100:BB102,{1,1,1})", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP(5,BA100:BB102,{1,1,1})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 4, "Result of VLOOKUP(5,BA100:BB102,{1,1,1})[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), 4, "Result of VLOOKUP(5,BA100:BB102,{1,1,1})[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), 4, "Result of VLOOKUP(5,BA100:BB102,{1,1,1})[0,2]");

		// Case #35: Array, Area, Ref
		oParser = new parserFormula("VLOOKUP({2;4;40},BA100:BB102,BE100)", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP({2;4;40},BA100:BB102,BE100)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 2, "Result of VLOOKUP({2;4;40},BA100:BB102,BE100)[0,0]");
		assert.strictEqual(array.getElementRowCol(1,0).getValue(), 4, "Result of VLOOKUP({2;4;40},BA100:BB102,BE100)[1,0]");
		assert.strictEqual(array.getElementRowCol(2,0).getValue(), 40, "Result of VLOOKUP({2;4;40},BA100:BB102,BE100)[2,0]");

		// Case #36: Array, Area, Ref
		oParser = new parserFormula("VLOOKUP({2;4;40},BA100:BB102,BF100)", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP({2;4;40},BA100:BB102,BF100)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 1, "Result of VLOOKUP({2;4;40},A100:B102,BF100)[0,0]");
		assert.strictEqual(array.getElementRowCol(1,0).getValue(), 2, "Result of VLOOKUP({2;4;40},A100:B102,BF100)[1,0]");
		assert.strictEqual(array.getElementRowCol(2,0).getValue(), 3, "Result of VLOOKUP({2;4;40},A100:B102,BF100)[2,0]");

		// Case #37: Array, Area, Array
		oParser = new parserFormula("VLOOKUP({2;4;40},BA100:BB102,{1,2,3;1,1,1})", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP({2;4;40},BA100:BB102,{1,2,3;1,1,1})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), 2, "Result of VLOOKUP({2;4;40},BA100:BB102,{1,2,3;1,1,1})[0,0]");
		assert.strictEqual(array.getElementRowCol(1,0).getValue(), 4, "Result of VLOOKUP({2;4;40},BA100:BB102,{1,2,3;1,1,1})[1,0]");
		assert.strictEqual(array.getElementRowCol(2,0).getValue(), 40, "Result of VLOOKUP({2;4;40},BA100:BB102,{1,2,3;1,1,1})[2,0]");

		// Case #38: Number, Area, Number
		oParser = new parserFormula("VLOOKUP(2,A502:C510,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), 1.71);

		// Case #39: Empty, Area, Number. Area contains zeros
		oParser = new parserFormula('VLOOKUP(,D1101:C1123,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(,D1101:C1123,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Result of VLOOKUP(,D1101:C1123,2,TRUE)');

		// Case #40: Number, Area, Number
		oParser = new parserFormula('VLOOKUP(2.4,D1101:C1123,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(2.4,D1101:C1123,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of VLOOKUP(2.4,D1101:C1123,2,TRUE)');

		// Case #41: String, Area, Number. Area not contains exact match, but contains < seachValue
		oParser = new parserFormula('VLOOKUP("VIOLET",D1101:C1123,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP("VIOLET",D1101:C1123,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), 21, 'Result of VLOOKUP("VIOLET",D1101:C1123,2,TRUE)');

		// Case #42: Number, Area, Number. Area not contains exact match, but contains value < seachValue
		oParser = new parserFormula('VLOOKUP(2.3,D1101:C1123,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(2.3,D1101:C1123,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Result of VLOOKUP(2.3,D1101:C1123,2,TRUE)');

		// Case #43: String, Area, Number. Area contains exact match
		oParser = new parserFormula('VLOOKUP("cIaNo",D1101:C1123,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP("cIaNo",D1101:C1123,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), 18, 'Result of VLOOKUP("cIaNo",D1101:C1123,2,TRUE)');

		// Case #44: Boolean, Area, Number. Area contains exact match
		oParser = new parserFormula('VLOOKUP(FALSE,D1101:C1123,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(FALSE,D1101:C1123,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), 22, 'Result of VLOOKUP(FALSE,D1101:C1123,2,TRUE)');

		// Case #45: Number, Area, Number. For bug 63026. cEmpty tests.
		oParser = new parserFormula('VLOOKUP(576,K100:L113,2)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(576,K100:L113,2)');
		assert.strictEqual(oParser.calculate().getValue(), 0.3477, 'Result of VLOOKUP(576,K100:L113,2)');

		// Case #46: Number, Area, Number. For bug 63026. cEmpty tests.
		oParser = new parserFormula('VLOOKUP(576,N100:O114,2)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(576,N100:O114,2)');
		assert.strictEqual(oParser.calculate().getValue(), 0.21, 'Result of VLOOKUP(576,N100:O114,2)');

		// Case #47.1: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G101,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G101,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Aa", 'Result of VLOOKUP(G101,G101:G116,1)');

		// Case #47.2: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G102,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G102,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ae", 'Result of VLOOKUP(A102,G101:G116,1)');

		// Case #47.3: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G103,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G103,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ba", 'Result of VLOOKUP(A103,G101:G116,1)');

		// Case #47.4: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G104,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G104,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Be", 'Result of VLOOKUP(A104,G101:G116,1)');

		// Case #47.5: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G105,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G105,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "CA", 'Result of VLOOKUP(A105,G101:G116,1)');

		// Case #47.6: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G106,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G106,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "CE", 'Result of VLOOKUP(A106,G101:G116,1)');

		// Case #47.7: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G107,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G107,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "DA", 'Result of VLOOKUP(A107,G101:G116,1)');

		// Case #47.8: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G108,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G108,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "DE", 'Result of VLOOKUP(A108,G101:G116,1)');

		// Case #47.9: String, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP("Ha",G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP("Ha",G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ha", 'Result of VLOOKUP(A109,G101:G116,1)');

		// Case #47.10: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G109,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G109,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ha", 'Result of VLOOKUP(A109,G101:G116,1)');

		// Case #47.11: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G110,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G110,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "HE", 'Result of VLOOKUP(A110,G101:G116,1)');

		// Case #47.12: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G111,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G111,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ia", 'Result of VLOOKUP(A111,G101:G116,1)');

		// Case #47.13: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G112,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G112,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ie", 'Result of VLOOKUP(A112,G101:G116,1)');

		// Case #47.14: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G113,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G113,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ja", 'Result of VLOOKUP(A113,G101:G116,1)');

		// Case #47.15: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G114,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G114,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Je", 'Result of VLOOKUP(A114,G101:G116,1)');

		// Case #47.16: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G115,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G115,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ka", 'Result of VLOOKUP(A115,G101:G116,1)');

		// Case #47.17: Ref, Area, Number. For bug 54560.
		oParser = new parserFormula('VLOOKUP(G116,G101:G116,1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(G116,G101:G116,1)');
		assert.strictEqual(oParser.calculate().getValue(), "Ke", 'Result of VLOOKUP(A116,G101:G116,1)');

		// Case #48: Number, Area, Number. For bug 67099.
		oParser = new parserFormula('VLOOKUP(3,M101:N134,2)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(3,M101:N134,2)');
		assert.strictEqual(oParser.calculate().getValue(), "Looked result(3)", 'Result of VLOOKUP(3,M101:N134,2)');

		// Case #49: Area, Area, Number. For bug 67099.
		oParser = new parserFormula('VLOOKUP(M129,M101:N134,2)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(M129,M101:N134,2)');
		assert.strictEqual(oParser.calculate().getValue(), "Looked result(3)", 'Result of VLOOKUP(M129,M101:N134,2)');

		// Case #50: Number, Area, Number. Area contains same values in second half.
		oParser = new parserFormula('VLOOKUP(1,AA1101:AB1110,2)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(1,AA1101:AB1110,2)');
		assert.strictEqual(oParser.calculate().getValue(), 10, 'Result of VLOOKUP(1,AA1101:AB1110,2)');

		// Case #51: Number, Area, Number. Area contains same values in first half.
		oParser = new parserFormula('VLOOKUP(1,AA1111:AB1120,2)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(1,AA1111:AB1120,2)');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Result of VLOOKUP(1,AA1111:AB1120,2)');

		// Case #52: Number, Area, Number. Area contains same values in second half and has error
		oParser = new parserFormula('VLOOKUP(1,AA1121:AB1130,2)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(1,AA1121:AB1130,2)');
		assert.strictEqual(oParser.calculate().getValue(), 10, 'Result of VLOOKUP(1,AA1121:AB1130,2)');

		// Case #53: Number, Area, Number. Area contains <= value in first half and exact match as first element
		oParser = new parserFormula('VLOOKUP(1,AA1131:AB1140,2)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(1,AA1131:AB1140,2)');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Result of VLOOKUP(1,AA1131:AB1140,2)');

		// Case #54: Number, Area, Number
		oParser = new parserFormula('VLOOKUP(2.24,A1101:B1113,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(2.24,A1101:B1113,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Result of VLOOKUP("2.24",A1101:B1113,2,FALSE)');

		// Case #55: Number, Area, Number
		oParser = new parserFormula('VLOOKUP("AnyStringValue2",A1101:B1113,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP("AnyStringValue2",A1101:B1113,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of VLOOKUP("AnyStringValue2",A1101:B1113,2,FALSE)');

		// Case #56: Number, Area, Number
		oParser = new parserFormula('VLOOKUP("Sandra",A1101:B1113,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP("Sandra",A1101:B1113,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 9, 'Result of VLOOKUP("Sandra",A1101:B1113,2,FALSE)');

		// Case #57: Number, Area, Number
		oParser = new parserFormula('VLOOKUP(,A1101:B1113,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(,A1101:B1113,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 12, 'Result of VLOOKUP(,A1101:B1113,2,FALSE)');

		// Case #58: String, Area, Number. For bug 65016
		oParser = new parserFormula('VLOOKUP("SANDRA",AE101:AF113,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP("SANDRA",AE101:AF113,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 9, 'Result of VLOOKUP("SANDRA",AE101:AF113,2,FALSE)');

		// Case #59: Boolean, Area, Number. For bug 65016
		oParser = new parserFormula('VLOOKUP(TRUE,AE101:AF113,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(TRUE,AE101:AF113,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Result of VLOOKUP(TRUE,AE101:AF113,2,FALSE)');

		// Case #60: Number, Area, Number. For bug 65016
		oParser = new parserFormula('VLOOKUP(5,AE101:AF113,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(5,AE101:AF113,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 13, 'Result of VLOOKUP(5,AE101:AF113,2,FALSE)');

		// Case #61: Name3D, Name3D, Name3D, Boolean
		oParser = new parserFormula('VLOOKUP(VLOOKUPTestName3D,VLOOKUPTestNameArea3D,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(VLOOKUPTestName3D,VLOOKUPTestNameArea3D,VLOOKUPTestName3D2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), 17, 'Result of VLOOKUP(VLOOKUPTestName3D,VLOOKUPTestNameArea3D,2,FALSE)');

		// Case #62: Ref3D, Area3D, Area3D, Area3D
		oParser = new parserFormula('VLOOKUP(' + ws.getName() + '!$C$1117,' + ws.getName() + '!$C$1101:$D$1123,'+ ws.getName() + '!$B$1102,'+ ws.getName() + '!$C$1122)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(' + ws.getName() + '!$C$1117,' + ws.getName() + '!$C$1101:$D$1123,'+ ws.getName() + '!$B$1102,'+ ws.getName() + '!$C$1122)');
		assert.strictEqual(oParser.calculate().getValue(), 17, 'Result of VLOOKUP(' + ws.getName() + '!$C$1117,' + ws.getName() + '!$C$1101:$D$1123,'+ ws.getName() + '!$B$1102,'+ ws.getName() + '!$C$1122)');

		// Case #63: Formula, Name3D, Formula, Formula
		oParser = new parserFormula('VLOOKUP(ABS(2),VLOOKUPTestNameArea3D,ABS(2),1=1)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(ABS(2),VLOOKUPTestNameArea3D,ABS(2),1=1)');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Result of VLOOKUP(ABS(2),VLOOKUPTestNameArea3D,ABS(2),1=1)');

		// Negative Cases:
		// Case #1: Array, Array, Array with wrong data
		oParser = new parserFormula("VLOOKUP({2,3,4},{1,2,3;2,3,4},{4,5,6})", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP({2,3,4},{1,2,3;2,3,4},{4,5,6})");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0,0).getValue(), "#REF!", "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4},{4,5,6})[0,0]");
		assert.strictEqual(array.getElementRowCol(0,1).getValue(), "#REF!", "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4},{4,5,6})[0,1]");
		assert.strictEqual(array.getElementRowCol(0,2).getValue(), "#REF!", "Result of VLOOKUP({2,3,4},{1,2,3;2,3,4},{4,5,6})[0,2]");

		// Case #2: Number, Array, Number. Out of range arg3
		oParser = new parserFormula("VLOOKUP(4,{1,2,3;2,3,4;6,7,8},5)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#REF!");

		// Case #3: String, Array, Number. Array not contains search type
		oParser = new parserFormula('VLOOKUP("a",{1,2,3;2,3,4;6,7,8},3)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #4: Boolean, Array, Number. Array not contains search type
		oParser = new parserFormula('VLOOKUP(FALSE,{1,2,3;2,3,4;6,7,8},3)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #5: Error, Array, Number. Search value is Error
		oParser = new parserFormula('VLOOKUP(#N/A,{1,2,3;2,3,4;6,7,8},3)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #6: Empty, Array, Number. Array not contains value <= 0 (Empty -> Zero)
		oParser = new parserFormula('VLOOKUP(,{1;2;3},1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #7: Error, Array, Number. Array contains error. Returning Error
		oParser = new parserFormula('VLOOKUP(#VALUE!,{0;#N/A;2},1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		// Case #8: Empty, Array, Number. Array contains Errors, not zero
		oParser = new parserFormula('VLOOKUP(,{#N/A,1;#N/A,2;#N/A,3;#N/A,4;#N/A,5;#N/A,6;#N/A,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #9: Boolean, Array, Number. Array contains Errors
		oParser = new parserFormula('VLOOKUP(FALSE,{#N/A,1;#N/A,2;#N/A,3;#N/A,4;#N/A,5;#N/A,6;#N/A,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #10: Boolean, Array, Number. Array contains Empty strings
		oParser = new parserFormula('VLOOKUP(FALSE,{"",1;"",2;"",3;"",4;"",5;"",6;"",7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #11: Boolean, Array, Number. Array contains zeros and empty, errors
		oParser = new parserFormula('VLOOKUP(FALSE,{"",1;0,2;"",3;0,4;0,5;0,6;#N/A,7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #12: Boolean, Array, Number. Array contains any other data
		oParser = new parserFormula('VLOOKUP(TRUE,{"asdac",1;2,2;"a",3;5,4;6,5;7,6;"8",7},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #13: Number, Array, Number. Array contains only string
		oParser = new parserFormula('VLOOKUP("item",{123, 1},2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #14: String, Array, Number, Number, Boolean. Array not contains string
		oParser = new parserFormula('VLOOKUP("a",{5,1;8,2;3,3;-20,4;1,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #15: Error, Array, Number, Number, Boolean. Returning error = search value
		oParser = new parserFormula('VLOOKUP(#N/A,{5,1;8,2;3,3;-20,4;1,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #16: Error, Array, Number, Number, Boolean. Returning error = search value
		oParser = new parserFormula('VLOOKUP(#VALUE!,{5,1;8,2;3,3;-20,4;1,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		// Case #17: String, Array, Number, Number, Boolean. Array not contains string
		oParser = new parserFormula('VLOOKUP("5",{5,1;8,2;3,3;-20,4;1,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #18: String, Array, Number, Boolean. Trying to find empty string
		oParser = new parserFormula('VLOOKUP("",{" ",1;" ",2;0,3;" ",4;#N/A,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #19: Empty, Array, Number, Boolean. Array contains Booleans
		oParser = new parserFormula('VLOOKUP(,{FALSE,1;FALSE,2;FALSE,3;FALSE,4;FALSE,5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #20: Empty, Array, Number, Boolean. Array contains Booleans and empty strings
		oParser = new parserFormula('VLOOKUP(,{"",1;FALSE,2;"",3;FALSE,4;"",5},2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #21: Number, Area, Area
		oParser = new parserFormula("VLOOKUP(5,A100:B102,E100:G100)", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP(5,A100:B102,E100:G100)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of VLOOKUP(5,A100:B102,E1:G1)");

		// Case #22: Number, Area, Array
		oParser = new parserFormula("VLOOKUP(5,BA100:BB102,{1,2,3})", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP(5,BA100:BB102,{1,2,3})");
		assert.strictEqual(oParser.calculate().getValue(), "#REF!", "Result of VLOOKUP(5,BA100:BB102,{1,2,3})");

		// Case #23: Number, Area, Area
		oParser = new parserFormula("VLOOKUP(5,BA100:BB102,BE101:BG101)", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP(5,BA100:BB102,BE101:BG101)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of VLOOKUP(5,BA100:BB102,BE101:BG101)[0,0]");

		// Case #24: Area, Area, Ref
		oParser = new parserFormula("VLOOKUP(BA100:BA102,BA100:BB102,BE100)", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP(BA100:BA102,BA100:BB102,BE100)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of VLOOKUP(BA100:BA102,BA100:BB102,BE100)[0,0]");

		// Case #25: Area, Area, Ref
		oParser = new parserFormula("VLOOKUP(BA100:BA102,BA100:BB102,BF100)", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP(BA100:BA102,BA100:BB102,BF100)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of VLOOKUP(A100:A102,A100:B102,F100)[0,0]");

		// Case #26: Area, Area, Area
		oParser = new parserFormula("VLOOKUP(BA100:BA102,BA100:BB102,BE100:BG100)", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP(BA100:BA102,BA100:BB102,BE100:BG100)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of VLOOKUP(BA100:BA102,BA100:BB102,BE100:BG100)");

		// Case #27: Area, Area, Area
		oParser = new parserFormula("VLOOKUP(BA100:BA102,BA100:BB102,BE100:BG101)", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP(BA100:BA102,BA100:BB102,BE100:BG101)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of VLOOKUP(BA100:BA102,BA100:BB102,BE100:BG101)[0,0]");

		// Case #28: Area, Area, Area
		oParser = new parserFormula("VLOOKUP(BA100:BA101,BA100:BB102,BF100:BG101)", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP(BA100:BA101,BA100:BB102,BF100:BG101)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of VLOOKUP(BA100:BA101,BA100:BB102,BF100:BG101)[0,0]");

		// Case #29: Area, Area, Area
		oParser = new parserFormula("VLOOKUP(BA100:BA102,BA100:BB102,BG100:BG101)", "A2", ws);
		assert.ok(oParser.parse(), "Parse VLOOKUP(BA100:BA102,BA100:BB102,BG100:BG101)");
		array = oParser.calculate();
		assert.strictEqual(array.getValue(), "#VALUE!", "Result of VLOOKUP(BA100:BA102,BA100:BB102,BG100:BG101)[0,0]");

		// Case #30: Empty, Area, Number. Area not contains value <= 0
		oParser = new parserFormula('VLOOKUP(,A502:C510,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #31: Ref, Area, Number. Area not contains empty string ""
		oParser = new parserFormula('VLOOKUP(D501,A502:C510,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #32: Error, Area, Number. Return SearchVal Error.
		oParser = new parserFormula('VLOOKUP(#N/A,D1101:C1123,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(#N/A,D1101:C1123,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of VLOOKUP(#N/A,D1101:C1123,2,TRUE)');

		// Case #33: Error, Area, Number. Return SearchVal Error.
		oParser = new parserFormula('VLOOKUP(#VALUE!,D1101:C1123,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(#VALUE!,D1101:C1123,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", 'Result of VLOOKUP(#VALUE!,D1101:C1123,2,TRUE)');

		// Case #34: Number, Area, Number. Area not contains value <= searchValue
		oParser = new parserFormula('VLOOKUP(-1,D1101:C1123,2,TRUE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(-1,D1101:C1123,2,TRUE)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of VLOOKUP(-1,D1101:C1123,2,TRUE)');

		// Case #35: String, Area, Number. Area not contains strings
		oParser = new parserFormula('VLOOKUP("2",A502:C510,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		// Case #36: Number, Area, Number
		oParser = new parserFormula('VLOOKUP(#DIV/0!,A1101:B1113,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(#DIV/0!,A1101:B1113,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), "#DIV/0!", 'Result of VLOOKUP(#DIV/0!,A1101:B1113,2,FALSE)');

		// Case #37: Number, Area, Number
		oParser = new parserFormula('VLOOKUP("",A1101:B1113,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP("",A1101:B1113,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of VLOOKUP("",A1101:B1113,2,FALSE)');

		// Case #38: Ref, Area, Number. For bug 65016. Searchval = Error, should return Error
		oParser = new parserFormula('VLOOKUP(AE107,AE101:AF113,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse(), 'VLOOKUP(AE107,AE101:AF113,2,FALSE)');
		assert.strictEqual(oParser.calculate().getValue(), "#DIV/0!", 'Result of VLOOKUP(AA107,AE101:AF113,2,FALSE)');

		// Case #39: String, Area, Number. Area not contains strings
		oParser = new parserFormula('VLOOKUP("2",A502:C510,2,FALSE)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#N/A");

		wb.delDefinesNames(defName3D);
		wb.delDefinesNames(defNameArea3D);
		wb.delDefinesNames(defName3D2);

	});


	QUnit.test("Test: \"XLOOKUP\"", function (assert) {

		ws.getRange2("A551").setValue("6");
		ws.getRange2("A552").setValue("2");
		ws.getRange2("A553").setValue("test");
		ws.getRange2("A554").setValue("5");
		ws.getRange2("A555").setValue("4");
		ws.getRange2("A556").setValue("12");
		ws.getRange2("A557").setValue("16");
		ws.getRange2("A558").setValue("14");
		ws.getRange2("A559").setValue("99");
		ws.getRange2("A560").setValue("tt");
		ws.getRange2("A561").setValue("t4");

		ws.getRange2("B551").setValue("a");
		ws.getRange2("B552").setValue("b");
		ws.getRange2("B553").setValue("c");
		ws.getRange2("B554").setValue("d");
		ws.getRange2("B555").setValue("e");
		ws.getRange2("B556").setValue("f");
		ws.getRange2("B557").setValue("g");
		ws.getRange2("B558").setValue("l");
		ws.getRange2("B559").setValue("n");
		ws.getRange2("B560").setValue("u");
		ws.getRange2("B561").setValue("p");

		ws.getRange2("C551").setValue("a1");
		ws.getRange2("C552").setValue("b1");
		ws.getRange2("C553").setValue("test2");
		ws.getRange2("C554").setValue("c2");
		ws.getRange2("C555").setValue("d2");
		ws.getRange2("C556").setValue("h3");
		ws.getRange2("C557").setValue("j5");
		ws.getRange2("C558").setValue("u2");
		ws.getRange2("C559").setValue("m1");
		ws.getRange2("C560").setValue("k");
		ws.getRange2("C561").setValue("l");
		ws.getRange2("C565").setValue("99");

		ws.getRange2("A203").setValue("Mark");
		ws.getRange2("A204").setValue("Ned");
		ws.getRange2("A205").setValue("Hans");
		ws.getRange2("A206").setValue("Martha");
		ws.getRange2("A207").setValue("Greg");
		ws.getRange2("A208").setValue("Scott");
		ws.getRange2("A209").setValue("Jenna");
		ws.getRange2("A210").setValue("Donna");

		ws.getRange2("B202").setValue("Math");
		ws.getRange2("B203").setValue("87");
		ws.getRange2("B204").setValue("67");
		ws.getRange2("B205").setValue("16");
		ws.getRange2("B206").setValue("68");
		ws.getRange2("B207").setValue("21");
		ws.getRange2("B208").setValue("72");
		ws.getRange2("B209").setValue("19");
		ws.getRange2("B210").setValue("14");

		ws.getRange2("C202").setValue("Physics");
		ws.getRange2("C203").setValue("91");
		ws.getRange2("C204").setValue("71");
		ws.getRange2("C205").setValue("32");
		ws.getRange2("C206").setValue("82");
		ws.getRange2("C207").setValue("94");
		ws.getRange2("C208").setValue("38");
		ws.getRange2("C209").setValue("40");
		ws.getRange2("C210").setValue("69");

		ws.getRange2("A300").setValue("String");
		ws.getRange2("A301").setValue("1");
		ws.getRange2("A302").setValue("2");
		ws.getRange2("A303").setValue("3");
		ws.getRange2("A304").setValue("#VALUE!");
		ws.getRange2("A305").setValue("#NUM!");
		ws.getRange2("A306").setValue("#DIV/0!");
		ws.getRange2("A307").setValue("TRUE");
		ws.getRange2("A308").setValue("Sandra");
		ws.getRange2("A309").setValue("");
		ws.getRange2("A310").setValue("");
		ws.getRange2("A311").setValue("5");

		ws.getRange2("B300").setValue("1");
		ws.getRange2("B301").setValue("2");
		ws.getRange2("B302").setValue("3");
		ws.getRange2("B303").setValue("4");
		ws.getRange2("B304").setValue("5");
		ws.getRange2("B305").setValue("6");
		ws.getRange2("B306").setValue("7");
		ws.getRange2("B307").setValue("8");
		ws.getRange2("B308").setValue("9");
		ws.getRange2("B309").setValue("10");
		ws.getRange2("B310").setValue("11");
		ws.getRange2("B311").setValue("12");

		ws.getRange2("A1101:B1123").cleanAll();
		ws.getRange2("A1101").setValue("0");
		ws.getRange2("A1102").setValue("0");
		ws.getRange2("A1103").setValue("2.1");
		ws.getRange2("A1104").setValue("2.4");
		ws.getRange2("A1105").setValue("2.4");
		ws.getRange2("A1106").setValue("9");
		ws.getRange2("A1107").setValue("10");
		ws.getRange2("A1108").setValue("11");
		ws.getRange2("A1109").setValue("11");
		ws.getRange2("A1110").setValue("11");
		ws.getRange2("A1111").setValue("12");
		ws.getRange2("A1112").setValue("12");
		ws.getRange2("A1113").setValue("12");
		ws.getRange2("A1114").setValue("67");
		ws.getRange2("A1115").setValue("");
		ws.getRange2("A1116").setValue("ALDEBARAN");
		ws.getRange2("A1117").setValue("BLUE");
		ws.getRange2("A1118").setValue("CIANO");
		ws.getRange2("A1119").setValue("RED");
		ws.getRange2("A1120").setValue("#N/A");
		ws.getRange2("A1121").setValue("Vega");
		ws.getRange2("A1122").setValue("FALSE");
		ws.getRange2("A1123").setValue("TRUE");

		ws.getRange2("B1101").setValue("1");
		ws.getRange2("B1102").setValue("2");
		ws.getRange2("B1103").setValue("3");
		ws.getRange2("B1104").setValue("4");
		ws.getRange2("B1105").setValue("5");
		ws.getRange2("B1106").setValue("6");
		ws.getRange2("B1107").setValue("7");
		ws.getRange2("B1108").setValue("8");
		ws.getRange2("B1109").setValue("9");
		ws.getRange2("B1110").setValue("10");
		ws.getRange2("B1111").setValue("11");
		ws.getRange2("B1112").setValue("12");
		ws.getRange2("B1113").setValue("13");
		ws.getRange2("B1114").setValue("14");
		ws.getRange2("B1115").setValue("15");
		ws.getRange2("B1116").setValue("16");
		ws.getRange2("B1117").setValue("17");
		ws.getRange2("B1118").setValue("18");
		ws.getRange2("B1119").setValue("19");
		ws.getRange2("B1120").setValue("20");
		ws.getRange2("B1121").setValue("21");
		ws.getRange2("B1122").setValue("22");
		ws.getRange2("B1123").setValue("23");

		ws.getRange2("A700:G710").setValue("1");
		ws.getRange2("A701").setValue("2");
		ws.getRange2("B701:G701").setValue("3");

		ws.getRange2("A1201:B1223").cleanAll();
		ws.getRange2("A1201").setValue("a");
		ws.getRange2("A1202").setValue("1");
		ws.getRange2("A1203").setValue("a");
		ws.getRange2("A1204").setValue("a");
		ws.getRange2("A1205").setValue("1");
		ws.getRange2("A1206").setValue("a");
		ws.getRange2("A1207").setValue("a");
		ws.getRange2("A1208").setValue("a");
		ws.getRange2("A1209").setValue("a");
		ws.getRange2("A1210").setValue("a");

		ws.getRange2("B1201").setValue("1");
		ws.getRange2("B1202").setValue("2");
		ws.getRange2("B1203").setValue("3");
		ws.getRange2("B1204").setValue("4");
		ws.getRange2("B1205").setValue("5");
		ws.getRange2("B1206").setValue("6");
		ws.getRange2("B1207").setValue("7");
		ws.getRange2("B1208").setValue("8");
		ws.getRange2("B1209").setValue("9");
		ws.getRange2("B1210").setValue("10");

		ws.getRange2("A1301:B1310").cleanAll();
		ws.getRange2("A1301").setValue("a");
		ws.getRange2("A1302").setValue("a");
		ws.getRange2("A1303").setValue("a");
		ws.getRange2("A1304").setValue("a");
		ws.getRange2("A1305").setValue("#N/A");
		ws.getRange2("A1306").setValue("a");
		ws.getRange2("A1307").setValue("a");
		ws.getRange2("A1308").setValue("a");
		ws.getRange2("A1309").setValue("a");
		ws.getRange2("A1310").setValue("a");

		ws.getRange2("B1301").setValue("1");
		ws.getRange2("B1302").setValue("2");
		ws.getRange2("B1303").setValue("3");
		ws.getRange2("B1304").setValue("4");
		ws.getRange2("B1305").setValue("5");
		ws.getRange2("B1306").setValue("6");
		ws.getRange2("B1307").setValue("7");
		ws.getRange2("B1308").setValue("8");
		ws.getRange2("B1309").setValue("9");
		ws.getRange2("B1310").setValue("10");

		ws.getRange2("A1401:B1410").cleanAll();
		ws.getRange2("A1401").setValue("a");
		ws.getRange2("A1402").setValue("b");
		ws.getRange2("A1403").setValue("a");
		ws.getRange2("A1404").setValue("a");
		ws.getRange2("A1405").setValue("#N/A");
		ws.getRange2("A1406").setValue("a");
		ws.getRange2("A1407").setValue("a");
		ws.getRange2("A1408").setValue("a");
		ws.getRange2("A1409").setValue("a");
		ws.getRange2("A1410").setValue("a");

		ws.getRange2("B1401").setValue("1");
		ws.getRange2("B1402").setValue("2");
		ws.getRange2("B1403").setValue("3");
		ws.getRange2("B1404").setValue("4");
		ws.getRange2("B1405").setValue("5");
		ws.getRange2("B1406").setValue("6");
		ws.getRange2("B1407").setValue("7");
		ws.getRange2("B1408").setValue("8");
		ws.getRange2("B1409").setValue("9");
		ws.getRange2("B1410").setValue("10");

		ws.getRange2("A1501:B1510").cleanAll();
		ws.getRange2("A1501").setValue("1");
		ws.getRange2("A1502").setValue("1");
		ws.getRange2("A1503").setValue("1");
		ws.getRange2("A1504").setValue("1");
		ws.getRange2("A1505").setValue("#N/A");
		ws.getRange2("A1506").setValue("1");
		ws.getRange2("A1507").setValue("1");
		ws.getRange2("A1508").setValue("1");
		ws.getRange2("A1509").setValue("1");
		ws.getRange2("A1510").setValue("1");

		ws.getRange2("B1501").setValue("1");
		ws.getRange2("B1502").setValue("2");
		ws.getRange2("B1503").setValue("3");
		ws.getRange2("B1504").setValue("4");
		ws.getRange2("B1505").setValue("5");
		ws.getRange2("B1506").setValue("6");
		ws.getRange2("B1507").setValue("7");
		ws.getRange2("B1508").setValue("8");
		ws.getRange2("B1509").setValue("9");
		ws.getRange2("B1510").setValue("10");

		const defName3D = new Asc.asc_CDefName('XLOOKUPTestName3D', ws.getName() + '!$A$1118');
		const defNameArea3D = new Asc.asc_CDefName('XLOOKUPTestNameArea3D', ws.getName() + '!$A$1101:$A$1123');
		const defNameArea3DResult = new Asc.asc_CDefName('XLOOKUPTestNameArea3DResult', ws.getName() + '!$B$1101:$B$1123');
		const defName3D2 = new Asc.asc_CDefName('XLOOKUPTestName3D2', ws.getName() + '!$B$1101')

		wb.editDefinesNames(null, defName3D);
		wb.editDefinesNames(null, defNameArea3D);
		wb.editDefinesNames(null, defNameArea3DResult);
		wb.editDefinesNames(null, defName3D2);

		AscCommonExcel.g_oVLOOKUPCache.clean();

		// Positive Cases:
		// Case #1: Number, Array, Array. Exact match number
		oParser = new parserFormula('XLOOKUP(2,{1,2,3,4},{10,20,30,40})', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 20);

		// Case #2: Number, Array, Array, , Number. Exact match number
		oParser = new parserFormula('XLOOKUP(2,{1,2,3,4},{10,20,30,40},,0)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 20);

		// Case #3: Number, Array, Array, , Number. Search for nearest smaller value (match_mode = -1)
		oParser = new parserFormula('XLOOKUP(2.5,{1,2,3,4},{10,20,30,40},,-1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 20);

		// Case #4: Number, Array, Array, , Number. Search for nearest larger value (match_mode = 1)
		oParser = new parserFormula('XLOOKUP(2.5,{1,2,3,4},{10,20,30,40},,1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 30);

		// Case #5: Number, Array, Array, , , Number. Search from last element (search_mode = -1)
		oParser = new parserFormula('XLOOKUP(2,{1,2,3,2},{10,20,30,40},,,-1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 40);

		// Case #6: Number, Array, Array, , , Number. Search from frist element (search_mode = 1)
		oParser = new parserFormula('XLOOKUP(2,{1,2,3,2},{10,20,30,40},,,1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 20);

		// Case #7: Number, Array, Array, , , Number. Wildcard search (match_mode = 2)
		oParser = new parserFormula('XLOOKUP(2,{1,2,3,2},{10,20,30,40},,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 20);

		// Case #8: String, Array, Array. Exact match string
		oParser = new parserFormula('XLOOKUP("b",{"a","b","c","d"},{"apple","banana","cherry","date"})', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "banana");

		// Case #9: String, Array, Array. Search for nearest smaller value (match_mode = -1)
		oParser = new parserFormula('XLOOKUP("b",{"a","a","c","d"},{"apple","apple2","cherry","date"},,-1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "apple");

		// Case #10: Number, Array, Array, , Number. Search for nearest larger value (match_mode = 1)
		oParser = new parserFormula('XLOOKUP("b",{"a","a","c","d"},{"apple","apple2","cherry","date"},,-1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "apple");

		// Case #11: Boolean, Array, Array. Exact match boolean
		oParser = new parserFormula('XLOOKUP(FALSE,{"a","b",FALSE,"d"},{1,2,3,4})', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 3);

		// Case #12: Number, Array, Array, String. Search with if_not_found parameter
		oParser = new parserFormula('XLOOKUP(5,{1,2,3,4},{10,20,30,40},"Not Found")', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "Not Found");

		// Case #13: String, Array, Array, , Number. Wildcard search (match_mode = 2)
		oParser = new parserFormula('XLOOKUP("a*",{"apple","banana","apricot"},{"fruit1","fruit2","fruit3"},,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "fruit1");

		// Case #14: String, Array, Array, , Number, Number. Wildcard with search_mode
		oParser = new parserFormula('XLOOKUP("*le",{"apple","table","simple"},{"fruit","furniture","adjective"},,2,1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "fruit");

		// Case #15: String, Array, Array, , Number. Search with partial wildcard
		oParser = new parserFormula('XLOOKUP("te?t",{"test","text","tent"},{"word1","word2","word3"},,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "word1");

		// Case #16: String, Array, Array. Search with empty values
		oParser = new parserFormula('XLOOKUP("",{"","a","b"},{0,1,2})', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 0);

		// Case #17: String, Array, Array. Search in mixed array (numbers and text)
		oParser = new parserFormula('XLOOKUP("test",{1,"test",3,"hello"},{10,20,30,40})', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 20);

		// Case #18: String, Array, Array. Search with duplicate values (first match)
		oParser = new parserFormula('XLOOKUP("x",{"x","y","x","z"},{"first","second","third","fourth"})', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "first");

		// Case #19: String, String, String. if searchValue = second arg, return third
		oParser = new parserFormula('XLOOKUP("123","123",22)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 22);

		// Case #20: Number, Array, Array, , Number, Number. BinarySearch
		oParser = new parserFormula('XLOOKUP(1,{1,2,3,4},{1,2,3,4},,0,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 1);

		// Case #21: Number, Array, Array, , Number, Number. Reversed binarySearch
		oParser = new parserFormula('XLOOKUP(1,{4,3,2,1},{1,2,3,4},,0,-2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 4);

		// Case #22: String, Array, Array, , Number, Number. BinarySearch
		oParser = new parserFormula('XLOOKUP("1",{"1","2","3","4"},{1,2,3,4})', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 1);

		// Case #23: Number, Array, Array, , Number, Number. BinarySearch
		oParser = new parserFormula('XLOOKUP(1,{0,2,3,4},{1,2,3,4},,-1,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 1);

		// Case #24: Number, Array, Array, , Number, Number. Reversed BinarySearch
		oParser = new parserFormula('XLOOKUP(1,{4,3,2,0},{1,2,3,4},,-1,-2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 4);

		// Case #25: Number, Array, Array, , Number, Number. Reversed BinarySearch
		oParser = new parserFormula('XLOOKUP(1,{4,3,2,0},{1,2,3,4},,1,-2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 3);

		// Case #26: String, Array, Array, , Number, Number. BinarySearch. Mixed values, exact match.
		oParser = new parserFormula('XLOOKUP("a",{1,2,3,4,5,6,7,8,"a",10},{1,2,3,4,5,6,7,8,9,10},,0,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 9);

		// Case #27: String, Array, Array, , Number, Number. Reversed BinarySearch. Mixed values, exact match.
		oParser = new parserFormula('XLOOKUP("a",{10,"a",9,8,7,6,5,4,3,2},{1,2,3,4,5,6,7,8,9,10},,0,-2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 2);

		// Case #28: String, Array, Array, , Number, Number. BinarySearch. Mixed values, arg4 = 1.
		oParser = new parserFormula('XLOOKUP("c",{1,"c",3,4,"a",6,"b","c","b",10},{1,2,3,4,5,6,7,8,9,10},,1,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 8);

		// Case #29: String, Array, Array, , Number, Number. BinarySearch. Mixed values, arg4 = -1.
		oParser = new parserFormula('XLOOKUP("c",{1,"c",3,4,"a",6,"b","d","b",10},{1,2,3,4,5,6,7,8,9,10},,-1,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 7);

		// Case #30: String, Array, Array, , Number, Number. Reversed BinarySearch. Mixed values, arg4 = -1.
		oParser = new parserFormula('XLOOKUP("c",{1,"c",3,4,"a",6,"b","d","b",10},{1,2,3,4,5,6,7,8,9,10},,-1,-2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 2);

		// Case #31: String, Array, Array, , Number, Number. Reversed BinarySearch. Mixed values, arg4 = -1.
		oParser = new parserFormula('XLOOKUP("c",{1,"d",3,4,"a",6,"b","d","b",10},{1,2,3,4,5,6,7,8,9,10},,-1,-2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 3);

		// Case #32: String, Array, Array, , Number, Number. Reversed BinarySearch. Mixed values, arg4 = 1.
		oParser = new parserFormula('XLOOKUP("c",{1,"d",3,4,"a",6,"b","d","b",10},{1,2,3,4,5,6,7,8,9,10},,1,-2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 2);

		// Case #33: Number, Area, Area. Basic lookup returning single value
		oParser = new parserFormula("XLOOKUP(14,A551:A561,C551:C561)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "u2");

		// Case #34: Ref, Area, Area. Lookup with cell reference returning array values
		oParser = new parserFormula("XLOOKUP(C565,A551:A561,B551:C561)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate(), 0, 0), "n");
		assert.strictEqual(_getValue(oParser.calculate(), 0, 1), "m1");

		// Case #35: Number, Area, Area, String. Lookup with if_not_found parameter (should return "not found")
		oParser = new parserFormula('XLOOKUP(1,A551:A561,B551:C561,"not found")', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "not found");

		// Case #36: Number, Area, Area, Number, Number, Number. Lookup with match_mode=1 (exact match or next smallest item)
		oParser = new parserFormula('XLOOKUP(10,A551:A561,B551:C561,0,1,1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate(), 0, 0), "f");
		assert.strictEqual(_getValue(oParser.calculate(), 0, 1), "h3");

		// Case #37: Number, Area, Area, Number, Number, Number. Lookup with match_mode=-1 (exact match or next largest item)
		oParser = new parserFormula('XLOOKUP(10,A551:A561,B551:C561,0,-1,1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate(), 0, 0), "a");
		assert.strictEqual(_getValue(oParser.calculate(), 0, 1), "a1");

		// Case #38: Number, Area, Area, Number, Number. Lookup with match_mode=0 (exact match only, should return 0 as if_not_found)
		oParser = new parserFormula('XLOOKUP(10,A551:A561,B551:C561,0,0)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 0);

		// Case #39: String, Area, Area, , Number, Number.
		oParser = new parserFormula('XLOOKUP("test",A551:A561,B551:C561,,-1,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate(), 0, 0), "n");

		// Case #40: String, Area, Area, , Number, Number.
		oParser = new parserFormula('XLOOKUP("tt",A551:A561,B551:C561,,-1,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate(), 0, 0), "u");

		// Case #41: String, Area, Area, , Number. Wildcard lookup "t???" with match_mode=2 (? matches single character)
		oParser = new parserFormula('XLOOKUP("t???",A551:A561,B551:C561,,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate(), 0, 0), "c");

		// Case #42: String, Area, Area, , Number, Number. Wildcard lookup "t???" with match_mode=2, search_mode=1
		oParser = new parserFormula('XLOOKUP("t???",A551:A561,B551:C561,,2,-1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate(), 0, 0), "c");

		// Case #43: String, Area, Area, , Number. Wildcard lookup "t?" with match_mode=2 (single ? wildcard)
		oParser = new parserFormula('XLOOKUP("t?",A551:A561,B551:C561,,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate(), 0, 0), "u");

		// Case #44: String, Area, Area, , Number. Wildcard lookup "t*" with match_mode=2 (* matches any characters)
		oParser = new parserFormula('XLOOKUP("t*",A551:A561,B551:C561,,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate(), 0, 0), "c");
		assert.strictEqual(_getValue(oParser.calculate(), 0, 1), "test2");

		// Case #45: Number, Area, Area
		oParser = new parserFormula('XLOOKUP(19,B203:B210,A203:A210)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(19,B203:B210,A203:A210)');
		assert.strictEqual(_getValue(oParser.calculate()), "Jenna", 'Result of XLOOKUP(19,B203:B210,A203:A210)');

		// Case #46: Number, Formula, Area
		oParser = new parserFormula('XLOOKUP(19,XLOOKUP(B202,B202:C202,B203:C210),A203:A210)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(19,XLOOKUP(B202,B202:C202,B202:C210),A203:A210)');
		assert.strictEqual(_getValue(oParser.calculate()), "Jenna", 'Result of XLOOKUP(19,XLOOKUP(B202,B202:C202,B202:C210),A203:A210)');

		// Case #47: Number, Array, Area
		oParser = new parserFormula('XLOOKUP(19,{87;67;16;68;21;72;19;14},A203:A210)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(19,{87;67;16;68;21;72;19;14},A203:A210)');
		assert.strictEqual(_getValue(oParser.calculate()), "Jenna", 'Result of XLOOKUP(19,{87;67;16;68;21;72;19;14},A203:A210)');

		// Case #48: Number, Area, Area, String, Number. XLOOKUP returning range reference (should return cellsRange type). For bug 70550.
		oParser = new parserFormula('XLOOKUP(2,A100:A110,A100:G110,"",1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(2,A100:A110,A100:G110,"",1)');
		assert.strictEqual(oParser.calculate().type, AscCommonExcel.cElementType.cellsRange, 'Result of XLOOKUP(2,A100:A110,A100:G110,"",1)');

		// Case #49: XLOOKUP inside ISREF function. Testing if XLOOKUP result is a reference (should return TRUE). For bug 70550.
		oParser = new parserFormula('ISREF(XLOOKUP(2,A700:A710,A700:G710,"",1))', "A2", ws);
		assert.ok(oParser.parse(), 'ISREF(XLOOKUP(2,A700:A710,A700:G710,"",1))');
		assert.strictEqual(oParser.calculate().getValue(), "TRUE", 'Result of ISREF(XLOOKUP(2,A700:A710,A700:G710,"",1))');

		// Case #50: XLOOKUP in range operation with SUM. Using XLOOKUP result as range reference in SUM function. For bug 70550.
		oParser = new parserFormula('SUM(XLOOKUP(2,A700:A710,A700:G710,"",1):XLOOKUP(2,A700:A710,A700:G710,"",1))', "A2", ws);
		assert.ok(oParser.parse(), 'SUM(XLOOKUP(2,A700:A710,A700:G710,"",1):XLOOKUP(2,A700:A710,A700:G710,"",1))');
		assert.strictEqual(oParser.calculate().getValue(), 20, 'Result of SUM(XLOOKUP(2,A700:A710,A700:G710,"",1):XLOOKUP(2,A700:A710,A700:G710,"",1))');

		// Case #51: Number, Area, Area, , Number, Number. Number lookup with match_mode=1 and search_mode=2 (next smallest)
		oParser = new parserFormula('XLOOKUP(2.3,A1101:A1123,B1101:B1123,,1,2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(2.3,A1101:A1123,B1101:B1123,,1,2)');
		assert.strictEqual(_getValue(oParser.calculate()), 4, 'Result of XLOOKUP(2.3,A1101:A1123,B1101:B1123,,1,2)');

		// Case #52: Number, Area, Area, , Number, Number. Number lookup with match_mode=-1 and search_mode=2 (next largest)
		oParser = new parserFormula('XLOOKUP(2.3,A1101:A1123,B1101:B1123,,-1,2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(2.3,A1101:A1123,B1101:B1123,,-1,2)');
		assert.strictEqual(_getValue(oParser.calculate()), 3, 'Result of XLOOKUP(2.3,A1101:A1123,B1101:B1123,,-1,2)');

		// Case #53: Number, Area, Area, , Number, Number. Number lookup with match_mode=1 and search_mode=1 (linear search)
		oParser = new parserFormula('XLOOKUP(2.4,A1101:A1123,B1101:B1123,,1,1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(2.4,A1101:A1123,B1101:B1123,,1,1)');
		assert.strictEqual(_getValue(oParser.calculate()), 4, 'Result of XLOOKUP(2.4,A1101:A1123,B1101:B1123,,1,1)');

		// Case #54: Number, Area, Area, , Number, Number. Number lookup with match_mode=-1 and search_mode=1 (linear search)
		oParser = new parserFormula('XLOOKUP(2.4,A1101:A1123,B1101:B1123,,-1,1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(2.4,A1101:A1123,B1101:B1123,,-1,1)');
		assert.strictEqual(_getValue(oParser.calculate()), 4, 'Result of XLOOKUP(2.4,A1101:A1123,B1101:B1123,,-1,1)');

		// Case #55: String, Area, Area, , Number, Number. String lookup with match_mode=1 and search_mode=2. Case sensitivity check
		oParser = new parserFormula('XLOOKUP("cIano",A1101:A1123,B1101:B1123,,1,2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("cIano",A1101:A1123,B1101:B1123,,1,2)');
		assert.strictEqual(_getValue(oParser.calculate()), 18, 'Result of XLOOKUP("cIano",A1101:A1123,B1101:B1123,,1,2)');

		// Case #56: String, Area, Area, , Number, Number. String lookup with match_mode=-1 and search_mode=2
		oParser = new parserFormula('XLOOKUP("cIano",A1101:A1123,B1101:B1123,,-1,2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("cIano",A1101:A1123,B1101:B1123,,-1,2)');
		assert.strictEqual(_getValue(oParser.calculate()), 18, 'Result of XLOOKUP("cIano",A1101:A1123,B1101:B1123,,-1,2)');

		// Case #57: Number, Area, Area, , Number, Number. Negative number lookup with match_mode=1 and search_mode=2
		oParser = new parserFormula('XLOOKUP(-1,A1101:A1123,B1101:B1123,,1,2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(-1,A1101:A1123,B1101:B1123,,1,2)');
		assert.strictEqual(_getValue(oParser.calculate()), 1, 'Result of XLOOKUP(-1,A1101:A1123,B1101:B1123,,1,2)');

		// Case #58: Boolean, Area, Area, , Number, Number. Boolean FALSE lookup with match_mode=1 and search_mode=1
		oParser = new parserFormula('XLOOKUP(FALSE,A1101:A1123,B1101:B1123,,1,1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(FALSE,A1101:A1123,B1101:B1123,,1,1)');
		assert.strictEqual(_getValue(oParser.calculate()), 22, 'Result of XLOOKUP(FALSE,A1101:A1123,B1101:B1123,,1,1)');

		// Case #59: String, Area, Area, , Number, Number. String lookup "VIOLET" with match_mode=1 and search_mode=2
		oParser = new parserFormula('XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,1,2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,1,2)');
		assert.strictEqual(_getValue(oParser.calculate()), 22, 'Result of XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,1,2)');

		// Case #60: String, Area, Area, , Number, Number. String lookup "VIOLET" with match_mode=-1 and search_mode=2
		oParser = new parserFormula('XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,-1,2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,-1,2)');
		assert.strictEqual(_getValue(oParser.calculate()), 21, 'Result of XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,-1,2)');

		// Case #61: String, Area, Area, , Number, Number. String lookup "VIOLET" with match_mode=1 and search_mode=1
		oParser = new parserFormula('XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,1,1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,1,1)');
		assert.strictEqual(_getValue(oParser.calculate()), 22, 'Result of XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,1,1)');

		// Case #62: String, Area, Area, , Number, Number. String lookup "VIOLET" with match_mode=-1 and search_mode=1
		oParser = new parserFormula('XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,-1,1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,-1,1)');
		assert.strictEqual(_getValue(oParser.calculate()), 21, 'Result of XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,-1,1)');

		// Case #63: String, Area, Area, , Number, Number. String lookup "VIOLET" with match_mode=-1 and search_mode=-1
		oParser = new parserFormula('XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,-1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,-1,-1)');
		assert.strictEqual(_getValue(oParser.calculate()), 21, 'Result of XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,-1,-1)');

		// Case #64: String, Area, Area, , Number, Number. String lookup "VIOLET" with match_mode=1 and search_mode=-1
		oParser = new parserFormula('XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,1,-1)');
		assert.strictEqual(_getValue(oParser.calculate()), 22, 'Result of XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,1,-1)');

		// Case #65: Number, Area, Area, , Number, Number. Number match_mode=-1 and search_mode=-1 (reverse search)
		oParser = new parserFormula('XLOOKUP(1,A1201:A1210,B1201:B1210,, -1, -1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(1,A1201:A1210,B1201:B1210,, -1, -1)');
		assert.strictEqual(_getValue(oParser.calculate()), 5, 'Result of XLOOKUP(1,A1201:A1210,B1201:B1210,, -1, -1)');

		// Case #66: Number, Area, Area, , Number, Number. Number match_mode=-1 and search_mode=-1 (reverse search)
		oParser = new parserFormula('XLOOKUP(2,A1201:A1210,B1201:B1210,, -1, -1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(2,A1201:A1210,B1201:B1210,, -1, -1)');
		assert.strictEqual(_getValue(oParser.calculate()), 5, 'Result of XLOOKUP(2,A1201:A1210,B1201:B1210,, -1, -1)');

		// Case #67: Number, Area, Area, , Number, Number. Number match_mode=1 and search_mode=-1 (reverse linear search)
		oParser = new parserFormula('XLOOKUP(2,A1201:A1210,B1201:B1210,, 1, -1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(2,A1201:A1210,B1201:B1210,, 1, -1)');
		assert.strictEqual(_getValue(oParser.calculate()), 10, 'Result of XLOOKUP(2,A1201:A1210,B1201:B1210,, 1, -1)');

		// Case #68: Number, Area, Area, , Number, Number. Number match_mode=1 and search_mode=1 (linear search)
		oParser = new parserFormula('XLOOKUP(2,A1201:A1210,B1201:B1210,, 1, 1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(2,A1201:A1210,B1201:B1210,, 1, 1)');
		assert.strictEqual(_getValue(oParser.calculate()), 1, 'Result of XLOOKUP(2,A1201:A1210,B1201:B1210,, 1, 1)');

		// Case #69: Number, Area, Area, , Number, Number. Number match_mode=0 and search_mode=1 (exact match)
		oParser = new parserFormula('XLOOKUP(1,A1201:A1210,B1201:B1210,, 0, 1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(1,A1201:A1210,B1201:B1210,, 0, 1)');
		assert.strictEqual(_getValue(oParser.calculate()), 2, 'Result of XLOOKUP(1,A1201:A1210,B1201:B1210,, 0, 1)');

		// Case #70: Number, Area, Area, , Number, Number. Number match_mode=1 and search_mode=-2 (binary search descending)
		oParser = new parserFormula('XLOOKUP(1,A1201:A1210,B1201:B1210,, 1, -2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(1,A1201:A1210,B1201:B1210,, 1, -2)');
		assert.strictEqual(_getValue(oParser.calculate()), 5, 'Result of XLOOKUP(1,A1201:A1210,B1201:B1210,, 1, -2)');

		// Case #71: Number, Area, Area, , Number, Number. Number match_mode=1 and search_mode=2 (binary search ascending)
		oParser = new parserFormula('XLOOKUP(1,A1201:A1210,B1201:B1210,, 1, 2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(1,A1201:A1210,B1201:B1210,, 1, 2)');
		assert.strictEqual(_getValue(oParser.calculate()), 2, 'Result of XLOOKUP(1,A1201:A1210,B1201:B1210,, 1, 2)');

		// Case #72: String, Area, Area, , Number, Number. match_mode=1 and search_mode=-2 (binary search descending)
		oParser = new parserFormula('XLOOKUP("a",A1201:A1210,B1201:B1210,, 1, -2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("a",A1201:A1210,B1201:B1210,, 1, -2)');
		assert.strictEqual(_getValue(oParser.calculate()), 1, 'Result of XLOOKUP("a",A1201:A1210,B1201:B1210,, 1, -2)');

		// Case #73: String, Area, Area, , Number, Number. match_mode=1 and search_mode=2 (binary search ascending)
		oParser = new parserFormula('XLOOKUP("a",A1201:A1210,B1201:B1210,, 1, 2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("a",A1201:A1210,B1201:B1210,, 1, 2)');
		assert.strictEqual(_getValue(oParser.calculate()), 6, 'Result of XLOOKUP("a",A1201:A1210,B1201:B1210,, 1, 2)');

		// Case #74: String, Area, Area, , Number, Number. match_mode=1 and search_mode=1 (linear search)
		oParser = new parserFormula('XLOOKUP("a",A1201:A1210,B1201:B1210,, 1, 1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("a",A1201:A1210,B1201:B1210,, 1, 1)');
		assert.strictEqual(_getValue(oParser.calculate()), 1, 'Result of XLOOKUP("a",A1201:A1210,B1201:B1210,, 1, 1)');

		// Case #75: String, Area, Area, , Number, Number. match_mode=1 and search_mode=-1 (reverse linear search)
		oParser = new parserFormula('XLOOKUP("a",A1201:A1210,B1201:B1210,, 1, -1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("a",A1201:A1210,B1201:B1210,, 1, -1)');
		assert.strictEqual(_getValue(oParser.calculate()), 10, 'Result of XLOOKUP("a",A1201:A1210,B1201:B1210,, 1, -1)');

		// Case #76: Number, Area, Area, , Number, Number. match_mode=1 and search_mode=1 (linear search)
		oParser = new parserFormula('XLOOKUP(2,A1301:A1310,B1301:B1310,, 1, 1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(2,A1301:A1310,B1301:B1310,, 1, 1)');
		assert.strictEqual(_getValue(oParser.calculate()), 1, 'Result of XLOOKUP(2,A1301:A1310,B1301:B1310,, 1, 1)');

		// Case #77: String, Area, Area, , Number, Number. match_mode=1 and search_mode=1 (linear search)
		oParser = new parserFormula('XLOOKUP("b",A1301:A1310,B1301:B1310,, 1, 1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("b",A1301:A1310,B1301:B1310,, 1, 1');
		assert.strictEqual(_getValue(oParser.calculate()), 5, 'Result of XLOOKUP("b",A1301:A1310,B1301:B1310,, 1, 1');

		// Case #78: String, Area, Area, , Number, Number. match_mode=1 and search_mode=-1 (reverse linear search)
		oParser = new parserFormula('XLOOKUP("b",A1301:A1310,B1301:B1310,, 1, -1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("b",A1301:A1310,B1301:B1310,, 1, -1');
		assert.strictEqual(_getValue(oParser.calculate()), 5, 'Result of XLOOKUP("b",A1301:A1310,B1301:B1310,, 1, -1');

		// Case #79: String, Area, Area, , Number, Number. match_mode=1 and search_mode=2 (binary search ascending)
		oParser = new parserFormula('XLOOKUP("b",A1301:A1310,B1301:B1310,, 1, 2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("b",A1301:A1310,B1301:B1310,, 1, 2');
		assert.strictEqual(_getValue(oParser.calculate()), 5, 'Result of XLOOKUP("b",A1301:A1310,B1301:B1310,, 1, 2');

		// Case #80: String, Area, Area, , Number, Number. match_mode=1 and search_mode=-2 (binary search descending)
		oParser = new parserFormula('XLOOKUP("b",A1301:A1310,B1301:B1310,, 1, -2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("b",A1301:A1310,B1301:B1310,, 1, -2');
		assert.strictEqual(_getValue(oParser.calculate()), 5, 'Result of XLOOKUP("b",A1301:A1310,B1301:B1310,, 1, -2');

		// Case #81: String, Area, Area, , Number, Number. match_mode=1 and search_mode=-2 (binary search descending)
		oParser = new parserFormula('XLOOKUP("b",A1401:A1410,B1401:B1410,, 1, -2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("b",A1401:A1410,B1401:B1410,, 1, -2');
		assert.strictEqual(_getValue(oParser.calculate()), 5, 'Result of XLOOKUP("b",A1401:A1410,B1401:B1410,, 1, -2');

		// Case #82: String, Area, Area, , Number, Number. match_mode=1 and search_mode=2 (binary search ascending)
		oParser = new parserFormula('XLOOKUP("b",A1401:A1410,B1401:B1410,, 1, 2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("b",A1401:A1410,B1401:B1410,, 1, 2');
		assert.strictEqual(_getValue(oParser.calculate()), 2, 'Result of XLOOKUP("b",A1401:A1410,B1401:B1410,, 1, 2');

		// Case #83: Number, Area, Area, , Number, Number. match_mode=1 and search_mode=2 (binary search ascending)
		oParser = new parserFormula('XLOOKUP(1,A1401:A1410,B1401:B1410,, 1, 2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(1,A1401:A1410,B1401:B1410,, 1, 2');
		assert.strictEqual(_getValue(oParser.calculate()), 1, 'Result of XLOOKUP(1,A1401:A1410,B1401:B1410,, 1, 2');

		// Case #84: Number, Area, Area, , Number, Number. match_mode=1 and search_mode=-2 (binary search descending)
		oParser = new parserFormula('XLOOKUP(1,A1401:A1410,B1401:B1410,, 1, -2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(1,A1401:A1410,B1401:B1410,, 1, -2');
		assert.strictEqual(_getValue(oParser.calculate()), 10, 'Result of XLOOKUP(1,A1401:A1410,B1401:B1410,, 1, -2');

		// Case #85: String, Area, Area, , Number, Number. match_mode=-1 and search_mode=-2 (binary search descending)
		oParser = new parserFormula('XLOOKUP("a",A1501:A1510,B1501:B1510,, -1, -2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("a",A1501:A1510,B1501:B1510,, -1, -2)');
		assert.strictEqual(_getValue(oParser.calculate()), 6, 'XLOOKUP("a",A1501:A1510,B1501:B1510,, -1, -2)');

		// Case #86: String, Area, Area, , Number, Number. match_mode=1 and search_mode=-2 (binary search descending)
		oParser = new parserFormula('XLOOKUP("a",A1501:A1510,B1501:B1510,, 1, -2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("a",A1501:A1510,B1501:B1510,, 1, -2)');
		assert.strictEqual(_getValue(oParser.calculate()), 5, 'XLOOKUP("a",A1501:A1510,B1501:B1510,, 1, -2)');

		// Case #87: String, Area, Area, , Number, Number. match_mode=1 and search_mode=1 (linear search)
		oParser = new parserFormula('XLOOKUP("a",A1501:A1510,B1501:B1510,, 1, 1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("a",A1501:A1510,B1501:B1510,, 1, 1)');
		assert.strictEqual(_getValue(oParser.calculate()), 5, 'XLOOKUP("a",A1501:A1510,B1501:B1510,, 1, 1)');

		// Case #88: String, Area, Area, , Number, Number. match_mode=-1 and search_mode=1 (linear search)
		oParser = new parserFormula('XLOOKUP("a",A1501:A1510,B1501:B1510,, -1, 1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("a",A1501:A1510,B1501:B1510,, -1, 1)');
		assert.strictEqual(_getValue(oParser.calculate()), 1, 'XLOOKUP("a",A1501:A1510,B1501:B1510,, -1, 1)');

		// Case #89: Ref, Ref, Number. if searchValue = second arg, return third
		oParser = new parserFormula('XLOOKUP(A1501,A1501,22)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 22);

		// Case #90: Name3D, Name3D, Name3D
		oParser = new parserFormula('XLOOKUP(XLOOKUPTestName3D,XLOOKUPTestNameArea3D,XLOOKUPTestNameArea3DResult)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 18);

		// Case #91: Name3D, Name3D, Name3D, Name3D. Name3D, Name3D
		oParser = new parserFormula('XLOOKUP(XLOOKUPTestName3D,XLOOKUPTestNameArea3D,XLOOKUPTestNameArea3DResult,XLOOKUPTestName3D2,XLOOKUPTestName3D2,XLOOKUPTestName3D2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 18);

		// Case #92: Name3D, Name3D, Ref3D
		oParser = new parserFormula('XLOOKUP(XLOOKUPTestName3D,XLOOKUPTestNameArea3D,' + ws.getName() + '!$B$1101:$B$1123)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 18);

		// Case #93: Name3D, Ref3D, Ref3D
		oParser = new parserFormula('XLOOKUP(XLOOKUPTestName3D,' + ws.getName() + '!$A$1101:$A$1123,' + ws.getName() + '!$B$1101:$B$1123)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 18);

		// Case #94: Ref3D, Ref3D, Ref3D
		oParser = new parserFormula('XLOOKUP(' + ws.getName() + '!$A$1118,' + ws.getName() + '!$A$1101:$A$1123,' + ws.getName() + '!$B$1101:$B$1123)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 18);

		// Case #95: Ref3D, Ref3D, Ref3D, Ref3D, Ref3D, Ref3D
		oParser = new parserFormula('XLOOKUP(' + ws.getName() + '!$A$1118,' + ws.getName() + '!$A$1101:$A$1123,' + ws.getName() + '!$B$1101:$B$1123,' + ws.getName() + '!$B$1101,' + ws.getName() + '!$B$1101,' + ws.getName() + '!$B$1101)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 18);

		// Case #96: Formula, Ref3D, Ref3D
		oParser = new parserFormula('XLOOKUP(ABS(2.4),' + ws.getName() + '!$A$1101:$A$1123,' + ws.getName() + '!$B$1101:$B$1123)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 4);

		// Case #97: Formula, Ref3D, Ref3D, Formula, Formula, Formula
		oParser = new parserFormula('XLOOKUP(ABS(2.4),' + ws.getName() + '!$A$1101:$A$1123,' + ws.getName() + '!$B$1101:$B$1123,ABS(1),ABS(2),ABS(-1))', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 4);

		// TODO DYNAMIC ARRAYS in TESTS
		// Case #98: Number, Array, Array, Array, Array, Array. 4,5,6 args as arrays
		// oParser = new parserFormula('XLOOKUP(2,{1,2,3},{10,20,30},{1},{1},{1})', "A2", ws);
		// assert.ok(oParser.parse());
		// assert.strictEqual(_getValue(oParser.calculate()), 20);

		// Case #99: Number, Array, Array, String, Number, Number. if_not_found empty string
		oParser = new parserFormula('XLOOKUP(7,{4,5,6},{1,2,3},"",1,1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "");

		// Case #100: String, Array, Array, , Number, Number. Wildcard with ~
		oParser = new parserFormula('XLOOKUP("t~*st",{"test","thst","t*st","teest"},{1,2,3,4},,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 3);

		// Case #101: String, Array, Array, , Number, Number. Wildcard
		oParser = new parserFormula('XLOOKUP("?????",{"test","thst","t*st","teest"},{1,2,3,4},,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 4);

		// Case #102: String, Array, Array, , Number, Number. Wildcard
		oParser = new parserFormula('XLOOKUP("t*est",{"test2","t  ass&^=d asd12312_%$!##****32 sdfsdfsdfsest","test123","teees t"},{1,2,3,4},,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 2);

		// Case #103: String, Array, Array, , Number, Number. Wildcard
		oParser = new parserFormula('XLOOKUP("t*est",{"test2","t  ass&^=d asd12312_%$!##****32 sdfsdfsdfsest","test123","teees t"},{1,2,3,4},,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 2);

		// Case #104: String, Array, Array, , Number, Number. Wildcard
		oParser = new parserFormula('XLOOKUP("t*est",{"t*est","t  ass&^=d asd12312_%$!##****32 sdfsdfsdfsest","test123","teees t"},{1,2,3,4},,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), 1);

		// Negative Cases:
		// Case #1: Number, Array, Array. Mismatched array sizes (should return #VALUE!)
		oParser = new parserFormula('XLOOKUP(2,{1,2,3},{10,20})', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#VALUE!");

		// Case #2: Number, Array, Array, , Number. Invalid match_mode value (should return #VALUE!)
		oParser = new parserFormula('XLOOKUP(2,{1,2,3},{10,20,30},,5)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#VALUE!");

		// Case #3: Number, Array, Array, , , Number. Invalid search_mode value (should return #VALUE!)
		oParser = new parserFormula('XLOOKUP(2,{1,2,3},{10,20,30},,,3)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#VALUE!");

		// Case #4: Error, Array, Array. Search for error, returning error
		oParser = new parserFormula('XLOOKUP(#N/A,{"a",1,2,3},{1,2,3,4})', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A");

		// Case #5: String, Array, Array, , Number, Number. BinarySearch. Mixed values, arg4 = 1. Bad order
		oParser = new parserFormula('XLOOKUP("c",{1,"d",3,4,1,6,2,3,"b",10},{1,2,3,4,5,6,7,8,9,10},,1,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A");

		// Case #6: Number, Area, Area. Basic lookup with no match (should return #N/A)
		oParser = new parserFormula('XLOOKUP(10,A551:A561,B551:C561)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A");

		// Case #7: String, Area, Area, , Number. Wildcard "t*" with match_mode=0 (exact match, should return #N/A)
		oParser = new parserFormula('XLOOKUP("t*",A551:A561,B551:C561,,0)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A");

		// Case #8: String, Area, Area, , Number. Wildcard "t?" with match_mode=0 (exact match, should return #N/A)
		oParser = new parserFormula('XLOOKUP("t?",A551:A561,B551:C561,,0)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A");

		// Case #9: Number, Area, Area, , Number, Number. Lookup with match_mode=-1 and search_mode=-2 (should return #N/A)
		oParser = new parserFormula('XLOOKUP(10,A551:A561,B551:C561,,-1,-2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A");

		// Case #10: Number, Area, Area, , , Number. Lookup with search_mode=-2 (binary search descending, should return #N/A)
		oParser = new parserFormula('XLOOKUP(10,A551:A561,B551:C561,,,-2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A");

		// Case #11: Number, Area, Area, , , Number. Lookup with search_mode=2 (binary search ascending, should return #N/A)
		oParser = new parserFormula('XLOOKUP(10,A551:A561,B551:C561,,,2)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A");

		// Case #12: Ref, Area, Area, Number, Number , Number
		oParser = new parserFormula('XLOOKUP(A304,A300:A311,B300:B311,-2,0,1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(A304,A300:A311,B300:B311,-2,0,1)');
		assert.strictEqual(_getValue(oParser.calculate()), "#VALUE!", 'Result of XLOOKUP(A304,A300:A311,B300:B311,-2,0,1)');

		// Case #13: Ref, Area, Area, Number, Number , Number
		oParser = new parserFormula('XLOOKUP(A305,A300:A311,B300:B311,-2,0,1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(A305,A300:A311,B300:B311,-2,0,1)');
		assert.strictEqual(_getValue(oParser.calculate()), "#NUM!", 'Result of XLOOKUP(A305,A300:A311,B300:B311,-2,0,1)');

		// Case #14: Ref, Area, Area, Number, Number , Number
		oParser = new parserFormula('XLOOKUP(A306,A300:A311,B300:B311,-2,0,1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(A306,A300:A311,B300:B311,-2,0,1)');
		assert.strictEqual(_getValue(oParser.calculate()), "#DIV/0!", 'Result of XLOOKUP(A306,A300:A311,B300:B311,-2,0,1)');

		// Case #15: Number, Area, Area, , Number, Number. Number lookup with match_mode=0 (exact match only, should return #N/A)
		oParser = new parserFormula('XLOOKUP(2.3,A1101:A1123,B1101:B1123,,0, 1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(2.3,A1101:A1123,B1101:B1123,,0, 1)');
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A", 'Result of XLOOKUP(2.3,A1101:A1123,B1101:B1123,,1,0)');

		// Case #16: Error, Area, Area, , Number, Number. Error value #N/A lookup (should return #N/A)
		oParser = new parserFormula('XLOOKUP(#N/A,A1101:A1123,B1101:B1123,,1,1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(#N/A,A1101:A1123,B1101:B1123,,1,1)');
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A", 'Result of XLOOKUP(#N/A,A1101:A1123,B1101:B1123,,1,1)');

		// Case #17: String, Area, Area, , Number, Number. String lookup with match_mode=0 (exact match only, should return #N/A)
		oParser = new parserFormula('XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,0, 1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,0, 1)');
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A", 'Result of XLOOKUP("VIOLET",A1101:A1123,B1101:B1123,,1,0)');

		// Case #18: Number, Area, Area, , Number, Number. Number match_mode=-1 and search_mode=-1 (should return #N/A)
		oParser = new parserFormula('XLOOKUP(0,A1201:A1210,B1201:B1210,, -1, -1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(0,A1201:A1210,B1201:B1210,, -1, -1)');
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A", 'Result of XLOOKUP(0,A1201:A1210,B1201:B1210,, -1, -1)');

		// Case #19: String, Area, Area, , Number, Number. match_mode=0 and search_mode=1 (exact match, should return #N/A)
		oParser = new parserFormula('XLOOKUP("VIOLET",A1201:A1210,B1201:B1210,, 0, 1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("VIOLET",A1201:A1210,B1201:B1210,, 0, 1)');
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A", 'Result of XLOOKUP("VIOLET",A1201:A1210,B1201:B1210,, 0, 1)');

		// Case #20: String, Area, Area, , Number, Number. match_mode=0 (exact match only, should return #N/A)
		oParser = new parserFormula('XLOOKUP("VIOLET",A1201:A1223,B1201:B1223,,0, 1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("VIOLET",A1201:A1223,B1201:B1223,,0, 1)');
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A", 'Result of XLOOKUP("VIOLET",A1201:A1223,B1201:B1223,,1,0)');

		// Case #21: String, Area, Area, , Number, Number. match_mode=0 and search_mode=1 (exact match, should return #N/A)
		oParser = new parserFormula('XLOOKUP("VIOLET",A1301:A1310,B1301:B1310,, 0, 1)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP("VIOLET",A1301:A1310,B1301:B1310,, 0, 1)');
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A", 'Result of XLOOKUP("VIOLET",A1301:A1310,B1301:B1310,, 0, 1)');

		// Case #22: Number, Area, Area, , Number, Number. match_mode=-1 and search_mode=-2 (should return #N/A)
		oParser = new parserFormula('XLOOKUP(1,A1401:A1410,B1401:B1410,, -1, -2)', "A2", ws);
		assert.ok(oParser.parse(), 'XLOOKUP(1,A1401:A1410,B1401:B1410,, -1, -2)');
		assert.strictEqual(_getValue(oParser.calculate()), "#N/A", 'XLOOKUP(1,A1401:A1410,B1401:B1410,, -1, -2)');

		// Case #23: Number, Array, Array, String, String, String. bad 4,5,6 args
		oParser = new parserFormula('XLOOKUP(2,{1,2,3},{10,20,30},"a","b","c")', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#VALUE!");

		// Case #24: Number, Array, Array, Number, Number, Number. bad 4,5,6 args
		oParser = new parserFormula('XLOOKUP(2,{1,2,3},{10,20,30},20,10,30)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#VALUE!");

		// Case #25: Number, Array, Array, Name, Name, Name. bad 4,5,6 args, not existed Name
		oParser = new parserFormula('XLOOKUP(2,{1,2,3},{10,20,30},AWESOMEBADARG,AWESOMEBADARG,AWESOMEBADARG)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#NAME?");

		// Case #26: String, Array, Array, , Number, Number. Sizes mismatch
		oParser = new parserFormula('XLOOKUP("a",A1501:A1555,B1501:B1510,, -1, 1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#VALUE!");

		// Case #26: String, Array, Array, , Number, Number. Sizes mismatch
		oParser = new parserFormula('XLOOKUP("a",A1501:A1510,B1501:B1515,, -1, 1)', "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(_getValue(oParser.calculate()), "#VALUE!");

		wb.delDefinesNames(defName3D);
		wb.delDefinesNames(defNameArea3D);
		wb.delDefinesNames(defNameArea3DResult);
		wb.delDefinesNames(defName3D2);

	});

	QUnit.test("Test: \"VSTACK\"", function (assert) {
		//1. добавляем общие тесты
		putStackData();
		oParser = new parserFormula("VSTACK(A1:B3,B5:D5,B8:B11,B14:E18)", "A1", ws);
		assert.ok(oParser.parse());
		let array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'test2');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), '#N/A');


		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 'w');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 3);


		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 4);


		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 'test11');
		assert.strictEqual(array.getElementRowCol(3, 1).getValue(), 'test12');
		assert.strictEqual(array.getElementRowCol(3, 2).getValue(), 'test13');


		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 'test13');


		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), 'test14');

		assert.strictEqual(array.getElementRowCol(6, 0).getValue(), '#VALUE!');


		assert.strictEqual(array.getElementRowCol(7, 0).getValue(), 'test16');


		assert.strictEqual(array.getElementRowCol(8, 0).getValue(), 'f');
		assert.strictEqual(array.getElementRowCol(8, 1).getValue(), 'g');
		assert.strictEqual(array.getElementRowCol(8, 2).getValue(), 'h');
		assert.strictEqual(array.getElementRowCol(8, 3).getValue(), 'g');


		assert.strictEqual(array.getElementRowCol(9, 0).getValue(), 's');
		assert.strictEqual(array.getElementRowCol(9, 1).getValue(), '');
		assert.strictEqual(array.getElementRowCol(9, 2).getValue(), 'd');
		assert.strictEqual(array.getElementRowCol(9, 3).getValue(), 'f');


		assert.strictEqual(array.getElementRowCol(10, 0).getValue(), 'd');
		assert.strictEqual(array.getElementRowCol(10, 1).getValue(), '');
		assert.strictEqual(array.getElementRowCol(10, 2).getValue(), 'g');
		assert.strictEqual(array.getElementRowCol(10, 3).getValue(), 'f');


		assert.strictEqual(array.getElementRowCol(11, 0).getValue(), 's');
		assert.strictEqual(array.getElementRowCol(11, 1).getValue(), 'dfg');
		assert.strictEqual(array.getElementRowCol(11, 2).getValue(), 's');
		assert.strictEqual(array.getElementRowCol(11, 3).getValue(), 'd');


		assert.strictEqual(array.getElementRowCol(12, 0).getValue(), 'd');
		assert.strictEqual(array.getElementRowCol(12, 1).getValue(), '');
		assert.strictEqual(array.getElementRowCol(12, 2).getValue(), '');
		assert.strictEqual(array.getElementRowCol(12, 3).getValue(), 'g');

		//2. аргументы - разные типы. нужно пербрать все аргументы
		//2.1 аргумент - number
		oParser = new parserFormula("VSTACK(1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.2 аргумент - string
		oParser = new parserFormula("VSTACK(\"test\")", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test");
		//2.3 аргумент - bool
		oParser = new parserFormula("VSTACK(true)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "TRUE");
		//2.4 аргумент - error
		oParser = new parserFormula("VSTACK(#VALUE!)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.5 аргумент - empty
		oParser = new parserFormula("VSTACK(1,,1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.6 аргумент - cellsRange
		//2.7 аргумент - cell
		oParser = new parserFormula("VSTACK(B1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test2");

		//2.8 аргумент - array
		oParser = new parserFormula("VSTACK({1,2})", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1);
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 2);

		ws.getRange2("A1:C214").cleanAll();
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("0.5");
		ws.getRange2("A101").setValue("1.5");
		ws.getRange2("A104").setValue("-1");
		// For area
		ws.getRange2("A102").setValue("0.5");
		ws.getRange2("A103").setValue("");
		ws.getRange2("A105").setValue("1");
		ws.getRange2("A110").setValue("TRUE");
		ws.getRange2("A111").setValue("FALSE");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 1);
		ws.getRange2("A601").setValue("1"); // Number (Column1)
		ws.getRange2("B601").setValue("1s"); // Text (Column2)
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2


		// Positive cases:
		// Case #1: Number. Single number converted to array. 1 argument used.
		oParser = new parserFormula('VSTACK(1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Number. Single number converted to array. 1 argument used.');
		// Case #2: Number, Number. Two numbers stacked vertically. 2 arguments used.
		oParser = new parserFormula('VSTACK(1,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(1,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Number, Number. Two numbers stacked vertically. 2 arguments used.');
		// Case #3: Number, Number, Number. Three numbers stacked vertically. 3 arguments used.
		oParser = new parserFormula('VSTACK(1,2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(1,2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Number, Number, Number. Three numbers stacked vertically. 3 arguments used.');
		// Case #4: String. Single string converted to array. 1 argument used.
		oParser = new parserFormula('VSTACK("text")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK("text") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'text', 'Test: Positive case: String. Single string converted to array. 1 argument used.');
		// Case #5: String, String. Two strings stacked vertically. 2 arguments used.
		oParser = new parserFormula('VSTACK("text1","text2")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK("text1","text2") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'text1', 'Test: Positive case: String, String. Two strings stacked vertically. 2 arguments used.');
		// Case #6: Formula. Formula returning number (2) as array. 1 argument used.
		oParser = new parserFormula('VSTACK(SQRT(4))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(SQRT(4)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 2, 'Test: Positive case: Formula. Formula returning number (2) as array. 1 argument used.');
		// Case #7: Formula, Number. Formula and number stacked vertically. 2 arguments used.
		oParser = new parserFormula('VSTACK(SQRT(4),3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(SQRT(4),3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 2, 'Test: Positive case: Formula, Number. Formula and number stacked vertically. 2 arguments used.');
		// Case #8: Date. Date as serial number (44197) as array. 1 argument used.
		oParser = new parserFormula('VSTACK(DATE(2025,1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(DATE(2025,1,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 45658, 'Test: Positive case: Date. Date as serial number (44197) as array. 1 argument used.');
		// Case #9: Time. Time as decimal (0.5) as array. 1 argument used.
		oParser = new parserFormula('VSTACK(TIME(12,0,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(TIME(12,0,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.5, 'Test: Positive case: Time. Time as decimal (0.5) as array. 1 argument used.');
		// Case #10: Reference link. Reference to cell with number (1). 1 argument used.
		oParser = new parserFormula('VSTACK(A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(A100) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.5, 'Test: Positive case: Reference link. Reference to cell with number (1). 1 argument used.');
		// Case #11: Area. Single-cell range with number (2). 1 argument used.
		oParser = new parserFormula('VSTACK(A101:A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(A101:A101) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1.5, 'Test: Positive case: Area. Single-cell range with number (2). 1 argument used.');
		// Case #12: Array. Single array with two elements. 1 argument used.
		oParser = new parserFormula('VSTACK({1,2})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK({1,2}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Array. Single array with two elements. 1 argument used.');
		// Case #13: Array, Array. Two arrays stacked vertically. 2 arguments used.
		oParser = new parserFormula('VSTACK({1,2},{3,4})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK({1,2},{3,4}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Array, Array. Two arrays stacked vertically. 2 arguments used.');
		// Case #14: Name. Named range with number (10). 1 argument used.
		oParser = new parserFormula('VSTACK(TestName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(TestName) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), -0.5, 'Test: Positive case: Name. Named range with number (10). 1 argument used.');
		// Case #15: Name3D. 3D named range with number (100). 1 argument used.
		oParser = new parserFormula('VSTACK(TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), -0.5, 'Test: Positive case: Name3D. 3D named range with number (100). 1 argument used.');
		// Case #16: Ref3D. 3D reference to cell with number (1000). 1 argument used.
		oParser = new parserFormula('VSTACK(Sheet2!A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(Sheet2!A1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Ref3D. 3D reference to cell with number (1000). 1 argument used.');
		// Case #17: Area3D. 3D single-cell range with number (2000). 1 argument used.
		oParser = new parserFormula('VSTACK(Sheet2!A2:A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(Sheet2!A2:A2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 2, 'Test: Positive case: Area3D. 3D single-cell range with number (2000). 1 argument used.');
		// Case #18: Table. Table structured reference with numbers (1,2). 1 argument used.
		oParser = new parserFormula('VSTACK(Table1[Column1])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(Table1[Column1]) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Table. Table structured reference with numbers (1,2). 1 argument used.');
		// Case #19: Formula. Formula (SUM) returning number (2) as array. 1 argument used.
		oParser = new parserFormula('VSTACK(SUM(1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(SUM(1,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 2, 'Test: Positive case: Formula. Formula (SUM) returning number (2) as array. 1 argument used.');
		// Case #20: Formula. Nested IF formula returning number (1). 1 argument used.
		oParser = new parserFormula('VSTACK(IF(TRUE,1,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(IF(TRUE,1,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Formula. Nested IF formula returning number (1). 1 argument used.');
		// Case #21: Array, Number, String. Mixed types (array, number, string) stacked vertically. 3 arguments used.
		oParser = new parserFormula('VSTACK({1,2},3,"text")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK({1,2},3,"text") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Array, Number, String. Mixed types (array, number, string) stacked vertically. 3 arguments used.');
		// Case #22: Formula. Nested VSTACK returning array. 1 argument used.
		oParser = new parserFormula('VSTACK(VSTACK(1,2))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(VSTACK(1,2)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Positive case: Formula. Nested VSTACK returning array. 1 argument used.');

		// Negative cases:
		// Case #1: Empty. No arguments provided returns #VALUE!.
		oParser = new parserFormula('VSTACK(".")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(".") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '.', 'Test: Negative case: Empty. No arguments provided returns #VALUE!.');
		// Case #2: Error. Error value (NA) propagates #N/A. 1 argument used.
		oParser = new parserFormula('VSTACK(NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error. Error value (NA) propagates #N/A. 1 argument used.');
		// Case #3: Boolean. Boolean value (TRUE) returns #VALUE!. 1 argument used.
		oParser = new parserFormula('VSTACK(TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'TRUE', 'Test: Negative case: Boolean. Boolean value (TRUE) returns #VALUE!. 1 argument used.');
		// Case #4: Boolean, Number. Boolean (FALSE) with number returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('VSTACK(FALSE,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(FALSE,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'FALSE', 'Test: Negative case: Boolean, Number. Boolean (FALSE) with number returns #VALUE!. 2 arguments used.');
		// Case #5: String. Non-numeric string not convertible to array returns #VALUE!. 1 argument used.
		oParser = new parserFormula('VSTACK("abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK("abc") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'abc', 'Test: Negative case: String. Non-numeric string not convertible to array returns #VALUE!. 1 argument used.');
		// Case #6: Reference link. Reference to cell with text (abc) returns #VALUE!. 1 argument used.
		oParser = new parserFormula('VSTACK(A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(A102) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.5, 'Test: Negative case: Reference link. Reference to cell with text (abc) returns #VALUE!. 1 argument used.');
		// Case #7: Area. Multi-cell range returns #VALUE!. 1 argument used.
		oParser = new parserFormula('VSTACK(A103:A104)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(A103:A104) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "", 'Test: Negative case: Area. Multi-cell range returns #VALUE!. 1 argument used.');
		// Case #8: Name. Named range with text (abc) returns #VALUE!. 1 argument used.
		oParser = new parserFormula('VSTACK(TestNameArea2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(TestNameArea2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.8, 'Test: Negative case: Name. Named range with text (abc) returns #VALUE!. 1 argument used.');
		// Case #9: Name3D. 3D named range with text (xyz) returns #VALUE!. 1 argument used.
		oParser = new parserFormula('VSTACK(TestNameArea3D2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(TestNameArea3D2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 0.8, 'Test: Negative case: Name3D. 3D named range with text (xyz) returns #VALUE!. 1 argument used.');
		// Case #10: Ref3D. 3D reference to cell with text (xyz) returns #VALUE!. 1 argument used.
		oParser = new parserFormula('VSTACK(Sheet2!A3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(Sheet2!A3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'Text', 'Test: Negative case: Ref3D. 3D reference to cell with text (xyz) returns #VALUE!. 1 argument used.');
		// Case #11: Area3D. 3D multi-cell range returns #VALUE!. 1 argument used.
		oParser = new parserFormula('VSTACK(Sheet2!A4:A5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(Sheet2!A4:A5) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "", 'Test: Negative case: Area3D. 3D multi-cell range returns #VALUE!. 1 argument used.');
		// Case #12: Table. Table column with text (text1,text2) returns #VALUE!. 1 argument used.
		oParser = new parserFormula('VSTACK(Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), '1s', 'Test: Negative case: Table. Table column with text (text1,text2) returns #VALUE!. 1 argument used.');
		// Case #14: Formula. Formula returning #NUM! propagates error. 1 argument used.
		oParser = new parserFormula('VSTACK(SQRT(-1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(SQRT(-1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula. Formula returning #NUM! propagates error. 1 argument used.');
		// Case #15: Number. Formula resulting in #DIV/0! propagates error. 1 argument used.
		oParser = new parserFormula('VSTACK(0/0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(0/0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#DIV/0!', 'Test: Negative case: Number. Formula resulting in #DIV/0! propagates error. 1 argument used.');
		// Case #16: Array. Array with booleans returns #VALUE!. 1 argument used.
		oParser = new parserFormula('VSTACK({TRUE,FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK({TRUE,FALSE}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 'TRUE', 'Test: Negative case: Array. Array with booleans returns #VALUE!. 1 argument used.');
		// Case #17: Array, Array. Arrays with mixed types including booleans return #VALUE!. 2 arguments used.
		oParser = new parserFormula('VSTACK({1,TRUE},{2,FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK({1,TRUE},{2,FALSE}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Negative case: Array, Array. Arrays with mixed types including booleans return #VALUE!. 2 arguments used.');
		// Case #18: Reference link. Reference to empty cell returns #VALUE!. 1 argument used.
		oParser = new parserFormula('VSTACK(A103)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(A103) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "", 'Test: Negative case: Reference link. Reference to empty cell returns #VALUE!. 1 argument used.');
		// Case #19: Formula, Error. Formula with error (NA) propagates #N/A. 2 arguments used.
		oParser = new parserFormula('VSTACK(SUM(1,1),NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(SUM(1,1),NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Formula, Error. Formula with error (NA) propagates #N/A. 2 arguments used.');
		// Case #20: Array. Empty array returns #VALUE!. 1 argument used.
		oParser = new parserFormula('VSTACK({".1"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK({".1"}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), ".1", 'Test: Negative case: Array. Empty array returns #VALUE!. 1 argument used.');

		// Bounded cases:
		// Case #1: Number. Maximum valid Excel number. 1 argument used.
		oParser = new parserFormula('VSTACK(9.99999999999999E+307)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(9.99999999999999E+307) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1e+308, 'Test: Bounded case: Number. Maximum valid Excel number. 1 argument used.');
		// Case #2: Number. Minimum valid Excel number. 1 argument used.
		oParser = new parserFormula('VSTACK(-9.99999999999999E+307)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK(-9.99999999999999E+307) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), -1e+308, 'Test: Bounded case: Number. Minimum valid Excel number. 1 argument used.');
		// Case #3: Array. Large vertical array (5 elements, extensible to Excelâ??s row limit). 1 argument used.
		oParser = new parserFormula('VSTACK({1;2;3;4;5})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK({1;2;3;4;5}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1, 'Test: Bounded case: Array. Large vertical array (5 elements, extensible to Excelâ??s row limit). 1 argument used.');
		let str = "X";
		// Case #4: String. Maximum string length (255 characters) in array. 1 argument used.
		oParser = new parserFormula('VSTACK("A"&REPT("X",255))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: VSTACK("A"&REPT("X",255)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "A" + str.repeat(255), 'Test: Bounded case: String. Maximum string length (255 characters) in array. 1 argument used.');

		// Need to fix: bounded case, name handle
		// Case #8: Name. Named range with text (abc) returns #VALUE!. 1 argument used.
		// Case #1: Number. Maximum valid Excel number. 1 argument used.
		// Case #2: Number. Minimum valid Excel number. 1 argument used.


	});


	QUnit.test("Test: \"HSTACK\"", function (assert) {
		//1. добавляем общие тесты
		putStackData();
		oParser = new parserFormula("HSTACK(A1:B3,B5:D5,B8:B11,B14:E18,A1)", "A1", ws);
		assert.ok(oParser.parse());
		let array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'test2');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 'test11');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 'test12');
		assert.strictEqual(array.getElementRowCol(0, 4).getValue(), 'test13');
		assert.strictEqual(array.getElementRowCol(0, 5).getValue(), 'test13');
		assert.strictEqual(array.getElementRowCol(0, 6).getValue(), 'f');
		assert.strictEqual(array.getElementRowCol(0, 7).getValue(), 'g');
		assert.strictEqual(array.getElementRowCol(0, 8).getValue(), 'h');
		assert.strictEqual(array.getElementRowCol(0, 9).getValue(), 'g');
		assert.strictEqual(array.getElementRowCol(0, 10).getValue(), 2);

		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 'w');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 3);
		assert.strictEqual(array.getElementRowCol(1, 5).getValue(), 'test14');
		assert.strictEqual(array.getElementRowCol(1, 6).getValue(), 's');
		assert.strictEqual(array.getElementRowCol(1, 7).getValue(), '');
		assert.strictEqual(array.getElementRowCol(1, 8).getValue(), 'd');
		assert.strictEqual(array.getElementRowCol(1, 9).getValue(), 'f');

		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(2, 1).getValue(), 4);
		assert.strictEqual(array.getElementRowCol(2, 5).getValue(), '#VALUE!');
		assert.strictEqual(array.getElementRowCol(2, 6).getValue(), 'd');
		assert.strictEqual(array.getElementRowCol(2, 7).getValue(), '');
		assert.strictEqual(array.getElementRowCol(2, 8).getValue(), 'g');
		assert.strictEqual(array.getElementRowCol(2, 9).getValue(), 'f');

		assert.strictEqual(array.getElementRowCol(3, 5).getValue(), 'test16');
		assert.strictEqual(array.getElementRowCol(3, 6).getValue(), 's');
		assert.strictEqual(array.getElementRowCol(3, 7).getValue(), 'dfg');
		assert.strictEqual(array.getElementRowCol(3, 8).getValue(), 's');
		assert.strictEqual(array.getElementRowCol(3, 9).getValue(), 'd');

		assert.strictEqual(array.getElementRowCol(4, 6).getValue(), 'd');
		assert.strictEqual(array.getElementRowCol(4, 7).getValue(), '');
		assert.strictEqual(array.getElementRowCol(4, 8).getValue(), '');
		assert.strictEqual(array.getElementRowCol(4, 9).getValue(), 'g');


		//2. аргументы - разные типы. нужно пербрать все аргументы
		//2.1 аргумент - number
		oParser = new parserFormula("HSTACK(1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.2 аргумент - string
		oParser = new parserFormula("HSTACK(\"test\")", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test");
		//2.3 аргумент - bool
		oParser = new parserFormula("HSTACK(true)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "TRUE");
		//2.4 аргумент - error
		oParser = new parserFormula("HSTACK(#VALUE!)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.5 аргумент - empty
		oParser = new parserFormula("HSTACK(1,,1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.6 аргумент - cellsRange
		//2.7 аргумент - cell
		oParser = new parserFormula("HSTACK(B1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test2");

		//2.8 аргумент - array
		oParser = new parserFormula("HSTACK({1,2})", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1);
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 2);

		ws.getRange2("A1:C214").cleanAll();
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("0.5");
		ws.getRange2("A101").setValue("1.5");
		ws.getRange2("A104").setValue("-1");
		// For area
		ws.getRange2("A102").setValue("0.5");
		ws.getRange2("A103").setValue("");
		ws.getRange2("A105").setValue("1");
		ws.getRange2("A110").setValue("TRUE");
		ws.getRange2("A111").setValue("FALSE");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 1);
		ws.getRange2("A601").setValue("1"); // Number (Column1)
		ws.getRange2("B601").setValue("1s"); // Text (Column2)
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2

		// Positive cases:
		// Case #1: Number. Single number converted to array. 1 argument used.
		oParser = new parserFormula('HSTACK(1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number. Single number converted to array. 1 argument used.');
		// Case #2: Number, Number. Two numbers stacked vertically. 2 arguments used.
		oParser = new parserFormula('HSTACK(1,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(1,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number, Number. Two numbers stacked vertically. 2 arguments used.');
		// Case #3: Number, Number, Number. Three numbers stacked vertically. 3 arguments used.
		oParser = new parserFormula('HSTACK(1,2,3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(1,2,3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number, Number, Number. Three numbers stacked vertically. 3 arguments used.');
		// Case #4: String. Single string converted to array. 1 argument used.
		oParser = new parserFormula('HSTACK("text")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK("text") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'text', 'Test: Positive case: String. Single string converted to array. 1 argument used.');
		// Case #5: String, String. Two strings stacked vertically. 2 arguments used.
		oParser = new parserFormula('HSTACK("text1","text2")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK("text1","text2") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'text1', 'Test: Positive case: String, String. Two strings stacked vertically. 2 arguments used.');
		// Case #6: Formula. Formula returning number (2) as array. 1 argument used.
		oParser = new parserFormula('HSTACK(SQRT(4))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(SQRT(4)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 2, 'Test: Positive case: Formula. Formula returning number (2) as array. 1 argument used.');
		// Case #7: Formula, Number. Formula and number stacked vertically. 2 arguments used.
		oParser = new parserFormula('HSTACK(SQRT(4),3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(SQRT(4),3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 2, 'Test: Positive case: Formula, Number. Formula and number stacked vertically. 2 arguments used.');
		// Case #8: Date. Date as serial number (44197) as array. 1 argument used.
		oParser = new parserFormula('HSTACK(DATE(2025,1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(DATE(2025,1,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 45658, 'Test: Positive case: Date. Date as serial number (44197) as array. 1 argument used.');
		// Case #9: Time. Time as decimal (0.5) as array. 1 argument used.
		oParser = new parserFormula('HSTACK(TIME(12,0,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(TIME(12,0,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Time. Time as decimal (0.5) as array. 1 argument used.');
		// Case #10: Reference link. Reference to cell with number (1). 1 argument used.
		oParser = new parserFormula('HSTACK(A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(A100) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Reference link. Reference to cell with number (1). 1 argument used.');
		// Case #11: Area. Single-cell range with number (2). 1 argument used.
		oParser = new parserFormula('HSTACK(A101:A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(A101:A101) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1.5, 'Test: Positive case: Area. Single-cell range with number (2). 1 argument used.');
		// Case #12: Array. Single array with two elements. 1 argument used.
		oParser = new parserFormula('HSTACK({1,2})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK({1,2}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array. Single array with two elements. 1 argument used.');
		// Case #13: Array, Array. Two arrays stacked vertically. 2 arguments used.
		oParser = new parserFormula('HSTACK({1,2},{3,4})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK({1,2},{3,4}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Array. Two arrays stacked vertically. 2 arguments used.');
		// Case #14: Name. Named range with number (10). 1 argument used.
		oParser = new parserFormula('HSTACK(TestName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(TestName) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name. Named range with number (10). 1 argument used.');
		// Case #15: Name3D. 3D named range with number (100). 1 argument used.
		oParser = new parserFormula('HSTACK(TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name3D. 3D named range with number (100). 1 argument used.');
		// Case #16: Ref3D. 3D reference to cell with number (1000). 1 argument used.
		oParser = new parserFormula('HSTACK(Sheet2!A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(Sheet2!A1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Ref3D. 3D reference to cell with number (1000). 1 argument used.');
		// Case #17: Area3D. 3D single-cell range with number (2000). 1 argument used.
		oParser = new parserFormula('HSTACK(Sheet2!A2:A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(Sheet2!A2:A2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 2, 'Test: Positive case: Area3D. 3D single-cell range with number (2000). 1 argument used.');
		// Case #18: Table. Table structured reference with numbers (1,2). 1 argument used.
		oParser = new parserFormula('HSTACK(Table1[Column1])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(Table1[Column1]) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Table. Table structured reference with numbers (1,2). 1 argument used.');
		// Case #19: Formula. Formula (SUM) returning number (2) as array. 1 argument used.
		oParser = new parserFormula('HSTACK(SUM(1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(SUM(1,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 2, 'Test: Positive case: Formula. Formula (SUM) returning number (2) as array. 1 argument used.');
		// Case #20: Formula. Nested IF formula returning number (1). 1 argument used.
		oParser = new parserFormula('HSTACK(IF(TRUE,1,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(IF(TRUE,1,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula. Nested IF formula returning number (1). 1 argument used.');
		// Case #21: Array, Number, String. Mixed types (array, number, string) stacked vertically. 3 arguments used.
		oParser = new parserFormula('HSTACK({1,2},3,"text")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK({1,2},3,"text") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Number, String. Mixed types (array, number, string) stacked vertically. 3 arguments used.');
		// Case #22: Formula. Nested VSTACK returning array. 1 argument used.
		oParser = new parserFormula('HSTACK(VSTACK(1,2))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(VSTACK(1,2)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula. Nested VSTACK returning array. 1 argument used.');

		// Negative cases:
		// Case #1: Empty. No arguments provided returns #VALUE!.
		oParser = new parserFormula('HSTACK(".")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(".") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '.', 'Test: Negative case: Empty. No arguments provided returns #VALUE!.');
		// Case #2: Error. Error value (NA) propagates #N/A. 1 argument used.
		oParser = new parserFormula('HSTACK(NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error. Error value (NA) propagates #N/A. 1 argument used.');
		// Case #3: Boolean. Boolean value (TRUE) returns #VALUE!. 1 argument used.
		oParser = new parserFormula('HSTACK(TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'TRUE', 'Test: Negative case: Boolean. Boolean value (TRUE) returns #VALUE!. 1 argument used.');
		// Case #4: Boolean, Number. Boolean (FALSE) with number returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('HSTACK(FALSE,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(FALSE,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'FALSE', 'Test: Negative case: Boolean, Number. Boolean (FALSE) with number returns #VALUE!. 2 arguments used.');
		// Case #5: String. Non-numeric string not convertible to array returns #VALUE!. 1 argument used.
		oParser = new parserFormula('HSTACK("abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK("abc") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'abc', 'Test: Negative case: String. Non-numeric string not convertible to array returns #VALUE!. 1 argument used.');
		// Case #6: Reference link. Reference to cell with text (abc) returns #VALUE!. 1 argument used.
		oParser = new parserFormula('HSTACK(A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(A102) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Negative case: Reference link. Reference to cell with text (abc) returns #VALUE!. 1 argument used.');
		// Case #7: Area. Multi-cell range returns #VALUE!. 1 argument used.
		oParser = new parserFormula('HSTACK(A103:A104)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(A103:A104) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), "", 'Test: Negative case: Area. Multi-cell range returns #VALUE!. 1 argument used.');
		// Case #8: Name. Named range with text (abc) returns #VALUE!. 1 argument used.
		oParser = new parserFormula('HSTACK(TestNameArea2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(TestNameArea2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name. Named range with text (abc) returns #VALUE!. 1 argument used.');
		// Case #9: Name3D. 3D named range with text (xyz) returns #VALUE!. 1 argument used.
		oParser = new parserFormula('HSTACK(TestNameArea3D2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(TestNameArea3D)2 is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name3D. 3D named range with text (xyz) returns #VALUE!. 1 argument used.');
		// Case #10: Ref3D. 3D reference to cell with text (xyz) returns #VALUE!. 1 argument used.
		oParser = new parserFormula('HSTACK(Sheet2!A3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(Sheet2!A3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'Text', 'Test: Negative case: Ref3D. 3D reference to cell with text (xyz) returns #VALUE!. 1 argument used.');
		// Case #11: Area3D. 3D multi-cell range returns #VALUE!. 1 argument used.
		oParser = new parserFormula('HSTACK(Sheet2!A4:A5)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(Sheet2!A4:A5) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), "", 'Test: Negative case: Area3D. 3D multi-cell range returns #VALUE!. 1 argument used.');
		// Case #12: Table. Table column with text (text1,text2) returns #VALUE!. 1 argument used.
		oParser = new parserFormula('HSTACK(Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), "1s", 'Test: Negative case: Table. Table column with text (text1,text2) returns #VALUE!. 1 argument used.');
		// Case #14: Formula. Formula returning #NUM! propagates error. 1 argument used.
		oParser = new parserFormula('HSTACK(SQRT(-1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(SQRT(-1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula. Formula returning #NUM! propagates error. 1 argument used.');
		// Case #15: Number. Formula resulting in #DIV/0! propagates error. 1 argument used.
		oParser = new parserFormula('HSTACK(0/0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(0/0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#DIV/0!', 'Test: Negative case: Number. Formula resulting in #DIV/0! propagates error. 1 argument used.');
		// Case #16: Array. Array with booleans returns #VALUE!. 1 argument used.
		oParser = new parserFormula('HSTACK({TRUE,FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK({TRUE,FALSE}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'TRUE', 'Test: Negative case: Array. Array with booleans returns #VALUE!. 1 argument used.');
		// Case #17: Array, Array. Arrays with mixed types including booleans return #VALUE!. 2 arguments used.
		oParser = new parserFormula('HSTACK({1,TRUE},{2,FALSE})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK({1,TRUE},{2,FALSE}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array, Array. Arrays with mixed types including booleans return #VALUE!. 2 arguments used.');
		// Case #18: Reference link. Reference to empty cell returns #VALUE!. 1 argument used.
		oParser = new parserFormula('HSTACK(A103)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(A103) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), "", 'Test: Negative case: Reference link. Reference to empty cell returns #VALUE!. 1 argument used.');
		// Case #19: Formula, Error. Formula with error (NA) propagates #N/A. 2 arguments used.
		oParser = new parserFormula('HSTACK(SUM(1,1),NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(SUM(1,1),NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Formula, Error. Formula with error (NA) propagates #N/A. 2 arguments used.');
		// Case #20: Array. Empty array returns #VALUE!. 1 argument used.
		oParser = new parserFormula('HSTACK({".1"})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK({".1"}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), ".1", 'Test: Negative case: Array. Empty array returns #VALUE!. 1 argument used.');

		// Bounded cases:
		// Case #1: Number. Maximum valid Excel number. 1 argument used.
		oParser = new parserFormula('HSTACK(9.99999999999999E+307)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(9.99999999999999E+307) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1e+308, 'Test: Bounded case: Number. Maximum valid Excel number. 1 argument used.');
		// Case #2: Number. Minimum valid Excel number. 1 argument used.
		oParser = new parserFormula('HSTACK(-9.99999999999999E+307)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK(-9.99999999999999E+307) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -1e+308, 'Test: Bounded case: Number. Minimum valid Excel number. 1 argument used.');
		// Case #3: Array. Large vertical array (5 elements, extensible to Excelâ??s row limit). 1 argument used.
		oParser = new parserFormula('HSTACK({1;2;3;4;5})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK({1;2;3;4;5}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Array. Large vertical array (5 elements, extensible to Excelâ??s row limit). 1 argument used.');
		// Case #4: String. Maximum string length (255 characters) in array. 1 argument used.
		let str = "X";
		oParser = new parserFormula('HSTACK("A"&REPT("X",255))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: HSTACK("A"&REPT("X",255)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'A' + str.repeat(255), 'Test: Bounded case: String. Maximum string length (255 characters) in array. 1 argument used.');

		// Need to fix: boundary cases
		// Case #1: Number. Maximum valid Excel number. 1 argument used.
		// Case #2: Number. Minimum valid Excel number. 1 argument used.

	});


	QUnit.test("Test: \"TOROW\"", function (assert) {
		//1. добавляем общие тесты

		ws.getRange2("A1").setValue("2");
		ws.getRange2("A2").setValue("");
		ws.getRange2("A3").setValue("test");

		ws.getRange2("B1").setValue("test2");
		ws.getRange2("B2").setValue("#N/A");
		ws.getRange2("B3").setValue("");

		oParser = new parserFormula("TOROW(A1:B3,0, FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		let array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'test2');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), '');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), '#N/A');
		assert.strictEqual(array.getElementRowCol(0, 4).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(0, 5).getValue(), '');

		oParser = new parserFormula("TOROW(A1:B3,1, FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'test2');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), '#N/A');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 'test');

		oParser = new parserFormula("TOROW(A1:B3,2, FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'test2');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), '');
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(0, 4).getValue(), '');
		assert.strictEqual(array.getElementRowCol(0, 5).getValue(), '');

		oParser = new parserFormula("TOROW(A1:B3,3,FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'test2');
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), 'test');


		//2. аргументы - разные типы. нужно пербрать все аргументы
		//2.1 аргумент - number
		oParser = new parserFormula("TOROW(1,3,FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.2 аргумент - string
		oParser = new parserFormula("TOROW(\"test\",3,FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test");
		//2.3 аргумент - bool
		oParser = new parserFormula("TOROW(true)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "TRUE");
		//2.4 аргумент - error
		oParser = new parserFormula("TOROW(#VALUE!)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.5 аргумент - empty
		oParser = new parserFormula("TOROW(1,,1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.6 аргумент - cellsRange
		//2.7 аргумент - cell
		oParser = new parserFormula("TOROW(B1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test2");

		//2.8 аргумент - array
		oParser = new parserFormula("TOROW({1,2})", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1);
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 2);


		oParser = new parserFormula("TOROW(1,{1,2,3},FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("TOROW(1,{1,2,3},{false,true})", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("TOROW(1,A1:A3,{false,true})", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("TOROW(1,A1:A3,A1:A3)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		// for bug 69719
		let sheetName = ws.getName();

		ws.getRange2("C1").setValue("test3");
		ws.getRange2("D1").setValue("test4");
		ws.getRange2("E1").setValue("test5");

		oParser = new parserFormula("TOROW("+sheetName+"!A1:A3)", "A1", ws);
		assert.ok(oParser.parse(), "TOROW("+sheetName+"!A1:A3)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of TOROW("+sheetName+"!A1:A3)[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "", "Result of TOROW("+sheetName+"!A1:A3)[0,1]");
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), "test", "Result of TOROW("+sheetName+"!A1:A3)[0,2]");

		oParser = new parserFormula("TOROW("+sheetName+"!A1:E1)", "A1", ws);
		assert.ok(oParser.parse(), "TOROW("+sheetName+"!A1:E1)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of TOROW("+sheetName+"!A1:E1)[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "test2", "Result of TOROW("+sheetName+"!A1:E1)[0,1]");
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), "test3", "Result of TOROW("+sheetName+"!A1:E1)[0,2]");
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), "test4", "Result of TOROW("+sheetName+"!A1:E1)[0,3]");
		assert.strictEqual(array.getElementRowCol(0, 4).getValue(), "test5", "Result of TOROW("+sheetName+"!A1:E1)[0,4]");

		oParser = new parserFormula("TOROW("+sheetName+"!A1:B3)", "A1", ws);
		assert.ok(oParser.parse(), "TOROW("+sheetName+"!A1:B3)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of TOROW("+sheetName+"!A1:B3)[0,0]");
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), "test2", "Result of TOROW("+sheetName+"!A1:B3)[0,1]");
		assert.strictEqual(array.getElementRowCol(0, 2).getValue(), "", "Result of TOROW("+sheetName+"!A1:B3)[0,2]");
		assert.strictEqual(array.getElementRowCol(0, 3).getValue(), "#N/A", "Result of TOROW("+sheetName+"!A1:B3)[0,3]");
		assert.strictEqual(array.getElementRowCol(0, 4).getValue(), "test", "Result of TOROW("+sheetName+"!A1:B3)[0,4]");
		assert.strictEqual(array.getElementRowCol(0, 5).getValue(), "", "Result of TOROW("+sheetName+"!A1:B3)[0,5]");
		

		ws.getRange2("A1:C214").cleanAll();
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("0.5");
		ws.getRange2("A101").setValue("1.5");
		ws.getRange2("A104").setValue("-1");
		// For area
		ws.getRange2("A102").setValue("0.5");
		ws.getRange2("A103").setValue("");
		ws.getRange2("A105").setValue("1");
		ws.getRange2("A110").setValue("TRUE");
		ws.getRange2("A111").setValue("FALSE");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 1);
		ws.getRange2("A601").setValue("1"); // Number (Column1)
		ws.getRange2("B601").setValue("1s"); // Text (Column2)
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2


		// Positive cases:
		// Case #1: Array. Basic array input, converts to single column. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW({1,2,3})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({1,2,3}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array. Basic array input, converts to single column. 1 of 3 arguments used.');
		// Case #2: Array. 2D array, default row-wise scan. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW({1,2;3,4})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({1,2;3,4}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array. 2D array, default row-wise scan. 1 of 3 arguments used.');
		// Case #3: Array, Number. Array with blank, ignore blanks (1). 2 of 3 arguments used.
		oParser = new parserFormula('TOROW({1,2,"",3},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({1,2,"",3},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Number. Array with blank, ignore blanks (1). 2 of 3 arguments used.');
		// Case #4: Array, Number, Boolean. 2D array, column-wise scan (TRUE). 3 of 3 arguments used.
		oParser = new parserFormula('TOROW({1,2;3,4},0,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({1,2;3,4},0,TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Number, Boolean. 2D array, column-wise scan (TRUE). 3 of 3 arguments used.');
		// Case #5: Reference link. Single cell reference, converts to single value. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW(A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(A100) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Reference link. Single cell reference, converts to single value. 1 of 3 arguments used.');
		// Case #6: Area. Single-column range, converts to column. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW(A100:A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(A100:A101) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Area. Single-column range, converts to column. 1 of 3 arguments used.');
		// Case #7: Name. Named range with valid array. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW(TestName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(TestName) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name. Named range with valid array. 1 of 3 arguments used.');
		// Case #8: Ref3D. 3D reference to single cell. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW(Sheet2!A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(Sheet2!A1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Ref3D. 3D reference to single cell. 1 of 3 arguments used.');
		// Case #9: Area3D. 3D single-column range. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW(Sheet2!A1:A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(Sheet2!A1:A2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Area3D. 3D single-column range. 1 of 3 arguments used.');
		// Case #10: Table. Table column reference. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW(Table1[Column1])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(Table1[Column1]) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Table. Table column reference. 1 of 3 arguments used.');
		// Case #11: Formula. Nested formula returning array. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW(TRANSPOSE({3,2,3}))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(TRANSPOSE({3,2,3})) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 3, 'Test: Positive case: Formula. Nested formula returning array. 1 of 3 arguments used.');
		// Case #12: Array, Number. Array with error, ignore errors (2). 2 of 3 arguments used.
		oParser = new parserFormula('TOROW({"a",#N/A,"b"},2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({"a",#N/A,"b"},2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'a', 'Test: Positive case: Array, Number. Array with error, ignore errors (2). 2 of 3 arguments used.');
		// Case #13: Array, Number. Array with blank and error, ignore both (3). 2 of 3 arguments used.
		oParser = new parserFormula('TOROW({"3",#N/A,1},3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({"3",#N/A,1},3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '3', 'Test: Positive case: Array, Number. Array with blank and error, ignore both (3). 2 of 3 arguments used.');
		// Case #14: Date. Date as serial number. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW(DATE(2025,1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(DATE(2025,1,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 45658, 'Test: Positive case: Date. Date as serial number. 1 of 3 arguments used.');
		// Case #15: Time. Time as serial number. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW(TIME(12,0,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(TIME(12,0,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Time. Time as serial number. 1 of 3 arguments used.');
		// Case #16: Array. 2D array, default row-wise scan. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW({1,2,3;4,5,6})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({1,2,3;4,5,6}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array. 2D array, default row-wise scan. 1 of 3 arguments used.');
		// Case #17: Formula. Nested IF returning array. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW(IF(TRUE,{1,2},{3,4}))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(IF(TRUE,{1,2},{3,4})) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula. Nested IF returning array. 1 of 3 arguments used.');
		// Case #18: Array, Boolean. 2D array, explicit row-wise scan (FALSE). 2 of 3 arguments used.
		oParser = new parserFormula('TOROW({1,2;3,4},FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({1,2;3,4},FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Boolean. 2D array, explicit row-wise scan (FALSE). 2 of 3 arguments used.');
		// Case #19: Name3D. 3D named range with valid array. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW(TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name3D. 3D named range with valid array. 1 of 3 arguments used.');
		// Case #20: String. String input treated as single value. 1 of 3 arguments used.
		oParser = new parserFormula('TOROW("1,2,3")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW("1,2,3") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '1,2,3', 'Test: Positive case: String. String input treated as single value. 1 of 3 arguments used.');

		// Negative cases:
		// Case #1: Empty. Missing required array argument, returns #VALUE!.
		oParser = new parserFormula('TOROW(,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(,) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '#VALUE!', 'Test: Negative case: Empty. Missing required array argument, returns #VALUE!.');
		// Case #2: Number. Single number not in array/range, returns #VALUE!.
		oParser = new parserFormula('TOROW(1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Number. Single number not in array/range, returns #VALUE!.');
		// Case #3: Boolean. Boolean input, returns #VALUE!.
		oParser = new parserFormula('TOROW(TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'TRUE', 'Test: Negative case: Boolean. Boolean input, returns #VALUE!.');
		// Case #4: Error. Error input propagates #N/A.
		oParser = new parserFormula('TOROW(NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error. Error input propagates #N/A.');
		// Case #5: String. Non-numeric string, returns #VALUE!.
		oParser = new parserFormula('TOROW("abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW("abc") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'abc', 'Test: Negative case: String. Non-numeric string, returns #VALUE!.');
		// Case #6: Array, Number. Invalid ignore value (4), returns #VALUE!.
		oParser = new parserFormula('TOROW({1,2,3},4)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({1,2,3},4) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '#VALUE!', 'Test: Negative case: Array, Number. Invalid ignore value (4), returns #VALUE!.');
		// Case #7: Array, String. Invalid ignore type (string), returns #VALUE!.
		oParser = new parserFormula('TOROW({1,2,3},"1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({1,2,3},"1") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array, String. Invalid ignore type (string), returns #VALUE!.');
		// Case #8: Area. Multi-column range, returns #VALUE!.
		oParser = new parserFormula('TOROW(A100:A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(A100:A102) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Negative case: Area. Multi-column range, returns #VALUE!.');
		// Case #9: Ref3D. 3D ref to invalid data, returns #VALUE!.
		oParser = new parserFormula('TOROW(Sheet2!A3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(Sheet2!A3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'Text', 'Test: Negative case: Ref3D. 3D ref to invalid data, returns #VALUE!.');
		// Case #10: Name. Named range with invalid data, returns #VALUE!.
		oParser = new parserFormula('TOROW(TestNameArea2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(TestNameArea2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name. Named range with invalid data, returns #VALUE!.');
		// Case #11: Array. Array with error value, returns #VALUE!.
		oParser = new parserFormula('TOROW({#VALUE!})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({#VALUE!}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '#VALUE!', 'Test: Negative case: Array. Array with error value, returns #VALUE!.');
		// Case #12: Formula. Formula resulting in #NUM!, propagates error.
		oParser = new parserFormula('TOROW(SQRT(-1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(SQRT(-1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula. Formula resulting in #NUM!, propagates error.');
		// Case #13: Area3D. 3D range with invalid data, returns #VALUE!.
		oParser = new parserFormula('TOROW(Sheet2!A3:A4)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(Sheet2!A3:A4) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'Text', 'Test: Negative case: Area3D. 3D range with invalid data, returns #VALUE!.');
		// Case #14: Name3D. 3D named range with invalid data, returns #VALUE!.
		oParser = new parserFormula('TOROW(TestNameArea3D2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(TestNameArea3D2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name3D. 3D named range with invalid data, returns #VALUE!.');
		// Case #15: Table. Table column with non-numeric data, returns #VALUE!.
		oParser = new parserFormula('TOROW(Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '1s', 'Test: Negative case: Table. Table column with non-numeric data, returns #VALUE!.');
		// Case #16: Array, Number. Negative ignore value, returns #VALUE!.
		oParser = new parserFormula('TOROW({1,2,3},-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({1,2,3},-1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '#VALUE!', 'Test: Negative case: Array, Number. Negative ignore value, returns #VALUE!.');
		// Case #17: Array, Boolean. Invalid scan_by_column type (number), returns #VALUE!.
		oParser = new parserFormula('TOROW({1,2;3,4},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({1,2;3,4},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array, Boolean. Invalid scan_by_column type (number), returns #VALUE!.');
		// Case #18: Reference link. Empty reference, returns #VALUE!.
		oParser = new parserFormula('TOROW(A103)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(A103) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0, 'Test: Negative case: Reference link. Empty reference, returns #VALUE!.');
		// Case #19: Array. Empty array, returns #VALUE!.
		oParser = new parserFormula('TOROW({"."})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({"."}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '.', 'Test: Negative case: Array. Empty array, returns #VALUE!.');
		// Case #20: Time. Time value (0), returns #VALUE!.
		oParser = new parserFormula('TOROW(TIME(0,0,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW(TIME(0,0,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0, 'Test: Negative case: Time. Time value (0), returns #VALUE!.');

		// Bounded cases:
		// Case #1: Array. Minimum valid array (single element). 1 of 3 arguments used.
		oParser = new parserFormula('TOROW({1})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({1}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Array. Minimum valid array (single element). 1 of 3 arguments used.');
		// Case #2: Array, Number. Minimum valid ignore value (3) with mixed data. 2 of 3 arguments used.
		oParser = new parserFormula('TOROW({1,"",#N/A},3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({1,"",#N/A},3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Array, Number. Minimum valid ignore value (3) with mixed data. 2 of 3 arguments used.');
		// Case #3: Array, Number, Boolean. Maximum valid ignore (0) and explicit row-wise scan. 3 of 3 arguments used.
		oParser = new parserFormula('TOROW({1,2;3,4},0,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOROW({1,2;3,4},0,FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Array, Number, Boolean. Maximum valid ignore (0) and explicit row-wise scan. 3 of 3 arguments used.');

		// Need to fix: empty handle, array result diff
		// Case #1: Empty. Missing required array argument, returns #VALUE!.
		// Case #6: Array, Number. Invalid ignore value (4), returns #VALUE!.
		// Case #16: Array, Number. Negative ignore value, returns #VALUE!.
		// Case #18: Reference link. Empty reference, returns #VALUE!.


	});


	QUnit.test("Test: \"TOCOL\"", function (assert) {
		//1. добавляем общие тесты

		ws.getRange2("A1").setValue("2");
		ws.getRange2("A2").setValue("");
		ws.getRange2("A3").setValue("test");

		ws.getRange2("B1").setValue("test2");
		ws.getRange2("B2").setValue("#N/A");
		ws.getRange2("B3").setValue("");

		oParser = new parserFormula("TOCOL(A1:B3,0, FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		let array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 'test2');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), '');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), '#N/A');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), '');

		oParser = new parserFormula("TOCOL(A1:B3,1, FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 'test2');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), '#N/A');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 'test');

		oParser = new parserFormula("TOCOL(A1:B3,2, FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 'test2');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), '');
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), '');
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), '');

		oParser = new parserFormula("TOCOL(A1:B3,3,FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 'test2');
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), 'test');


		//2. аргументы - разные типы. нужно пербрать все аргументы
		//2.1 аргумент - number
		oParser = new parserFormula("TOCOL(1,3,FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.2 аргумент - string
		oParser = new parserFormula("TOCOL(\"test\",3,FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test");
		//2.3 аргумент - bool
		oParser = new parserFormula("TOCOL(true)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "TRUE");
		//2.4 аргумент - error
		oParser = new parserFormula("TOCOL(#VALUE!)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.5 аргумент - empty
		oParser = new parserFormula("TOCOL(1,,1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.6 аргумент - cellsRange
		//2.7 аргумент - cell
		oParser = new parserFormula("TOCOL(B1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test2");

		//2.8 аргумент - array
		oParser = new parserFormula("TOCOL({1,2})", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 2);


		oParser = new parserFormula("TOCOL(1,{1,2,3},FALSE)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("TOCOL(1,{1,2,3},{false,true})", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("TOCOL(1,A1:A3,{false,true})", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("TOCOL(1,A1:A3,A1:A3)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		// for bug 69719
		let sheetName = ws.getName();

		ws.getRange2("C1").setValue("test3");
		ws.getRange2("D1").setValue("test4");
		ws.getRange2("E1").setValue("test5");

		oParser = new parserFormula("TOCOL("+sheetName+"!A1:A3)", "A1", ws);
		assert.ok(oParser.parse(), "TOCOL("+sheetName+"!A1:A3)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of TOCOL("+sheetName+"!A1:A3)[0,0]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "", "Result of TOCOL("+sheetName+"!A1:A3)[1,0]");
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "test", "Result of TOCOL("+sheetName+"!A1:A3)[2,0]");

		oParser = new parserFormula("TOCOL("+sheetName+"!A1:E1)", "A1", ws);
		assert.ok(oParser.parse(), "TOCOL("+sheetName+"!A1:E1)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of TOCOL("+sheetName+"!A1:E1)[0,0]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "test2", "Result of TOCOL("+sheetName+"!A1:E1)[1,0]");
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "test3", "Result of TOCOL("+sheetName+"!A1:E1)[2,0]");
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "test4", "Result of TOCOL("+sheetName+"!A1:E1)[3,0]");
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), "test5", "Result of TOCOL("+sheetName+"!A1:E1)[4,0]");

		oParser = new parserFormula("TOCOL("+sheetName+"!A1:B3)", "A1", ws);
		assert.ok(oParser.parse(), "TOCOL("+sheetName+"!A1:E1)");
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2, "Result of TOCOL("+sheetName+"!A1:B3)[0,0]");
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), "test2", "Result of TOCOL("+sheetName+"!A1:B3)[1,0]");
		assert.strictEqual(array.getElementRowCol(2, 0).getValue(), "", "Result of TOCOL("+sheetName+"!A1:B3)[2,0]");
		assert.strictEqual(array.getElementRowCol(3, 0).getValue(), "#N/A", "Result of TOCOL("+sheetName+"!A1:B3)[3,0]");
		assert.strictEqual(array.getElementRowCol(4, 0).getValue(), "test", "Result of TOCOL("+sheetName+"!A1:B3)[4,0]");
		assert.strictEqual(array.getElementRowCol(5, 0).getValue(), "", "Result of TOCOL("+sheetName+"!A1:B3)[5,0]");

		ws.getRange2("A1:C214").cleanAll();
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("0.5");
		ws.getRange2("A101").setValue("1.5");
		ws.getRange2("A104").setValue("-1");
		// For area
		ws.getRange2("A102").setValue("0.5");
		ws.getRange2("A103").setValue("");
		ws.getRange2("A105").setValue("1");
		ws.getRange2("A110").setValue("TRUE");
		ws.getRange2("A111").setValue("FALSE");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 1);
		ws.getRange2("A601").setValue("1"); // Number (Column1)
		ws.getRange2("B601").setValue("1s"); // Text (Column2)
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2


		// Positive cases:
		// Case #1: Array. Basic array input, converts to single column. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL({1,2,3})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({1,2,3}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array. Basic array input, converts to single column. 1 of 3 arguments used.');
		// Case #2: Array. 2D array, default row-wise scan. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL({1,2;3,4})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({1,2;3,4}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array. 2D array, default row-wise scan. 1 of 3 arguments used.');
		// Case #3: Array, Number. Array with blank, ignore blanks (1). 2 of 3 arguments used.
		oParser = new parserFormula('TOCOL({1,2,"",3},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({1,2,"",3},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Number. Array with blank, ignore blanks (1). 2 of 3 arguments used.');
		// Case #4: Array, Number, Boolean. 2D array, column-wise scan (TRUE). 3 of 3 arguments used.
		oParser = new parserFormula('TOCOL({1,2;3,4},0,TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({1,2;3,4},0,TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Number, Boolean. 2D array, column-wise scan (TRUE). 3 of 3 arguments used.');
		// Case #5: Reference link. Single cell reference, converts to single value. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL(A100)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(A100) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Reference link. Single cell reference, converts to single value. 1 of 3 arguments used.');
		// Case #6: Area. Single-column range, converts to column. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL(A100:A101)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(A100:A101) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Area. Single-column range, converts to column. 1 of 3 arguments used.');
		// Case #7: Name. Named range with valid array. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL(TestName)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(TestName) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name. Named range with valid array. 1 of 3 arguments used.');
		// Case #8: Ref3D. 3D reference to single cell. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL(Sheet2!A1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(Sheet2!A1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Ref3D. 3D reference to single cell. 1 of 3 arguments used.');
		// Case #9: Area3D. 3D single-column range. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL(Sheet2!A1:A2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(Sheet2!A1:A2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Area3D. 3D single-column range. 1 of 3 arguments used.');
		// Case #10: Table. Table column reference. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL(Table1[Column1])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(Table1[Column1]) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Table. Table column reference. 1 of 3 arguments used.');
		// Case #11: Formula. Nested formula returning array. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL(TRANSPOSE({1,2,3}))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(TRANSPOSE({1,2,3})) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula. Nested formula returning array. 1 of 3 arguments used.');
		// Case #12: Array, Number. Array with error, ignore errors (2). 2 of 3 arguments used.
		oParser = new parserFormula('TOCOL({"a",#N/A,"b"},2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({"a",#N/A,"b"},2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'a', 'Test: Positive case: Array, Number. Array with error, ignore errors (2). 2 of 3 arguments used.');
		// Case #13: Array, Number. Array with blank and error, ignore both (3). 2 of 3 arguments used.
		oParser = new parserFormula('TOCOL({"3",#N/A,1},3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({"3",#N/A,1},3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '3', 'Test: Positive case: Array, Number. Array with blank and error, ignore both (3). 2 of 3 arguments used.');
		// Case #14: Date. Date as serial number. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL(DATE(2025,1,1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(DATE(2025,1,1)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 45658, 'Test: Positive case: Date. Date as serial number. 1 of 3 arguments used.');
		// Case #15: Time. Time as serial number. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL(TIME(12,0,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(TIME(12,0,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Time. Time as serial number. 1 of 3 arguments used.');
		// Case #16: Array. 2D array, default row-wise scan. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL({1,2,3;4,5,6})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({1,2,3;4,5,6}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array. 2D array, default row-wise scan. 1 of 3 arguments used.');
		// Case #17: Formula. Nested IF returning array. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL(IF(TRUE,{1,2},{3,4}))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(IF(TRUE,{1,2},{3,4})) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula. Nested IF returning array. 1 of 3 arguments used.');
		// Case #18: Array, Boolean. 2D array, explicit row-wise scan (FALSE). 2 of 3 arguments used.
		oParser = new parserFormula('TOCOL({1,2;3,4},FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({1,2;3,4},FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array, Boolean. 2D array, explicit row-wise scan (FALSE). 2 of 3 arguments used.');
		// Case #19: Name3D. 3D named range with valid array. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL(TestName3D)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(TestName3D) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name3D. 3D named range with valid array. 1 of 3 arguments used.');
		// Case #20: String. String input treated as single value. 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL("1,2,3")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL("1,2,3") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '1,2,3', 'Test: Positive case: String. String input treated as single value. 1 of 3 arguments used.');

		// Negative cases:
		// Case #1: Empty. Missing required array argument, returns #VALUE!.
		oParser = new parserFormula('TOCOL(,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(,) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '#VALUE!', 'Test: Negative case: Empty. Missing required array argument, returns #VALUE!.');
		// Case #2: Number. Single number not in array/range, returns #VALUE!.
		oParser = new parserFormula('TOCOL(1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Number. Single number not in array/range, returns #VALUE!.');
		// Case #3: Boolean. Boolean input, returns #VALUE!.
		oParser = new parserFormula('TOCOL(TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'TRUE', 'Test: Negative case: Boolean. Boolean input, returns #VALUE!.');
		// Case #4: Error. Error input propagates #N/A.
		oParser = new parserFormula('TOCOL(NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(NA()) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error. Error input propagates #N/A.');
		// Case #5: String. Non-numeric string, returns #VALUE!.
		oParser = new parserFormula('TOCOL("abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL("abc") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'abc', 'Test: Negative case: String. Non-numeric string, returns #VALUE!.');
		// Case #6: Array, Number. Invalid ignore value (4), returns #VALUE!.
		oParser = new parserFormula('TOCOL({1,2,3},4)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({1,2,3},4) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '#VALUE!', 'Test: Negative case: Array, Number. Invalid ignore value (4), returns #VALUE!.');
		// Case #7: Array, String. Invalid ignore type (string), returns #VALUE!.
		oParser = new parserFormula('TOCOL({1,2,3},"1")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({1,2,3},"1") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array, String. Invalid ignore type (string), returns #VALUE!.');
		// Case #8: Area. Multi-column range, returns #VALUE!.
		oParser = new parserFormula('TOCOL(A100:A102)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(A100:A102) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Negative case: Area. Multi-column range, returns #VALUE!.');
		// Case #9: Ref3D. 3D ref to invalid data, returns #VALUE!.
		oParser = new parserFormula('TOCOL(Sheet2!A3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(Sheet2!A3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'Text', 'Test: Negative case: Ref3D. 3D ref to invalid data, returns #VALUE!.');
		// Case #10: Name. Named range with invalid data, returns #VALUE!.
		oParser = new parserFormula('TOCOL(TestNameArea2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(TestNameArea2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name. Named range with invalid data, returns #VALUE!.');
		// Case #11: Array. Array with error value, returns #VALUE!.
		oParser = new parserFormula('TOCOL({#VALUE!})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({#VALUE!}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '#VALUE!', 'Test: Negative case: Array. Array with error value, returns #VALUE!.');
		// Case #12: Formula. Formula resulting in #NUM!, propagates error.
		oParser = new parserFormula('TOCOL(SQRT(-1))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(SQRT(-1)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula. Formula resulting in #NUM!, propagates error.');
		// Case #13: Area3D. 3D range with invalid data, returns #VALUE!.
		oParser = new parserFormula('TOCOL(Sheet2!A3:A4)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(Sheet2!A3:A4) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'Text', 'Test: Negative case: Area3D. 3D range with invalid data, returns #VALUE!.');
		// Case #14: Name3D. 3D named range with invalid data, returns #VALUE!.
		oParser = new parserFormula('TOCOL(TestNameArea3D2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(TestNameArea3D2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name3D. 3D named range with invalid data, returns #VALUE!.');
		// Case #15: Table. Table column with non-numeric data, returns #VALUE!.
		oParser = new parserFormula('TOCOL(Table1[Column2])', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(Table1[Column2]) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '1s', 'Test: Negative case: Table. Table column with non-numeric data, returns #VALUE!.');
		// Case #16: Array, Number. Negative ignore value, returns #VALUE!.
		oParser = new parserFormula('TOCOL({1,2,3},-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({1,2,3},-1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '#VALUE!', 'Test: Negative case: Array, Number. Negative ignore value, returns #VALUE!.');
		// Case #17: Array, Boolean. Invalid scan_by_column type (number), returns #VALUE!.
		oParser = new parserFormula('TOCOL({1,2;3,4},1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({1,2;3,4},1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array, Boolean. Invalid scan_by_column type (number), returns #VALUE!.');
		// Case #18: Reference link. Empty reference, returns #VALUE!.
		oParser = new parserFormula('TOCOL(A103)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(A103) is parsed.');
		//? assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0, 'Test: Negative case: Reference link. Empty reference, returns #VALUE!.');
		// Case #19: Array. Empty array, returns #VALUE!.
		oParser = new parserFormula('TOCOL({"."})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({"."}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '.', 'Test: Negative case: Array. Empty array, returns #VALUE!.');
		// Case #20: Time. Time value (0), returns #VALUE!.
		oParser = new parserFormula('TOCOL(TIME(0,0,0))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL(TIME(0,0,0)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0, 'Test: Negative case: Time. Time value (0), returns #VALUE!.');

		// Bounded cases:
		// Case #1: Array. Minimum valid array (single element). 1 of 3 arguments used.
		oParser = new parserFormula('TOCOL({1})', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({1}) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Array. Minimum valid array (single element). 1 of 3 arguments used.');
		// Case #2: Array, Number. Minimum valid ignore value (3) with mixed data. 2 of 3 arguments used.
		oParser = new parserFormula('TOCOL({1,"",#N/A},3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({1,"",#N/A},3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Array, Number. Minimum valid ignore value (3) with mixed data. 2 of 3 arguments used.');
		// Case #3: Array, Number, Boolean. Maximum valid ignore (0) and explicit row-wise scan. 3 of 3 arguments used.
		oParser = new parserFormula('TOCOL({1,2;3,4},0,FALSE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: TOCOL({1,2;3,4},0,FALSE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Array, Number, Boolean. Maximum valid ignore (0) and explicit row-wise scan. 3 of 3 arguments used.');

		// Need to fix: empty handle
		// Case #1: Empty. Missing required array argument, returns #VALUE!.
		// Case #6: Array, Number. Invalid ignore value (4), returns #VALUE!.
		// Case #16: Array, Number. Negative ignore value, returns #VALUE!.
		// Case #18: Reference link. Empty reference, returns #VALUE!.

		// assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
	});

	QUnit.test("Test: \"WRAPROWS\"", function (assert) {
		//1. добавляем общие тесты

		ws.getRange2("A1").setValue("2");
		ws.getRange2("A2").setValue("");
		ws.getRange2("A3").setValue("test");

		ws.getRange2("B1").setValue("test2");
		ws.getRange2("B2").setValue("#N/A");
		ws.getRange2("B3").setValue("");

		oParser = new parserFormula("WRAPROWS(1,A1:B5)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("WRAPROWS(A1:A3,2)", "A1", ws);
		assert.ok(oParser.parse());
		let array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), '');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), '#N/A');

		oParser = new parserFormula("WRAPROWS(A1:A3,2, \"error\")", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), '');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 'error');


		oParser = new parserFormula("WRAPROWS(A1:B3,3)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");



		//2. аргументы - разные типы. нужно пербрать все аргументы
		//2.1 аргумент - number
		oParser = new parserFormula("WRAPROWS(1,3)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.2 аргумент - string
		oParser = new parserFormula("WRAPROWS(\"test\",3)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test");
		//2.3 аргумент - bool
		oParser = new parserFormula("WRAPROWS(true,3)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "TRUE");
		//2.4 аргумент - error
		oParser = new parserFormula("WRAPROWS(#VALUE!,3)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.5 аргумент - empty
		oParser = new parserFormula("WRAPROWS(,2)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.6 аргумент - cellsRange
		//2.7 аргумент - cell
		oParser = new parserFormula("WRAPROWS(B1, 10)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test2");

		//2.8 аргумент - array
		oParser = new parserFormula("WRAPROWS({2;\"\";\"test\"},2)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), '');
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), '#N/A');


		//2.2 аргумент - string
		oParser = new parserFormula("WRAPROWS(1,\"test\")", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.3 аргумент - bool
		oParser = new parserFormula("WRAPROWS(1,true)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.4 аргумент - error
		oParser = new parserFormula("WRAPROWS(1, #VALUE!)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.5 аргумент - empty
		oParser = new parserFormula("WRAPROWS(1,)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#NUM!");


		//2.6 аргумент - cellsRange
		//2.7 аргумент - cell
		oParser = new parserFormula("WRAPROWS(1,A1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("WRAPROWS(1,A1:B5)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		//2.8 аргумент - array
		oParser = new parserFormula("WRAPROWS(1,{2;\"\";\"test\"})", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);


		//2. аргументы - разные типы. нужно пербрать все аргументы
		//2.1 аргумент - number
		oParser = new parserFormula("WRAPROWS(1,3,1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);


		//2.2 аргумент - string
		oParser = new parserFormula("WRAPROWS(1,3,\"test\")", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.3 аргумент - bool
		oParser = new parserFormula("WRAPROWS(1,3,true)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.4 аргумент - error
		oParser = new parserFormula("WRAPROWS(1,3,#VALUE!)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.5 аргумент - empty
		oParser = new parserFormula("WRAPROWS(1,3,)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.6 аргумент - cellsRange
		//2.7 аргумент - cell
		oParser = new parserFormula("WRAPROWS(1,3, B1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.8 аргумент - array
		oParser = new parserFormula("WRAPROWS(1,3, {1,2,3})", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("WRAPROWS(1,3, B1:B2)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("WRAPROWS(1,0)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#NUM!");

		oParser = new parserFormula("WRAPROWS(1,-100)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#NUM!");

		oParser = new parserFormula("WRAPROWS(1,)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#NUM!");

		oParser = new parserFormula("WRAPROWS(1,\"asd\")", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		ws.getRange2("A1:C214").cleanAll();
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("0.5");
		ws.getRange2("A101").setValue("1.5");
		ws.getRange2("A104").setValue("-1");
		// For area
		ws.getRange2("A102").setValue("0.5");
		ws.getRange2("A103").setValue("");
		ws.getRange2("A105").setValue("1");
		ws.getRange2("A110").setValue("TRUE");
		ws.getRange2("A111").setValue("FALSE");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 1);
		ws.getRange2("A601").setValue("1"); // Number (Column1)
		ws.getRange2("B601").setValue("1s"); // Text (Column2)
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2

		// Positive cases:
		// Case #1: Number. Array with 4 elements, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({1,2,3,4},2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({1,2,3,4},2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number. Array with 4 elements, wrap_count=2. 2 arguments used.');
		// Case #2: Reference link. Reference to cell with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(A100,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(A100,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Reference link. Reference to cell with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #3: Area. Single-cell range with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(A101:A101,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(A101:A101,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1.5, 'Test: Positive case: Area. Single-cell range with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #4: Array. Array with 6 elements, wrap_count=3. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({1,2,3,4,5,6},3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({1,2,3,4,5,6},3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array. Array with 6 elements, wrap_count=3. 2 arguments used.');
		// Case #5: Formula. Formula generating vector {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(SEQUENCE(4),2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(SEQUENCE(4),2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula. Formula generating vector {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #6: Number,String. Array with 4 elements, wrap_count=2, string pad. 3 arguments used.
		oParser = new parserFormula('WRAPROWS({1,2,3,4},2,"Pad")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({1,2,3,4},2,"Pad") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number,String. Array with 4 elements, wrap_count=2, string pad. 3 arguments used.');
		// Case #7: Reference link,String. Reference to array {1,2,3,4}, wrap_count=2, string pad. 3 arguments used.
		oParser = new parserFormula('WRAPROWS(A100,2,"Pad")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(A100,2,"Pad") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Reference link,String. Reference to array {1,2,3,4}, wrap_count=2, string pad. 3 arguments used.');
		// Case #8: Area,String. Single-cell range with array, wrap_count=2, string pad. 3 arguments used.
		oParser = new parserFormula('WRAPROWS(A101:A101,2,"Pad")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(A101:A101,2,"Pad") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1.5, 'Test: Positive case: Area,String. Single-cell range with array, wrap_count=2, string pad. 3 arguments used.');
		// Case #9: Formula,Number,Number. Formula generating vector {1,2,3,4,5}, wrap_count=2, number pad. 3 arguments used.
		oParser = new parserFormula('WRAPROWS(SEQUENCE(5),2,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(SEQUENCE(5),2,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula,Number,Number. Formula generating vector {1,2,3,4,5}, wrap_count=2, number pad. 3 arguments used.');
		// Case #10: Date. Date array, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({45658,45659},2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({45658,45659},2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 45658, 'Test: Positive case: Date. Date array, wrap_count=2. 2 arguments used.');
		// Case #11: Time. Time array, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({0.4,0.5},2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({0.4,0.5},2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.4, 'Test: Positive case: Time. Time array, wrap_count=2. 2 arguments used.');
		// Case #12: Name. Named range with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(TestName,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(TestName,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name. Named range with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #13: Name3D. 3D named range with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(TestName3D,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(TestName3D,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name3D. 3D named range with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #14: Ref3D. 3D reference to cell with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(Sheet2!A1,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(Sheet2!A1,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Ref3D. 3D reference to cell with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #15: Area3D. 3D single-cell range with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(Sheet2!A2:A2,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(Sheet2!A2:A2,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 2, 'Test: Positive case: Area3D. 3D single-cell range with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #16: Table. Table column with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(Table1[Column1],2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(Table1[Column1],2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Table. Table column with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #17: Formula. WRAPCOLS inside SUM formula, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('SUM(WRAPROWS({1,2,3,4},2))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SUM(WRAPROWS({1,2,3,4},2)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 10, 'Test: Positive case: Formula. WRAPCOLS inside SUM formula, wrap_count=2. 2 arguments used.');
		// Case #18: String. String array, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({"a","b","c","d"},2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({"a","b","c","d"},2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'a', 'Test: Positive case: String. String array, wrap_count=2. 2 arguments used.');
		// Case #19: Formula. Nested IF returning vector {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(IF(TRUE,SEQUENCE(4),SEQUENCE(2)),2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(IF(TRUE,SEQUENCE(4),SEQUENCE(2)),2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula. Nested IF returning vector {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #20: Array,Number,Formula. Array with 5 elements, wrap_count=2, formula pad. 3 arguments used.
		oParser = new parserFormula('WRAPROWS({1,2,3,4,5},2,SQRT(4))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({1,2,3,4,5},2,SQRT(4)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array,Number,Formula. Array with 5 elements, wrap_count=2, formula pad. 3 arguments used.');
		// Case #21: Reference link,Formula,Number. Reference to array, formula wrap_count, number pad. 3 arguments used.
		oParser = new parserFormula('WRAPROWS(A100,IF(TRUE,2,1),0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(A100,IF(TRUE,2,1),0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Reference link,Formula,Number. Reference to array, formula wrap_count, number pad. 3 arguments used.');
		// Case #22: Number. Array with 3 elements, wrap_count=1. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({1,2,3},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({1,2,3},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number. Array with 3 elements, wrap_count=1. 2 arguments used.');

		// Negative cases:
		// Case #1: Number. wrap_count=0 returns #NUM!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({1,2,3,4},0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({1,2,3,4},0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Number. wrap_count=0 returns #NUM!. 2 arguments used.');
		// Case #2: Number. Negative wrap_count returns #NUM!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({1,2,3,4},-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({1,2,3,4},-1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Number. Negative wrap_count returns #NUM!. 2 arguments used.');
		// Case #3: String. Non-array string vector returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS("abc",2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS("abc",2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'abc', 'Test: Negative case: String. Non-array string vector returns #VALUE!. 2 arguments used.');
		// Case #4: Array,String. String wrap_count returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({1,2,3,4},"2")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({1,2,3,4},"2") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array,String. String wrap_count returns #VALUE!. 2 arguments used.');
		// Case #5: Error. Error vector propagates #N/A. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(NA(),2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(NA(),2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error. Error vector propagates #N/A. 2 arguments used.');
		// Case #6: Area. Multi-cell range returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(A102:A103,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(A102:A103,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Negative case: Area. Multi-cell range returns #VALUE!. 2 arguments used.');
		// Case #7: Empty. Empty reference returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(A104,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(A104,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -1, 'Test: Negative case: Empty. Empty reference returns #VALUE!. 2 arguments used.');
		// Case #8: Boolean. Boolean vector returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(FALSE,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(FALSE,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'FALSE', 'Test: Negative case: Boolean. Boolean vector returns #VALUE!. 2 arguments used.');
		// Case #9: Array,Boolean. Boolean wrap_count returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({1,2,3,4},TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({1,2,3,4},TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array,Boolean. Boolean wrap_count returns #VALUE!. 2 arguments used.');
		// Case #10: Name. Named range with multi-cell area returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(TestNameArea2,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(TestNameArea2,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name. Named range with multi-cell area returns #VALUE!. 2 arguments used.');
		// Case #11: Name3D. 3D named range with multi-cell area returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(TestNameArea3D2,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(TestNameArea3D2,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name3D. 3D named range with multi-cell area returns #VALUE!. 2 arguments used.');
		// Case #12: Ref3D. 3D reference to text returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(Sheet2!A3,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(Sheet2!A3,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'Text', 'Test: Negative case: Ref3D. 3D reference to text returns #VALUE!. 2 arguments used.');
		// Case #13: Area3D. 3D multi-cell range returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(Sheet2!A4:A5,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(Sheet2!A4:A5,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), "", 'Test: Negative case: Area3D. 3D multi-cell range returns #VALUE!. 2 arguments used.');
		// Case #14: Table. Table column with text returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(Table1[Column2],2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(Table1[Column2],2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '1s', 'Test: Negative case: Table. Table column with text returns #VALUE!. 2 arguments used.');
		// Case #15: Formula. Formula resulting in #NUM! returns #NUM!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(SQRT(-1),2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(SQRT(-1),2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula. Formula resulting in #NUM! returns #NUM!. 2 arguments used.');
		// Case #17: Number. Single-element array with wrap_count=0 returns #NUM!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({1},0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({1},0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Number. Single-element array with wrap_count=0 returns #NUM!. 2 arguments used.');
		// Case #18: Reference link,Number,Error. Error pad_with propagates #N/A. 3 arguments used.
		oParser = new parserFormula('WRAPROWS(A100,2,NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(A100,2,NA()) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0.5, 'Test: Negative case: Reference link,Number,Error. Error pad_with propagates #N/A. 3 arguments used.');
		// Case #19: Array,String. Non-numeric wrap_count returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({1,2,3},"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({1,2,3},"abc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array,String. Non-numeric wrap_count returns #VALUE!. 2 arguments used.');
		// Case #20: Array,Number. Boolean array vector returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({TRUE,FALSE},2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({TRUE,FALSE},2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'TRUE', 'Test: Negative case: Array,Number. Boolean array vector returns #VALUE!. 2 arguments used.');

		// Bounded cases:
		// Case #1: Number. Minimum valid wrap_count=1, single-element vector. 2 arguments used.
		oParser = new parserFormula('WRAPROWS({1},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({1},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Number. Minimum valid wrap_count=1, single-element vector. 2 arguments used.');
		// Case #2: Number. Maximum valid vector length (Excel row limit), wrap_count=1048576. 2 arguments used.
		oParser = new parserFormula('WRAPROWS(SEQUENCE(1048576),1048576)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS(SEQUENCE(1048576),1048576) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Number. Maximum valid vector length (Excel row limit), wrap_count=1048576. 2 arguments used.');
		// Case #3: Number. Maximum valid number for pad_with. 3 arguments used.
		oParser = new parserFormula('WRAPROWS({1,2},2,9.99999999999999E+307)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPROWS({1,2},2,9.99999999999999E+307) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Number. Maximum valid number for pad_with. 3 arguments used.');

		// Need to fix:
		// Case #18: Reference link,Number,Error. Error pad_with propagates #N/A. 3 arguments used.

	});

	QUnit.test("Test: \"WRAPCOLS\"", function (assert) {
		//1. добавляем общие тесты

		ws.getRange2("A1").setValue("2");
		ws.getRange2("A2").setValue("");
		ws.getRange2("A3").setValue("test");
		ws.getRange2("A4").setValue("rwe");

		ws.getRange2("B1").setValue("test2");
		ws.getRange2("B2").setValue("#N/A");
		ws.getRange2("B3").setValue("");

		oParser = new parserFormula("WRAPCOLS(1,A1:B5)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("WRAPCOLS(A1:A3,2)", "A1", ws);
		assert.ok(oParser.parse());
		let array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), '');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), '#N/A');

		oParser = new parserFormula("WRAPCOLS(A1:A3,2, \"error\")", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), '');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), 'error');


		oParser = new parserFormula("WRAPCOLS(A1:B3,3)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");



		//2. аргументы - разные типы. нужно пербрать все аргументы
		//2.1 аргумент - number
		oParser = new parserFormula("WRAPCOLS(1,3)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.2 аргумент - string
		oParser = new parserFormula("WRAPCOLS(\"test\",3)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test");
		//2.3 аргумент - bool
		oParser = new parserFormula("WRAPCOLS(true,3)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "TRUE");
		//2.4 аргумент - error
		oParser = new parserFormula("WRAPCOLS(#VALUE!,3)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.5 аргумент - empty
		oParser = new parserFormula("WRAPCOLS(,2)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.6 аргумент - cellsRange
		//2.7 аргумент - cell
		oParser = new parserFormula("WRAPCOLS(B1, 10)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), "test2");

		//2.8 аргумент - array
		oParser = new parserFormula("WRAPCOLS({2;\"\";\"test\"},2)", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();

		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 2);
		assert.strictEqual(array.getElementRowCol(1, 0).getValue(), '');
		assert.strictEqual(array.getElementRowCol(0, 1).getValue(), 'test');
		assert.strictEqual(array.getElementRowCol(1, 1).getValue(), '#N/A');


		//2.2 аргумент - string
		oParser = new parserFormula("WRAPCOLS(1,\"test\")", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.3 аргумент - bool
		oParser = new parserFormula("WRAPCOLS(1,true)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.4 аргумент - error
		oParser = new parserFormula("WRAPCOLS(1, #VALUE!)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.5 аргумент - empty
		oParser = new parserFormula("WRAPCOLS(1,)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#NUM!");


		//2.6 аргумент - cellsRange
		//2.7 аргумент - cell
		oParser = new parserFormula("WRAPCOLS(1,A1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("WRAPCOLS(1,A1:B5)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		//2.8 аргумент - array
		oParser = new parserFormula("WRAPCOLS(1,{2;\"\";\"test\"})", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);


		//2. аргументы - разные типы. нужно пербрать все аргументы
		//2.1 аргумент - number
		oParser = new parserFormula("WRAPCOLS(1,3,1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);


		//2.2 аргумент - string
		oParser = new parserFormula("WRAPCOLS(1,3,\"test\")", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.3 аргумент - bool
		oParser = new parserFormula("WRAPCOLS(1,3,true)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.4 аргумент - error
		oParser = new parserFormula("WRAPCOLS(1,3,#VALUE!)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");
		//2.5 аргумент - empty
		oParser = new parserFormula("WRAPCOLS(1,3,)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.6 аргумент - cellsRange
		//2.7 аргумент - cell
		oParser = new parserFormula("WRAPCOLS(1,3, B1)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);
		//2.8 аргумент - array
		oParser = new parserFormula("WRAPCOLS(1,3, {1,2,3})", "A1", ws);
		assert.ok(oParser.parse());
		array = oParser.calculate();
		assert.strictEqual(array.getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("WRAPCOLS(1,3, B1:B2)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getElementRowCol(0, 0).getValue(), 1);

		oParser = new parserFormula("WRAPCOLS(1,0)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#NUM!");

		oParser = new parserFormula("WRAPCOLS(1,-100)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#NUM!");

		oParser = new parserFormula("WRAPCOLS(1,)", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#NUM!");

		oParser = new parserFormula("WRAPCOLS(1,\"asd\")", "A1", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		ws.getRange2("A1:C214").cleanAll();
		// Data for reference link. Use A100-A111
		ws.getRange2("A100").setValue("0.5");
		ws.getRange2("A101").setValue("1.5");
		ws.getRange2("A104").setValue("-1");
		// For area
		ws.getRange2("A102").setValue("0.5");
		ws.getRange2("A103").setValue("");
		ws.getRange2("A105").setValue("1");
		ws.getRange2("A110").setValue("TRUE");
		ws.getRange2("A111").setValue("FALSE");

		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 1);
		ws.getRange2("A601").setValue("1"); // Number (Column1)
		ws.getRange2("B601").setValue("1s"); // Text (Column2)
		// 3D links. Use A1:Z10
		let ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2


		// Positive cases:
		// Case #1: Number. Array with 4 elements, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({1,2,3,4},2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({1,2,3,4},2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number. Array with 4 elements, wrap_count=2. 2 arguments used.');
		// Case #2: Reference link. Reference to cell with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(A100,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(A100,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Reference link. Reference to cell with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #3: Area. Single-cell range with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(A101:A101,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(A101:A101,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1.5, 'Test: Positive case: Area. Single-cell range with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #4: Array. Array with 6 elements, wrap_count=3. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({1,2,3,4,5,6},3)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({1,2,3,4,5,6},3) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array. Array with 6 elements, wrap_count=3. 2 arguments used.');
		// Case #5: Formula. Formula generating vector {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(SEQUENCE(4),2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(SEQUENCE(4),2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula. Formula generating vector {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #6: Number,String. Array with 4 elements, wrap_count=2, string pad. 3 arguments used.
		oParser = new parserFormula('WRAPCOLS({1,2,3,4},2,"Pad")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({1,2,3,4},2,"Pad") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number,String. Array with 4 elements, wrap_count=2, string pad. 3 arguments used.');
		// Case #7: Reference link,String. Reference to array {1,2,3,4}, wrap_count=2, string pad. 3 arguments used.
		oParser = new parserFormula('WRAPCOLS(A100,2,"Pad")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(A100,2,"Pad") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Reference link,String. Reference to array {1,2,3,4}, wrap_count=2, string pad. 3 arguments used.');
		// Case #8: Area,String. Single-cell range with array, wrap_count=2, string pad. 3 arguments used.
		oParser = new parserFormula('WRAPCOLS(A101:A101,2,"Pad")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(A101:A101,2,"Pad") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1.5, 'Test: Positive case: Area,String. Single-cell range with array, wrap_count=2, string pad. 3 arguments used.');
		// Case #9: Formula,Number,Number. Formula generating vector {1,2,3,4,5}, wrap_count=2, number pad. 3 arguments used.
		oParser = new parserFormula('WRAPCOLS(SEQUENCE(5),2,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(SEQUENCE(5),2,0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula,Number,Number. Formula generating vector {1,2,3,4,5}, wrap_count=2, number pad. 3 arguments used.');
		// Case #10: Date. Date array, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({45658,45659},2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({45658,45659},2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 45658, 'Test: Positive case: Date. Date array, wrap_count=2. 2 arguments used.');
		// Case #11: Time. Time array, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({0.4,0.5},2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({0.4,0.5},2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.4, 'Test: Positive case: Time. Time array, wrap_count=2. 2 arguments used.');
		// Case #12: Name. Named range with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(TestName,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(TestName,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name. Named range with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #13: Name3D. 3D named range with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(TestName3D,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(TestName3D,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -0.5, 'Test: Positive case: Name3D. 3D named range with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #14: Ref3D. 3D reference to cell with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(Sheet2!A1,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(Sheet2!A1,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Ref3D. 3D reference to cell with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #15: Area3D. 3D single-cell range with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(Sheet2!A2:A2,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(Sheet2!A2:A2,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 2, 'Test: Positive case: Area3D. 3D single-cell range with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #16: Table. Table column with array {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(Table1[Column1],2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(Table1[Column1],2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Table. Table column with array {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #17: Formula. WRAPCOLS inside SUM formula, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('SUM(WRAPCOLS({1,2,3,4},2))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: SUM(WRAPCOLS({1,2,3,4},2)) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 10, 'Test: Positive case: Formula. WRAPCOLS inside SUM formula, wrap_count=2. 2 arguments used.');
		// Case #18: String. String array, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({"a","b","c","d"},2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({"a","b","c","d"},2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'a', 'Test: Positive case: String. String array, wrap_count=2. 2 arguments used.');
		// Case #19: Formula. Nested IF returning vector {1,2,3,4}, wrap_count=2. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(IF(TRUE,SEQUENCE(4),SEQUENCE(2)),2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(IF(TRUE,SEQUENCE(4),SEQUENCE(2)),2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Formula. Nested IF returning vector {1,2,3,4}, wrap_count=2. 2 arguments used.');
		// Case #20: Array,Number,Formula. Array with 5 elements, wrap_count=2, formula pad. 3 arguments used.
		oParser = new parserFormula('WRAPCOLS({1,2,3,4,5},2,SQRT(4))', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({1,2,3,4,5},2,SQRT(4)) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Array,Number,Formula. Array with 5 elements, wrap_count=2, formula pad. 3 arguments used.');
		// Case #21: Reference link,Formula,Number. Reference to array, formula wrap_count, number pad. 3 arguments used.
		oParser = new parserFormula('WRAPCOLS(A100,IF(TRUE,2,1),0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(A100,IF(TRUE,2,1),0) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Positive case: Reference link,Formula,Number. Reference to array, formula wrap_count, number pad. 3 arguments used.');
		// Case #22: Number. Array with 3 elements, wrap_count=1. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({1,2,3},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({1,2,3},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Positive case: Number. Array with 3 elements, wrap_count=1. 2 arguments used.');

		// Negative cases:
		// Case #1: Number. wrap_count=0 returns #NUM!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({1,2,3,4},0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({1,2,3,4},0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Number. wrap_count=0 returns #NUM!. 2 arguments used.');
		// Case #2: Number. Negative wrap_count returns #NUM!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({1,2,3,4},-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({1,2,3,4},-1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Number. Negative wrap_count returns #NUM!. 2 arguments used.');
		// Case #3: String. Non-array string vector returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS("abc",2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS("abc",2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'abc', 'Test: Negative case: String. Non-array string vector returns #VALUE!. 2 arguments used.');
		// Case #4: Array,String. String wrap_count returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({1,2,3,4},"2")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({1,2,3,4},"2") is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0)	.getValue(), 1, 'Test: Negative case: Array,String. String wrap_count returns #VALUE!. 2 arguments used.');
		// Case #5: Error. Error vector propagates #N/A. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(NA(),2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(NA(),2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error. Error vector propagates #N/A. 2 arguments used.');
		// Case #6: Area. Multi-cell range returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(A102:A103,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(A102:A103,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.5, 'Test: Negative case: Area. Multi-cell range returns #VALUE!. 2 arguments used.');
		// Case #7: Empty. Empty reference returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(A104,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(A104,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), -1, 'Test: Negative case: Empty. Empty reference returns #VALUE!. 2 arguments used.');
		// Case #8: Boolean. Boolean vector returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(FALSE,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(FALSE,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'FALSE', 'Test: Negative case: Boolean. Boolean vector returns #VALUE!. 2 arguments used.');
		// Case #9: Array,Boolean. Boolean wrap_count returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({1,2,3,4},TRUE)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({1,2,3,4},TRUE) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Negative case: Array,Boolean. Boolean wrap_count returns #VALUE!. 2 arguments used.');
		// Case #10: Name. Named range with multi-cell area returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(TestNameArea2,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(TestNameArea2,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name. Named range with multi-cell area returns #VALUE!. 2 arguments used.');
		// Case #11: Name3D. 3D named range with multi-cell area returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(TestNameArea3D2,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(TestNameArea3D2,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 0.8, 'Test: Negative case: Name3D. 3D named range with multi-cell area returns #VALUE!. 2 arguments used.');
		// Case #12: Ref3D. 3D reference to text returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(Sheet2!A3,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(Sheet2!A3,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'Text', 'Test: Negative case: Ref3D. 3D reference to text returns #VALUE!. 2 arguments used.');
		// Case #13: Area3D. 3D multi-cell range returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(Sheet2!A4:A5,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(Sheet2!A4:A5,2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), "", 'Test: Negative case: Area3D. 3D multi-cell range returns #VALUE!. 2 arguments used.');
		// Case #14: Table. Table column with text returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(Table1[Column2],2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(Table1[Column2],2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), '1s', 'Test: Negative case: Table. Table column with text returns #VALUE!. 2 arguments used.');
		// Case #15: Formula. Formula resulting in #NUM! returns #NUM!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(SQRT(-1),2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(SQRT(-1),2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula. Formula resulting in #NUM! returns #NUM!. 2 arguments used.');
		// Case #17: Number. Single-element array with wrap_count=0 returns #NUM!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({1},0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({1},0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Number. Single-element array with wrap_count=0 returns #NUM!. 2 arguments used.');
		// Case #18: Reference link,Number,Error. Error pad_with propagates #N/A. 3 arguments used.
		oParser = new parserFormula('WRAPCOLS(A100,2,NA())', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(A100,2,NA()) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 0.5, 'Test: Negative case: Reference link,Number,Error. Error pad_with propagates #N/A. 3 arguments used.');
		// Case #19: Array,String. Non-numeric wrap_count returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({1,2,3},"abc")', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({1,2,3},"abc") is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Array,String. Non-numeric wrap_count returns #VALUE!. 2 arguments used.');
		// Case #20: Array,Number. Boolean array vector returns #VALUE!. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({TRUE,FALSE},2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({TRUE,FALSE},2) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 'TRUE', 'Test: Negative case: Array,Number. Boolean array vector returns #VALUE!. 2 arguments used.');

		// Bounded cases:
		// Case #1: Number. Minimum valid wrap_count=1, single-element vector. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS({1},1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({1},1) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Number. Minimum valid wrap_count=1, single-element vector. 2 arguments used.');
		// Case #2: Number. Maximum valid vector length (Excel row limit), wrap_count=1048576. 2 arguments used.
		oParser = new parserFormula('WRAPCOLS(SEQUENCE(1048576),1048576)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS(SEQUENCE(1048576),1048576) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Bounded case: Number. Maximum valid vector length (Excel row limit), wrap_count=1048576. 2 arguments used.');
		// Case #3: Number. Maximum valid number for pad_with. 3 arguments used.
		oParser = new parserFormula('WRAPCOLS({1,2},2,9.99999999999999E+307)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: WRAPCOLS({1,2},2,9.99999999999999E+307) is parsed.');
		assert.strictEqual(oParser.calculate().getElementRowCol(0,0).getValue(), 1, 'Test: Bounded case: Number. Maximum valid number for pad_with. 3 arguments used.');


		// TODO remove critical error in Case #2: Number. Maximum valid vector length
		// Need to fix: error handle
		// Case #18: Reference link,Number,Error. Error pad_with propagates #N/A. 3 arguments used.
		// Case #2: Number. Maximum valid vector length (Excel row limit), wrap_count=1048576. 2 arguments used. - critical

	});

    	QUnit.test("Test: \"XMATCH\"", function (assert) {
		let array;

		ws.getRange2("B101").setValue();
		ws.getRange2("B102").setValue();
		ws.getRange2("B103").setValue();
		ws.getRange2("B101:B103").cleanAll();

		oParser = new parserFormula("XMATCH(B101,B102,2,-2)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,2,-2)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of XMATCH(B101,B102,2,-2)");

		oParser = new parserFormula("XMATCH(B101,B102,2,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,2,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,2,-1)");

		oParser = new parserFormula("XMATCH(B101,B102,2,0)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,2,0)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of XMATCH(B101,B102,2,0)");

		oParser = new parserFormula("XMATCH(B101,B102,2,1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,2,1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,2,1)");

		oParser = new parserFormula("XMATCH(B101,B102,2,2)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,2,2)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of XMATCH(B101,B102,2,2)");

		
		oParser = new parserFormula("XMATCH(B101,B102,1,-2)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,1,-2)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,1,-2)");

		oParser = new parserFormula("XMATCH(B101,B102,1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,1,-1)");

		oParser = new parserFormula("XMATCH(B101,B102,1,0)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,1,0)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of XMATCH(B101,B102,1,0)");

		oParser = new parserFormula("XMATCH(B101,B102,1,1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,1,1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,1,1)");

		oParser = new parserFormula("XMATCH(B101,B102,1,2)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,1,2)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,1,2)");


		oParser = new parserFormula("XMATCH(B101,B102,0,-2)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,0,-2)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,0,-2)");

		oParser = new parserFormula("XMATCH(B101,B102,0,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,0,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,0,-1)");

		oParser = new parserFormula("XMATCH(B101,B102,0,0)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,0,0)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of XMATCH(B101,B102,0,0)");

		oParser = new parserFormula("XMATCH(B101,B102,0,1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,0,1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,0,1)");

		oParser = new parserFormula("XMATCH(B101,B102,0,2)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,0,2)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,0,2)");


		oParser = new parserFormula("XMATCH(B101,B102,-1,-2)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,-1,-2)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,-1,-2)");

		oParser = new parserFormula("XMATCH(B101,B102,-1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,-1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,-1,-1)");

		oParser = new parserFormula("XMATCH(B101,B102,-1,0)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,-1,0)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of XMATCH(B101,B102,-1,0)");

		oParser = new parserFormula("XMATCH(B101,B102,-1,1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,-1,1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,-1,1)");

		oParser = new parserFormula("XMATCH(B101,B102,-1,2)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,-1,2)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,-1,2)");


		oParser = new parserFormula("XMATCH(3,{3,2,21,1,1,2,3},0,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(3,{3,2,21,1,1,2,3},0,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 7, "Result of XMATCH(3,{3,2,21,1,1,2,3},0,-1)");

		oParser = new parserFormula("XMATCH(3,{3,2,21,1,1,2,3},0,1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(3,{3,2,21,1,1,2,3},0,1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(3,{3,2,21,1,1,2,3},0,1)");

		oParser = new parserFormula("XMATCH(1,{3,2,21,1,21,2,3},0,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(1,{3,2,21,1,21,2,3},0,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(1,{3,2,21,1,21,2,3},0,-1)");

		oParser = new parserFormula("XMATCH(1,{3,2,21,1,21,2,3},0,1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(1,{3,2,21,1,21,2,3},0,1)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(1,{3,2,21,1,21,2,3},0,1)");

		oParser = new parserFormula("XMATCH(1,{1,1,1,1},0,1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(1,{1,1,1,1},0,1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(1,{1,1,1,1},0,1)");

		oParser = new parserFormula("XMATCH(1,{1,1,1,1},0,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(1,{1,1,1,1},0,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(1,{1,1,1,1},0,-1)");

		oParser = new parserFormula("XMATCH(1,{1},0,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(1,{1},0,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(1,{1},0,-1)");

		oParser = new parserFormula("XMATCH(1,{2},-1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(1,{2},-1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(1,{2},-1,-1)");

		oParser = new parserFormula("XMATCH(1,{2},1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(1,{2},1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(1,{2},1,-1)");

		oParser = new parserFormula("XMATCH(1,{2,2,2,2,2,2},-1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(1,{2,2,2,2,2,2},-1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(1,{2,2,2,2,2,2},-1,-1)");

		oParser = new parserFormula("XMATCH(1,{2,2,2,2,2,2},1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(1,{2,2,2,2,2,2},1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 6, "Result of XMATCH(1,{2,2,2,2,2,2},1,-1)");

		oParser = new parserFormula("XMATCH(1,{3,3,3,3,2,3},1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(1,{3,3,3,3,2,3},1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 5, "Result of XMATCH(1,{3,3,3,3,2,3},1,-1)");

		oParser = new parserFormula("XMATCH(1,{3,3,3,3,2,3},1,1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(1,{3,3,3,3,2,3},1,1)");
		assert.strictEqual(oParser.calculate().getValue(), 5, "Result of XMATCH(1,{3,3,3,3,2,3},1,1)");

		oParser = new parserFormula("XMATCH(1,{2,2,2,2,2,2},1,1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(1,{2,2,2,2,2,2},1,1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(1,{2,2,2,2,2,2},1,1)");

		oParser = new parserFormula("XMATCH(1,{2,2,2,1,2,2},2,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(1,{2,2,2,1,2,2},2,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(1,{2,2,2,1,2,2},2,-1)");

		oParser = new parserFormula('XMATCH(1,{3,3,"str",3,"22s",3},1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(1,{3,3,"str",3,"22s",3},1,-1)');
		assert.strictEqual(oParser.calculate().getValue(), 6, 'Result of XMATCH(1,{3,3,"str",3,"22s",3},1,-1)');

		oParser = new parserFormula('XMATCH(1,{3,3,"str",3,"22s",3},1,1)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(1,{3,3,"str",3,"22s",3},1,1)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of XMATCH(1,{3,3,"str",3,"22s",3},1,1)');

		oParser = new parserFormula('XMATCH(1,{3,3,"str",3,"22s",3},-1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(1,{3,3,"str",3,"22s",3},-1,-1)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of XMATCH(1,{3,3,"str",3,"22s",3},-1,-1)');

		oParser = new parserFormula('XMATCH("apple",{"banana","grape","lemon","watermelon"},1,1)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH("apple",{"banana","grape","lemon","watermelon"},1,1)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of XMATCH("apple",{"banana","grape","lemon","watermelon"},1,1)');

		oParser = new parserFormula('XMATCH("apple",{"banana","grape","lemon","watermelon","app"},-1,1)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH("apple",{"banana","grape","lemon","watermelon","app"},-1,1)');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of XMATCH("apple",{"banana","grape","lemon","watermelon","app"},-1,1)');

		oParser = new parserFormula('XMATCH("apple",{"banana","grape","apple1","apple2","apple1","app","apple2","aple3"},1,1)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH("apple",{"banana","grape","apple1","apple2","apple1","app","apple2","aple3"},1,1)');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Result of XMATCH("apple",{"banana","grape","apple1","apple2","apple1","app","apple2","aple3"},1,1)');

		oParser = new parserFormula('XMATCH("apple",{"banana","grape","apple1","apple2","apple1","app","apple2","aple3"},1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH("apple",{"banana","grape","apple1","apple2","apple1","app","apple2","aple3"},1,-1)');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of XMATCH("apple",{"banana","grape","apple1","apple2","apple1","app","apple2","aple3"},1,-1)');

		oParser = new parserFormula('XMATCH(TRUE,{1,3,-1,2,"str","TRUE","FALSE","app"},-1)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(TRUE,{1,3,-1,2,"str","TRUE","FALSE","app"},-1)');

		// ??? js: "str" > "TRUE", ms: "str" < "TRUE"
		oParser = new parserFormula('XMATCH(FALSE,{1,3,-1,2,"str","TRUE","FALSE","app"},-1)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(FALSE,{1,3,-1,2,"str","TRUE","FALSE","app"},-1)');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of XMATCH(FALSE,{1,3,-1,2,"str","TRUE","FALSE","app"},-1)');	// 6

		// ??? js: "str" > "ZZZ", ms: "str" < "ZZZ"
		oParser = new parserFormula('XMATCH(FALSE,{"ZZZ",3,-1,2,"str","TRUE","FALSE","app"},-1)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(FALSE,{"ZZZ",3,-1,2,"str","TRUE","FALSE","app"},-1)');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of XMATCH(FALSE,{"ZZZ",3,-1,2,"str","TRUE","FALSE","app"},-1)');	// 1

		oParser = new parserFormula('XMATCH(FALSE,{"zzz",3,-1,2,"str","TRUE","FALSE","app","zzz"},-1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(FALSE,{"zzz",3,-1,2,"str","TRUE","FALSE","app","zzz"},-1,-1)');
		assert.strictEqual(oParser.calculate().getValue(), 9, 'Result of XMATCH(FALSE,{"zzz",3,-1,2,"str","TRUE","FALSE","app","zzz"},-1,-1)');

		oParser = new parserFormula('XMATCH(FALSE,{"ZZZ",3,-1,2,"str","TRUE","FALSE","app"},1)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(FALSE,{"ZZZ",3,-1,2,"str","TRUE","FALSE","app"},1)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of XMATCH(FALSE,{"ZZZ",3,-1,2,"str","TRUE","FALSE","app"},1)');

		oParser = new parserFormula('XMATCH(1,{2,2,2,1,2,2,2},0,2)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(1,{2,2,2,1,2,2,2},0,2)');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Result of XMATCH(1,{2,2,2,1,2,2,2},0,2)');

		oParser = new parserFormula('XMATCH(1,{2,2,2,1,2,2},0,2)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(1,{2,2,2,1,2,2},0,2)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of XMATCH(1,{2,2,2,1,2,2},0,2)');

		oParser = new parserFormula('XMATCH(1,{2,2,2,1,2,2},1,2)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(1,{2,2,2,1,2,2},1,2)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of XMATCH(1,{2,2,2,1,2,2},1,2)');

		oParser = new parserFormula('XMATCH(1,{2,2,2,1,2,2},-1,2)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(1,{2,2,2,1,2,2},-1,2)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of XMATCH(1,{2,2,2,1,2,2},-1,2)');

		oParser = new parserFormula('XMATCH(1,{2,2,2,1,2,2},0,-2)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(1,{2,2,2,1,2,2},0,-2)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of XMATCH(1,{2,2,2,1,2,2},0,-2)');

		oParser = new parserFormula('XMATCH(1,{2,2,2,1,2,2},1,-2)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(1,{2,2,2,1,2,2},1,-2)');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of XMATCH(1,{2,2,2,1,2,2},1,-2)');	// 6

		oParser = new parserFormula('XMATCH(1,{2,2,2,1,2,2},-1,-2)', "A2", ws);
		assert.ok(oParser.parse(), 'XMATCH(1,{2,2,2,1,2,2},-1,-2)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of XMATCH(1,{2,2,2,1,2,2},-1,-2)');


		oParser = new parserFormula("XMATCH(,,-2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		oParser = new parserFormula("XMATCH(,,-1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		oParser = new parserFormula("XMATCH(,,0)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		oParser = new parserFormula("XMATCH(,,1)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		oParser = new parserFormula("XMATCH(,,2)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		oParser = new parserFormula("XMATCH(,,3)", "A2", ws);
		assert.ok(oParser.parse());
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!");

		oParser = new parserFormula("XMATCH(B101,B102)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102)");

		oParser = new parserFormula("XMATCH(B101,B102,-2)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,-2)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of XMATCH(B101,B102,-2)");

		oParser = new parserFormula("XMATCH(B101,B102,-1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,-1)");

		oParser = new parserFormula("XMATCH(B101,B102,0)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,0)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,0)");

		oParser = new parserFormula("XMATCH(B101,B102,1)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,1)");

		oParser = new parserFormula("XMATCH(B101,B102,2)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,2)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,2)");

		oParser = new parserFormula("XMATCH(B101,B102,2)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,2)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,B102,2)");

		oParser = new parserFormula("XMATCH(B101,B102,3)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(B101,B102,3)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of XMATCH(B101,B102,3)");

		oParser = new parserFormula("XMATCH(#DIV/0!,#NUM!)", "A2", ws);
		assert.ok(oParser.parse(), "XMATCH(#DIV/0!,#NUM!)");
		assert.strictEqual(oParser.calculate().getValue(), "#DIV/0!", "Result of XMATCH(#DIV/0!,#NUM!)");


		// ---------------------- arrays of numbers ---------------------- //
		ws.getRange2("B50").setValue("9");
		ws.getRange2("B51").setValue("12");
		ws.getRange2("B52").setValue("11");
		ws.getRange2("B53").setValue("9");
		ws.getRange2("B54").setValue("9");
		ws.getRange2("B55").setValue("12");
		ws.getRange2("B56").setValue("7");
		ws.getRange2("B57").setValue("9");
		ws.getRange2("B58").setValue("12");
		ws.getRange2("B59").setValue("9");

		oParser = new parserFormula("XMATCH(2,B50:B59)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(2,B50:B59)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(2,B50:B59)");

		oParser = new parserFormula("XMATCH(\"12\",B50:B59)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH('12',B50:B59)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH('12',B50:B59)");

		oParser = new parserFormula("XMATCH(9,B50:B59)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(9,B50:B59)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(9,B50:B59)");
		
		oParser = new parserFormula("XMATCH(9,B50:B59,0,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(9,B50:B59)");
		assert.strictEqual(oParser.calculate().getValue(), 10, "Result of XMATCH(9,B50:B59,0,-1)");

		oParser = new parserFormula("XMATCH(10,B50:B59,1,1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,B50:B59,1,1)");
		assert.strictEqual(oParser.calculate().getValue(), 3, "Result of XMATCH(10,B50:B59,1,1)");

		oParser = new parserFormula("XMATCH(10,B50:B59,-1,1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,B50:B59,-1,1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(10,B50:B59,-1,1)");

		oParser = new parserFormula("XMATCH(9,B50:B59,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(9,B50:B59,2)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(9,B50:B59,2)");

		oParser = new parserFormula("XMATCH(10,B50:B59,-1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,B50:B59,-1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 10, "Result of XMATCH(10,B50:B59,-1,-1)");

		oParser = new parserFormula("XMATCH(10,B50:B59,0,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,B50:B59,0,2)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(10,B50:B59,0,2)");

		oParser = new parserFormula("XMATCH(10,B50:B59,1,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,B50:B59,1,2)");
		assert.strictEqual(oParser.calculate().getValue(), 9, "Result of XMATCH(10,B50:B59,1,2)");

		oParser = new parserFormula("XMATCH(10,B50:B59,-1,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,B50:B59,-1,2)");
		assert.strictEqual(oParser.calculate().getValue(), 8, "Result of XMATCH(10,B50:B59,-1,2)");

		oParser = new parserFormula("XMATCH(10,B50:B59,0,-2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,B50:B59,0,-2)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(10,B50:B59,0,-2)");

		// TODO excel выдает другой результат (3)
		oParser = new parserFormula("XMATCH(10,B50:B59,1,-2)", "A2", ws); 
		assert.ok(oParser.parse(), "Call: XMATCH(10,B50:B59,1,-2)");
		assert.strictEqual(oParser.calculate().getValue(), 2, "Result of XMATCH(10,B50:B59,1,-2)");

		oParser = new parserFormula("XMATCH(10,B50:B59,-1,-2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,B50:B59,-1,-2)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(10,B50:B59,-1,-2)");

		oParser = new parserFormula("XMATCH(10,B50:B59,2,-2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,B50:B59,2,-2)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of XMATCH(10,B50:B59,2,-2)");

		// sort by asc
		ws.getRange2("C50").setValue("1");
		ws.getRange2("C51").setValue("2");
		ws.getRange2("C52").setValue("2");
		ws.getRange2("C53").setValue("2");
		ws.getRange2("C54").setValue("3");
		ws.getRange2("C55").setValue("5");
		ws.getRange2("C56").setValue("6");
		ws.getRange2("C57").setValue("7");
		ws.getRange2("C58").setValue("9");
		ws.getRange2("C59").setValue("11");

		// sort by desc
		ws.getRange2("D50").setValue("11");
		ws.getRange2("D51").setValue("9");
		ws.getRange2("D52").setValue("7");
		ws.getRange2("D53").setValue("6");
		ws.getRange2("D54").setValue("5");
		ws.getRange2("D55").setValue("4");
		ws.getRange2("D56").setValue("2");
		ws.getRange2("D57").setValue("2");
		ws.getRange2("D58").setValue("2");
		ws.getRange2("D59").setValue("1");

		// binary search tests
		oParser = new parserFormula("XMATCH(1,C50:C59,0,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(1,C50:C59,0,2)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(1,C50:C59,0,2)");

		oParser = new parserFormula("XMATCH(3,C50:C59,0,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(3,C50:C59,0,2)");
		assert.strictEqual(oParser.calculate().getValue(), 5, "Result of XMATCH(3,C50:C59,0,2)");

		// TODO ms выдает другой результат (6)
		oParser = new parserFormula("XMATCH(4,C50:C59,1,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(4,C50:C59,1,2)");
		assert.strictEqual(oParser.calculate().getValue(), 8, "Result of XMATCH(4,C50:C59,1,2)");

		// TODO ms выдает другой результат (5)
		oParser = new parserFormula("XMATCH(4,C50:C59,-1,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(4,C50:C59,-1,2)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(4,C50:C59,-1,2)");

		oParser = new parserFormula("XMATCH(3,C50:C59,0,-2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(3,C50:C59,0,-2)");
		assert.strictEqual(oParser.calculate().getValue(), 5, "Result of XMATCH(3,C50:C59,0,-2)");

		oParser = new parserFormula("XMATCH(-4,C50:C59,1,-2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(-4,C50:C59,1,-2)");
		assert.strictEqual(oParser.calculate().getValue(), 8, "Result of XMATCH(-4,C50:C59,1,-2)");

		// TODO ms выдает другой результат (1)
		oParser = new parserFormula("XMATCH(4,C50:C59,-1,-2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(4,C50:C59,-1,-2)");
		assert.strictEqual(oParser.calculate().getValue(), 2, "Result of XMATCH(4,C50:C59,-1,-2)");

		// ---------------------- arrays of strings ---------------------- //
		ws.getRange2("E50").setValue("idas");
		ws.getRange2("E51").setValue("zxc");
		ws.getRange2("E52").setValue("f");
		ws.getRange2("E53").setValue("_d");
		ws.getRange2("E54").setValue("edasd");
		ws.getRange2("E55").setValue("SiM`Gl23");
		ws.getRange2("E56").setValue("g");
		ws.getRange2("E57").setValue("bbbbbbbb");
		ws.getRange2("E58").setValue("SDY");
		ws.getRange2("E59").setValue("1d23dd");

		ws.getRange2("E60").setValue("b");

		oParser = new parserFormula("XMATCH(i,E50:E59)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(i,E50:E59)");
		assert.strictEqual(oParser.calculate().getValue(), "#NAME?", "Result of XMATCH(i,E50:E59)");

		oParser = new parserFormula("XMATCH(E52,E50:E59)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(E52,E50:E59)");
		assert.strictEqual(oParser.calculate().getValue(), 3, "Result of XMATCH(E52,E50:E59)");

		oParser = new parserFormula("XMATCH(E60,E50:E59, 1, 1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(E60,E50:E59, 1, 1)");
		assert.strictEqual(oParser.calculate().getValue(), 8, "Result of XMATCH(E60,E50:E59, 1, 1)");

		// TODO ms и js выдают разные результаты при подобных сравнениях строк. К примеру "_d" считается меньше чем "1d23dd" тогда как у нас в редакторе по-другому(как в js)
		oParser = new parserFormula("XMATCH(E60,E50:E59,-1,1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(E60,E50:E59,-1,1)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(E60,E50:E59,-1,1)");		// 10

		oParser = new parserFormula("XMATCH(E60,E50:E59,1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(E60,E50:E59,1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 8, "Result of XMATCH(E60,E50:E59,1,-1)");

		oParser = new parserFormula("XMATCH(E60,E50:E59,-1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(E60,E50:E59,-1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(E60,E50:E59,-1,-1)");		// 10

		oParser = new parserFormula("XMATCH(E60,E50:E59,1,1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(E60,E50:E59,1,1)");
		assert.strictEqual(oParser.calculate().getValue(), 8, "Result of XMATCH(E60,E50:E59,1,1)");

		oParser = new parserFormula("XMATCH(B101,E50:E59,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E50:E59,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 2, "Result of XMATCH(B101,E50:E59,-1)");	

		oParser = new parserFormula("XMATCH(B101,E50:E59,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E50:E59,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 2, "Result of XMATCH(B101,E50:E59,-1)")

		oParser = new parserFormula("XMATCH(B101,E50:E59,0)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E50:E59,0)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(B101,E50:E59,0)");

		oParser = new parserFormula("XMATCH(B101,E50:E59,1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E50:E59,1)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(B101,E50:E59,1)");

		oParser = new parserFormula('XMATCH(12,{13,"b",92,#NUM!,13},1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH(12,{13,"b",92,#NUM!,13},1)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of XMATCH(12,{13,"b",92,#NUM!,13},1)');

		oParser = new parserFormula('XMATCH(12,{13,"b",92,#NUM!,13},1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH(12,{13,"b",92,#NUM!,13},1,-1)');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of XMATCH(12,{13,"b",92,#NUM!,13},1,-1)');

		oParser = new parserFormula('XMATCH(13,{12,"b",-92,#NUM!,12},-1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH(13,{12,"b",-92,#NUM!,12},-1)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of XMATCH(13,{12,"b",-92,#NUM!,12},-1)');

		oParser = new parserFormula('XMATCH(13,{12,"b",-92,#NUM!,12},-1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH(13,{12,"b",-92,#NUM!,12},-1,-1)');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of XMATCH(13,{12,"b",-92,#NUM!,12},-1,-1)');

		oParser = new parserFormula('XMATCH(1,{"a","b",-2,-2,-2,"a"},1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH(1,{"a","b",-2,-2,-2,"a"},1)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of XMATCH(1,{"a","b",-2,-2,-2,"a"},1)');

		oParser = new parserFormula('XMATCH(1,{"a","b",-2,-2,-2,"a"},1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH(1,{"a","b",-2,-2,-2,"a"},1,-1)');
		assert.strictEqual(oParser.calculate().getValue(), 6, 'Result of XMATCH(1,{"a","b",-2,-2,-2,"a"},1,-1)');

		oParser = new parserFormula('XMATCH(1,{"a","b",2,2,TRUE,"c"},-1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH(1,{"a","b",2,2,TRUE,"c"},-1)');
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", 'Result of XMATCH(1,{"a","b",2,2,TRUE,"c"},-1)');

		oParser = new parserFormula('XMATCH("a",{"z","b",-2,-2,TRUE,"z"},-1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH("a",{"z","b",-2,-2,TRUE,"z"},-1)');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Result of XMATCH("a",{"z","b",-2,-2,TRUE,"z"},-1)');

		oParser = new parserFormula('XMATCH("a",{"z","b",-2,-2,TRUE,"z"},-1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH("a",{"z","b",-2,-2,TRUE,"z"},-1,-1)');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Result of XMATCH("a",{"z","b",-2,-2,TRUE,"z"},-1,-1)');

		oParser = new parserFormula('XMATCH("z",{"a","b",FALSE,FALSE,TRUE,"a"},1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH("z",{"a","b",FALSE,FALSE,TRUE,"a"},1)');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Result of XMATCH("z",{"a","b",FALSE,FALSE,TRUE,"a"},1)');

		oParser = new parserFormula('XMATCH("z",{"a","b",FALSE,FALSE,TRUE,"a"},1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH("z",{"a","b",FALSE,FALSE,TRUE,"a"},1,-1)');
		assert.strictEqual(oParser.calculate().getValue(), 4, 'Result of XMATCH("z",{"a","b",FALSE,FALSE,TRUE,"a"},1,-1)');

		oParser = new parserFormula('XMATCH(FALSE,{"z","b",92,#NUM!,"z"},-1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH(FALSE,{"z","b",92,#NUM!,"z"},-1)');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Result of XMATCH(FALSE,{"z","b",92,#NUM!,"z"},-1)');

		oParser = new parserFormula('XMATCH(FALSE,{"z","b",92,#NUM!,"z"},-1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH(FALSE,{"z","b",92,#NUM!,"z"},-1,-1)');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of XMATCH(FALSE,{"z","b",92,#NUM!,"z"},-1,-1)');

		oParser = new parserFormula('XMATCH(FALSE,{"z","b",92,#NUM!,TRUE,"z"},1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH(FALSE,{"z","b",92,#NUM!,TRUE,"z"},1)');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of XMATCH(FALSE,{"z","b",92,#NUM!,TRUE,"z"},1)');

		oParser = new parserFormula('XMATCH(TRUE,{"z","b",#VALUE!,92,#NUM!,FALSE,"z"},1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH(TRUE,{"z","b",#VALUE!,92,#NUM!,FALSE,"z"},1)');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Result of XMATCH(TRUE,{"z","b",#VALUE!,92,#NUM!,FALSE,"z"},1)');

		oParser = new parserFormula('XMATCH(TRUE,{"z","b",#VALUE!,92,#NUM!,FALSE,"z"},1,-1)', "A2", ws);
		assert.ok(oParser.parse(), 'Call: XMATCH(TRUE,{"z","b",#VALUE!,92,#NUM!,FALSE,"z"},1,-1)');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Result of XMATCH(TRUE,{"z","b",#VALUE!,92,#NUM!,FALSE,"z"},1,-1)');

		// numbers, strings, booleans and errors
		ws.getRange2("E101").setValue("TRUE");
		ws.getRange2("E102").setValue("z");
		ws.getRange2("E103").setValue("b");
		ws.getRange2("E104").setValue("#VALUE!");
		ws.getRange2("E105").setValue("2");
		ws.getRange2("E106").setValue("FALSE");
		ws.getRange2("E107").setValue("#NUM!");

		oParser = new parserFormula("XMATCH(B101,E101:E107,1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E101:E107,1)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(B101,E101:E107,1)");

		oParser = new parserFormula("XMATCH(B101,E101:E107,0)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E101:E107,0)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(B101,E101:E107,0)");

		oParser = new parserFormula("XMATCH(B101,E101:E107,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E101:E107,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(B101,E101:E107,-1)");

		oParser = new parserFormula("XMATCH(B101,E101:E107,-1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E101:E107,-1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(B101,E101:E107,-1,-1)");

		// numbers, strings, booleans
		ws.getRange2("E111").setValue("TRUE");
		ws.getRange2("E112").setValue("z");
		ws.getRange2("E113").setValue("a");
		ws.getRange2("E114").setValue("99");
		ws.getRange2("E115").setValue("2");
		ws.getRange2("E116").setValue("FALSE");
		ws.getRange2("E117").setValue("TRUE");

		oParser = new parserFormula("XMATCH(B101,E111:E111,1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E111:E117,1)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(B101,E111:E117,1)");

		oParser = new parserFormula("XMATCH(B101,E111:E117,0)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E111:E117,0)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(B101,E111:E117,0)");

		oParser = new parserFormula("XMATCH(B101,E111:E117,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E111:E117,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,E111:E117,-1)");

		oParser = new parserFormula("XMATCH(B101,E111:E117,-1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E111:E117,-1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 7, "Result of XMATCH(B101,E111:E117,-1,-1)");

		// numbers, strings
		ws.getRange2("E121").setValue("x");
		ws.getRange2("E122").setValue("z");
		ws.getRange2("E123").setValue("a");
		ws.getRange2("E124").setValue("99");
		ws.getRange2("E125").setValue("2");
		ws.getRange2("E126").setValue("-98908");
		ws.getRange2("E127").setValue("z");

		oParser = new parserFormula("XMATCH(B101,E121:E127,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E121:E127,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 2, "Result of XMATCH(B101,E121:E127,-1)");

		oParser = new parserFormula("XMATCH(B101,E121:E127,-1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E121:E127,-1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 7, "Result of XMATCH(B101,E121:E127,-1,-1)");

		// numbers
		ws.getRange2("E131").setValue("99");
		ws.getRange2("E132").setValue("12");
		ws.getRange2("E133").setValue("-123");
		ws.getRange2("E134").setValue("13");
		ws.getRange2("E135").setValue("99");
		ws.getRange2("E136").setValue("-98908");
		ws.getRange2("E137").setValue("0");

		oParser = new parserFormula("XMATCH(B101,E131:E137,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E131:E137,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(B101,E131:E137,-1)");

		oParser = new parserFormula("XMATCH(B101,E131:E137,-1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(B101,E131:E137,-1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 5, "Result of XMATCH(B101,E131:E137,-1,-1)");

		// sort by asc
		ws.getRange2("F50").setValue("a");
		ws.getRange2("F51").setValue("b");
		ws.getRange2("F52").setValue("c");
		ws.getRange2("F53").setValue("d");
		ws.getRange2("F54").setValue("e");
		ws.getRange2("F55").setValue("f");
		ws.getRange2("F56").setValue("g");
		ws.getRange2("F57").setValue("h");
		ws.getRange2("F58").setValue("i");
		ws.getRange2("F59").setValue("j");

		// sort by desc
		ws.getRange2("G50").setValue("j");
		ws.getRange2("G51").setValue("i");
		ws.getRange2("G52").setValue("h");
		ws.getRange2("G53").setValue("g");
		ws.getRange2("G54").setValue("f");
		ws.getRange2("G55").setValue("e");
		ws.getRange2("G56").setValue("d");
		ws.getRange2("G57").setValue("c");
		ws.getRange2("G58").setValue("b");
		ws.getRange2("G59").setValue("a");

		ws.getRange2("H50").setValue("Apple");
		ws.getRange2("H51").setValue("Grape");
		ws.getRange2("H52").setValue("Banana");
		ws.getRange2("H53").setValue("Orange");
		ws.getRange2("H54").setValue("Lemon");
		ws.getRange2("H55").setValue("Cherry");
		ws.getRange2("H55").setValue("Zucchini");
		ws.getRange2("H56").setValue("Grape");

		ws.getRange2("H57").setValue("*n*");
		ws.getRange2("H58").setValue("Grap?");
		ws.getRange2("H59").setValue("*a*");
		ws.getRange2("H60").setValue("*");
		ws.getRange2("H61").setValue("?");

		oParser = new parserFormula("XMATCH(H59,H50:H56, 2, 1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(*a*,H50:H56, 2, 1)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(*a*,H50:H56, 2, 1)");

		oParser = new parserFormula("XMATCH(H59,H50:H56, 2, -1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(*a*,H50:H56, 2, -1)");
		assert.strictEqual(oParser.calculate().getValue(), 7, "Result of XMATCH(*a*,H50:H56, 2, -1)");

		oParser = new parserFormula("XMATCH(H58,H50:H56, 2, 1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(Grap?,H50:H56, 2, 1)");
		assert.strictEqual(oParser.calculate().getValue(), 2, "Result of XMATCH(Grap?,H50:H56, 2, 1)");

		oParser = new parserFormula("XMATCH(H58,H50:H56, 2, -1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(Grap?,H50:H56, 2, -1)");
		assert.strictEqual(oParser.calculate().getValue(), 7, "Result of XMATCH(Grap?,H50:H56, 2, -1)");

		// ---------------------- array of mixed data ---------------------- //
		ws.getRange2("I50").setValue("FALSE");
		ws.getRange2("I51").setValue("dsgG");
		ws.getRange2("I52").setValue("TRUE");
		ws.getRange2("I53").setValue("12");
		ws.getRange2("I54").setValue();
		ws.getRange2("I55").setValue("#N/A");
		ws.getRange2("I56").setValue("-1212");
		ws.getRange2("I57").setValue("00009");
		ws.getRange2("I58").setValue("b");
		ws.getRange2("I59").setValue("a");

		ws.getRange2("I60").setValue("10");
		ws.getRange2("I61").setValue("7/18/2011 7:45");
		ws.getRange2("I62").setValue("7/18/2011 7:40");
		ws.getRange2("I63").setValue("=TODAY()");
		ws.getRange2("I64").setValue("=1+1");

		oParser = new parserFormula("XMATCH(I61,I50:I64)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(I61,I50:I64)");
		assert.strictEqual(oParser.calculate().getValue(), 12, "Result of XMATCH(I61,I50:I64)");

		oParser = new parserFormula("XMATCH(I62,I50:I61,1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(I62,I50:I61,1)");
		assert.strictEqual(oParser.calculate().getValue(), 12, "Result of XMATCH(I62,I50:I61,1)");

		oParser = new parserFormula("XMATCH(I62,I50:I61,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(I62,I50:I61,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(I62,I50:I61,-1)");

		oParser = new parserFormula("XMATCH(I62,I50:I61,0,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(I62,I50:I61,1)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(I62,I50:I61,1)");

		oParser = new parserFormula("XMATCH(I62,I50:I61,1,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(I62,I50:I61,1)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(I62,I50:I61,1)");

		oParser = new parserFormula("XMATCH(I62,I50:I61,-1,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(I62,I50:I61,1)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(I62,I50:I61,1)");

		oParser = new parserFormula("XMATCH(12,I50:I59)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(12,I50:I59)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(12,I50:I59)");

		oParser = new parserFormula("XMATCH(I52,I50:I59)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(TRUE,I50:I59)");
		assert.strictEqual(oParser.calculate().getValue(), 3, "Result of XMATCH(TRUE,I50:I59)");

		oParser = new parserFormula("XMATCH(I60,I50:I59,1,1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,I50:I59,1,1)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(10,I50:I59,1,1)");

		oParser = new parserFormula("XMATCH(I60,I50:I59,-1,1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,I50:I59,-1,1)");
		assert.strictEqual(oParser.calculate().getValue(), 8, "Result of XMATCH(10,I50:I59,-1,1)");	

		oParser = new parserFormula("XMATCH(I60,I50:I59,1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,I50:I59,1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(10,I50:I59,1,-1)");

		oParser = new parserFormula("XMATCH(I60,I50:I59,-1,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,I50:I59,-1,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 8, "Result of XMATCH(10,I50:I59,-1,-1)");

		oParser = new parserFormula("XMATCH(H61,I50:I59,2,1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH('?',I50:I59,2,1)");
		assert.strictEqual(oParser.calculate().getValue(), 9, "Result of XMATCH('?',I50:I59,2,1)");

		oParser = new parserFormula("XMATCH(H61,I50:I59,2,-1)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH('?',I50:I59,2,-1)");
		assert.strictEqual(oParser.calculate().getValue(), 10, "Result of XMATCH('?',I50:I59,2,-1)");

		oParser = new parserFormula("XMATCH(I60,I50:I59,0,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,I50:I59,0,2)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(10,I50:I59,0,2)");

		oParser = new parserFormula("XMATCH(I60,I50:I59,1,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,I50:I59,1,2)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(10,I50:I59,1,2)");

		oParser = new parserFormula("XMATCH(I60,I50:I59,-1,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,I50:I59,-1,2)");
		assert.strictEqual(oParser.calculate().getValue(), 8, "Result of XMATCH(10,I50:I59,-1,2)");

		oParser = new parserFormula("XMATCH(I60,I50:I59,0,-2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,I50:I59,0,-2)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(10,I50:I59,0,-2)");

		oParser = new parserFormula("XMATCH(I60,I50:I59,1,-2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,I50:I59,1,-2)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(10,I50:I59,1,-2)");

		oParser = new parserFormula("XMATCH(I60,I50:I59,-1,-2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(10,I50:I59,-1,-2)");
		assert.strictEqual(oParser.calculate().getValue(), "#N/A", "Result of XMATCH(10,I50:I59,-1,-2)");

		oParser = new parserFormula("XMATCH(2,{1,2,3})", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(2,{1,2,3})");
		assert.strictEqual(oParser.calculate().getValue(), 2, "Result of XMATCH(2,{1,2,3})");

		oParser = new parserFormula("XMATCH(TRUE,{1,2,TRUE})", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(TRUE,{1,2,TRUE})");
		assert.strictEqual(oParser.calculate().getValue(), 3, "Result of XMATCH(TRUE,{1,2,TRUE})");

		oParser = new parserFormula("XMATCH(\"\",{1,2,TRUE,\"\"})", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(\"\",{1,2,TRUE,\"\"})");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH(\"\",{1,2,TRUE,\"\"})");

		oParser = new parserFormula("XMATCH(\"str\",{1,2,\"str\"})", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(\"str\",{1,2,\"str\"})");
		assert.strictEqual(oParser.calculate().getValue(), 3, "Result of XMATCH(\"str\",{1,2,\"str\"})");

		oParser = new parserFormula("XMATCH(I50,I50,0,0)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(I50,I50,0,0)");
		assert.strictEqual(oParser.calculate().getValue(), "#VALUE!", "Result of XMATCH(I50,I50,0,0)");

		oParser = new parserFormula("XMATCH(I50,I50,0)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(I50,I50,0)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(I50,I50,0)");

		oParser = new parserFormula("XMATCH(I59,\"a\",0)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(I59,\"a\",0)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(I59,\"a\",0)");

		// TODO ms возвращает массив c длиной искомого значения
		oParser = new parserFormula("XMATCH(I50:I55,I50:I59,0)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(I50:I55,I50:I59,0)");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH(I50:I55,I50:I59,0)");

		// TODO ms возвращает массив c длиной искомого значения
		oParser = new parserFormula("XMATCH({12,2,9},I50:I59,0)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH({12,2,9},I50:I59,0)");
		assert.strictEqual(oParser.calculate().getValue(), 4, "Result of XMATCH({12,2,9},I50:I59,0)");

		// TODO ms возвращает массив c длиной искомого значения
		oParser = new parserFormula("XMATCH({2,2,2},{2,2,3,4,5,2})", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH({2,2,2},{2,2,3,4,5,2})");
		assert.strictEqual(oParser.calculate().getValue(), 1, "Result of XMATCH({2,2,2},{2,2,3,4,5,2})");

		oParser = new parserFormula("XMATCH(,I50:I59,-1,2)", "A2", ws);
		assert.ok(oParser.parse(), "Call: XMATCH(,I50:I59,-1,2)");
		assert.strictEqual(oParser.calculate().getValue(), 5, "Result of XMATCH(,I50:I59,-1,2)");

		ws.getRange2("A100:C214").cleanAll();
		// Data for reference link. Use A100-A115
		ws.getRange2("A100").setValue("1");
		ws.getRange2("A101").setValue("2");
		ws.getRange2("A102").setValue("3");
		ws.getRange2("A103").setValue("4");
		ws.getRange2("A104").setValue("5");
		ws.getRange2("A105").setValue("6");
		ws.getRange2("A106").setValue("7");
		ws.getRange2("A107").setValue("10");
		ws.getRange2("A108").setValue("9000");
		ws.getRange2("A109").setValue("10000");

		ws.getRange2("B100").setValue("a");
		ws.getRange2("B101").setValue("b");
		ws.getRange2("B102").setValue("app");
		ws.getRange2("B103").setValue("d");
		ws.getRange2("B104").setValue("e");
		ws.getRange2("B105").setValue("aaa");
		ws.getRange2("B106").setValue("g");
		ws.getRange2("B107").setValue("h");
		ws.getRange2("B108").setValue("i");
		ws.getRange2("B109").setValue("j");
		// Table type. Use A601:L6**
		getTableType(599, 0, 600, 5);
		ws.getRange2("A601").setValue("10"); // Num (Column1)
		ws.getRange2("B601").setValue("10000"); // Num (Column2)
		ws.getRange2("C601").setValue("Text"); // Text (Column3)
		// 3D links. Use A1:Z10
		ws2 = getSecondSheet();
		ws2.getRange2("A1:C10").cleanAll();
		ws2.getRange2("A1").setValue("1");
		ws2.getRange2("A2").setValue("2");
		ws2.getRange2("A3").setValue("Text");
		ws2.getRange2("B1").setValue("3");
		ws2.getRange2("B2").setValue("4");
		ws2.getRange2("C1").setValue("1");
		// DefNames.
		initDefNames();
		ws.getRange2("A201").setValue("-0.5"); // TestName
		ws.getRange2("A202").setValue("0.5"); // TestName1
		ws.getRange2("A203").setValue("10.5"); // TestName2
		ws2.getRange2("A11").setValue("-0.5"); // TestName3D
		ws.getRange2("A208").setValue("0.8"); // TestNameArea2
		ws.getRange2("B208").setValue("-0.8"); // TestNameArea2
		ws2.getRange2("A18").setValue("0.8"); // TestNameArea3D2
		ws2.getRange2("B18").setValue("-0.8"); // TestNameArea3D2


		// Positive cases:
		// Case #1: Number, Area, Number, Number. Exact match, numeric range, match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,A100:A110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,A100:A110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Positive case: Number, Area, Number, Number. Exact match, numeric range, match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #2: Number, Area, Number, Number. Exact or next larger, numeric range, match_mode 1, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(5,A100:A110,1,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(5,A100:A110,1,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 5, 'Test: Positive case: Number, Area, Number, Number. Exact or next larger, numeric range, match_mode 1, search_mode 1. 4 of 4 arguments used.');
		// Case #3: Number, Area, Number, Number. Exact or next smaller, numeric range, match_mode -1, search_mode -1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(15,A100:A110,-1,-1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(15,A100:A110,-1,-1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Positive case: Number, Area, Number, Number. Exact or next smaller, numeric range, match_mode -1, search_mode -1. 4 of 4 arguments used.');
		// Case #4: String, Area, Number, Number. Exact match, text range, match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH("apple",B100:B110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH("apple",B100:B110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: String, Area, Number, Number. Exact match, text range, match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #5: Formula, Area, Number, Number. Lookup_value from formula, exact match, match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(SUM(5,5),A100:A110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(SUM(5,5),A100:A110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Positive case: Formula, Area, Number, Number. Lookup_value from formula, exact match, match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #6: Number, Reference link, Number, Number. Exact match with reference link, match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,A100,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,A100,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Number, Reference link, Number, Number. Exact match with reference link, match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #7: Number, Array, Number, Number. Exact match in numeric array, match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,{10,20,30},0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,{10,20,30},0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Number, Array, Number, Number. Exact match in numeric array, match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #8: Number, Array, Number, Number. Exact or next larger in numeric array, match_mode 1, search_mode 2 (ascending). 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(15,{10,15,20},1,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(15,{10,15,20},1,2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Number, Array, Number, Number. Exact or next larger in numeric array, match_mode 1, search_mode 2 (ascending). 4 of 4 arguments used.');
		// Case #9: Number, Array, Number, Number. Exact or next smaller in numeric array, match_mode -1, search_mode -2 (descending). 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(25,{30,25,20},-1,-2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(25,{30,25,20},-1,-2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: Number, Array, Number, Number. Exact or next smaller in numeric array, match_mode -1, search_mode -2 (descending). 4 of 4 arguments used.');
		// Case #10: String, Array, Number, Number. Exact match in text array, match_mode 0, search_mode 1, case-insensitive. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH("b",{"a","b","c"},0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH("b",{"a","b","c"},0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 2, 'Test: Positive case: String, Array, Number, Number. Exact match in text array, match_mode 0, search_mode 1, case-insensitive. 4 of 4 arguments used.');
		// Case #11: Number, Table, Number, Number. Exact match in table column (numeric), match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,Table1[Column1],0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,Table1[Column1],0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Positive case: Number, Table, Number, Number. Exact match in table column (numeric), match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #12: Date, Area, Number, Number. Exact match with date as serial number, match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(DATE(2025,1,1),A100:A110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(DATE(2025,1,1),A100:A110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Date, Area, Number, Number. Exact match with date as serial number, match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #13: Time, Area, Number, Number. Exact match with time as fraction, match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(TIME(12,0,0),A100:A110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(TIME(12,0,0),A100:A110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Time, Area, Number, Number. Exact match with time as fraction, match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #14: Number, Ref3D, Number, Number. Exact match with 3D reference, match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,Sheet2!A1,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,Sheet2!A1,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Number, Ref3D, Number, Number. Exact match with 3D reference, match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #15: Number, Area3D, Number, Number. Exact match with 3D range, match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,Sheet2!A2:A3,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,Sheet2!A2:A3,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Number, Area3D, Number, Number. Exact match with 3D range, match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #16: Number, Name, Number, Number. Exact match with named range, match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,TestName,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,TestName,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Number, Name, Number, Number. Exact match with named range, match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #17: Number, Name3D, Number, Number. Exact match with 3D named range, match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,TestName3D,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,TestName3D,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Number, Name3D, Number, Number. Exact match with 3D named range, match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #18: String, Area, Number, Number. Wildcard match with text, match_mode 2, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH("app*",B100:B110,2,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH("app*",B100:B110,2,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 3, 'Test: Positive case: String, Area, Number, Number. Wildcard match with text, match_mode 2, search_mode 1. 4 of 4 arguments used.');
		// Case #19: Formula, Area, Number, Number. XMATCH as parent formula with nested ACOSH, exact match, match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(SUM(ACOSH(2),8),A100:A110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(SUM(ACOSH(2),8),A100:A110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: Formula, Area, Number, Number. XMATCH as parent formula with nested ACOSH, exact match, match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #20: String, Area, Number, Number. Case-insensitive text match, match_mode 0, search_mode 1. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH("APPLE",B100:B110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH("APPLE",B100:B110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Positive case: String, Area, Number, Number. Case-insensitive text match, match_mode 0, search_mode 1. 4 of 4 arguments used.');
		// Case #21: Number, Area, Empty, Number. Omitted match_mode (defaults to 0), search_mode 1. 3 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,A100:A110,,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,A100:A110,,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Positive case: Number, Area, Empty, Number. Omitted match_mode (defaults to 0), search_mode 1. 3 of 4 arguments used.');
		// Case #22: Number, Area, Number, Empty. Omitted search_mode (defaults to 1), match_mode 0. 3 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,A100:A110,0,)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,A100:A110,0,) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Positive case: Number, Area, Number, Empty. Omitted search_mode (defaults to 1), match_mode 0. 3 of 4 arguments used.');

		// Negative cases:
		// Case #1: Number, Area, Number, Number. Lookup_value not in array, returns #N/A. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(99,A100:A110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(99,A100:A110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Area, Number, Number. Lookup_value not in array, returns #N/A. 4 of 4 arguments used.');
		// Case #2: Empty, Area, Number, Number. Empty lookup_value, returns #VALUE!. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(,A100:A110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(,A100:A110,0,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 11, 'Test: Negative case: Empty, Area, Number, Number. Empty lookup_value, returns #VALUE!. 4 of 4 arguments used.');
		// Case #3: Error, Area, Number, Number. Error lookup_value propagates #N/A. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(NA(),A100:A110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(NA(),A100:A110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Error, Area, Number, Number. Error lookup_value propagates #N/A. 4 of 4 arguments used.');
		// Case #4: Number, Area, Boolean, Number. Boolean match_mode, returns #N/A. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,A100:A110,TRUE,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,A100:A110,TRUE,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Negative case: Number, Area, Boolean, Number. Boolean match_mode, returns #N/A. 4 of 4 arguments used.');
		// Case #5: Number, Empty, Number, Number. Empty lookup_array, returns #N/A. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Empty, Number, Number. Empty lookup_array, returns #N/A. 4 of 4 arguments used.');
		// Case #6: Number, Area, Number, Number. Non-ascending text array with match_mode 1, search_mode 2, returns #N/A. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,B100:B110,1,2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,B100:B110,1,2) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Negative case: Number, Area, Number, Number. Non-ascending text array with match_mode 1, search_mode 2, returns #N/A. 4 of 4 arguments used.');
		// Case #7: Number, Area, Number, Number. Non-descending text array with match_mode -1, search_mode -2, returns #N/A. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,B100:B110,-1,-2)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,B100:B110,-1,-2) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Area, Number, Number. Non-descending text array with match_mode -1, search_mode -2, returns #N/A. 4 of 4 arguments used.');
		// Case #8: String, Area, Number, Number. String not in array, returns #N/A. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH("xyz",B100:B110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH("xyz",B100:B110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: String, Area, Number, Number. String not in array, returns #N/A. 4 of 4 arguments used.');
		// Case #9: Number, Area, String, Number. Non-numeric string match_mode, returns #VALUE!. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,A100:A110,"abc",1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,A100:A110,"abc",1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#VALUE!', 'Test: Negative case: Number, Area, String, Number. Non-numeric string match_mode, returns #VALUE!. 4 of 4 arguments used.');
		// Case #10: Boolean, Area, Number, Number. Boolean lookup_value not in array, returns #N/A. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(FALSE,A100:A110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(FALSE,A100:A110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Boolean, Area, Number, Number. Boolean lookup_value not in array, returns #N/A. 4 of 4 arguments used.');
		// Case #11: Number, Area, Number, Number. Invalid match_mode (3), returns #N/A. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,A100:A110,3,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,A100:A110,3,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), 8, 'Test: Negative case: Number, Area, Number, Number. Invalid match_mode (3), returns #N/A. 4 of 4 arguments used.');
		// Case #12: Number, Ref3D, Number, Number. Ref3D to text data, returns #VALUE!. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,Sheet2!A4,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,Sheet2!A4,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Ref3D, Number, Number. Ref3D to text data, returns #VALUE!. 4 of 4 arguments used.');
		// Case #13: Number, Name, Number, Number. Named range with text, returns #VALUE!. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,TestNameArea2,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,TestNameArea2,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Name, Number, Number. Named range with text, returns #VALUE!. 4 of 4 arguments used.');
		// Case #14: Number, Name3D, Number, Number. 3D named range with text, returns #VALUE!. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,TestNameArea3D2,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,TestNameArea3D2,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Name3D, Number, Number. 3D named range with text, returns #VALUE!. 4 of 4 arguments used.');
		// Case #15: Number, Table, Number, Number. Table column with text, returns #VALUE!. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,Table1[Column2],0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,Table1[Column2],0,1) is parsed.');
		//? assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Table, Number, Number. Table column with text, returns #VALUE!. 4 of 4 arguments used.');
		// Case #16: Array, Area, Number, Number. Array with boolean lookup_value, returns #N/A. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH({TRUE},A100:A110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH({TRUE},A100:A110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Array, Area, Number, Number. Array with boolean lookup_value, returns #N/A. 4 of 4 arguments used.');
		// Case #17: Number, Area3D, Number, Number. 3D range with text data, returns #VALUE!. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(10,Sheet2!A5:A6,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(10,Sheet2!A5:A6,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: Number, Area3D, Number, Number. 3D range with text data, returns #VALUE!. 4 of 4 arguments used.');
		// Case #18: Formula, Area, Number, Number. Formula resulting in #NUM!, propagates error. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH(SQRT(-1),A100:A110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(SQRT(-1),A100:A110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#NUM!', 'Test: Negative case: Formula, Area, Number, Number. Formula resulting in #NUM!, propagates error. 4 of 4 arguments used.');
		// Case #19: String, Area, Number, Number. Empty string lookup_value, returns #VALUE!. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH("",B100:B110,0,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH("",B100:B110,0,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: String, Area, Number, Number. Empty string lookup_value, returns #VALUE!. 4 of 4 arguments used.');
		// Case #20: String, Area, Number, Number. Wildcard with no match, returns #N/A. 4 of 4 arguments used.
		oParser = new parserFormula('XMATCH("app?",B100:B110,2,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH("app?",B100:B110,2,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Negative case: String, Area, Number, Number. Wildcard with no match, returns #N/A. 4 of 4 arguments used.');

		// Bounded cases:
		// Case #1: Number, Area, Number. Minimum valid lookup_value, exact match. 3 of 3 arguments used.
		oParser = new parserFormula('XMATCH(-9.99999999999999E+307,A100:A110,1)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(-9.99999999999999E+307,A100:A110,1) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), 1, 'Test: Bounded case: Number, Area, Number. Minimum valid lookup_value, exact match. 3 of 3 arguments used.');
		// Case #2: Number, Area, Number. Maximum valid Excel number, exact match. 3 of 3 arguments used.
		oParser = new parserFormula('XMATCH(9.99999999999999E+307,A100:A110,0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(9.99999999999999E+307,A100:A110,0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Bounded case: Number, Area, Number. Maximum valid Excel number, exact match. 3 of 3 arguments used.');
		// Case #3: Number, Area, Number. Smallest positive number, exact match, match_type 0. 3 arguments used.
		oParser = new parserFormula('XMATCH(1E-307, A100:A110, 0)', 'A2', ws);
		assert.ok(oParser.parse(), 'Test: XMATCH(1E-307, A100:A110, 0) is parsed.');
		assert.strictEqual(oParser.calculate().getValue(), '#N/A', 'Test: Bounded case: Number, Area, Number. Smallest positive number, exact match, match_type 0. 3 arguments used.');

		// Need to fix: binary mode, error types diff, ms result diff
		// Case #22: Number, Area, Number, Empty. Omitted search_mode (defaults to 1), match_mode 0. 3 of 4 arguments used.
		// Case #6: Number, Area, Number, Number. Non-ascending text array with match_mode 1, search_mode 2, returns #N/A. 4 of 4 arguments used.
		// Case #11: Number, Area, Number, Number. Invalid match_mode (3), returns #N/A. 4 of 4 arguments used.
		// Case #15: Number, Table, Number, Number. Table column with text, returns #VALUE!. 4 of 4 arguments used.


	});

	wb.dependencyFormulas.unlockRecal();
});
